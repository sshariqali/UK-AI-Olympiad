define("discourse/plugins/discourse-ai/discourse/admin-discourse-ai-plugin-route-map",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"admin.adminPlugins.show",path:"/plugins",map(){this.route("discourse-ai-personas",{path:"ai-personas"},function(){this.route("new"),this.route("edit",{path:"/:id/edit"})}),this.route("discourse-ai-llms",{path:"ai-llms"},function(){this.route("new"),this.route("edit",{path:"/:id/edit"})}),this.route("discourse-ai-secrets",{path:"ai-secrets"},function(){this.route("new"),this.route("edit",{path:"/:id/edit"})}),this.route("discourse-ai-tools",{path:"ai-tools"},function(){this.route("new"),this.route("edit",{path:"/:id/edit"})}),this.route("discourse-ai-spam",{path:"ai-spam"}),this.route("discourse-ai-translations",{path:"ai-translations"}),this.route("discourse-ai-usage",{path:"ai-usage"}),this.route("discourse-ai-embeddings",{path:"ai-embeddings"},function(){this.route("new"),this.route("edit",{path:"/:id/edit"})}),this.route("discourse-ai-features",{path:"ai-features"},function(){this.route("edit",{path:"/:id/edit"})})}}}),define("discourse/plugins/discourse-ai/discourse/admin-discourse-ai-route-map",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"admin.dashboard",path:"/dashboard",map(){this.route("admin.dashboardSentiment",{path:"/dashboard/sentiment",resetNamespace:!0})}}}),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-embedding",["exports","discourse/adapters/rest"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-embedding"}}e.default=s}),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-feature",["exports","discourse/adapters/rest"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-feature"}}e.default=s}),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-llm",["exports","discourse/adapters/rest"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-llm"}}e.default=s}),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-persona",["exports","discourse/adapters/rest"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-persona"}}e.default=s}),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-secret",["exports","discourse/adapters/rest"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-secret"}}e.default=s}),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-tool",["exports","discourse/adapters/rest"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-tool"}}e.default=s}),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-embedding",["exports","discourse/lib/ajax","discourse/models/rest"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{createProperties(){return this.getProperties("id","display_name","dimensions","provider","tokenizer_class","dimensions","url","ai_secret_id","max_sequence_length","provider_params","pg_function","embed_prompt","search_prompt","matryoshka_dimensions")}updateProperties(){const e=this.createProperties()
return e.id=this.id,e}async testConfig(){return await(0,t.ajax)("/admin/plugins/discourse-ai/ai-embeddings/test.json",{data:{ai_embedding:this.createProperties()}})}workingCopy(){const e=this.createProperties()
return this.store.createRecord("ai-embedding",e)}}e.default=i}),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-feature",["exports","discourse/models/rest"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{createProperties(){return this.getProperties("id","module","global_enabled","features")}}e.default=s}),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-llm",["exports","discourse/lib/ajax","discourse/models/rest"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{createProperties(){return this.getProperties("id","display_name","name","provider","tokenizer","max_prompt_tokens","max_output_tokens","url","ai_secret_id","provider_params","vision_enabled","input_cost","cached_input_cost","cache_write_cost","output_cost","allowed_attachment_types")}updateProperties(){const e=this.createProperties()
return e.id=this.id,e.llm_quotas=this.llm_quotas,e}async testConfig(e){return await(0,t.ajax)("/admin/plugins/discourse-ai/ai-llms/test.json",{data:{ai_llm:e??this.createProperties()}})}}e.default=i}),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-persona",["exports","discourse/lib/ajax","discourse/models/rest","discourse/plugins/discourse-ai/discourse/lib/utilities"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o=["id","name","description","tools","system_prompt","allowed_group_ids","enabled","system","priority","top_p","temperature","user_id","default_llm_id","force_default_llm","user","max_context_posts","vision_enabled","vision_max_pixels","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens","rag_conversation_chunks","rag_llm_model_id","question_consolidator_llm_id","allow_chat","show_thinking","forced_tool_count","allow_personal_messages","allow_topic_mentions","allow_chat_channel_mentions","allow_chat_direct_messages","response_format","examples"],n=["id","allowed_group_ids","enabled","system","priority","tools","user_id","default_llm_id","force_default_llm","user","max_context_posts","vision_enabled","vision_max_pixels","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens","rag_conversation_chunks","rag_llm_model_id","question_consolidator_llm_id","show_thinking","allow_personal_messages","allow_topic_mentions","allow_chat_channel_mentions","allow_chat_direct_messages"]
class a extends s.default{async createUser(){const e=await(0,t.ajax)(`/admin/plugins/discourse-ai/ai-personas/${this.id}/create-user.json`,{type:"POST"})
return this.user=e.user,this.user_id=this.user.id,this.user}flattenedToolStructure(e){return(e.tools||[]).map(t=>[t,e.toolOptions[t]||{},e.forcedTools.includes(t)])}populateTools(e){const t=[],s={},i=e.tools?.map(e=>{if("string"==typeof e)return e
{let[i,o,n]=e
const a={}
for(const e in o)o.hasOwnProperty(e)&&(a[e]=o[e])
return Object.keys(a).length>0&&(s[i]=a),n&&t.push(i),i}})
e.tools=i,e.forcedTools=t,e.toolOptions=s}updateProperties(){const e=this.system?this.getProperties(n):this.getProperties(o)
return e.id=this.id,e}createProperties(){return this.getProperties(o)}fromPOJO(e){const t=(0,i.toPlainObject)(e),s=a.create(t)
return s.tools=this.flattenedToolStructure(t),s}toPOJO(){const e=this.getProperties(o)
return this.populateTools(e),e.forced_tool_count=this.forced_tool_count||-1,e.response_format=e.response_format||[],e.examples=e.examples||[],e.rag_uploads?.length>0&&(e.rag_uploads=(0,i.toPlainObject)(e.rag_uploads)),e}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-secret",["exports","discourse/models/rest"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{createProperties(){return this.getProperties("id","name","secret")}updateProperties(){const e=this.createProperties()
return e.id=this.id,e}}e.default=s}),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-tool",["exports","@ember-compat/tracked-built-ins","discourse/models/rest"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const i=["id","name","tool_name","description","parameters","script","summary","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens","rag_llm_model_id","enabled"]
class o extends s.default{createProperties(){return this.getProperties(i)}updateProperties(){return this.getProperties(i)}trackParameters(e){return new t.TrackedArray(e?.map(e=>{const s=new t.TrackedObject(e)
return s.enum&&s.enum.length?s.enum=new t.TrackedArray(s.enum):s.enum=null,s}))}workingCopy(){const e=this.getProperties(i)
return e.parameters=this.trackParameters(e.parameters),this.store.createRecord("ai-tool",e)}}e.default=o}),define("discourse/plugins/discourse-ai/discourse/components/admin-report-emotion",["exports","@ember/component","@ember-decorators/component","discourse/helpers/d-icon","discourse/helpers/number","discourse/lib/get-url","@ember/template-factory"],function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const r=dt7948.c(class extends t.default{get todayLink(){let e=moment().format("YYYY-MM-DD")
return this._filterURL(e)}get yesterdayLink(){let e=moment().subtract(1,"day").format("YYYY-MM-DD")
return this._filterURL(e)}get lastSevenDaysLink(){let e=moment().subtract(1,"week").format("YYYY-MM-DD")
return this._filterURL(e)}get lastThirtyDaysLink(){let e=moment().subtract(1,"month").format("YYYY-MM-DD")
return this._filterURL(e)}_baseFilter(){return"/filter?q=activity-after%3A"}_model(){return"%20order%3A"+this.model.type}_filterURL(e){return(0,n.default)(`${this._baseFilter()}${e}${this._model()}`)}static{(0,t.setComponentTemplate)((0,a.createTemplateFactory)({id:"4qS6RFir",block:'[[[11,0],[16,"title",[30,0,["model","description"]]],[24,0,"admin-report-counters"],[17,1],[12],[1,"\\n  "],[10,0],[14,0,"cell title"],[12],[1,"\\n"],[41,[30,0,["model","icon"]],[[[1,"      "],[1,[28,[32,0],[[30,0,["model","icon"]]],null]],[1,"\\n"]],[]],null],[1,"    "],[1,[30,0,["model","title"]]],[1,"\\n  "],[13],[1,"\\n\\n  "],[10,0],[14,0,"cell value today-count"],[12],[1,"\\n    "],[10,3],[15,6,[30,0,["todayLink"]]],[12],[1,"\\n      "],[1,[28,[32,1],[[30,0,["model","todayCount"]]],null]],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n\\n  "],[10,0],[15,0,[29,["cell value yesterday-count ",[30,0,["model","yesterdayTrend"]]]]],[15,"title",[30,0,["model","yesterdayCountTitle"]]],[12],[1,"\\n    "],[10,3],[15,6,[30,0,["yesterdayLink"]]],[12],[1,"\\n      "],[1,[28,[32,1],[[30,0,["model","yesterdayCount"]]],null]],[1,"\\n    "],[13],[1,"\\n    "],[1,[28,[32,0],[[30,0,["model","yesterdayTrendIcon"]]],null]],[1,"\\n  "],[13],[1,"\\n\\n  "],[10,0],[15,0,[29,["cell value sevendays-count ",[30,0,["model","sevenDaysTrend"]]]]],[15,"title",[30,0,["model","sevenDaysCountTitle"]]],[12],[1,"\\n    "],[10,3],[15,6,[30,0,["lastSevenDaysLink"]]],[12],[1,"\\n      "],[1,[28,[32,1],[[30,0,["model","lastSevenDaysCount"]]],null]],[1,"\\n    "],[13],[1,"\\n    "],[1,[28,[32,0],[[30,0,["model","sevenDaysTrendIcon"]]],null]],[1,"\\n  "],[13],[1,"\\n\\n  "],[10,0],[15,0,[29,["cell value thirty-days-count ",[30,0,["model","thirtyDaysTrend"]]]]],[15,"title",[30,0,["model","thirtyDaysCountTitle"]]],[12],[1,"\\n\\n    "],[10,3],[15,6,[30,0,["lastThirtyDaysLink"]]],[12],[1,"\\n      "],[1,[28,[32,1],[[30,0,["model","lastThirtyDaysCount"]]],null]],[1,"\\n    "],[13],[1,"\\n"],[41,[30,0,["model","canDisplayTrendIcon"]],[[[1,"      "],[1,[28,[32,0],[[30,0,["model","thirtyDaysTrendIcon"]]],null]],[1,"\\n"]],[]],null],[1,"  "],[13],[1,"\\n"],[13]],["&attrs"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/admin-report-emotion.js",scope:()=>[i.default,o.default],isStrictMode:!0}),this)}},[(0,s.tagName)("")])
e.default=r}),define("discourse/plugins/discourse-ai/discourse/components/admin-report-sentiment-analysis",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","@ember-compat/tracked-built-ins","ember-modifier","discourse/components/d-button","discourse/components/horizontal-overflow-nav","discourse/components/post-list","discourse/float-kit/components/d-tooltip","discourse/helpers/body-class","discourse/helpers/category-badge","discourse/helpers/d-icon","discourse/helpers/replace-emoji","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/get-url","discourse/lib/later","discourse/lib/utilities","discourse/models/category","discourse/models/post","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/doughnut-chart","discourse/plugins/discourse-ai/discourse/components/ai-sentiment-horizontal-bar","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x,k,T,C,P,M,j,A){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class L extends t.default{static{dt7948.g(this.prototype,"router",[r.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"selectedChart",[s.tracked],function(){return null})}#t=void dt7948.i(this,"selectedChart")
static{dt7948.g(this.prototype,"posts",[s.tracked],function(){return[]})}#s=void dt7948.i(this,"posts")
static{dt7948.g(this.prototype,"hasMorePosts",[s.tracked],function(){return!1})}#i=void dt7948.i(this,"hasMorePosts")
static{dt7948.g(this.prototype,"nextOffset",[s.tracked],function(){return 0})}#o=void dt7948.i(this,"nextOffset")
static{dt7948.g(this.prototype,"showingSelectedChart",[s.tracked],function(){return!1})}#n=void dt7948.i(this,"showingSelectedChart")
static{dt7948.g(this.prototype,"activeFilter",[s.tracked],function(){return"all"})}#a=void dt7948.i(this,"activeFilter")
static{dt7948.g(this.prototype,"shareIcon",[s.tracked],function(){return"link"})}#r=void dt7948.i(this,"shareIcon")
setActiveFilter=(0,d.modifier)(e=>{this.clearActiveFilters(e),e.querySelector(`li[data-filter-type="${this.activeFilter}"] button`).classList.add("active")})
clearActiveFilters(e){const t=e.querySelectorAll("li button")
for(let s of t)s.classList.remove("active")}calculateNeutralScore(e){return e.total_count-(e.positive_count+e.negative_count)}sentimentMapping(e){switch(e){case"positive":return{id:"positive",text:(0,C.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.positive"),icon:"face-smile"}
case"neutral":return{id:"neutral",text:(0,C.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.neutral"),icon:"face-meh"}
case"negative":return{id:"negative",text:(0,C.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.negative"),icon:"face-angry"}}}get groupingType(){const e="discourse_ai.sentiments.sentiment_analysis.group_types"
return this.args.model.data[0].category_name?(0,C.i18n)(`${e}.category`):(0,C.i18n)(`${e}.tag`)}get colors(){return["#2ecc71","#95a5a6","#e74c3c"]}get currentGroupFilter(){return this.args.model.available_filters.find(e=>"group_by"===e.id).default}get currentSortFilter(){return this.args.model.available_filters.find(e=>"sort_by"===e.id).default}get transformedData(){return this.args.model.data.map(e=>({category:x.default.findById(e.category_id),title:e.category_name||e.tag_name,scores:[e.positive_count,this.calculateNeutralScore(e),e.negative_count],score_map:{positive:e.positive_count,neutral:this.calculateNeutralScore(e),negative:e.negative_count},total_score:e.total_count,widths:{positive:e.positive_count/e.total_count*100,neutral:this.calculateNeutralScore(e)/e.total_count*100,negative:e.negative_count/e.total_count*100}}))}get filteredPosts(){let e
return e=this.posts&&this.posts.length?this.posts.filter(e=>(e.topic_title=(0,f.default)(e.topic_title),e.category=x.default.findById(e.category_id),"all"===this.activeFilter||e.sentiment===this.activeFilter)):[],new l.TrackedArray(e)}get postFilters(){return[{id:"all",text:`${(0,C.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.all")} (${this.selectedChart.total_score})`,icon:"bars-staggered",action:()=>{this.activeFilter="all"}},{id:"positive",text:`${(0,C.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.positive")} (${this.selectedChart.scores[0]})`,icon:"face-smile",action:()=>{this.activeFilter="positive"}},{id:"neutral",text:`${(0,C.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.neutral")} (${this.selectedChart.scores[1]})`,icon:"face-meh",action:()=>{this.activeFilter="neutral"}},{id:"negative",text:`${(0,C.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.negative")} (${this.selectedChart.scores[2]})`,icon:"face-angry",action:()=>{this.activeFilter="negative"}}]}async postRequest(){return await(0,b.ajax)("/discourse-ai/sentiment/posts",{data:{group_by:this.currentGroupFilter,group_value:this.selectedChart?.title,start_date:this.args.model.start_date,end_date:this.args.model.end_date,offset:this.nextOffset}})}async openToChart(){const e=this.router.currentRoute.queryParams
if(e.selectedChart){if(this.selectedChart=this.transformedData.find(t=>t.title===e.selectedChart),!this.selectedChart)return
this.showingSelectedChart=!0
try{const e=await this.postRequest()
this.posts=e.posts.map(e=>k.default.create(e)),this.hasMorePosts=e.has_more,this.nextOffset=e.next_offset}catch(t){(0,y.popupAjaxError)(t)}}}static{dt7948.n(this.prototype,"openToChart",[n.action])}async showDetails(e){if(this.selectedChart===e)return
const t=this.router.currentRoute.queryParams,s=t?.filters?JSON.parse(t.filters):{}
this.router.transitionTo(this.router.currentRoute.name,{queryParams:{...t,filters:s,selectedChart:e.title}}),this.selectedChart=e,this.showingSelectedChart=!0
try{const e=await this.postRequest()
this.posts=e.posts.map(e=>k.default.create(e)),this.hasMorePosts=e.has_more,this.nextOffset=e.next_offset}catch(i){(0,y.popupAjaxError)(i)}}static{dt7948.n(this.prototype,"showDetails",[n.action])}async fetchMorePosts(){if(!this.hasMorePosts||null===this.selectedChart)return[]
try{const e=await this.postRequest()
this.hasMorePosts=e.has_more,this.nextOffset=e.next_offset
const t=e.posts.map(e=>k.default.create(e))
return this.posts.push(t),t}catch(e){(0,y.popupAjaxError)(e)}}static{dt7948.n(this.prototype,"fetchMorePosts",[n.action])}backToAllCharts(){this.showingSelectedChart=!1,this.selectedChart=null,this.activeFilter="all",this.posts=[]
const e=this.router.currentRoute.queryParams,t=e?.filters?JSON.parse(e.filters):{}
this.router.transitionTo(this.router.currentRoute.name,{queryParams:{...e,filters:t,selectedChart:null}})}static{dt7948.n(this.prototype,"backToAllCharts",[n.action])}shareChart(){const e=this.router.currentURL
e&&((0,S.clipboardCopy)((0,v.getAbsoluteURL)(e)),this.shareIcon="check",(0,w.default)(()=>{this.shareIcon="link"},2e3))}static{dt7948.n(this.prototype,"shareChart",[n.action])}static{(0,j.setComponentTemplate)((0,A.createTemplateFactory)({id:"9cnc8qCf",block:'[[[11,1],[4,[32,0],[[30,0,["openToChart"]]],null],[12],[13],[1,"\\n\\n"],[41,[51,[30,0,["showingSelectedChart"]]],[[[1,"  "],[10,0],[14,0,"admin-report-sentiment-analysis"],[12],[1,"\\n    "],[10,"table"],[14,0,"sentiment-analysis-table md-table"],[12],[1,"\\n      "],[10,"thead"],[12],[1,"\\n        "],[10,"th"],[12],[1,[30,0,["groupingType"]]],[13],[1,"\\n        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.sentiments.sentiment_analysis.table.total_count"],null]],[13],[1,"\\n        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.sentiments.sentiment_analysis.table.sentiment"],null]],[13],[1,"\\n      "],[13],[1,"\\n\\n      "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["transformedData"]]],null]],null],null,[[[1,"          "],[11,"tr"],[24,0,"sentiment-analysis-table__row"],[24,"role","button"],[4,[32,2],["click",[28,[32,3],[[30,0,["showDetails"]],[30,1]],null]],null],[12],[1,"\\n            "],[10,"td"],[14,0,"sentiment-analysis-table__title"],[12],[1,"\\n"],[41,[30,1,["category"]],[[[1,"                "],[1,[28,[32,4],[[30,1,["category"]]],null]],[1,"\\n"]],[]],[[[1,"                "],[1,[30,1,["title"]]],[1,"\\n"]],[]]],[1,"            "],[13],[1,"\\n            "],[10,"td"],[14,0,"sentiment-analysis-table__total-score"],[12],[1,[30,1,["total_score"]]],[13],[1,"\\n            "],[10,"td"],[14,0,"sentiment-horizontal-bar"],[12],[1,"\\n              "],[8,[32,5],null,[["@type","@score","@width"],["positive",[30,1,["score_map","positive"]],[30,1,["widths","positive"]]]],null],[1,"\\n              "],[8,[32,5],null,[["@type","@score","@width"],["negative",[30,1,["score_map","negative"]],[30,1,["widths","negative"]]]],null],[1,"\\n              "],[8,[32,5],null,[["@type","@score","@width"],["neutral",[30,1,["score_map","neutral"]],[30,1,["widths","neutral"]]]],null],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[1]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,6],[[30,0,["selectedChart"]],[30,0,["showingSelectedChart"]]],null],[[[1,"  "],[1,[28,[32,7],["showing-sentiment-analysis-chart"],null]],[1,"\\n  "],[10,0],[14,0,"admin-report-sentiment-analysis__selected-chart"],[12],[1,"\\n    "],[10,0],[14,0,"admin-report-sentiment-analysis__selected-chart-actions"],[12],[1,"\\n      "],[8,[32,8],[[24,0,"btn-flat"]],[["@label","@icon","@action"],["back_button","chevron-left",[30,0,["backToAllCharts"]]]],null],[1,"\\n\\n      "],[8,[32,9],[[24,0,"share btn-flat"],[4,[32,2],["click",[30,0,["shareChart"]]],null]],[["@icon","@content"],[[30,0,["shareIcon"]],[28,[32,1],["discourse_ai.sentiments.sentiment_analysis.share_chart"],null]]],null],[1,"\\n    "],[13],[1,"\\n\\n    "],[8,[32,10],null,[["@labels","@colors","@data","@totalScore","@doughnutTitle","@displayLegend"],[[30,2,["labels"]],[30,0,["colors"]],[30,0,["selectedChart","scores"]],[30,0,["selectedChart","total_score"]],[30,0,["selectedChart","title"]],true]],null],[1,"\\n\\n  "],[13],[1,"\\n  "],[10,0],[14,0,"admin-report-sentiment-analysis-details"],[12],[1,"\\n    "],[8,[32,11],[[24,0,"admin-report-sentiment-analysis-details__filters"],[4,[30,0,["setActiveFilter"]],null,null]],null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["postFilters"]]],null]],null],null,[[[1,"        "],[10,"li"],[15,"data-filter-type",[30,3,["id"]]],[12],[1,"\\n          "],[8,[32,8],[[24,0,"btn-transparent"]],[["@icon","@translatedLabel","@action"],[[30,3,["icon"]],[30,3,["text"]],[30,3,["action"]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[3]],null],[1,"    "]],[]]]]],[1,"\\n\\n    "],[8,[32,12],[[24,0,"admin-report-sentiment-analysis-details__post-list"]],[["@posts","@urlPath","@idPath","@titlePath","@usernamePath","@fetchMorePosts"],[[30,0,["filteredPosts"]],"url","post_id","topic_title","username",[30,0,["fetchMorePosts"]]]],[["abovePostItemExcerpt"],[[[[1,"\\n"],[44,[[28,[30,0,["sentimentMapping"]],[[30,4,["sentiment"]]],null]],[[[1,"          "],[10,1],[14,0,"admin-report-sentiment-analysis-details__post-score"],[15,"data-sentiment-score",[30,5,["id"]]],[12],[1,"\\n            "],[1,[28,[32,13],[[30,5,["icon"]]],null]],[1,"\\n            "],[1,[30,5,["text"]]],[1,"\\n          "],[13],[1,"\\n"]],[5]]],[1,"      "]],[4]]]]],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],["data","@model","filter","post","sentiment"],["unless","each","-track-array","if","let"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/admin-report-sentiment-analysis.js",scope:()=>[a.default,C.i18n,o.on,i.fn,g.default,M.default,T.and,h.default,u.default,m.default,P.default,c.default,p.default,_.default],isStrictMode:!0}),this)}}e.default=L}),define("discourse/plugins/discourse-ai/discourse/components/ai-artifact",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","@ember/template","discourse/components/d-button","discourse/helpers/html-class","discourse/lib/get-url","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class p extends t.default{static{dt7948.g(this.prototype,"siteSettings",[n.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"expanded",[s.tracked],function(){return!1})}#d=void dt7948.i(this,"expanded")
static{dt7948.g(this.prototype,"showingArtifact",[s.tracked],function(){return!1})}#u=void dt7948.i(this,"showingArtifact")
constructor(){super(...arguments),this.keydownHandler=this.handleKeydown.bind(this),this.popStateHandler=this.handlePopState.bind(this),window.addEventListener("popstate",this.popStateHandler)}willDestroy(){super.willDestroy(...arguments),window.removeEventListener("keydown",this.keydownHandler),window.removeEventListener("popstate",this.popStateHandler)}handleKeydown(e){"Escape"!==e.key&&"Esc"!==e.key||history.back()}static{dt7948.n(this.prototype,"handleKeydown",[i.action])}handlePopState(e){const t=e.state
this.expanded=t?.artifactId===this.args.artifactId,this.expanded||window.removeEventListener("keydown",this.keydownHandler)}static{dt7948.n(this.prototype,"handlePopState",[i.action])}get requireClickToRun(){if(this.showingArtifact)return!1
if("strict"===this.siteSettings.ai_artifact_security)return!0
if("hybrid"===this.siteSettings.ai_artifact_security){return!("true"===this.args.autorun||!0===this.args.autorun||"1"===this.args.autorun)}return"lax"!==this.siteSettings.ai_artifact_security}get artifactUrl(){let e=(0,d.default)(`/discourse-ai/ai-bot/artifacts/${this.args.artifactId}`)
return this.args.artifactVersion&&(e=`${e}/${this.args.artifactVersion}`),e}showArtifact(){this.showingArtifact=!0}static{dt7948.n(this.prototype,"showArtifact",[i.action])}toggleView(){this.expanded?history.back():(window.history.pushState({artifactId:this.args.artifactId},"",window.location.href+"#artifact-fullscreen"),window.addEventListener("keydown",this.keydownHandler)),this.expanded=!this.expanded}static{dt7948.n(this.prototype,"toggleView",[i.action])}get wrapperClasses(){return`ai-artifact__wrapper ${this.expanded?"ai-artifact__expanded":""} ${this.seamless?"ai-artifact__seamless":""}`}setDataAttributes(e){this.args.dataAttributes&&Object.entries(this.args.dataAttributes).forEach(([t,s])=>{e.setAttribute(t,s)})}static{dt7948.n(this.prototype,"setDataAttributes",[i.action])}get heightStyle(){if(this.args.artifactHeight){let e=parseInt(this.args.artifactHeight,10)
return(isNaN(e)||e<=0)&&(e=500),e>2e3&&(e=2e3),(0,a.htmlSafe)(`height: ${e}px;`)}}get seamless(){return"true"===this.args.seamless||!0===this.args.seamless||"1"===this.args.seamless}get showFooter(){return!this.seamless&&!this.requireClickToRun}static{(0,u.setComponentTemplate)((0,c.createTemplateFactory)({id:"y+hC3soH",block:'[[[41,[30,0,["expanded"]],[[[1,"  "],[1,[28,[32,0],["ai-artifact-expanded"],null]],[1,"\\n"]],[]],null],[10,0],[15,0,[30,0,["wrapperClasses"]]],[15,5,[30,0,["heightStyle"]]],[12],[1,"\\n  "],[10,0],[14,0,"ai-artifact__panel--wrapper"],[12],[1,"\\n    "],[10,0],[14,0,"ai-artifact__panel"],[12],[1,"\\n      "],[8,[32,1],[[24,0,"btn-flat btn-icon-text"]],[["@icon","@label","@action"],["discourse-compress","discourse_ai.ai_artifact.collapse_view_label",[30,0,["toggleView"]]]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"],[41,[30,0,["requireClickToRun"]],[[[1,"    "],[10,0],[14,0,"ai-artifact__click-to-run"],[12],[1,"\\n      "],[8,[32,1],[[24,0,"btn btn-primary"]],[["@icon","@label","@action"],["play","discourse_ai.ai_artifact.click_to_run_label",[30,0,["showArtifact"]]]],null],[1,"\\n    "],[13],[1,"\\n"]],[]],[[[1,"    "],[11,"iframe"],[24,"title","AI Artifact"],[16,"src",[30,0,["artifactUrl"]]],[24,"width","100%"],[24,"frameborder","0"],[4,[32,2],[[30,0,["setDataAttributes"]]],null],[12],[13],[1,"\\n"]],[]]],[41,[30,0,["showFooter"]],[[[1,"    "],[10,0],[14,0,"ai-artifact__footer"],[12],[1,"\\n      "],[8,[32,1],[[24,0,"btn-transparent btn-icon-text ai-artifact__expand-button"]],[["@icon","@label","@action"],["discourse-expand","discourse_ai.ai_artifact.expand_view_label",[30,0,["toggleView"]]]],null],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[13]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-artifact.js",scope:()=>[l.default,r.default,o.default],isStrictMode:!0}),this)}}e.default=p}),define("discourse/plugins/discourse-ai/discourse/components/ai-blinking-animation",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/runloop","discourse/helpers/concat-class","discourse/lib/later","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m{static{dt7948.g(this.prototype,"show",[s.tracked],function(){return!1})}#c=void dt7948.i(this,"show")
static{dt7948.g(this.prototype,"shown",[s.tracked],function(){return!1})}#p=void dt7948.i(this,"shown")
static{dt7948.g(this.prototype,"blinking",[s.tracked],function(){return!1})}#m=void dt7948.i(this,"blinking")
constructor(e={}){this.show=e.show??!1,this.shown=e.shown??!1}}class h extends t.default{blocks=[...Array.from({length:20},()=>new m)]
#h
#g
#_
setupAnimation(){this.blocks[0].show=!0,this.blocks[0].shown=!0}static{dt7948.n(this.prototype,"setupAnimation",[o.action])}onBlinking(e){e.blinking&&(e.show=!1,this.#h=(0,u.default)(this,()=>{this.#f(e).blinking=!0},250),this.#g=(0,u.default)(this,()=>{e.blinking=!1},500))}static{dt7948.n(this.prototype,"onBlinking",[o.action])}onShowing(e){e.show&&(this.#_=(0,u.default)(this,()=>{this.#f(e).show=!0,this.#f(e).shown=!0,this.blocks.at(-1)===e&&(this.blocks[0].blinking=!0)},250))}static{dt7948.n(this.prototype,"onShowing",[o.action])}teardownAnimation(){(0,l.cancel)(this.#_),(0,l.cancel)(this.#h),(0,l.cancel)(this.#g)}static{dt7948.n(this.prototype,"teardownAnimation",[o.action])}#f(e){return e===this.blocks.at(-1)?this.blocks[0]:this.blocks[this.blocks.indexOf(e)+1]}static{(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"JNDFGwia",block:'[[[11,"ul"],[24,0,"ai-blinking-animation"],[4,[32,0],[[30,0,["setupAnimation"]]],null],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["blocks"]]],null]],null],null,[[[1,"    "],[11,"li"],[16,0,[28,[32,1],["ai-blinking-animation__list-item",[52,[30,1,["show"]],"show"],[52,[30,1,["shown"]],"is-shown"],[52,[30,1,["blinking"]],"blink"]],null]],[4,[32,2],[[28,[32,3],[[30,0,["onBlinking"]],[30,1]],null],[30,1,["blinking"]]],null],[4,[32,2],[[28,[32,3],[[30,0,["onShowing"]],[30,1]],null],[30,1,["show"]]],null],[4,[32,4],[[30,0,["teardownAnimation"]]],null],[12],[13],[1,"\\n"]],[1]],null],[13]],["block"],["each","-track-array","if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-blinking-animation.js",scope:()=>[n.default,d.default,a.default,i.fn,r.default],isStrictMode:!0}),this)}}e.default=h}),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-conversations",["exports","@glimmer/tracking","@ember/component","@ember/helper","@ember/modifier","@ember/object","@ember/owner","@ember/render-modifiers/modifiers/did-insert","@ember/runloop","@ember/service","@ember/template","@ember-compat/tracked-built-ins","@ember-decorators/component","ember-modifier","discourse/components/d-button","discourse/components/plugin-outlet","discourse/components/user-autocomplete-results","discourse/helpers/body-class","discourse/helpers/concat-class","discourse/helpers/lazy-hash","discourse/lib/ajax-error","discourse/lib/hashtag-autocomplete","discourse/lib/textarea-text-manipulation","discourse/lib/uppy/uppy-upload","discourse/lib/uppy-media-optimization-plugin","discourse/lib/user-search","discourse/lib/user-status-on-autocomplete","discourse/lib/utilities","discourse/modifiers/d-autocomplete","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-persona-llm-selector","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x,k,T,C,P,M,j,A,L){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const E=dt7948.c(class extends s.default{static{dt7948.g(this.prototype,"aiCredits",[d.service])}#b=void dt7948.i(this,"aiCredits")
static{dt7948.g(this.prototype,"aiBotConversationsHiddenSubmit",[d.service])}#y=void dt7948.i(this,"aiBotConversationsHiddenSubmit")
static{dt7948.g(this.prototype,"capabilities",[d.service])}#v=void dt7948.i(this,"capabilities")
static{dt7948.g(this.prototype,"mediaOptimizationWorker",[d.service])}#w=void dt7948.i(this,"mediaOptimizationWorker")
static{dt7948.g(this.prototype,"site",[d.service])}#S=void dt7948.i(this,"site")
static{dt7948.g(this.prototype,"siteSettings",[d.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"tooltip",[d.service])}#x=void dt7948.i(this,"tooltip")
static{dt7948.g(this.prototype,"creditStatus",[t.tracked],function(){return null})}#k=void dt7948.i(this,"creditStatus")
static{dt7948.g(this.prototype,"selectedLlmId",[t.tracked],function(){return null})}#T=void dt7948.i(this,"selectedLlmId")
static{dt7948.g(this.prototype,"uploads",[t.tracked],function(){return new c.TrackedArray})}#C=void dt7948.i(this,"uploads")
textarea=null
uppyUpload=null
fileInputEl=null
creditLimitTooltipModifier=(0,m.modifier)(e=>{if(!this.isSubmitDisabled)return
const t=this.tooltip.register(e,{identifier:"ai-credit-limit-tooltip",content:(0,u.htmlSafe)(this.aiCredits.getCreditLimitMessage(this.creditStatus)),placement:"top",triggers:"hover",interactive:!0,trapTab:!1})
return()=>{t.destroy()}})
#P=e=>{if(document.activeElement!==this.textarea)return
const{canUpload:t,canPasteHtml:s,types:i}=(0,P.clipboardHelpers)(e,{siteSettings:this.siteSettings,canUpload:!0})
!t||s||i.includes("text/plain")||e&&e.clipboardData&&e.clipboardData.files&&this.uppyUpload.addFiles([...e.clipboardData.files],{pasted:!0})}
init(){super.init(...arguments),this.uppyUpload=new x.default((0,a.getOwner)(this),{id:"ai-bot-file-uploader",type:"ai-bot-conversation",useMultipartUploadsIfAvailable:!0,uppyReady:()=>{this.siteSettings.composer_media_optimization_image_enabled&&this.uppyUpload.uppyWrapper.useUploadPlugin(k.default,{optimizeFn:(e,t)=>this.mediaOptimizationWorker.optimizeImage(e,t),runParallel:!this.capabilities.isMobileDevice}),this.uppyUpload.uppyWrapper.onPreProcessProgress(e=>{const t=this.inProgressUploads?.find(t=>t.id===e.id)
t&&!t.processing&&(t.processing=!0)}),this.uppyUpload.uppyWrapper.onPreProcessComplete(e=>{const t=this.inProgressUploads?.find(t=>t.id===e.id)
t&&(t.processing=!1)}),this.textarea?.addEventListener("paste",this.#P)},uploadDone:e=>{this.uploads.push(e)},onProgressUploadsChanged:()=>{this.notifyPropertyChange("inProgressUploads")}})}willDestroy(){super.willDestroy(...arguments),this.textarea?.removeEventListener("paste",this.#P),this.uppyUpload?.teardown(),this.textarea.autocomplete&&this.textarea.autocomplete("destroy")}get loading(){return this.aiBotConversationsHiddenSubmit?.loading}get inProgressUploads(){return this.uppyUpload?.inProgressUploads||[]}get showUploadsContainer(){return this.uploads?.length>0||this.inProgressUploads?.length>0}get isSubmitDisabled(){return!0===this.creditStatus?.hard_limit_reached}async setPersonaId(e){this.aiBotConversationsHiddenSubmit.personaId=e,this.selectedLlmId||await this.#M(e,"persona")}static{dt7948.n(this.prototype,"setPersonaId",[n.action])}async setLlmId(e){this.selectedLlmId=e,await this.#M(e,"llm")}static{dt7948.n(this.prototype,"setLlmId",[n.action])}async#M(e,t){if(this.creditStatus=null,e)try{this.creditStatus="persona"===t?await this.aiCredits.getPersonaCreditStatus(e):await this.aiCredits.getLlmModelCreditStatus(e)}catch{this.creditStatus=null}}setTargetRecipient(e){this.aiBotConversationsHiddenSubmit.targetUsername=e}static{dt7948.n(this.prototype,"setTargetRecipient",[n.action])}updateInputValue(e){this._autoExpandTextarea(),this.aiBotConversationsHiddenSubmit.inputValue=e.target?.value||e}static{dt7948.n(this.prototype,"updateInputValue",[n.action])}handleKeyDown(e){"TEXTAREA"===e.target.tagName&&("Enter"!==e.key||e.shiftKey||this.prepareAndSubmitToBot())}static{dt7948.n(this.prototype,"handleKeyDown",[n.action])}setTextArea(e){this.textarea=e,this.setupAutocomplete(e),(0,l.scheduleOnce)("afterRender",this,this.focusTextarea)}static{dt7948.n(this.prototype,"setTextArea",[n.action])}focusTextarea(){this.textarea?.focus()}static{dt7948.n(this.prototype,"focusTextarea",[n.action])}setupAutocomplete(e){this.applyUserAutocomplete(e),this.applyHashtagAutocomplete(e)}static{dt7948.n(this.prototype,"setupAutocomplete",[n.action])}applyUserAutocomplete(e){if(!this.siteSettings.enable_mentions)return
const t=new S.TextareaAutocompleteHandler(e)
M.default.setupAutocomplete((0,a.getOwner)(this),e,t,{component:_.default,key:_.default.TRIGGER_KEY,dataSource:e=>((0,C.destroyUserStatuses)(),(0,T.default)({term:e,includeGroups:!0}).then(e=>((0,C.initUserStatusHtml)((0,a.getOwner)(this),e.users),e))),onRender:e=>(0,C.renderUserStatusHtml)(e),fixedTextareaPosition:!0,autoSelectFirstSuggestion:!0,offset:2,transformComplete:e=>((0,T.validateSearchResult)(e),e.username||e.name),afterComplete:e=>{this.textarea.value=e,this.focusTextarea(),this.updateInputValue({target:{value:e}})},onClose:C.destroyUserStatuses})}static{dt7948.n(this.prototype,"applyUserAutocomplete",[n.action])}applyHashtagAutocomplete(e){const t=this.site.hashtag_configurations["topic-composer"],s=new S.TextareaAutocompleteHandler(e)
M.default.setupAutocomplete((0,a.getOwner)(this),e,s,(0,w.hashtagAutocompleteOptions)(t,{offset:2,fixedTextareaPosition:!0,afterComplete:e=>{this.textarea.value=e,this.focusTextarea(),this.updateInputValue({target:{value:e}})}}))}static{dt7948.n(this.prototype,"applyHashtagAutocomplete",[n.action])}registerFileInput(e){e&&(this.fileInputEl=e,this.uppyUpload&&this.uppyUpload.setup(e))}static{dt7948.n(this.prototype,"registerFileInput",[n.action])}openFileUpload(){this.fileInputEl&&this.fileInputEl.click()}static{dt7948.n(this.prototype,"openFileUpload",[n.action])}removeUpload(e){this.uploads=new c.TrackedArray(this.uploads.filter(t=>t!==e))}static{dt7948.n(this.prototype,"removeUpload",[n.action])}cancelUpload(e){this.uppyUpload.cancelSingleUpload({fileId:e.id})}static{dt7948.n(this.prototype,"cancelUpload",[n.action])}async prepareAndSubmitToBot(){try{await this.aiBotConversationsHiddenSubmit.submitToBot({uploads:this.uploads,inProgressUploadsCount:this.inProgressUploads.length}),this.uploads=new c.TrackedArray}catch(e){(0,v.popupAjaxError)(e)}}static{dt7948.n(this.prototype,"prepareAndSubmitToBot",[n.action])}_autoExpandTextarea(){this.textarea.style.height="auto",this.textarea.style.height=this.textarea.scrollHeight+"px"
const e=parseInt(getComputedStyle(this.textarea).maxHeight,10)
this.textarea.scrollHeight>e?this.textarea.style.overflowY="auto":this.textarea.style.overflowY="hidden"}static{(0,s.setComponentTemplate)((0,L.createTemplateFactory)({id:"WFwOLG/h",block:'[[[11,0],[24,0,"ai-bot-conversations"],[17,1],[12],[1,"\\n  "],[1,[28,[32,0],["ai-bot-conversations-page"],null]],[1,"\\n  "],[8,[32,1],null,[["@showLabels","@setPersonaId","@setLlmId","@setTargetRecipient","@personaName","@llmName"],[true,[30,0,["setPersonaId"]],[30,0,["setLlmId"]],[30,0,["setTargetRecipient"]],[30,2,["persona"]],[30,2,["llm"]]]],null],[1,"\\n\\n  "],[10,0],[14,0,"ai-bot-conversations__content-wrapper"],[12],[1,"\\n    "],[10,0],[14,0,"ai-bot-conversations__title"],[12],[1,"\\n      "],[1,[28,[32,2],["discourse_ai.ai_bot.conversations.header"],null]],[1,"\\n    "],[13],[1,"\\n    "],[8,[32,3],null,[["@name","@outletArgs"],["ai-bot-conversations-above-input",[28,[32,4],null,[["updateInput","submit"],[[30,0,["updateInputValue"]],[30,0,["prepareAndSubmitToBot"]]]]]]],null],[1,"\\n\\n    "],[11,0],[16,0,[28,[32,5],["ai-bot-conversations__input-wrapper",[52,[30,0,["isSubmitDisabled"]],"--disabled"]],null]],[4,[30,0,["creditLimitTooltipModifier"]],null,null],[12],[1,"\\n      "],[8,[32,6],[[24,0,"btn btn-transparent ai-bot-upload-btn"]],[["@icon","@action","@disabled","@title"],["upload",[52,[51,[30,0,["isSubmitDisabled"]]],[30,0,["openFileUpload"]]],[30,0,["isSubmitDisabled"]],"discourse_ai.ai_bot.conversations.upload_files"]],null],[1,"\\n      "],[11,"textarea"],[24,1,"ai-bot-conversations-input"],[16,"autofocus",[52,[51,[30,0,["isSubmitDisabled"]]],"true"]],[16,"placeholder",[28,[32,2],["discourse_ai.ai_bot.conversations.placeholder"],null]],[24,"minlength","10"],[16,"disabled",[52,[30,0,["isSubmitDisabled"]],true,[30,0,["loading"]]]],[24,"rows","1"],[4,[32,7],[[30,0,["setTextArea"]]],null],[4,[32,8],["input",[30,0,["updateInputValue"]]],null],[4,[32,8],["keydown",[30,0,["handleKeyDown"]]],null],[12],[13],[1,"      "],[8,[32,6],[[24,0,"ai-bot-button btn-transparent ai-conversation-submit"]],[["@action","@icon","@disabled","@isLoading","@title"],[[52,[51,[30,0,["isSubmitDisabled"]]],[30,0,["prepareAndSubmitToBot"]]],"paper-plane",[30,0,["isSubmitDisabled"]],[52,[51,[30,0,["isSubmitDisabled"]]],[30,0,["loading"]]],"discourse_ai.ai_bot.conversations.header"]],null],[1,"\\n      "],[11,"input"],[24,1,"ai-bot-file-uploader"],[24,0,"hidden-upload-field"],[24,"multiple","multiple"],[24,4,"file"],[4,[32,7],[[30,0,["registerFileInput"]]],null],[12],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,2],[14,0,"ai-disclaimer"],[12],[1,"\\n      "],[1,[28,[32,2],["discourse_ai.ai_bot.conversations.disclaimer"],null]],[1,"\\n    "],[13],[1,"\\n\\n"],[41,[30,0,["showUploadsContainer"]],[[[1,"      "],[10,0],[14,0,"ai-bot-conversations__uploads-container"],[12],[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,0,["uploads"]]],null]],null],null,[[[1,"          "],[10,0],[14,0,"ai-bot-upload"],[12],[1,"\\n            "],[10,1],[14,0,"ai-bot-upload__filename"],[12],[1,"\\n              "],[1,[30,3,["original_filename"]]],[1,"\\n            "],[13],[1,"\\n            "],[8,[32,6],[[24,0,"btn-transparent ai-bot-upload__remove"]],[["@icon","@action"],["xmark",[28,[32,9],[[30,0,["removeUpload"]],[30,3]],null]]],null],[1,"\\n          "],[13],[1,"\\n"]],[3]],null],[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,0,["inProgressUploads"]]],null]],null],null,[[[1,"          "],[10,0],[14,0,"ai-bot-upload ai-bot-upload--in-progress"],[12],[1,"\\n            "],[10,1],[14,0,"ai-bot-upload__filename"],[12],[1,[30,4,["fileName"]]],[13],[1,"\\n            "],[10,1],[14,0,"ai-bot-upload__progress"],[12],[1,"\\n              "],[1,[30,4,["progress"]]],[1,"%\\n            "],[13],[1,"\\n            "],[8,[32,6],[[24,0,"btn-flat ai-bot-upload__cancel"]],[["@icon","@action"],["xmark",[28,[32,9],[[30,0,["cancelUpload"]],[30,4]],null]]],null],[1,"\\n          "],[13],[1,"\\n"]],[4]],null],[1,"      "],[13],[1,"\\n"]],[]],null],[1,"  "],[13],[1,"\\n"],[13]],["&attrs","@controller","upload","upload"],["if","unless","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-bot-conversations.js",scope:()=>[f.default,A.default,j.i18n,g.default,y.default,b.default,h.default,r.default,o.on,i.fn],isStrictMode:!0}),this)}},[(0,p.tagName)("")])
e.default=E}),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/components/plugin-outlet","discourse/helpers/lazy-hash","discourse/lib/get-url","discourse-i18n","discourse/plugins/discourse-ai/discourse/services/ai-conversations-sidebar-manager","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class p extends t.default{static{dt7948.g(this.prototype,"appEvents",[i.service])}#j=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"currentUser",[i.service])}#A=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"navigationMenu",[i.service])}#L=void dt7948.i(this,"navigationMenu")
static{dt7948.g(this.prototype,"sidebarState",[i.service])}#E=void dt7948.i(this,"sidebarState")
static{dt7948.g(this.prototype,"siteSettings",[i.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"aiConversationsSidebarManager",[i.service])}#R=void dt7948.i(this,"aiConversationsSidebarManager")
get bots(){const e=this.currentUser.ai_enabled_chat_bots.filter(e=>!e.is_persona||e.has_default_llm).filter(Boolean)
return e?e.map(e=>e.model_name):[]}get showHeaderButton(){return this.bots.length>0&&this.siteSettings.ai_bot_add_to_header}get title(){return this.clickShouldRouteOutOfConversations?(0,l.i18n)("discourse_ai.ai_bot.exit"):(0,l.i18n)("discourse_ai.ai_bot.shortcut_title")}get icon(){return this.clickShouldRouteOutOfConversations?"shuffle":"robot"}get clickShouldRouteOutOfConversations(){return!this.navigationMenu.isHeaderDropdownMode&&this.sidebarState.currentPanel?.key===d.AI_CONVERSATIONS_PANEL}get href(){return this.clickShouldRouteOutOfConversations?(0,r.default)(this.aiConversationsSidebarManager.lastKnownAppURL||"/"):(0,r.default)("/discourse-ai/ai-bot/conversations")}onClick(){this.clickShouldRouteOutOfConversations||this.appEvents.trigger("discourse-ai:bot-header-icon-clicked")}static{dt7948.n(this.prototype,"onClick",[s.action])}static{(0,u.setComponentTemplate)((0,c.createTemplateFactory)({id:"eIDsUVF0",block:'[[[41,[30,0,["showHeaderButton"]],[[[1,"  "],[10,"li"],[12],[1,"\\n    "],[8,[32,0],null,[["@name","@outletArgs"],["ai-bot-header-icon",[28,[32,1],null,[["onClick","icon"],[[30,0,["onClick"]],[30,0,["icon"]]]]]]],[["default"],[[[[1,"\\n      "],[8,[32,2],[[16,"title",[30,0,["title"]]],[24,0,"ai-bot-button icon btn-flat"]],[["@href","@action","@icon"],[[30,0,["href"]],[52,[51,[30,0,["href"]]],[30,0,["onClick"]]],[30,0,["icon"]]]],null],[1,"\\n    "]],[]]]]],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],[],["if","unless"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon.js",scope:()=>[n.default,a.default,o.default],isStrictMode:!0}),this)}}e.default=p}),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-empty-state",["exports","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,s.setComponentTemplate)((0,i.createTemplateFactory)({id:"QWE2zuns",block:'[[[10,0],[14,0,"ai-bot-sidebar-empty-state"],[12],[1,"\\n  "],[1,[28,[32,0],["discourse_ai.ai_bot.sidebar_empty"],null]],[1,"\\n"],[13]],[],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-empty-state.js",scope:()=>[t.i18n],isStrictMode:!0}),(0,o.default)(void 0,"ai-bot-sidebar-empty-state"))}),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-new-conversation",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/components/sidebar/back-to-forum","discourse/plugins/discourse-ai/discourse/services/ai-conversations-sidebar-manager","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static{dt7948.g(this.prototype,"appEvents",[i.service])}#j=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"router",[i.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"sidebarState",[i.service])}#E=void dt7948.i(this,"sidebarState")
static{dt7948.g(this.prototype,"siteSettings",[i.service])}#l=void dt7948.i(this,"siteSettings")
get shouldRender(){return this.sidebarState.isCurrentPanel(a.AI_CONVERSATIONS_PANEL)}get shouldShowBackLink(){return!this.siteSettings.ai_bot_add_to_header}focusTextarea(){document.getElementById("ai-bot-conversations-input")?.focus()}static{dt7948.n(this.prototype,"focusTextarea",[s.action])}routeTo(){this.appEvents.trigger("discourse-ai:new-conversation-btn-clicked"),"discourse-ai-bot-conversations"!==this.router.currentRouteName?this.router.transitionTo("/discourse-ai/ai-bot/conversations"):this.focusTextarea(),this.args.outletArgs?.toggleNavigationMenu?.()}static{dt7948.n(this.prototype,"routeTo",[s.action])}static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"WpO6XIBG",block:'[[[41,[30,0,["shouldRender"]],[[[41,[30,0,["shouldShowBackLink"]],[[[1,"    "],[8,[32,0],null,null,null],[1,"\\n"]],[]],null],[1,"  "],[10,0],[14,0,"ai-new-question-button__wrapper"],[12],[1,"\\n    "],[8,[32,1],[[24,0,"ai-new-question-button btn-default"]],[["@label","@icon","@action"],["discourse_ai.ai_bot.conversations.new","plus",[30,0,["routeTo"]]]],null],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-new-conversation.js",scope:()=>[n.default,o.default],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/discourse-ai/discourse/components/ai-composer-helper-menu",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/owner","@ember/service","discourse/float-kit/components/d-toast","discourse/float-kit/lib/d-toast-instance","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list","discourse/plugins/discourse-ai/discourse/components/modal/diff-modal","discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static{dt7948.g(this.prototype,"modal",[n.service])}#O=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"siteSettings",[n.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"currentUser",[n.service])}#A=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"site",[n.service])}#S=void dt7948.i(this,"site")
static{dt7948.g(this.prototype,"newSelectedText",[s.tracked])}#F=void dt7948.i(this,"newSelectedText")
static{dt7948.g(this.prototype,"diff",[s.tracked])}#I=void dt7948.i(this,"diff")
static{dt7948.g(this.prototype,"customPromptValue",[s.tracked],function(){return""})}#D=void dt7948.i(this,"customPromptValue")
static{dt7948.g(this.prototype,"noContentError",[s.tracked],function(){return!1})}#N=void dt7948.i(this,"noContentError")
prompts=[]
promptTypes={}
constructor(){super(...arguments),0===this.args.data.toolbarEvent.getText().length&&(this.noContentError=!0)}get helperOptions(){let e=this.currentUser?.ai_helper_prompts
e=e.filter(e=>e.location.includes("composer")).filter(e=>"generate_titles"!==e.name).map(e=>{const t=this.siteSettings.default_locale,s=this.siteSettings.available_locales.find(e=>e.value===t),i=(0,l.i18n)("discourse_ai.ai_helper.context_menu.translate_prompt",{language:s.name})
return"translate"===e.name?{...e,translated_name:i}:e})
const t=e.findIndex(e=>"custom_prompt"===e.name)
if(-1!==t){const s=e.splice(t,1)[0]
e.unshift(s)}return this.currentUser?.can_use_custom_prompts||(e=e.filter(e=>"custom_prompt"!==e.name)),e.forEach(e=>{this.prompts[e.name]=e}),this.promptTypes=e.reduce((e,t)=>(e[t.name]=t.prompt_type,e),{}),e}get toast(){const e=(0,o.getOwner)(this),t={close:()=>this.args.close(),duration:"short",data:{theme:"error",icon:"triangle-exclamation",message:(0,l.i18n)("discourse_ai.ai_helper.no_content_error")}}
return new class extends r.default{constructor(){super(e,t)}close(){this.options.close()}static{dt7948.n(this.prototype,"close",[i.action])}}(e,t)}async suggestChanges(e){if(await this.args.close(),"illustrate_post"===e.name)return this.modal.show(c.default,{model:{mode:e.name,selectedText:this.args.data.selectedText,thumbnails:this.thumbnailSuggestions}})
const t="diff"===e.prompt_type&&"markdown_table"!==e.name
return this.modal.show(u.default,{model:{mode:e.name,selectedText:this.args.data.selectedText,revert:this.undoAiAction,toolbarEvent:this.args.data.toolbarEvent,customPromptValue:this.customPromptValue,showResultAsDiff:t}})}static{dt7948.n(this.prototype,"suggestChanges",[i.action])}closeMenu(){this.customPromptValue="",this.args.close()}static{dt7948.n(this.prototype,"closeMenu",[i.action])}static{(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"r+lQM8L8",block:'[[[41,[30,0,["noContentError"]],[[[1,"  "],[8,[32,0],null,[["@toast"],[[30,0,["toast"]]]],null],[1,"\\n"]],[]],[[[1,"  "],[10,0],[14,0,"ai-composer-helper-menu"],[12],[1,"\\n"],[41,[30,0,["site","mobileView"]],[[[1,"      "],[10,0],[14,0,"ai-composer-helper-menu__selected-text"],[12],[1,"\\n        "],[1,[30,1,["selectedText"]]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"\\n    "],[8,[32,1],null,[["@options","@customPromptValue","@performAction","@shortcutVisible"],[[30,0,["helperOptions"]],[30,0,["customPromptValue"]],[30,0,["suggestChanges"]],true]],null],[1,"\\n  "],[13],[1,"\\n"]],[]]]],["@data"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-composer-helper-menu.js",scope:()=>[a.default,d.default],isStrictMode:!0}),this)}}e.default=h}),define("discourse/plugins/discourse-ai/discourse/components/ai-credit-bar",["exports","@glimmer/component","@ember/template","discourse/float-kit/components/d-tooltip","discourse/helpers/concat-class","discourse/lib/formatter","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{get barClass(){const e=[]
return this.args.allocation.soft_limit_reached&&e.push("ai-credit-bar--warning"),this.args.compact&&e.push("ai-credit-bar--compact"),e.join(" ")}get fillStyle(){return(0,s.htmlSafe)(`width: ${this.args.allocation.percentage_remaining}%`)}get barText(){return this.args.compact?`${this.args.allocation.percentage_remaining}%`:(0,a.i18n)("discourse_ai.llms.credit_allocation.credits_remaining",{remaining:(0,n.number)(this.args.allocation.credits_remaining),total:(0,n.number)(this.args.allocation.daily_credits),percentage:this.args.allocation.percentage_remaining})}get tooltipText(){if(this.args.compact)return(0,a.i18n)("discourse_ai.llms.credit_allocation.credits_remaining",{remaining:(0,n.number)(this.args.allocation.credits_remaining),total:(0,n.number)(this.args.allocation.daily_credits),percentage:this.args.allocation.percentage_remaining})
const e=new Date(this.args.allocation.next_reset_at).toLocaleString(void 0,{month:"long",day:"numeric",hour:"numeric",minute:"2-digit",timeZone:"UTC"})
return(0,a.i18n)("discourse_ai.llms.credit_allocation.next_reset",{time:e})}get shouldShowTooltip(){return!1!==this.args.showTooltip}static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"0gm716pP",block:'[[[41,[30,0,["shouldShowTooltip"]],[[[1,"  "],[8,[32,0],null,[["@content"],[[30,0,["tooltipText"]]]],[["trigger"],[[[[1,"\\n      "],[10,0],[15,0,[28,[32,1],["ai-credit-bar",[30,0,["barClass"]]],null]],[12],[1,"\\n        "],[10,0],[14,0,"ai-credit-bar__progress"],[12],[1,"\\n          "],[10,0],[14,0,"ai-credit-bar__fill"],[15,5,[30,0,["fillStyle"]]],[12],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"ai-credit-bar__text"],[12],[1,"\\n          "],[1,[30,0,["barText"]]],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n    "]],[]]]]],[1,"\\n"]],[]],[[[1,"  "],[10,0],[15,0,[28,[32,1],["ai-credit-bar",[30,0,["barClass"]]],null]],[12],[1,"\\n    "],[10,0],[14,0,"ai-credit-bar__progress"],[12],[1,"\\n      "],[10,0],[14,0,"ai-credit-bar__fill"],[15,5,[30,0,["fillStyle"]]],[12],[13],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"ai-credit-bar__text"],[12],[1,"\\n      "],[1,[30,0,["barText"]]],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[]]]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-credit-bar.js",scope:()=>[i.default,o.default],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/discourse-ai/discourse/components/ai-default-llm-selector",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/service","discourse/components/conditional-loading-spinner","discourse/lib/ajax","discourse/lib/ajax-error","discourse/select-kit/components/combo-box","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends t.default{static{dt7948.g(this.prototype,"toasts",[n.service])}#U=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"llmModels",[s.tracked],function(){return[]})}#q=void dt7948.i(this,"llmModels")
static{dt7948.g(this.prototype,"selectedValue",[s.tracked],function(){return""})}#B=void dt7948.i(this,"selectedValue")
static{dt7948.g(this.prototype,"isSaving",[s.tracked],function(){return!1})}#z=void dt7948.i(this,"isSaving")
constructor(){super(...arguments),this.#V()}async#V(){try{const e=await(0,r.ajax)("/admin/plugins/discourse-ai/ai-llms.json")
this.llmModels=e.ai_llms||[]
const{site_settings:t}=await(0,r.ajax)("/admin/config/site_settings.json",{data:{plugin:"discourse-ai",category:"discourse_ai"}}),s=t.find(e=>"ai_default_llm_model"===e.setting),i=s?.value
this.selectedValue=null==i||""===i?"none":String(i)}catch(e){(0,l.popupAjaxError)(e)}}get content(){return[{id:"none",name:(0,u.i18n)("discourse_ai.llm_selector.none")},...this.llmModels.map(e=>({id:String(e.id),name:e.display_name}))]}async onChange(e){const t=this.selectedValue
this.selectedValue=e,this.isSaving=!0
try{const t="none"===e?"":e
await(0,r.ajax)("/admin/site_settings/ai_default_llm_model",{type:"PUT",data:{ai_default_llm_model:t}}),this.toasts.success({duration:3e3,data:{message:(0,u.i18n)("discourse_ai.llm_selector.saved")}})}catch(s){this.selectedValue=t,(0,l.popupAjaxError)(s)}finally{this.isSaving=!1}}static{dt7948.n(this.prototype,"onChange",[o.action])}static{(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"/dx1XVxa",block:'[[[10,0],[14,0,"ai-configure-default-llm"],[12],[1,"\\n  "],[10,0],[14,0,"ai-configure-default-llm__header"],[12],[1,"\\n    "],[10,"h3"],[12],[1,[28,[32,0],["discourse_ai.default_llm.title"],null]],[13],[1,"\\n    "],[10,2],[12],[1,[28,[32,0],["discourse_ai.default_llm.description"],null]],[13],[1,"\\n  "],[13],[1,"\\n\\n  "],[10,0],[14,0,"ai-configure-default-llm__setting"],[12],[1,"\\n    "],[8,[32,1],null,[["@value","@content","@onChange","@valueProperty","@nameProperty","@options"],[[30,0,["selectedValue"]],[30,0,["content"]],[30,0,["onChange"]],"id","name",[28,[32,2],null,[["disabled"],[[30,0,["isSaving"]]]]]]],null],[1,"\\n    "],[8,[32,3],null,[["@condition","@size"],[[30,0,["isSaving"]],"small"]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],[],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-default-llm-selector.js",scope:()=>[u.i18n,d.default,i.hash,a.default],isStrictMode:!0}),this)}}e.default=m}),define("discourse/plugins/discourse-ai/discourse/components/ai-embedding-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/runloop","@ember/service","discourse/admin/components/admin-section-landing-item","discourse/admin/components/admin-section-landing-wrapper","discourse/components/back-button","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/form","discourse/helpers/d-icon","discourse/lib/ajax-error","discourse/lib/array-tools","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-secret-selector","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class w extends t.default{static{dt7948.g(this.prototype,"toasts",[a.service])}#U=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"router",[a.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"dialog",[a.service])}#H=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"store",[a.service])}#$=void dt7948.i(this,"store")
static{dt7948.g(this.prototype,"isSaving",[s.tracked],function(){return!1})}#z=void dt7948.i(this,"isSaving")
static{dt7948.g(this.prototype,"selectedPreset",[s.tracked],function(){return null})}#G=void dt7948.i(this,"selectedPreset")
static{dt7948.g(this.prototype,"testRunning",[s.tracked],function(){return!1})}#W=void dt7948.i(this,"testRunning")
static{dt7948.g(this.prototype,"testResult",[s.tracked],function(){return null})}#K=void dt7948.i(this,"testResult")
static{dt7948.g(this.prototype,"testError",[s.tracked],function(){return null})}#Y=void dt7948.i(this,"testError")
static{dt7948.g(this.prototype,"currentProvider",[s.tracked],function(){return null})}#J=void dt7948.i(this,"currentProvider")
constructor(){super(...arguments),this.args.model&&(this.currentProvider=this.args.model.provider)}get formData(){let e
e=this.selectedPreset?this.store.createRecord("ai-embedding",this.selectedPreset).workingCopy():this.args.model.workingCopy()
const t=JSON.parse(JSON.stringify(e))
return this._originalFormData=t,t}static{dt7948.n(this.prototype,"formData",[s.cached])}get availableSecrets(){return this.args.embeddings?.resultSetMeta?.ai_secrets||[]}get selectedProviders(){return this.args.embeddings.resultSetMeta.providers.map(e=>{return{id:e,name:(t=e,(0,f.i18n)(`discourse_ai.embeddings.providers.${t}`))}
var t})}get distanceFunctions(){const e=e=>(0,f.i18n)(`discourse_ai.embeddings.distance_functions.${e}`)
return this.args.embeddings.resultSetMeta.distance_functions.map(t=>({id:t,name:e(t)}))}get presets(){const e=this.args.embeddings.resultSetMeta.presets.map(e=>({name:e.display_name,id:e.preset_id,provider:e.provider}))
return e.unshift({name:(0,f.i18n)("discourse_ai.embeddings.configure_manually"),id:"manual",provider:"fake"}),e}get showPresets(){return!this.selectedPreset&&this.args.model.isNew}get metaProviderParams(){const e=this.currentProvider
if(!e)return{}
return(((this.args.embeddings||{}).resultSetMeta||{}).provider_params||{})[e]||{}}get testErrorMessage(){return(0,f.i18n)("discourse_ai.llms.tests.failure",{error:this.testError})}get displayTestResult(){return this.testRunning||null!==this.testResult}get seeded(){return this.args.model.id<0}configurePreset(e){this.selectedPreset=this.args.embeddings.resultSetMeta.presets.find(t=>t.preset_id===e.id)||{},this.selectedPreset.provider&&(this.currentProvider=this.selectedPreset.provider)}static{dt7948.n(this.prototype,"configurePreset",[o.action])}setProvider(e,{set:t}){t("provider",e),this.currentProvider=e
const s=(this.args.embeddings?.resultSetMeta?.provider_params||{})[e]||{},i={}
if(s){Object.keys(s).forEach(e=>{i[e]=null})}t("provider_params",i)}static{dt7948.n(this.prototype,"setProvider",[o.action])}get providerParams(){return Object.entries(this.metaProviderParams).reduce((e,[t,s])=>(e[t]=(e=>e?"string"==typeof e?{type:e}:{type:e.type||"text",values:(e.values||[]).map(e=>({id:e,name:e})),default:e.default}:{type:"text"})(s),e),{})}resetForm(){this.selectedPreset=null,this.currentProvider=null}static{dt7948.n(this.prototype,"resetForm",[o.action])}async save(e){this.isSaving=!0
const t=this.args.model.isNew
try{const s={...e}
if(this.selectedPreset){const e=this.store.createRecord("ai-embedding",{...this.selectedPreset,...s})
await e.save(),(0,g.addUniqueValueToArray)(this.args.embeddings.content,e)}else await this.args.model.save(s)
if(t)this.router.transitionTo("adminPlugins.show.discourse-ai-embeddings.index")
else{const e=this.currentProvider
this._originalFormData=JSON.parse(JSON.stringify(s)),this.currentProvider=e,this.toasts.success({data:{message:(0,f.i18n)("discourse_ai.embeddings.saved")},duration:"short"})}}catch(s){(0,h.popupAjaxError)(s)}finally{(0,n.later)(()=>{this.isSaving=!1},1e3)}}static{dt7948.n(this.prototype,"save",[o.action])}async test(e){this.testRunning=!0
try{let t
t=this.args.model.isNew||this.selectedPreset?this.store.createRecord("ai-embedding",{...this.selectedPreset,...e}):this.args.model
const s=await t.testConfig(e)
this.testResult=s.success,this.testResult?this.testError=null:this.testError=s.error}catch(t){(0,h.popupAjaxError)(t)}finally{(0,n.later)(()=>{this.testRunning=!1},1e3)}}static{dt7948.n(this.prototype,"test",[o.action])}delete(){return this.dialog.confirm({message:(0,f.i18n)("discourse_ai.embeddings.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then(()=>{(0,g.removeValueFromArray)(this.args.embeddings,this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-embeddings.index")}).catch(h.popupAjaxError)})}static{dt7948.n(this.prototype,"delete",[o.action])}providerKeys(e){return e?Object.keys(e):[]}static{dt7948.n(this.prototype,"providerKeys",[o.action])}static{(0,y.setComponentTemplate)((0,v.createTemplateFactory)({id:"0jDjP8hX",block:'[[[41,[30,0,["showPresets"]],[[[1,"  "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-embeddings","discourse_ai.embeddings.back"]],null],[1,"\\n  "],[10,0],[14,0,"control-group"],[12],[1,"\\n    "],[10,"h2"],[12],[1,[28,[32,1],["discourse_ai.embeddings.presets"],null]],[13],[1,"\\n    "],[8,[32,2],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["presets"]]],null]],null],null,[[[1,"        "],[8,[32,3],[[16,"data-preset-id",[30,1,["id"]]],[24,0,"ai-llms-list-editor__templates-list-item"]],[["@titleLabelTranslated","@taglineLabel"],[[30,1,["name"]],[28,[32,4],["discourse_ai.embeddings.providers.",[30,1,["provider"]]],null]]],[["buttons"],[[[[1,"\\n            "],[8,[30,2,["Default"]],null,[["@action","@icon","@label"],[[28,[32,5],[[30,0,["configurePreset"]],[30,1]],null],"gear","discourse_ai.llms.preconfigured.button"]],null],[1,"\\n          "]],[2]]]]],[1,"\\n"]],[1]],null],[1,"    "]],[]]]]],[1,"\\n  "],[13],[1,"\\n"]],[]],[[[1,"  "],[8,[32,6],[[16,0,[29,["form-horizontal ai-embedding-editor ",[52,[30,0,["seeded"]],"seeded"]]]]],[["@onSubmit","@data"],[[30,0,["save"]],[30,0,["formData"]]]],[["default"],[[[[1,"\\n"],[41,[30,5,["isNew"]],[[[1,"      "],[8,[32,7],[[24,0,"btn-flat back-button"]],[["@action","@label","@icon"],[[30,0,["resetForm"]],"back_button","chevron-left"]],null],[1,"\\n"]],[]],[[[1,"      "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-embeddings","discourse_ai.embeddings.back"]],null],[1,"\\n"]],[]]],[1,"\\n    "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__display-name"]],[["@name","@title","@validation","@format"],["display_name",[28,[32,1],["discourse_ai.embeddings.display_name"],null],"required|length:1,100","large"]],[["default"],[[[[1,"\\n      "],[8,[30,6,["Input"]],null,null,null],[1,"\\n    "]],[6]]]]],[1,"\\n\\n    "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__provider"]],[["@name","@title","@validation","@format","@onSet"],["provider",[28,[32,1],["discourse_ai.embeddings.provider"],null],"required","large",[30,0,["setProvider"]]]],[["default"],[[[[1,"\\n      "],[8,[30,7,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["selectedProviders"]]],null]],null],null,[[[1,"          "],[8,[30,8,["Option"]],null,[["@value"],[[30,9,["id"]]]],[["default"],[[[[1,[30,9,["name"]]]],[]]]]],[1,"\\n"]],[9]],null],[1,"      "]],[8]]]]],[1,"\\n    "]],[7]]]]],[1,"\\n\\n    "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__url"]],[["@name","@title","@validation","@format"],["url",[28,[32,1],["discourse_ai.embeddings.url"],null],"required","large"]],[["default"],[[[[1,"\\n      "],[8,[30,10,["Input"]],null,null,null],[1,"\\n    "]],[10]]]]],[1,"\\n\\n    "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__api-key"]],[["@name","@title","@format"],["ai_secret_id",[28,[32,1],["discourse_ai.embeddings.api_key"],null],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,11,["Custom"]],null,null,[["default"],[[[[1,"\\n        "],[8,[32,8],null,[["@value","@secrets","@onChange"],[[30,4,["ai_secret_id"]],[30,0,["availableSecrets"]],[30,11,["set"]]]],null],[1,"\\n      "]],[]]]]],[1,"\\n    "]],[11]]]]],[1,"\\n\\n    "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__tokenizer"]],[["@name","@title","@validation","@format"],["tokenizer_class",[28,[32,1],["discourse_ai.embeddings.tokenizer"],null],"required","large"]],[["default"],[[[[1,"\\n      "],[8,[30,12,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,14,["resultSetMeta","tokenizers"]]],null]],null],null,[[[1,"          "],[8,[30,13,["Option"]],null,[["@value"],[[30,15,["id"]]]],[["default"],[[[[1,[30,15,["name"]]]],[]]]]],[1,"\\n"]],[15]],null],[1,"      "]],[13]]]]],[1,"\\n    "]],[12]]]]],[1,"\\n\\n    "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__dimensions"]],[["@name","@title","@validation","@format","@tooltip"],["dimensions",[28,[32,1],["discourse_ai.embeddings.dimensions"],null],"required","large",[52,[30,5,["isNew"]],[28,[32,1],["discourse_ai.embeddings.hints.dimensions_warning"],null]]]],[["default"],[[[[1,"\\n      "],[8,[30,16,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"],[16,"disabled",[28,[32,9],[[30,5,["isNew"]]],null]]],[["@type"],["number"]],null],[1,"\\n    "]],[16]]]]],[1,"\\n\\n    "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__matryoshka_dimensions"]],[["@name","@title","@tooltip","@format"],["matryoshka_dimensions",[28,[32,1],["discourse_ai.embeddings.matryoshka_dimensions"],null],[28,[32,1],["discourse_ai.embeddings.hints.matryoshka_dimensions"],null],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,17,["Checkbox"]],null,null,null],[1,"\\n    "]],[17]]]]],[1,"\\n\\n    "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__embed_prompt"]],[["@name","@title","@tooltip","@format"],["embed_prompt",[28,[32,1],["discourse_ai.embeddings.embed_prompt"],null],[28,[32,1],["discourse_ai.embeddings.hints.embed_prompt"],null],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,18,["Textarea"]],null,null,null],[1,"\\n    "]],[18]]]]],[1,"\\n\\n    "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__search_prompt"]],[["@name","@title","@tooltip","@format"],["search_prompt",[28,[32,1],["discourse_ai.embeddings.search_prompt"],null],[28,[32,1],["discourse_ai.embeddings.hints.search_prompt"],null],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,19,["Textarea"]],null,null,null],[1,"\\n    "]],[19]]]]],[1,"\\n\\n    "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__max_sequence_length"]],[["@name","@title","@tooltip","@validation","@format"],["max_sequence_length",[28,[32,1],["discourse_ai.embeddings.max_sequence_length"],null],[28,[32,1],["discourse_ai.embeddings.hints.sequence_length"],null],"required","large"]],[["default"],[[[[1,"\\n      "],[8,[30,20,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n    "]],[20]]]]],[1,"\\n\\n    "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__distance_functions"]],[["@name","@title","@tooltip","@format","@validation"],["pg_function",[28,[32,1],["discourse_ai.embeddings.distance_function"],null],[28,[32,1],["discourse_ai.embeddings.hints.distance_function"],null],"large","required"]],[["default"],[[[[1,"\\n      "],[8,[30,21,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["distanceFunctions"]]],null]],null],null,[[[1,"          "],[8,[30,22,["Option"]],null,[["@value"],[[30,23,["id"]]]],[["default"],[[[[1,[30,23,["name"]]]],[]]]]],[1,"\\n"]],[23]],null],[1,"      "]],[22]]]]],[1,"\\n    "]],[21]]]]],[1,"\\n\\n"],[41,[30,0,["currentProvider"]],[[[1,"      "],[8,[30,3,["Object"]],null,[["@name"],["provider_params"]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[28,[30,0,["providerKeys"]],[[30,25]],null]],null]],null],null,[[[44,[[28,[32,10],[[30,0,["providerParams"]],[30,26]],null]],[[[41,[30,27],[[[1,"              "],[8,[30,24,["Field"]],[[16,0,[29,["ai-embedding-editor-provider-param__",[30,27,["type"]]]]]],[["@name","@title","@format","@validation"],[[30,26],[28,[32,1],[[28,[32,4],["discourse_ai.embeddings.provider_fields.",[30,26]],null]],null],"large","required"]],[["default"],[[[[1,"\\n"],[41,[28,[32,11],[[30,27,["type"]],"enum"],null],[[[1,"                  "],[8,[30,28,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,27,["values"]]],null]],null],null,[[[1,"                      "],[8,[30,29,["Option"]],null,[["@value"],[[30,30,["id"]]]],[["default"],[[[[1,[30,30,["name"]]]],[]]]]],[1,"\\n"]],[30]],null],[1,"                  "]],[29]]]]],[1,"\\n"]],[]],[[[41,[28,[32,11],[[30,27,["type"]],"checkbox"],null],[[[1,"                  "],[8,[30,28,["Checkbox"]],null,null,null],[1,"\\n"]],[]],[[[1,"                  "],[8,[30,28,["Input"]],null,[["@type"],[[30,27,["type"]]]],null],[1,"\\n                "]],[]]]],[]]],[1,"              "]],[28]]]]],[1,"\\n"]],[]],null]],[27]]]],[26]],null],[1,"      "]],[24,25]]]]],[1,"\\n"]],[]],null],[1,"\\n    "],[8,[30,3,["Actions"]],[[24,0,"ai-embedding-editor__action_panel"]],null,[["default"],[[[[1,"\\n      "],[8,[30,3,["Button"]],[[24,0,"ai-embedding-editor__test"]],[["@action","@disabled","@label"],[[28,[32,5],[[30,0,["test"]],[30,4]],null],[30,0,["testRunning"]],"discourse_ai.embeddings.tests.title"]],null],[1,"\\n\\n      "],[8,[30,3,["Submit"]],[[24,0,"btn-primary ai-embedding-editor__save"]],[["@label"],["discourse_ai.embeddings.save"]],null],[1,"\\n\\n"],[41,[51,[30,4,["isNew"]]],[[[1,"        "],[8,[30,3,["Button"]],[[24,0,"btn-danger ai-embedding-editor__delete"]],[["@action","@label"],[[30,0,["delete"]],"discourse_ai.embeddings.delete"]],null],[1,"\\n"]],[]],null],[1,"    "]],[]]]]],[1,"\\n\\n"],[41,[30,0,["displayTestResult"]],[[[1,"      "],[8,[30,3,["Container"]],[[24,0,"ai-embedding-editor-tests"]],[["@format"],["full"]],[["default"],[[[[1,"\\n        "],[8,[32,12],null,[["@size","@condition"],["small",[30,0,["testRunning"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["testResult"]],[[[1,"            "],[10,0],[14,0,"ai-embedding-editor-tests__success"],[12],[1,"\\n              "],[1,[28,[32,13],["check"],null]],[1,"\\n              "],[1,[28,[32,1],["discourse_ai.embeddings.tests.success"],null]],[1,"\\n            "],[13],[1,"\\n"]],[]],[[[1,"            "],[10,0],[14,0,"ai-embedding-editor-tests__failure"],[12],[1,"\\n              "],[1,[28,[32,13],["xmark"],null]],[1,"\\n              "],[1,[30,0,["testErrorMessage"]]],[1,"\\n            "],[13],[1,"\\n"]],[]]],[1,"        "]],[]]]]],[1,"\\n      "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],[3,4]]]]],[1,"\\n"]],[]]]],["preset","buttons","form","data","@model","field","field","select","provider","field","field","field","select","@embeddings","tokenizer","field","field","field","field","field","field","select","df","object","providerData","name","params","field","select","option"],["if","each","-track-array","let","unless"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-embedding-editor.js",scope:()=>[d.default,f.i18n,l.default,r.default,i.concat,i.fn,p.default,c.default,b.default,_.not,i.get,_.eq,u.default,m.default],isStrictMode:!0}),this)}}e.default=w}),define("discourse/plugins/discourse-ai/discourse/components/ai-embeddings-list-editor",["exports","@glimmer/component","@ember/helper","@ember/service","discourse/admin/components/admin-config-area-empty-list","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse/float-kit/components/d-tooltip","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-embedding-editor","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends t.default{static{dt7948.g(this.prototype,"adminPluginNavManager",[i.service])}#Q=void dt7948.i(this,"adminPluginNavManager")
get hasEmbeddingElements(){return 0!==this.args.embeddings.content.length}static{(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"KmeohtOO",block:'[[[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-embeddings"]],[28,[32,1],["discourse_ai.embeddings.short_title"],null]]],null],[1,"\\n"],[10,"section"],[14,0,"ai-embeddings-list-editor admin-detail"],[12],[1,"\\n"],[41,[30,1],[[[1,"    "],[8,[32,2],null,[["@model","@embeddings"],[[30,1],[30,2]]],null],[1,"\\n"]],[]],[[[1,"    "],[8,[32,3],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[28,[32,1],["discourse_ai.embeddings.short_title"],null],[28,[32,1],["discourse_ai.embeddings.description"],null],"https://meta.discourse.org/t/discourse-ai-embeddings/259603"]],[["actions"],[[[[1,"\\n        "],[8,[30,3,["Primary"]],[[24,0,"ai-embeddings-list-editor__new-button"]],[["@label","@route","@icon"],["discourse_ai.embeddings.new","adminPlugins.show.discourse-ai-embeddings.new","plus"]],null],[1,"\\n      "]],[3]]]]],[1,"\\n\\n"],[41,[30,0,["hasEmbeddingElements"]],[[[1,"      "],[10,"table"],[14,0,"d-admin-table"],[12],[1,"\\n        "],[10,"thead"],[12],[1,"\\n          "],[10,"tr"],[12],[1,"\\n            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.embeddings.display_name"],null]],[13],[1,"\\n            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.embeddings.provider"],null]],[13],[1,"\\n            "],[10,"th"],[12],[13],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2,["content"]]],null]],null],null,[[[1,"            "],[10,"tr"],[14,0,"ai-embeddings-list__row d-admin-row__content"],[12],[1,"\\n              "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n                "],[10,0],[14,0,"ai-embeddings-list__name"],[12],[1,"\\n                  "],[10,"strong"],[12],[1,"\\n                    "],[1,[30,4,["display_name"]]],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n              "],[10,"td"],[14,0,"d-admin-row__detail"],[12],[1,"\\n                "],[10,0],[14,0,"d-admin-row__mobile-label"],[12],[1,"\\n                  "],[1,[28,[32,1],["discourse_ai.embeddings.provider"],null]],[1,"\\n                "],[13],[1,"\\n                "],[1,[28,[32,1],[[28,[32,4],["discourse_ai.embeddings.providers.",[30,4,["provider"]]],null]],null]],[1,"\\n              "],[13],[1,"\\n              "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n"],[41,[30,4,["seeded"]],[[[1,"                  "],[8,[32,5],[[24,0,"ai-embeddings-list__edit-disabled-tooltip"]],null,[["trigger","content"],[[[[1,"\\n                      "],[8,[32,6],[[24,0,"btn btn-default btn-small disabled"]],[["@label"],["discourse_ai.embeddings.edit"]],null],[1,"\\n                    "]],[]],[[[1,"\\n                      "],[1,[28,[32,1],["discourse_ai.embeddings.seeded_warning"],null]],[1,"\\n                    "]],[]]]]],[1,"\\n"]],[]],[[[1,"                  "],[8,[32,6],[[24,0,"btn btn-default btn-small ai-embeddings-list__edit-button"]],[["@label","@route","@routeModels"],["discourse_ai.embeddings.edit","adminPlugins.show.discourse-ai-embeddings.edit",[30,4,["id"]]]],null],[1,"\\n"]],[]]],[1,"              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[4]],null],[1,"        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],[[[1,"      "],[8,[32,7],null,[["@ctaLabel","@ctaRoute","@ctaClass","@emptyLabel"],["discourse_ai.embeddings.new","adminPlugins.show.discourse-ai-embeddings.new","ai-embeddings-list-editor__empty-new-button","discourse_ai.embeddings.empty"]],null],[1,"\\n"]],[]]]],[]]],[13]],["@currentEmbedding","@embeddings","actions","embedding"],["if","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-embeddings-list-editor.js",scope:()=>[n.default,d.i18n,u.default,r.default,s.concat,l.default,a.default,o.default],isStrictMode:!0}),this)}}e.default=m}),define("discourse/plugins/discourse-ai/discourse/components/ai-feature-card",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/routing","discourse/components/d-button","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static{dt7948.g(this.prototype,"isExpanded",[s.tracked],function(){return!1})}#X=void dt7948.i(this,"isExpanded")
get maxItemsToShow(){return this.args.maxItemsToShow??5}get hasMore(){return this.args.items?.length>this.maxItemsToShow}get visibleItems(){return this.args.items?this.isExpanded?this.args.items:this.args.items.slice(0,this.maxItemsToShow):[]}get remainingCount(){return this.args.items?.length-this.maxItemsToShow}get expandToggleLabel(){return this.isExpanded?(0,r.i18n)("discourse_ai.features.collapse_list"):(0,r.i18n)("discourse_ai.features.expand_list",{count:this.remainingCount})}toggleExpanded(){this.isExpanded=!this.isExpanded}static{dt7948.n(this.prototype,"toggleExpanded",[o.action])}isLastItem(e){return e===this.visibleItems.length-1}static{dt7948.n(this.prototype,"isLastItem",[o.action])}static{(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"mph6YaIT",block:'[[[42,[28,[31,1],[[28,[31,1],[[30,0,["visibleItems"]]],null]],null],null,[[[1,"  "],[18,3,[[30,1],[30,2],[30,0,["isLastItem"]]]],[1,"\\n"]],[1,2]],null],[1,"\\n"],[41,[30,0,["hasMore"]],[[[1,"  "],[8,[32,0],[[24,0,"btn-flat ai-expanded-list__toggle-button"]],[["@translatedLabel","@action"],[[30,0,["expandToggleLabel"]],[30,0,["toggleExpanded"]]]],null],[1,"\\n"]],[]],null]],["item","index","&default"],["each","-track-array","yield","if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-feature-card.js",scope:()=>[a.default],isStrictMode:!0}),this)}}class c extends t.default{hasGroups(e){return this.groupList(e).length>0}static{dt7948.n(this.prototype,"hasGroups",[o.action])}groupList(e){const t=[],s=new Set
return e.personas&&e.personas.forEach(e=>{e.allowed_groups&&e.allowed_groups.forEach(e=>{s.has(e.id)||(s.add(e.id),t.push(e))})}),t}static{dt7948.n(this.prototype,"groupList",[o.action])}static{(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"0IpPDfPY",block:'[[[10,0],[14,0,"admin-section-landing-item ai-feature-card"],[15,"data-feature-name",[30,1,["name"]]],[12],[1,"\\n  "],[10,0],[14,0,"admin-section-landing-item__content"],[12],[1,"\\n    "],[10,0],[14,0,"ai-feature-card__feature-name"],[12],[1,"\\n      "],[1,[30,2]],[1,"\\n"],[41,[51,[30,1,["enabled"]]],[[[1,"        "],[10,1],[12],[1,[28,[32,0],["discourse_ai.features.disabled"],null]],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n    "],[10,0],[14,0,"ai-feature-card__persona"],[12],[1,"\\n      "],[10,1],[14,0,"ai-feature-card__label"],[12],[1,"\\n        "],[1,[28,[32,0],["discourse_ai.features.persona"],[["count"],[[30,1,["personas","length"]]]]]],[1,"\\n      "],[13],[1,"\\n"],[41,[30,1,["personas"]],[[[1,"        "],[8,[32,1],null,[["@items","@maxItemsToShow"],[[30,1,["personas"]],5]],[["default"],[[[[1,"\\n          "],[8,[32,2],[[24,0,"ai-feature-card__persona-link"]],[["@route","@model"],["adminPlugins.show.discourse-ai-personas.edit",[30,3,["id"]]]],[["default"],[[[[1,"\\n            "],[1,[28,[32,3],[[30,3,["name"]],[52,[51,[28,[30,5],[[30,4]],null]],", "]],null]],[1,"\\n          "]],[]]]]],[1,"\\n        "]],[3,4,5]]]]],[1,"\\n"]],[]],[[[1,"        "],[10,1],[14,0,"ai-feature-card__label"],[12],[1,"\\n          "],[1,[28,[32,0],["discourse_ai.features.no_persona"],null]],[1,"\\n        "],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n    "],[10,0],[14,0,"ai-feature-card__llm"],[12],[1,"\\n"],[41,[30,1,["llm_models"]],[[[1,"        "],[10,1],[14,0,"ai-feature-card__label"],[12],[1,"\\n          "],[1,[28,[32,0],["discourse_ai.features.llm"],[["count"],[[30,1,["llm_models","length"]]]]]],[1,"\\n        "],[13],[1,"\\n        "],[8,[32,1],null,[["@items","@maxItemsToShow"],[[30,1,["llm_models"]],5]],[["default"],[[[[1,"\\n          "],[8,[32,2],[[24,0,"ai-feature-card__llm-link"]],[["@route","@model"],["adminPlugins.show.discourse-ai-llms.edit",[30,6,["id"]]]],[["default"],[[[[1,"\\n            "],[1,[28,[32,3],[[30,6,["name"]],[52,[51,[28,[30,8],[[30,7]],null]],", "]],null]],[1,"\\n          "]],[]]]]],[1,"\\n        "]],[6,7,8]]]]],[1,"\\n"]],[]],[[[1,"        "],[10,1],[14,0,"ai-feature-card__label"],[12],[1,"\\n          "],[1,[28,[32,0],["discourse_ai.features.no_llm"],null]],[1,"\\n        "],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n"],[41,[30,9],[[[41,[30,1,["personas"]],[[[1,"        "],[10,0],[14,0,"ai-feature-card__groups"],[12],[1,"\\n          "],[10,1],[14,0,"ai-feature-card__label"],[12],[1,"\\n            "],[1,[28,[32,0],["discourse_ai.features.groups"],null]],[1,"\\n          "],[13],[1,"\\n"],[41,[28,[30,0,["hasGroups"]],[[30,1]],null],[[[1,"            "],[10,"ul"],[14,0,"ai-feature-card__item-groups"],[12],[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[28,[30,0,["groupList"]],[[30,1]],null]],null]],null],null,[[[1,"                "],[10,"li"],[12],[1,[30,10,["name"]]],[13],[1,"\\n"]],[10]],null],[1,"            "],[13],[1,"\\n"]],[]],[[[1,"            "],[10,1],[14,0,"ai-feature-card__label"],[12],[1,"\\n              "],[1,[28,[32,0],["discourse_ai.features.no_groups"],null]],[1,"\\n            "],[13],[1,"\\n"]],[]]],[1,"        "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"  "],[13],[1,"\\n"],[13]],["@feature","@localizedFeatureName","persona","index","isLastItem","llm","index","isLastItem","@showGroups","group"],["unless","if","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-feature-card.js",scope:()=>[r.i18n,u,n.LinkTo,i.concat],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/ai-feature-setting-field",["exports","@glimmer/component","@ember/service","discourse/select-kit/components/list-setting","discourse/truth-helpers","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static{dt7948.g(this.prototype,"site",[s.service])}#S=void dt7948.i(this,"site")
parseList=e=>e?.toString().split("|").filter(Boolean)||[]
serializeList=e=>t=>{e(Array.isArray(t)?t.join("|"):t)}
get groupChoices(){return(this.site.groups||[]).map(e=>({name:e.name,id:e.id.toString()}))}get hasEnumChoices(){return this.args.setting.valid_values?.length>0}get compactListChoices(){return this.hasEnumChoices?this.args.setting.valid_values.map(e=>({name:e.name,value:String(e.value)})):this.args.setting.choices}get controlType(){const{type:e,list_type:t}=this.args.setting
return"list"===e&&t?`${t}_list`:e}static{(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"nkAB6Ftk",block:'[[[41,[28,[32,0],[[30,0,["controlType"]],"bool"],null],[[[1,"  "],[8,[30,1,["Checkbox"]],null,null,[["default"],[[[[1,"\\n    "],[1,[30,2,["description"]]],[1,"\\n  "]],[]]]]],[1,"\\n"]],[]],[[[41,[28,[32,0],[[30,0,["controlType"]],"integer"],null],[[[1,"  "],[8,[30,1,["Input"]],null,[["@type"],["number"]],null],[1,"\\n"]],[]],[[[41,[28,[32,0],[[30,0,["controlType"]],"enum"],null],[[[1,"  "],[8,[30,1,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2,["valid_values"]]],null]],null],null,[[[1,"      "],[8,[30,3,["Option"]],null,[["@value"],[[30,4,["value"]]]],[["default"],[[[[1,"\\n        "],[1,[30,4,["name"]]],[1,"\\n      "]],[]]]]],[1,"\\n"]],[4]],null],[1,"  "]],[3]]]]],[1,"\\n"]],[]],[[[41,[28,[32,0],[[30,0,["controlType"]],"group_list"],null],[[[1,"  "],[8,[30,1,["Custom"]],null,null,[["default"],[[[[1,"\\n    "],[8,[32,1],null,[["@value","@choices","@settingName","@nameProperty","@valueProperty","@onChange"],[[28,[30,0,["parseList"]],[[30,1,["value"]]],null],[30,0,["groupChoices"]],[30,2,["setting"]],"name","id",[28,[30,0,["serializeList"]],[[30,1,["set"]]],null]]],null],[1,"\\n  "]],[]]]]],[1,"\\n"]],[]],[[[41,[28,[32,0],[[30,0,["controlType"]],"compact_list"],null],[[[1,"  "],[8,[30,1,["Custom"]],null,null,[["default"],[[[[1,"\\n    "],[8,[32,1],null,[["@value","@choices","@settingName","@nameProperty","@valueProperty","@onChange"],[[28,[30,0,["parseList"]],[[30,1,["value"]]],null],[30,0,["compactListChoices"]],[30,2,["setting"]],[52,[30,0,["hasEnumChoices"]],"name"],[52,[30,0,["hasEnumChoices"]],"value"],[28,[30,0,["serializeList"]],[[30,1,["set"]]],null]]],null],[1,"\\n  "]],[]]]]],[1,"\\n"]],[]],[[[1,"  "],[8,[30,1,["Input"]],null,null,null],[1,"\\n"]],[]]]],[]]]],[]]]],[]]]],[]]]],["@field","@setting","select","option"],["if","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-feature-setting-field.js",scope:()=>[o.eq,i.default],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/components/ai-features-list",["exports","@glimmer/component","@ember/helper","@ember/object","@ember/service","discourse/components/d-button","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-feature-card","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static{dt7948.g(this.prototype,"router",[o.service])}#e=void dt7948.i(this,"router")
get sortedModules(){return(this.args.modules||[]).toSorted((e,t)=>(e.module_name||"").localeCompare(t.module_name||""))}isSpamModule(e){return"spam"===e.module_name}static{dt7948.n(this.prototype,"isSpamModule",[i.action])}isAutomationModule(e){return"automation_reports"===e.module_name||"automation_triage"===e.module_name}static{dt7948.n(this.prototype,"isAutomationModule",[i.action])}featureName(e,t){return this.isAutomationModule(t)?e.name:(0,r.i18n)(`discourse_ai.features.${t.module_name}.${e.name}`)}static{dt7948.n(this.prototype,"featureName",[i.action])}transitionToAutomations(){this.router.transitionTo("/admin/plugins/automation/automation")}static{dt7948.n(this.prototype,"transitionToAutomations",[i.action])}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"mjqR79iL",block:'[[[10,0],[14,0,"ai-features-list"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["sortedModules"]]],null]],null],null,[[[1,"    "],[10,0],[14,0,"ai-module"],[15,"data-module-name",[30,1,["module_name"]]],[12],[1,"\\n      "],[10,0],[14,0,"ai-module__header"],[12],[1,"\\n        "],[10,0],[14,0,"ai-module__module-title"],[12],[1,"\\n          "],[10,"h3"],[12],[1,"\\n            "],[1,[28,[32,0],[[28,[32,1],["discourse_ai.features.",[30,1,["module_name"]],".name"],null]],null]],[1,"\\n          "],[13],[1,"\\n"],[41,[28,[30,0,["isSpamModule"]],[[30,1]],null],[[[1,"            "],[8,[32,2],[[24,0,"btn-default edit"]],[["@label","@route"],["discourse_ai.features.edit","adminPlugins.show.discourse-ai-spam"]],null],[1,"\\n"]],[]],[[[41,[28,[30,0,["isAutomationModule"]],[[30,1]],null],[[[1,"            "],[8,[32,2],[[24,0,"btn-default edit"]],[["@label","@action"],["discourse_ai.features.edit",[30,0,["transitionToAutomations"]]]],null],[1,"\\n"]],[]],[[[1,"            "],[8,[32,2],[[24,0,"btn-default edit"]],[["@label","@route","@routeModels"],["discourse_ai.features.edit","adminPlugins.show.discourse-ai-features.edit",[30,1,["id"]]]],null],[1,"\\n          "]],[]]]],[]]],[1,"        "],[13],[1,"\\n        "],[10,0],[12],[1,[28,[32,0],[[28,[32,1],["discourse_ai.features.",[30,1,["module_name"]],".description"],null]],null]],[13],[1,"\\n      "],[13],[1,"\\n\\n      "],[10,0],[14,0,"admin-section-landing-wrapper ai-feature-cards"],[12],[1,"\\n"],[41,[28,[32,3],[[28,[30,0,["isAutomationModule"]],[[30,1]],null],[28,[32,4],[[30,1,["features","length"]],0],null]],null],[[[1,"          "],[10,0],[12],[1,[28,[32,0],["discourse_ai.features.no_automations"],null]],[13],[1,"\\n"]],[]],[[[42,[28,[31,1],[[28,[31,1],[[30,1,["features"]]],null]],null],null,[[[1,"            "],[8,[32,5],null,[["@localizedFeatureName","@feature","@showGroups"],[[28,[30,0,["featureName"]],[[30,2],[30,1]],null],[30,2],[28,[32,6],[[28,[30,0,["isSpamModule"]],[[30,1]],null]],null]]],null],[1,"\\n"]],[2]],null]],[]]],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n"]],[1]],null],[13]],["module","feature"],["each","-track-array","if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-features-list.js",scope:()=>[r.i18n,s.concat,n.default,a.and,a.eq,l.default,a.not],isStrictMode:!0}),this)}}e.default=c})
define("discourse/plugins/discourse-ai/discourse/components/ai-features",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/service","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse/components/d-select","discourse/components/filter-input","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-default-llm-selector","discourse/plugins/discourse-ai/discourse/components/ai-features-list","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const _="configured",f="unconfigured"
class b extends t.default{static{dt7948.g(this.prototype,"adminPluginNavManager",[n.service])}#Q=void dt7948.i(this,"adminPluginNavManager")
static{dt7948.g(this.prototype,"filterValue",[s.tracked],function(){return""})}#Z=void dt7948.i(this,"filterValue")
static{dt7948.g(this.prototype,"selectedFeatureGroup",[s.tracked],function(){return _})}#ee=void dt7948.i(this,"selectedFeatureGroup")
constructor(){if(super(...arguments),this.args.features?.length>0){0===this.args.features.filter(e=>!0===e.module_enabled).length&&(this.selectedFeatureGroup=f)}}get featureGroupOptions(){return[{value:"all",label:(0,c.i18n)("discourse_ai.features.filters.all")},{value:_,label:(0,c.i18n)("discourse_ai.features.nav.configured")},{value:f,label:(0,c.i18n)("discourse_ai.features.nav.unconfigured")}]}get filteredFeatures(){if(!this.args.features||0===this.args.features.length)return[]
let e=this.args.features
if(this.selectedFeatureGroup===_?e=e.filter(e=>!0===e.module_enabled):this.selectedFeatureGroup===f&&(e=e.filter(e=>!1===e.module_enabled)),this.filterValue&&""!==this.filterValue.trim()){const t=this.filterValue.toLowerCase().trim(),s=(e,s)=>{try{if((0,c.i18n)(`discourse_ai.features.${e.module_name}.${s.name}`).toLowerCase().includes(t))return!0
const i=s.personas?.some(e=>e.name?.toLowerCase().includes(t)),o=s.llm_models?.some(e=>e.name?.toLowerCase().includes(t)),n=s.personas?.some(e=>e.allowed_groups?.some(e=>e.name?.toLowerCase().includes(t)))
return i||o||n}catch(i){return console.error("Error filtering features",i),!1}}
e=e.filter(e=>{try{return!!(0,c.i18n)(`discourse_ai.features.${e.module_name}.name`).toLowerCase().includes(t)||(e.features||[]).some(t=>s(e,t))}catch(i){return console.error("Error filtering features",i),!1}}),e=e.map(e=>{try{if((0,c.i18n)(`discourse_ai.features.${e.module_name}.name`).toLowerCase().includes(t))return e
const i=(e.features||[]).filter(t=>s(e,t))
return Object.assign({},e,{features:i})}catch(i){return console.error("Error filtering features",i),e}}).filter(e=>e.features&&e.features.length>0)}return e}onFilterChange(e){this.filterValue=e.target?.value||""}static{dt7948.n(this.prototype,"onFilterChange",[o.action])}onFeatureGroupChange(e){this.selectedFeatureGroup=e}static{dt7948.n(this.prototype,"onFeatureGroupChange",[o.action])}resetAndFocus(){this.filterValue="",this.selectedFeatureGroup=_,document.querySelector(".admin-filter__input").focus()}static{dt7948.n(this.prototype,"resetAndFocus",[o.action])}static{(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"mHgVxhNj",block:'[[[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-features"]],[28,[32,1],["discourse_ai.features.short_title"],null]]],null],[1,"\\n"],[10,"section"],[14,0,"ai-features admin-detail"],[12],[1,"\\n  "],[8,[32,2],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[28,[32,1],["discourse_ai.features.short_title"],null],[28,[32,1],["discourse_ai.features.description"],null],"todo"]],null],[1,"\\n\\n  "],[10,0],[14,0,"ai-features__controls"],[12],[1,"\\n    "],[8,[32,3],null,[["@value","@includeNone","@onChange"],[[30,0,["selectedFeatureGroup"]],false,[30,0,["onFeatureGroupChange"]]]],[["default"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["featureGroupOptions"]]],null]],null],null,[[[1,"        "],[8,[30,1,["Option"]],null,[["@value"],[[30,2,["value"]]]],[["default"],[[[[1,"\\n          "],[1,[30,2,["label"]]],[1,"\\n        "]],[]]]]],[1,"\\n"]],[2]],null],[1,"    "]],[1]]]]],[1,"\\n\\n    "],[8,[32,4],[[16,"placeholder",[28,[32,1],["discourse_ai.features.filters.text"],null]],[24,0,"admin-filter__input"]],[["@filterAction","@value","@icons"],[[30,0,["onFilterChange"]],[30,0,["filterValue"]],[28,[32,5],null,[["left"],["magnifying-glass"]]]]],null],[1,"\\n  "],[13],[1,"\\n\\n  "],[8,[32,6],null,null,null],[1,"\\n\\n"],[41,[30,0,["filteredFeatures","length"]],[[[1,"    "],[8,[32,7],null,[["@modules"],[[30,0,["filteredFeatures"]]]],null],[1,"\\n"]],[]],[[[1,"    "],[10,0],[14,0,"ai-features__no-results"],[12],[1,"\\n      "],[10,"h3"],[12],[1,[28,[32,1],["discourse_ai.features.filters.no_results"],null]],[13],[1,"\\n      "],[8,[32,8],[[24,0,"btn-default"]],[["@icon","@label","@action"],["arrow-rotate-left","discourse_ai.features.filters.reset",[30,0,["resetAndFocus"]]]],null],[1,"\\n    "],[13],[1,"\\n"]],[]]],[13]],["select","option"],["each","-track-array","if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-features.js",scope:()=>[a.default,c.i18n,l.default,d.default,u.default,i.hash,p.default,m.default,r.default],isStrictMode:!0}),this)}}e.default=b}),define("discourse/plugins/discourse-ai/discourse/components/ai-full-page-search",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-update","@ember/service","discourse/components/d-toggle-switch","discourse/controllers/full-page-search","discourse/float-kit/components/d-tooltip","discourse/helpers/concat-class","discourse/helpers/d-icon","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/search","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const y="full-page-search:ai-results-toggled"
class v extends t.default{static{dt7948.g(this.prototype,"appEvents",[a.service])}#j=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"siteSettings",[a.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"searching",[s.tracked])}#te=void dt7948.i(this,"searching")
static{dt7948.g(this.prototype,"AiResults",[s.tracked],function(){return[]})}#se=void dt7948.i(this,"AiResults")
static{dt7948.g(this.prototype,"showingAiResults",[s.tracked],function(){return!1})}#ie=void dt7948.i(this,"showingAiResults")
static{dt7948.g(this.prototype,"sortOrder",[s.tracked],function(){return this.args.sortOrder})}#oe=void dt7948.i(this,"sortOrder")
static{dt7948.g(this.prototype,"autoEnabledForZeroResults",[s.tracked],function(){return!1})}#ne=void dt7948.i(this,"autoEnabledForZeroResults")
static{dt7948.g(this.prototype,"shouldAutoEnableWhenAiReady",[s.tracked],function(){return!1})}#ae=void dt7948.i(this,"shouldAutoEnableWhenAiReady")
initialSearchTerm=this.args.searchTerm
constructor(){super(...arguments),this.appEvents.on("full-page-search:trigger-search",this,this.onSearch),this.appEvents.on("search:search_result_view",this,this.onSearchResultsLoaded),this.onSearch()}willDestroy(){super.willDestroy(...arguments),this.appEvents.off("full-page-search:trigger-search",this,this.onSearch),this.appEvents.off("search:search_result_view",this,this.onSearchResultsLoaded)}onSearch(){if(this.searchEnabled)return this.initialSearchTerm=this.args.searchTerm,this.searching=!0,this.autoEnabledForZeroResults=!1,this.shouldAutoEnableWhenAiReady=!1,this.resetAiResults(),this.performHyDESearch()}static{dt7948.n(this.prototype,"onSearch",[o.action])}onSearchResultsLoaded(){this.hasZeroRegularResults&&!this.showingAiResults&&!this.autoEnabledForZeroResults&&this.AiResults.length>0?(this.autoEnabledForZeroResults=!0,this.showingAiResults=!0,this.args.addSearchResults(this.AiResults,"topic_id"),this.appEvents.trigger(y,{enabled:!0})):!this.hasZeroRegularResults||this.showingAiResults||this.autoEnabledForZeroResults||0!==this.AiResults.length||(this.shouldAutoEnableWhenAiReady=!0)}static{dt7948.n(this.prototype,"onSearchResultsLoaded",[o.action])}get disableToggleSwitch(){if(this.searching||0===this.AiResults.length||!this.validSearchOrder)return!0}get validSearchOrder(){return 0===this.sortOrder}get hasZeroRegularResults(){if(!this.args.model)return!1
return(this.args.model.posts?.length||0)+(this.args.model.categories?.length||0)+(this.args.model.tags?.length||0)+(this.args.model.users?.length||0)===0}get searchStateText(){return this.validSearchOrder?this.autoEnabledForZeroResults&&this.showingAiResults&&this.AiResults.length>0?(0,g.i18n)("discourse_ai.embeddings.semantic_search_results.zero_results_expanded",{count:this.AiResults.length}):this.searching?(0,g.i18n)("discourse_ai.embeddings.semantic_search_loading"):this.AiResults.length&&this.showingAiResults?(0,g.i18n)("discourse_ai.embeddings.semantic_search_results.toggle",{count:this.AiResults.length}):this.AiResults.length&&!this.showingAiResults?(0,g.i18n)("discourse_ai.embeddings.semantic_search_results.toggle_hidden",{count:this.AiResults.length}):0===this.AiResults.length&&this.searchTerm!==this.initialSearchTerm?(0,g.i18n)("discourse_ai.embeddings.semantic_search_results.new"):0===this.AiResults.length?(0,g.i18n)("discourse_ai.embeddings.semantic_search_results.none"):void 0:(0,g.i18n)("discourse_ai.embeddings.semantic_search_results.unavailable")}get settled(){return this.validSearchOrder&&!this.searching&&this.searchTerm===this.initialSearchTerm}get noResults(){return this.settled&&0===this.AiResults.length}get searchTerm(){return this.initialSearchTerm!==this.args.searchTerm&&(this.initialSearchTerm=void 0),this.args.searchTerm}get searchEnabled(){return this.args.searchType===l.SEARCH_TYPE_DEFAULT&&(0,h.isValidSearchTerm)(this.searchTerm,this.siteSettings)&&this.validSearchOrder}get searchClass(){return this.validSearchOrder?this.searching?"in-progress":this.noResults?"no-results":void 0:"unavailable"}get tooltipText(){return(0,g.i18n)("discourse_ai.embeddings.semantic_search_tooltips."+(this.validSearchOrder?"results_explanation":"invalid_sort"))}toggleAiResults(){this.appEvents.trigger(y,{enabled:!this.showingAiResults}),this.showingAiResults?(this.args.addSearchResults([],"topic_id"),this.autoEnabledForZeroResults=!1):this.args.addSearchResults(this.AiResults,"topic_id"),this.showingAiResults=!this.showingAiResults}static{dt7948.n(this.prototype,"toggleAiResults",[o.action])}resetAiResults(){this.AiResults=[],this.showingAiResults=!1,this.args.addSearchResults([],"topic_id")}static{dt7948.n(this.prototype,"resetAiResults",[o.action])}performHyDESearch(){this.resetAiResults(),(0,p.ajax)("/discourse-ai/embeddings/semantic-search",{data:{q:this.searchTerm}}).then(async e=>{const t=await(0,h.translateResults)(e)||{}
0!==t.posts?.length&&(t.posts.forEach(e=>{e.generatedByAi=!0}),this.AiResults=t.posts,this.shouldAutoEnableWhenAiReady&&!this.showingAiResults&&!this.autoEnabledForZeroResults&&this.AiResults.length>0&&(this.autoEnabledForZeroResults=!0,this.showingAiResults=!0,this.shouldAutoEnableWhenAiReady=!1,this.args.addSearchResults(this.AiResults,"topic_id"),this.appEvents.trigger(y,{enabled:!0})))}).catch(m.popupAjaxError).finally(()=>{this.searching=!1})}sortChanged(){this.sortOrder!==this.args.sortOrder&&(this.sortOrder=this.args.sortOrder,this.validSearchOrder?this.onSearch():(this.showingAiResults=!1,this.resetAiResults()))}static{dt7948.n(this.prototype,"sortChanged",[o.action])}static{(0,f.setComponentTemplate)((0,b.createTemplateFactory)({id:"Z82upd94",block:'[[[11,0],[24,0,"semantic-search__container search-results"],[24,"role","region"],[4,[32,0],[[30,0,["sortChanged"]],[30,1]],null],[12],[1,"\\n  "],[10,0],[14,0,"semantic-search__results"],[12],[1,"\\n    "],[10,0],[15,0,[28,[32,1],["semantic-search__searching",[30,0,["searchClass"]]],null]],[12],[1,"\\n      "],[8,[32,2],[[16,"disabled",[30,0,["disableToggleSwitch"]]],[24,0,"semantic-search__results-toggle"],[4,[32,3],["click",[30,0,["toggleAiResults"]]],null]],[["@state"],[[30,0,["showingAiResults"]]]],null],[1,"\\n\\n      "],[10,0],[14,0,"semantic-search__searching-text"],[12],[1,"\\n        "],[1,[28,[32,4],["discourse-sparkles"],null]],[1,"\\n        "],[1,[30,0,["searchStateText"]]],[1,"\\n      "],[13],[1,"\\n\\n"],[41,[30,0,["validSearchOrder"]],[[[1,"        "],[8,[32,5],null,[["@loading"],[[30,0,["searching"]]]],null],[1,"\\n"]],[]],null],[1,"\\n      "],[8,[32,6],[[24,0,"semantic-search__tooltip"]],[["@identifier"],["semantic-search-tooltip"]],[["trigger","content"],[[[[1,"\\n          "],[1,[28,[32,4],["far-circle-question"],null]],[1,"\\n        "]],[]],[[[1,"\\n          "],[1,[30,0,["tooltipText"]]],[1,"\\n        "]],[]]]]],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"],[13]],["@sortOrder"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-full-page-search.js",scope:()=>[n.default,u.default,r.default,i.on,c.default,_.default,d.default],isStrictMode:!0}),this)}}e.default=v}),define("discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle",["exports","@glimmer/component","@ember/helper","@ember/object","@ember/service","discourse/components/d-button","discourse/components/dropdown-menu","discourse/float-kit/components/d-menu","discourse/helpers/d-icon","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/services/gists","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static{dt7948.g(this.prototype,"gists",[o.service])}#re=void dt7948.i(this,"gists")
get buttons(){return[{id:c.TABLE_LAYOUT,label:"discourse_ai.summarization.topic_list_layout.button.compact",icon:"discourse-table"},{id:c.TABLE_AI_LAYOUT,label:"discourse_ai.summarization.topic_list_layout.button.expanded",icon:"discourse-table-sparkles",description:"discourse_ai.summarization.topic_list_layout.button.expanded_description"}]}get selectedOptionId(){return this.gists.currentPreference}get currentButton(){return this.buttons.find(e=>e.id===this.selectedOptionId)||this.buttons[0]}onRegisterApi(e){this.dMenu=e}static{dt7948.n(this.prototype,"onRegisterApi",[i.action])}onSelect(e){this.gists.setPreference(e),this.dMenu.close()}static{dt7948.n(this.prototype,"onSelect",[i.action])}static{(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"UxfiXTy8",block:'[[[41,[30,0,["gists","showToggle"]],[[[1,"  "],[8,[32,0],null,[["@modalForMobile","@autofocus","@identifier","@onRegisterApi","@triggerClass"],[true,true,"topic-list-layout",[30,0,["onRegisterApi"]],"btn-default btn-icon"]],[["trigger","content"],[[[[1,"\\n      "],[1,[28,[32,1],[[30,0,["currentButton","icon"]]],null]],[1,"\\n    "]],[]],[[[1,"\\n      "],[8,[32,2],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["buttons"]]],null]],null],null,[[[1,"          "],[8,[30,1,["item"]],[[16,0,[52,[28,[32,3],[[30,0,["currentButton","id"]],[30,2,["id"]]],null],"--selected"]]],null,[["default"],[[[[1,"\\n            "],[8,[32,4],[[16,0,[29,["btn-transparent\\n                ",[52,[30,2,["description"]],"--with-description"]]]]],[["@label","@icon","@action"],[[30,2,["label"]],[30,2,["icon"]],[28,[32,5],[[30,0,["onSelect"]],[30,2,["id"]]],null]]],[["default"],[[[[1,"\\n"],[41,[30,2,["description"]],[[[1,"                "],[10,0],[14,0,"btn__description"],[12],[1,"\\n                  "],[1,[28,[32,6],[[30,2,["description"]]],null]],[1,"\\n                "],[13],[1,"\\n"]],[]],null],[1,"            "]],[]]]]],[1,"\\n          "]],[]]]]],[1,"\\n"]],[2]],null],[1,"      "]],[1]]]]],[1,"\\n    "]],[]]]]],[1,"\\n"]],[]],null]],["dropdown","button"],["if","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle.js",scope:()=>[r.default,l.default,a.default,d.eq,n.default,s.fn,u.i18n],isStrictMode:!0}),this)}}e.default=h}),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt",["exports","@glimmer/component","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/helpers/with-event-value","discourse/truth-helpers","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{sendInput(e){if("Enter"===e.key)return this.args.submit(this.args.promptArgs)}static{dt7948.n(this.prototype,"sendInput",[o.action])}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"NvOiGme1",block:'[[[10,0],[14,0,"ai-custom-prompt"],[12],[1,"\\n\\n  "],[11,"input"],[16,2,[30,1]],[16,"placeholder",[28,[32,0],["discourse_ai.ai_helper.context_menu.custom_prompt.placeholder"],null]],[24,0,"ai-custom-prompt__input"],[24,"autofocus","autofocus"],[24,4,"text"],[4,[32,1],["input",[28,[32,2],[[28,[32,3],[[28,[31,0],[[30,1]],null]],null]],null]],null],[4,[32,1],["keydown",[30,0,["sendInput"]]],null],[12],[13],[1,"\\n\\n  "],[8,[32,4],[[24,0,"ai-custom-prompt__submit btn-primary"]],[["@icon","@action","@disabled"],["discourse-sparkles",[28,[32,3],[[30,2],[30,3]],null],[28,[32,5],[[30,1,["length"]]],null]]],null],[1,"\\n"],[13]],["@value","@submit","@promptArgs"],["mut"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt.js",scope:()=>[l.i18n,i.on,a.default,s.fn,n.default,r.not],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-loading",["exports","discourse/components/d-button","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"m01xbwss",block:'[[[10,0],[14,0,"ai-helper-loading"],[12],[1,"\\n  "],[10,0],[14,0,"dot-falling"],[12],[13],[1,"\\n  "],[10,1],[12],[1,"\\n    "],[1,[28,[32,0],["discourse_ai.ai_helper.context_menu.loading"],null]],[1,"\\n  "],[13],[1,"\\n  "],[8,[32,1],[[24,0,"btn-flat cancel-request"]],[["@icon","@title","@action"],["xmark","discourse_ai.ai_helper.context_menu.cancel",[30,1]]],null],[1,"\\n"],[13]],["@cancel"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-loading.js",scope:()=>[s.i18n,t.default],isStrictMode:!0}),(0,n.default)(void 0,"ai-helper-loading:AiHelperLoading"))
e.default=a}),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list",["exports","@glimmer/component","@ember/helper","@ember/service","discourse/components/d-button","discourse/lib/utilities","discourse/services/keyboard-shortcuts","discourse/truth-helpers","discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static{dt7948.g(this.prototype,"site",[i.service])}#S=void dt7948.i(this,"site")
get showShortcut(){return this.site.desktopView&&this.args.shortcutVisible}get shortcut(){return(0,n.translateModKey)(`${a.PLATFORM_KEY_MODIFIER} alt p`)}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"P/vOyKfp",block:'[[[10,"ul"],[14,0,"ai-helper-options"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,1]],null]],null],null,[[[41,[28,[32,0],[[30,2,["name"]],"custom_prompt"],null],[[[1,"      "],[8,[32,1],null,[["@value","@promptArgs","@submit"],[[30,3],[30,2],[30,4]]],null],[1,"\\n"]],[]],[[[1,"      "],[10,"li"],[15,"data-name",[30,2,["translated_name"]]],[15,"data-value",[30,2,["name"]]],[12],[1,"\\n        "],[8,[32,2],[[16,"data-name",[30,2,["name"]]],[24,0,"ai-helper-options__button"]],[["@icon","@translatedLabel","@action"],[[30,2,["icon"]],[30,2,["translated_name"]],[28,[32,3],[[30,4],[30,2]],null]]],[["default"],[[[[1,"\\n"],[41,[28,[32,4],[[28,[32,0],[[30,2,["name"]],"proofread"],null],[30,0,["showShortcut"]]],null],[[[1,"            "],[10,"kbd"],[14,0,"shortcut"],[12],[1,[30,0,["shortcut"]]],[13],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n      "],[13],[1,"\\n"]],[]]]],[2]],null],[13]],["@options","option","@customPromptValue","@performAction"],["each","-track-array","if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list.js",scope:()=>[r.eq,l.default,o.default,s.fn,r.and],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave",["exports","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o=[".",".","."],n=(0,t.setComponentTemplate)((0,s.createTemplateFactory)({id:"jDNLNjRa",block:'[[[41,[30,1],[[[1,"  "],[10,1],[14,0,"ai-indicator-wave"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[32,0]],null]],null],null,[[[1,"      "],[10,1],[14,0,"ai-indicator-wave__dot"],[12],[1,[30,2]],[13],[1,"\\n"]],[2]],null],[1,"  "],[13],[1,"\\n"]],[]],null]],["@loading","dot"],["if","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave.js",scope:()=>[o],isStrictMode:!0}),(0,i.default)(void 0,"ai-indicator-wave:AiIndicatorWave"))
e.default=n}),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-attachment-types",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","discourse/lib/array-tools","discourse/select-kit/components/list-setting","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const u=["pdf","txt","doc","docx","rtf","html","markdown"]
class c extends t.default{static{dt7948.g(this.prototype,"currentValue",[s.tracked],function(){return this.args.value||[]})}#le=void dt7948.i(this,"currentValue")
get settingChoices(){return(0,n.uniqueItemsFromArray)([...u,...this.currentValue]).sort()}handleChange(e){const t=(e||[]).map(e=>e.toString().toLowerCase().trim()).filter(Boolean)
this.currentValue=(0,n.uniqueItemsFromArray)(t),this.args.onChange?.(this.currentValue)}static{dt7948.n(this.prototype,"handleChange",[o.action])}static{(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"b6hvZHlP",block:'[[[8,[32,0],null,[["@value","@settingName","@choices","@onChange","@allowAny","@options"],[[30,0,["currentValue"]],"allowed_attachment_types",[30,0,["settingChoices"]],[30,0,["handleChange"]],true,[28,[32,1],null,[["noneLabel"],[[28,[32,2],["discourse_ai.llms.attachment_types_placeholder"],null]]]]]],null]],[],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llm-attachment-types.js",scope:()=>[a.default,i.hash,r.i18n],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/routing","@ember/runloop","@ember/service","discourse/admin/models/admin-user","discourse/components/conditional-loading-spinner","discourse/components/form","discourse/helpers/bound-avatar-template","discourse/helpers/d-icon","discourse/lib/ajax-error","discourse/lib/array-tools","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-llm-attachment-types","discourse/plugins/discourse-ai/discourse/components/ai-quota-duration-selector","discourse/plugins/discourse-ai/discourse/components/ai-secret-selector","discourse/plugins/discourse-ai/discourse/components/modal/ai-llm-quota-modal","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class x extends t.default{static{dt7948.g(this.prototype,"toasts",[r.service])}#U=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"router",[r.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"dialog",[r.service])}#H=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"modal",[r.service])}#O=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"isSaving",[s.tracked],function(){return!1})}#z=void dt7948.i(this,"isSaving")
static{dt7948.g(this.prototype,"testRunning",[s.tracked],function(){return!1})}#W=void dt7948.i(this,"testRunning")
static{dt7948.g(this.prototype,"testResult",[s.tracked],function(){return null})}#K=void dt7948.i(this,"testResult")
static{dt7948.g(this.prototype,"testError",[s.tracked],function(){return null})}#Y=void dt7948.i(this,"testError")
static{dt7948.g(this.prototype,"testValidationErrors",[s.tracked],function(){return null})}#de=void dt7948.i(this,"testValidationErrors")
get formData(){if(this.args.llmTemplate){let[e,t]=this.args.llmTemplate.split(/-(.*)/)
if("none"===e)return{provider_params:{}}
const s=this.args.llms.resultSetMeta.presets.find(t=>t.id===e),i=s.models.find(e=>e.name===t)
return{max_prompt_tokens:i.tokens,max_output_tokens:i.max_output_tokens,tokenizer:s.tokenizer,url:i.endpoint||s.endpoint,display_name:i.display_name,name:i.name,provider:s.provider,provider_params:this.computeProviderParams(s.provider,i.provider_params??{}),input_cost:i.input_cost,output_cost:i.output_cost,cached_input_cost:i.cached_input_cost,vision_enabled:i.vision_enabled||!1,cache_write_cost:i.cache_write_cost,allowed_attachment_types:[]}}const{model:e}=this.args
return{max_prompt_tokens:e.max_prompt_tokens,max_output_tokens:e.max_output_tokens,ai_secret_id:e.ai_secret_id,tokenizer:e.tokenizer,url:e.url,display_name:e.display_name,name:e.name,provider:e.provider,vision_enabled:e.vision_enabled,input_cost:e.input_cost,output_cost:e.output_cost,cached_input_cost:e.cached_input_cost,cache_write_cost:e.cache_write_cost,provider_params:this.computeProviderParams(e.provider,e.provider_params),llm_quotas:e.llm_quotas,allowed_attachment_types:e.allowed_attachment_types||[]}}static{dt7948.n(this.prototype,"formData",[s.cached])}get availableSecrets(){return this.args.llms.resultSetMeta?.ai_secrets||[]}get selectedProviders(){return this.args.llms.resultSetMeta.providers.map(e=>{return{id:e,name:(t=e,(0,_.i18n)(`discourse_ai.llms.providers.${t}`))}
var t}).sort((e,t)=>e.name.localeCompare(t.name))}get tokenizers(){return this.args.llms.resultSetMeta.tokenizers.sort((e,t)=>e.name.localeCompare(t.name))}get adminUser(){return l.default.create(this.args.model?.user)}get testErrorMessage(){return this.testValidationErrors?.length>0?(0,_.i18n)("discourse_ai.llms.tests.invalid_config"):(0,_.i18n)("discourse_ai.llms.tests.failure",{error:this.testError})}get displayTestResult(){return this.testRunning||null!==this.testResult}get modulesUsingModel(){const e=this.args.model.used_by?.filter(e=>"ai_bot"!==e.type)
if(!e||0===e.length)return null
return e.map(e=>(0,_.i18n)(`discourse_ai.llms.usage.${e.type}`,{persona:e.name})).join(", ")}get inUseWarning(){return(0,_.i18n)("discourse_ai.llms.in_use_warning",{settings:this.modulesUsingModel,count:this.args.model.used_by.length})}get showAddQuotaButton(){return!this.args.model.isNew}computeProviderParams(e,t={}){const s=this.args.llms.resultSetMeta.provider_params[e]??{}
return Object.fromEntries(Object.entries(s).map(([e,s])=>[e,t[e]??("enum"===s?.type?s.default:null)]))}canEditURL(e){return"aws_bedrock"!==e}static{dt7948.n(this.prototype,"canEditURL",[o.action])}openAddQuotaModal(e){this.modal.show(v.default,{model:{llm:this.args.model,addItemToCollection:e}})}static{dt7948.n(this.prototype,"openAddQuotaModal",[o.action])}metaProviderParams(e){const t=this.args.llms.resultSetMeta.provider_params[e]||{}
return Object.entries(t).reduce((e,[t,s])=>("string"==typeof s?e[t]={type:s}:"object"==typeof s?(s.values&&((s={...s}).values=s.values.map(e=>({id:e,name:e}))),e[t]={type:s.type||"text",values:s.values||[],default:s.default??void 0}):e[t]={type:"text"},e),{})}static{dt7948.n(this.prototype,"metaProviderParams",[o.action])}async save(e){this.isSaving=!0
const t=this.args.model.isNew,s={...e}
e.max_output_tokens||(s.max_output_tokens=null)
try{await this.args.model.save(s),t&&((0,h.addUniqueValueToArray)(this.args.llms.content,this.args.model),await this.router.replaceWith("adminPlugins.show.discourse-ai-llms.edit",this.args.model.id)),this.toasts.success({data:{message:(0,_.i18n)("discourse_ai.llms.saved")},duration:"short"})}catch(i){(0,m.popupAjaxError)(i)}finally{(0,a.later)(()=>{this.isSaving=!1},1e3)}}static{dt7948.n(this.prototype,"save",[o.action])}async test(e){this.testRunning=!0
try{const t=this.args.model.seeded?{...e,id:this.args.model.id}:e,s=await this.args.model.testConfig(t)
this.testResult=s.success,this.testResult?(this.testError=null,this.testValidationErrors=null):(this.testError=s.error,this.testValidationErrors=s.validation_errors)}catch(t){(0,m.popupAjaxError)(t)}finally{(0,a.later)(()=>{this.testRunning=!1},1e3)}}static{dt7948.n(this.prototype,"test",[o.action])}setProvider(e,{set:t}){t("provider_params",this.computeProviderParams(e)),t("provider",e)}static{dt7948.n(this.prototype,"setProvider",[o.action])}delete(){return this.dialog.confirm({message:(0,_.i18n)("discourse_ai.llms.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then(()=>{(0,h.removeValueFromArray)(this.args.llms.content,this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-llms.index")}).catch(m.popupAjaxError)})}static{dt7948.n(this.prototype,"delete",[o.action])}providerParamsKeys(e){return e?Object.keys(e):[]}static{dt7948.n(this.prototype,"providerParamsKeys",[o.action])}static{(0,w.setComponentTemplate)((0,S.createTemplateFactory)({id:"vKmHwJfa",block:'[[[8,[32,0],[[24,0,"ai-llm-editor"]],[["@onSubmit","@data"],[[30,0,["save"]],[30,0,["formData"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["modulesUsingModel"]],[[[1,"    "],[8,[30,1,["Alert"]],null,[["@icon"],["circle-info"]],[["default"],[[[[1,"\\n      "],[1,[30,0,["inUseWarning"]]],[1,"\\n    "]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n  "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip","@disabled"],["display_name",[28,[32,1],["discourse_ai.llms.display_name"],null],"required|length:1,100","large",[28,[32,1],["discourse_ai.llms.hints.display_name"],null],[30,3,["seeded"]]]],[["default"],[[[[1,"\\n    "],[8,[30,4,["Input"]],null,null,null],[1,"\\n  "]],[4]]]]],[1,"\\n\\n  "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@validation","@format","@disabled"],["name",[28,[32,1],["discourse_ai.llms.name"],null],[28,[32,1],["discourse_ai.llms.hints.name"],null],"required","large",[30,3,["seeded"]]]],[["default"],[[[[1,"\\n    "],[8,[30,5,["Input"]],null,null,null],[1,"\\n  "]],[5]]]]],[1,"\\n\\n"],[41,[51,[30,3,["seeded"]]],[[[1,"    "],[8,[30,1,["Field"]],null,[["@name","@title","@format","@validation","@onSet"],["provider",[28,[32,1],["discourse_ai.llms.provider"],null],"large","required",[30,0,["setProvider"]]]],[["default"],[[[[1,"\\n      "],[8,[30,6,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,0,["selectedProviders"]]],null]],null],null,[[[1,"          "],[8,[30,7,["Option"]],null,[["@value"],[[30,8,["id"]]]],[["default"],[[[[1,[30,8,["name"]]]],[]]]]],[1,"\\n"]],[8]],null],[1,"      "]],[7]]]]],[1,"\\n    "]],[6]]]]],[1,"\\n\\n"],[41,[28,[30,0,["canEditURL"]],[[30,2,["provider"]]],null],[[[1,"      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format"],["url",[28,[32,1],["discourse_ai.llms.url"],null],"required","large"]],[["default"],[[[[1,"\\n        "],[8,[30,9,["Input"]],null,null,null],[1,"\\n      "]],[9]]]]],[1,"\\n"]],[]],null],[1,"\\n    "],[8,[30,1,["Field"]],null,[["@name","@title","@format"],["ai_secret_id",[28,[32,1],["discourse_ai.llms.api_key"],null],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,10,["Custom"]],null,null,[["default"],[[[[1,"\\n        "],[8,[32,2],null,[["@value","@secrets","@onChange"],[[30,2,["ai_secret_id"]],[30,0,["availableSecrets"]],[30,10,["set"]]]],null],[1,"\\n      "]],[]]]]],[1,"\\n    "]],[10]]]]],[1,"\\n\\n    "],[8,[30,1,["Object"]],null,[["@name"],["provider_params"]],[["default"],[[[[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[28,[30,0,["providerParamsKeys"]],[[30,12]],null]],null]],null],null,[[[44,[[28,[32,3],[[28,[30,0,["metaProviderParams"]],[[30,2,["provider"]]],null],[30,13]],null]],[[[1,"          "],[8,[30,11,["Field"]],null,[["@name","@title","@format"],[[30,13],[28,[32,1],[[28,[32,4],["discourse_ai.llms.provider_fields.",[30,13]],null]],null],"large"]],[["default"],[[[[1,"\\n"],[41,[28,[32,5],[[30,14,["type"]],"enum"],null],[[[1,"              "],[8,[30,15,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,14,["values"]]],null]],null],null,[[[1,"                  "],[8,[30,16,["Option"]],null,[["@value"],[[30,17,["id"]]]],[["default"],[[[[1,[30,17,["name"]]]],[]]]]],[1,"\\n"]],[17]],null],[1,"              "]],[16]]]]],[1,"\\n"]],[]],[[[41,[28,[32,5],[[30,14,["type"]],"checkbox"],null],[[[1,"              "],[8,[30,15,["Checkbox"]],null,null,null],[1,"\\n"]],[]],[[[41,[28,[32,5],[[30,14,["type"]],"secret"],null],[[[1,"              "],[8,[30,15,["Custom"]],null,null,[["default"],[[[[1,"\\n                "],[8,[32,2],null,[["@value","@secrets","@onChange"],[[30,15,["value"]],[30,0,["availableSecrets"]],[30,15,["set"]]]],null],[1,"\\n              "]],[]]]]],[1,"\\n"]],[]],[[[1,"              "],[8,[30,15,["Input"]],null,[["@type"],[[30,14,["type"]]]],null],[1,"\\n            "]],[]]]],[]]]],[]]],[1,"          "]],[15]]]]],[1,"\\n"]],[14]]]],[13]],null],[1,"    "]],[11,12]]]]],[1,"\\n\\n    "],[8,[30,1,["Field"]],null,[["@name","@title","@format","@validation"],["tokenizer",[28,[32,1],["discourse_ai.llms.tokenizer"],null],"large","required"]],[["default"],[[[[1,"\\n      "],[8,[30,18,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,0,["tokenizers"]]],null]],null],null,[[[1,"          "],[8,[30,19,["Option"]],null,[["@value"],[[30,20,["id"]]]],[["default"],[[[[1,[30,20,["name"]]]],[]]]]],[1,"\\n"]],[20]],null],[1,"      "]],[19]]]]],[1,"\\n    "]],[18]]]]],[1,"\\n\\n    "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@validation","@format"],["max_prompt_tokens",[28,[32,1],["discourse_ai.llms.max_prompt_tokens"],null],[28,[32,1],["discourse_ai.llms.hints.max_prompt_tokens"],null],"required","large"]],[["default"],[[[[1,"\\n      "],[8,[30,21,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n    "]],[21]]]]],[1,"\\n\\n    "],[8,[30,1,["InputGroup"]],null,null,[["default"],[[[[1,"\\n      "],[8,[30,22,["Field"]],null,[["@name","@title","@tooltip","@helpText"],["input_cost",[28,[32,1],["discourse_ai.llms.cost_input"],null],[28,[32,1],["discourse_ai.llms.hints.cost_input"],null],[28,[32,1],["discourse_ai.llms.hints.cost_measure"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,23,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n      "]],[23]]]]],[1,"\\n\\n      "],[8,[30,22,["Field"]],null,[["@name","@title","@tooltip","@helpText"],["cached_input_cost",[28,[32,1],["discourse_ai.llms.cost_cached_input"],null],[28,[32,1],["discourse_ai.llms.hints.cost_cached_input"],null],[28,[32,1],["discourse_ai.llms.hints.cost_measure"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,24,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n      "]],[24]]]]],[1,"\\n\\n      "],[8,[30,22,["Field"]],null,[["@name","@title","@tooltip","@helpText"],["cache_write_cost",[28,[32,1],["discourse_ai.llms.cost_cache_write"],null],[28,[32,1],["discourse_ai.llms.hints.cost_cache_write"],null],[28,[32,1],["discourse_ai.llms.hints.cost_measure"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,25,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n      "]],[25]]]]],[1,"\\n\\n      "],[8,[30,22,["Field"]],null,[["@name","@title","@tooltip","@helpText"],["output_cost",[28,[32,1],["discourse_ai.llms.cost_output"],null],[28,[32,1],["discourse_ai.llms.hints.cost_output"],null],[28,[32,1],["discourse_ai.llms.hints.cost_measure"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,26,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n      "]],[26]]]]],[1,"\\n    "]],[22]]]]],[1,"\\n\\n    "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@format"],["max_output_tokens",[28,[32,1],["discourse_ai.llms.max_output_tokens"],null],[28,[32,1],["discourse_ai.llms.hints.max_output_tokens"],null],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,27,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n    "]],[27]]]]],[1,"\\n\\n    "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@format"],["vision_enabled",[28,[32,1],["discourse_ai.llms.vision_enabled"],null],[28,[32,1],["discourse_ai.llms.hints.vision_enabled"],null],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,28,["Checkbox"]],null,null,null],[1,"\\n    "]],[28]]]]],[1,"\\n\\n    "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@format"],["allowed_attachment_types",[28,[32,1],["discourse_ai.llms.allowed_attachment_types"],null],[28,[32,1],["discourse_ai.llms.hints.allowed_attachment_types"],null],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,29,["Label"]],null,null,null],[1,"\\n      "],[8,[30,29,["Custom"]],null,null,[["default"],[[[[1,"\\n        "],[8,[32,6],null,[["@value","@onChange"],[[30,29,["value"]],[30,29,["set"]]]],null],[1,"\\n      "]],[]]]]],[1,"\\n      "],[8,[30,29,["Hint"]],null,null,null],[1,"\\n    "]],[29]]]]],[1,"\\n\\n"],[41,[30,3,["user"]],[[[1,"      "],[8,[30,1,["Container"]],null,[["@title"],[[28,[32,1],["discourse_ai.llms.ai_bot_user"],null]]],[["default"],[[[[1,"\\n        "],[10,3],[14,0,"avatar"],[15,6,[30,3,["user","path"]]],[15,"data-user-card",[30,3,["user","username"]]],[12],[1,"\\n          "],[1,[28,[32,7],[[30,3,["user","avatar_template"]],"small"],null]],[1,"\\n        "],[13],[1,"\\n        "],[8,[32,8],null,[["@route","@model"],["adminUser",[30,0,["adminUser"]]]],[["default"],[[[[1,"\\n          "],[1,[30,3,["user","username"]]],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[]]]]],[1,"\\n"]],[]],null]],[]],null],[1,"\\n"],[41,[28,[32,9],[[30,2,["llm_quotas","length"]],0],null],[[[1,"    "],[8,[30,1,["Container"]],null,[["@title"],[[28,[32,1],["discourse_ai.llms.quotas.title"],null]]],[["default"],[[[[1,"\\n      "],[10,"table"],[14,0,"ai-llm-quotas__table"],[12],[1,"\\n        "],[10,"thead"],[14,0,"ai-llm-quotas__table-head"],[12],[1,"\\n          "],[10,"tr"],[14,0,"ai-llm-quotas__header-row"],[12],[1,"\\n            "],[10,"th"],[14,0,"ai-llm-quotas__header"],[12],[1,[28,[32,1],["discourse_ai.llms.quotas.group"],null]],[13],[1,"\\n            "],[10,"th"],[14,0,"ai-llm-quotas__header"],[12],[1,[28,[32,1],["discourse_ai.llms.quotas.max_tokens"],null]],[13],[1,"\\n            "],[10,"th"],[14,0,"ai-llm-quotas__header"],[12],[1,[28,[32,1],["discourse_ai.llms.quotas.max_usages"],null]],[13],[1,"\\n            "],[10,"th"],[14,0,"ai-llm-quotas__header"],[12],[1,[28,[32,1],["discourse_ai.llms.quotas.duration"],null]],[13],[1,"\\n            "],[10,"th"],[14,0,"ai-llm-quotas__header ai-llm-quotas__header--actions"],[12],[13],[1,"\\n            "],[10,"th"],[12],[13],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,"tbody"],[14,0,"ai-llm-quotas__table-body"],[12],[1,"\\n          "],[8,[30,1,["Collection"]],[[24,0,"ai-llm-quotas__row"]],[["@name","@tagName"],["llm_quotas","tr"]],[["default"],[[[[1,"\\n            "],[10,"td"],[14,0,"ai-llm-quotas__cell"],[12],[1,[30,32,["group_name"]]],[13],[1,"\\n            "],[10,"td"],[14,0,"ai-llm-quotas__cell"],[12],[1,"\\n              "],[8,[30,30,["Field"]],null,[["@name","@title","@showTitle"],["max_tokens","max_tokens",false]],[["default"],[[[[1,"\\n                "],[8,[30,33,["Input"]],[[24,0,"ai-llm-quotas__input"],[24,"min","1"]],[["@type"],["number"]],null],[1,"\\n              "]],[33]]]]],[1,"\\n            "],[13],[1,"\\n            "],[10,"td"],[14,0,"ai-llm-quotas__cell"],[12],[1,"\\n              "],[8,[30,30,["Field"]],null,[["@name","@title","@showTitle"],["max_usages","max_usages",false]],[["default"],[[[[1,"\\n                "],[8,[30,34,["Input"]],[[24,0,"ai-llm-quotas__input"],[24,"min","1"]],[["@type"],["number"]],null],[1,"\\n              "]],[34]]]]],[1,"\\n            "],[13],[1,"\\n            "],[10,"td"],[14,0,"ai-llm-quotas__cell"],[12],[1,"\\n              "],[8,[30,30,["Field"]],null,[["@name","@title","@showTitle"],["duration_seconds","duration_seconds",false]],[["default"],[[[[1,"\\n                "],[8,[30,35,["Custom"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,10],null,[["@value","@onChange"],[[30,32,["duration_seconds"]],[30,35,["set"]]]],null],[1,"\\n                "]],[]]]]],[1,"\\n              "]],[35]]]]],[1,"\\n            "],[13],[1,"\\n            "],[10,"td"],[12],[1,"\\n              "],[8,[30,1,["Button"]],[[24,0,"btn-danger ai-llm-quotas__delete-btn"]],[["@icon","@action"],["trash-can",[28,[32,11],[[30,30,["remove"]],[30,31]],null]]],null],[1,"\\n            "],[13],[1,"\\n          "]],[30,31,32]]]]],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n    "]],[]]]]],[1,"\\n\\n    "],[8,[30,1,["Button"]],[[24,0,"ai-llm-editor__add-quota-btn"]],[["@action","@icon","@label"],[[28,[32,11],[[30,0,["openAddQuotaModal"]],[28,[32,11],[[30,1,["addItemToCollection"]],"llm_quotas"],null]],null],"plus","discourse_ai.llms.quotas.add"]],null],[1,"\\n"]],[]],null],[1,"\\n  "],[8,[30,1,["Actions"]],null,null,[["default"],[[[[1,"\\n    "],[8,[30,1,["Button"]],null,[["@action","@disabled","@label"],[[28,[32,11],[[30,0,["test"]],[30,2]],null],[30,0,["testRunning"]],"discourse_ai.llms.tests.title"]],null],[1,"\\n\\n    "],[8,[30,1,["Submit"]],null,null,null],[1,"\\n\\n"],[41,[28,[32,5],[[30,2,["llm_quotas","length"]],0],null],[[[1,"      "],[8,[30,1,["Button"]],[[24,0,"ai-llm-editor__add-quota-btn"]],[["@action","@label"],[[28,[32,11],[[30,0,["openAddQuotaModal"]],[28,[32,11],[[30,1,["addItemToCollection"]],"llm_quotas"],null]],null],"discourse_ai.llms.quotas.add"]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[51,[30,3,["isNew"]]],[[[41,[51,[30,3,["seeded"]]],[[[1,"        "],[8,[30,1,["Button"]],[[24,0,"btn-danger"]],[["@action","@label"],[[30,0,["delete"]],"discourse_ai.llms.delete"]],null],[1,"\\n"]],[]],null]],[]],null],[1,"  "]],[]]]]],[1,"\\n\\n"],[41,[30,0,["displayTestResult"]],[[[1,"    "],[8,[30,1,["Container"]],null,[["@format"],["full"]],[["default"],[[[[1,"\\n      "],[8,[32,12],null,[["@size","@condition"],["small",[30,0,["testRunning"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["testResult"]],[[[1,"          "],[10,0],[14,0,"ai-llm-editor-tests__success"],[12],[1,"\\n            "],[1,[28,[32,13],["check"],null]],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.llms.tests.success"],null]],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[1,"          "],[10,0],[14,0,"ai-llm-editor-tests__failure"],[12],[1,"\\n            "],[1,[28,[32,13],["xmark"],null]],[1,"\\n            "],[1,[30,0,["testErrorMessage"]]],[1,"\\n            "],[10,"ul"],[12],[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,0,["testValidationErrors"]]],null]],null],null,[[[1,"                "],[10,"li"],[12],[1,[30,36]],[13],[1,"\\n"]],[36]],null],[1,"            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]]],[1,"      "]],[]]]]],[1,"\\n    "]],[]]]]],[1,"\\n"]],[]],null]],[1,2]]]]]],["form","data","@model","field","field","field","select","provider","field","field","object","providerParamsData","name","params","field","select","option","field","select","tokenizer","field","inputGroup","field","field","field","field","field","field","field","collection","index","collectionData","field","field","field","error"],["if","unless","each","-track-array","let"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form.js",scope:()=>[u.default,_.i18n,y.default,i.get,i.concat,g.eq,f.default,c.default,n.LinkTo,g.gt,b.default,i.fn,d.default,p.default],isStrictMode:!0}),this)}}e.default=x}),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-editor",["exports","discourse/components/back-button","discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"GEyJ0/I5",block:'[[[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-llms","discourse_ai.llms.back"]],null],[1,"\\n"],[8,[32,1],null,[["@model","@llmTemplate","@llms"],[[30,1],[30,2],[30,3]]],null]],["@model","@llmTemplate","@llms"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llm-editor.js",scope:()=>[t.default,s.default],isStrictMode:!0}),(0,n.default)(void 0,"ai-llm-editor:AiLlmEditor"))
e.default=a}),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-selector",["exports","@ember/helper","discourse/select-kit/components/combo-box","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"WUNuhLe3",block:'[[[8,[32,0],[[17,1]],[["@value","@content","@onChange","@options"],[[30,2],[30,3],[30,4],[28,[32,1],null,[["filterable","none"],[true,"discourse_ai.ai_persona.no_llm_selected"]]]]],null]],["&attrs","@value","@llms","@onChange"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llm-selector.js",scope:()=>[s.default,t.hash],isStrictMode:!0}),(0,n.default)(void 0,"ai-llm-selector:AiLlmSelector"))
e.default=a}),define("discourse/plugins/discourse-ai/discourse/components/ai-llms-list-editor",["exports","@glimmer/component","@ember/helper","@ember/object","@ember/service","@ember/template","discourse/admin/components/admin-section-landing-item","discourse/admin/components/admin-section-landing-wrapper","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse/helpers/d-icon","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-credit-bar","discourse/plugins/discourse-ai/discourse/components/ai-default-llm-selector","discourse/plugins/discourse-ai/discourse/components/ai-llm-editor","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class b extends t.default{static{dt7948.g(this.prototype,"adminPluginNavManager",[o.service])}#Q=void dt7948.i(this,"adminPluginNavManager")
static{dt7948.g(this.prototype,"router",[o.service])}#e=void dt7948.i(this,"router")
formatResetDate(e){return new Date(e).toLocaleString(void 0,{month:"long",day:"numeric",hour:"numeric",minute:"2-digit",timeZone:"UTC"})}modelDescription(e){let t=""
return t="number"==typeof e.id?`${e.provider}-${e.name}`:e.id.replace(/[.:\/]/g,"-"),t=`discourse_ai.llms.model_description.${t}`,p.default.lookup(t,{ignoreMissing:!0})?(0,p.i18n)(t):""}static{dt7948.n(this.prototype,"modelDescription",[i.action])}preseededDescription(e){if(function(e){if(e.id<0)return!0}(e))return(0,p.i18n)("discourse_ai.llms.preseeded_model_description",{model:e.name})}static{dt7948.n(this.prototype,"preseededDescription",[i.action])}sanitizedTranslationKey(e){return e.replace(/\./g,"-")}get hasLlmElements(){return 0!==this.args.llms.content.length}get preconfiguredTitle(){return this.hasLlmElements?"discourse_ai.llms.preconfigured.title":"discourse_ai.llms.preconfigured.title_no_llms"}get preConfiguredLlms(){const e=[{id:"none",name:(0,p.i18n)("discourse_ai.llms.preconfigured.fake"),provider:"fake"}],t=this.args.llms.content.map(e=>({provider:e.provider,name:e.name}))
return this.args.llms.resultSetMeta.presets.forEach(s=>{s.models&&s.models.forEach(i=>{const o=`${s.id}-${i.name}`
t.some(e=>e.provider===s.provider&&e.name===i.name)||e.push({id:o,name:i.display_name,provider:s.provider})})}),e}transitionToLlmEditor(e){this.router.transitionTo("adminPlugins.show.discourse-ai-llms.new",{queryParams:{llmTemplate:e}})}static{dt7948.n(this.prototype,"transitionToLlmEditor",[i.action])}localizeUsage(e){return(0,p.i18n)(`discourse_ai.llms.usage.${e.type}`,{persona:e.name})}static{(0,_.setComponentTemplate)((0,f.createTemplateFactory)({id:"3wT7ejoa",block:'[[[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-llms"]],[28,[32,1],["discourse_ai.llms.short_title"],null]]],null],[1,"\\n"],[10,"section"],[14,0,"ai-llm-list-editor admin-detail"],[12],[1,"\\n"],[41,[30,1],[[[1,"    "],[8,[32,2],null,[["@model","@llms","@llmTemplate"],[[30,1],[30,2],[30,3]]],null],[1,"\\n"]],[]],[[[1,"    "],[8,[32,3],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[28,[32,1],["discourse_ai.llms.short_title"],null],[28,[32,1],["discourse_ai.llms.preconfigured.description"],null],"https://meta.discourse.org/t/discourse-ai-large-language-model-llm-settings-page/319903"]],null],[1,"\\n\\n    "],[8,[32,4],null,null,null],[1,"\\n\\n"],[41,[30,0,["hasLlmElements"]],[[[1,"      "],[10,"section"],[14,0,"ai-llms-list-editor__configured"],[12],[1,"\\n        "],[8,[32,3],null,[["@titleLabel"],[[28,[32,1],["discourse_ai.llms.configured.title"],null]]],null],[1,"\\n        "],[10,"table"],[14,0,"d-admin-table"],[12],[1,"\\n          "],[10,"thead"],[12],[1,"\\n            "],[10,"tr"],[12],[1,"\\n              "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.llms.display_name"],null]],[13],[1,"\\n              "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.llms.provider"],null]],[13],[1,"\\n              "],[10,"th"],[12],[13],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n          "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2,["content"]]],null]],null],null,[[[1,"              "],[10,"tr"],[15,"data-llm-id",[30,4,["name"]]],[14,0,"ai-llm-list__row d-admin-row__content"],[12],[1,"\\n                "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n\\n                  "],[10,0],[14,0,"ai-llm-list__name"],[12],[1,"\\n                    "],[10,"strong"],[12],[1,"\\n                      "],[1,[30,4,["display_name"]]],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n                  "],[10,0],[14,0,"ai-llm-list__description"],[12],[1,"\\n                    "],[1,[28,[30,0,["modelDescription"]],[[30,4]],null]],[1,"\\n                    "],[1,[28,[30,0,["preseededDescription"]],[[30,4]],null]],[1,"\\n                  "],[13],[1,"\\n"],[41,[30,4,["used_by"]],[[[1,"                    "],[10,"ul"],[14,0,"ai-llm-list-editor__usages"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,4,["used_by"]]],null]],null],null,[[[1,"                        "],[10,"li"],[12],[1,[28,[30,0,["localizeUsage"]],[[30,5]],null]],[13],[1,"\\n"]],[5]],null],[1,"                    "],[13],[1,"\\n"]],[]],null],[41,[30,4,["llm_credit_allocation"]],[[[1,"                    "],[10,0],[14,0,"ai-llm-list__credit-allocation"],[12],[1,"\\n                      "],[8,[32,5],null,[["@allocation"],[[30,4,["llm_credit_allocation"]]]],null],[1,"\\n"],[41,[30,4,["llm_credit_allocation","hard_limit_reached"]],[[[1,"                        "],[10,0],[14,0,"alert alert-danger ai-credit-warning"],[12],[1,"\\n                          "],[1,[28,[32,6],["circle-info"],null]],[1,"\\n                          "],[1,[28,[32,7],[[28,[32,1],["discourse_ai.llms.credit_allocation.hard_limit_warning"],[["reset_date"],[[28,[30,0,["formatResetDate"]],[[30,4,["llm_credit_allocation","next_reset_at"]]],null]]]]],null]],[1,"\\n                        "],[13],[1,"\\n"]],[]],[[[41,[30,4,["llm_credit_allocation","soft_limit_reached"]],[[[1,"                        "],[10,0],[14,0,"alert alert-warning ai-credit-warning"],[12],[1,"\\n                          "],[1,[28,[32,6],["circle-info"],null]],[1,"\\n                          "],[1,[28,[32,7],[[28,[32,1],["discourse_ai.llms.credit_allocation.soft_limit_warning"],[["percentage"],[[30,4,["llm_credit_allocation","percentage_remaining"]]]]]],null]],[1,"\\n                        "],[13],[1,"\\n                      "]],[]],null]],[]]],[1,"                    "],[13],[1,"\\n"]],[]],null],[1,"                "],[13],[1,"\\n                "],[10,"td"],[14,0,"d-admin-row__detail"],[12],[1,"\\n                  "],[10,0],[14,0,"d-admin-row__mobile-label"],[12],[1,"\\n                    "],[1,[28,[32,1],["discourse_ai.llms.provider"],null]],[1,"\\n                  "],[13],[1,"\\n                  "],[1,[28,[32,1],[[28,[32,8],["discourse_ai.llms.providers.",[30,4,["provider"]]],null]],null]],[1,"\\n                "],[13],[1,"\\n                "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n                  "],[8,[32,9],[[24,0,"btn btn-default btn-small ai-llm-list__edit-button"]],[["@label","@route","@routeModels"],["discourse_ai.llms.edit","adminPlugins.show.discourse-ai-llms.edit",[30,4,["id"]]]],null],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n"]],[4]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"    "],[10,"section"],[14,0,"ai-llms-list-editor__templates"],[12],[1,"\\n      "],[8,[32,3],null,[["@titleLabel"],[[28,[32,1],[[30,0,["preconfiguredTitle"]]],null]]],null],[1,"\\n      "],[8,[32,10],[[24,0,"ai-llms-list-editor__templates-list"]],null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["preConfiguredLlms"]]],null]],null],null,[[[1,"          "],[8,[32,11],[[16,"data-llm-id",[30,6,["id"]]],[24,0,"ai-llms-list-editor__templates-list-item"]],[["@titleLabelTranslated","@descriptionLabelTranslated","@taglineLabel"],[[30,6,["name"]],[28,[30,0,["modelDescription"]],[[30,6]],null],[28,[32,8],["discourse_ai.llms.providers.",[30,6,["provider"]]],null]]],[["buttons"],[[[[1,"\\n              "],[8,[30,7,["Default"]],null,[["@action","@icon","@label"],[[28,[32,12],[[30,0,["transitionToLlmEditor"]],[30,6,["id"]]],null],"gear","discourse_ai.llms.preconfigured.button"]],null],[1,"\\n            "]],[7]]]]],[1,"\\n"]],[6]],null],[1,"      "]],[]]]]],[1,"\\n    "],[13],[1,"\\n"]],[]]],[13]],["@currentLlm","@llms","@llmTemplate","llm","usage","llm","buttons"],["if","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llms-list-editor.js",scope:()=>[l.default,p.i18n,g.default,u.default,h.default,m.default,c.default,n.htmlSafe,s.concat,d.default,r.default,a.default,s.fn],isStrictMode:!0}),this)}}e.default=b}),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/routing","@ember/runloop","@ember/service","discourse/admin/models/admin-user","discourse/components/back-button","discourse/components/form","discourse/helpers/bound-avatar-template","discourse/lib/ajax-error","discourse/lib/array-tools","discourse/lib/constants","discourse/lib/get-url","discourse/models/group","discourse/select-kit/components/group-chooser","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/modal/ai-persona-response-format-editor","discourse/plugins/discourse-ai/discourse/lib/utilities","discourse/plugins/discourse-ai/discourse/components/ai-llm-selector","discourse/plugins/discourse-ai/discourse/components/ai-persona-example","discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options","discourse/plugins/discourse-ai/discourse/components/ai-tool-selector","discourse/plugins/discourse-ai/discourse/components/rag-options-fk","discourse/plugins/discourse-ai/discourse/components/rag-uploader","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x,k,T,C,P,M,j,A){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class L extends t.default{static{dt7948.g(this.prototype,"router",[l.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"dialog",[l.service])}#H=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"toasts",[l.service])}#U=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"siteSettings",[l.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"allGroups",[s.tracked],function(){return[]})}#ue=void dt7948.i(this,"allGroups")
static{dt7948.g(this.prototype,"isSaving",[s.tracked],function(){return!1})}#z=void dt7948.i(this,"isSaving")
dirtyFormData=null
get formData(){if(this.dirtyFormData){const e=this.dirtyFormData
return this.dirtyFormData=null,e}{const e=this.args.model.toPOJO()
return e.tools&&(e.toolOptions=this.mapToolOptions(e.toolOptions,e.tools)),e}}static{dt7948.n(this.prototype,"formData",[s.cached])}get chatPluginEnabled(){return this.siteSettings.chat_enabled}get allTools(){return this.args.personas.resultSetMeta.tools}get maxPixelValues(){const e=e=>(0,v.i18n)(`discourse_ai.ai_persona.vision_max_pixel_sizes.${e}`)
return[{name:e("low"),id:65536},{name:e("medium"),id:262144},{name:e("high"),id:1048576}]}get forcedToolStrategies(){const e=[{id:-1,name:(0,v.i18n)("discourse_ai.ai_persona.tool_strategies.all")}]
return[1,2,5].forEach(t=>{e.push({id:t,name:(0,v.i18n)("discourse_ai.ai_persona.tool_strategies.replies",{count:t})})}),e}async updateAllGroups(){const e=await f.default.findAll({include_everyone:!0})
e.find(e=>e.id===g.AUTO_GROUPS.everyone.id)||e.push({id:g.AUTO_GROUPS.everyone.id,name:g.AUTO_GROUPS.everyone.name}),this.allGroups=e}static{dt7948.n(this.prototype,"updateAllGroups",[o.action])}async save(e){const t=this.args.model.isNew
this.isSaving=!0
try{const s=Object.assign(this.args.model,this.args.model.fromPOJO(e))
await s.save(),this.#ce(),t&&0===this.args.model.rag_uploads.length&&((0,h.addUniqueValueToArray)(this.args.personas.content,s),await this.router.replaceWith("adminPlugins.show.discourse-ai-personas.edit",s)),this.toasts.success({data:{message:(0,v.i18n)("discourse_ai.ai_persona.saved")},duration:"short"})}catch(s){(0,m.popupAjaxError)(s)}finally{(0,r.later)(()=>{this.isSaving=!1},1e3)}}static{dt7948.n(this.prototype,"save",[o.action])}get adminUser(){const e=Object.assign({},this.args.model?.user)
return d.default.create(e)}delete(){return this.dialog.confirm({message:(0,v.i18n)("discourse_ai.ai_persona.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then(()=>{(0,h.removeValueFromArray)(this.args.personas.content,this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-personas.index")})})}static{dt7948.n(this.prototype,"delete",[o.action])}async toggleEnabled(e,t,{set:s}){s("enabled",t),await this.persistField(e,"enabled",t)}static{dt7948.n(this.prototype,"toggleEnabled",[o.action])}async togglePriority(e,t,{set:s}){s("priority",t),await this.persistField(e,"priority",t,!0)}static{dt7948.n(this.prototype,"togglePriority",[o.action])}async createUser(e){try{let t=await this.args.model.createUser()
e.set("user",t),e.set("user_id",t.id)}catch(t){(0,m.popupAjaxError)(t)}}static{dt7948.n(this.prototype,"createUser",[o.action])}updateUploads(e,t){const s=(0,S.toPlainObject)(t)
e.set("rag_uploads",s)}static{dt7948.n(this.prototype,"updateUploads",[o.action])}async removeUpload(e,t,s,i){const o=s.filter(e=>e.id!==i.id)
e.set("rag_uploads",o),this.args.model.isNew||await this.persistField(t,"rag_uploads",o)}static{dt7948.n(this.prototype,"removeUpload",[o.action])}updateToolNames(e,t,s){const i=t?.tools?.filter(e=>!s.includes(e))||[],o=this.mapToolOptions(t.toolOptions,s)
if(e.setProperties({tools:s,toolOptions:o}),t.forcedTools?.length>0){const s=t.forcedTools.filter(e=>!i.includes(e))
e.set("forcedTools",s)}}static{dt7948.n(this.prototype,"updateToolNames",[o.action])}availableForcedTools(e){return this.allTools.filter(t=>e.includes(t.id))}static{dt7948.n(this.prototype,"availableForcedTools",[o.action])}addExamplesPair(e,t){const s=[...t.examples,["",""]]
e.set("examples",s)}static{dt7948.n(this.prototype,"addExamplesPair",[o.action])}mapToolOptions(e,t){const s=Object.assign({},e)
return t.forEach(e=>{const t=this.allTools.find(t=>t.id===e),i=t?.options
if(!i||s[e])return
const o={}
Object.keys(i).forEach(e=>{o[e]=null}),s[e]=o}),s}async persistField(e,t,s,i){if(!this.args.model.isNew){const n=Object.assign({},e)
n[t]=s
try{const e={}
e[t]=s,this.dirtyFormData=n,await this.args.model.update(e),i&&this.#ce()}catch(o){(0,m.popupAjaxError)(o)}}}#ce(){this.args.personas.content.sort((e,t)=>e.priority&&!t.priority?-1:!e.priority&&t.priority?1:e.name.localeCompare(t.name))}exportPersona(){const e=`/admin/plugins/discourse-ai/ai-personas/${this.args.model.id}/export.json`
window.location.href=(0,_.default)(e)}static{dt7948.n(this.prototype,"exportPersona",[o.action])}static{(0,j.setComponentTemplate)((0,A.createTemplateFactory)({id:"+H4aeJcF",block:'[[[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-personas","discourse_ai.ai_persona.back"]],null],[1,"\\n"],[11,0],[24,0,"ai-persona-editor"],[4,[32,1],[[30,0,["updateAllGroups"]],[30,1,["id"]]],null],[12],[1,"\\n  "],[8,[32,2],null,[["@onSubmit","@data"],[[30,0,["save"]],[30,0,["formData"]]]],[["default"],[[[[1,"\\n    "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@disabled","@format"],["name",[28,[32,3],["discourse_ai.ai_persona.name"],null],"required|length:1,100",[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,4,["Input"]],null,null,null],[1,"\\n    "]],[4]]]]],[1,"\\n\\n    "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@disabled","@format"],["description",[28,[32,3],["discourse_ai.ai_persona.description"],null],"required|length:1,100",[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,5,["Textarea"]],null,null,null],[1,"\\n    "]],[5]]]]],[1,"\\n\\n    "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@disabled","@format"],["system_prompt",[28,[32,3],["discourse_ai.ai_persona.system_prompt"],null],"required|length:1,100000",[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,6,["Textarea"]],null,null,null],[1,"\\n    "]],[6]]]]],[1,"\\n\\n    "],[8,[32,4],null,[["@form","@data"],[[30,2],[30,3]]],null],[1,"\\n\\n    "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["default_llm_id",[28,[32,3],["discourse_ai.ai_persona.default_llm"],null],[28,[32,3],["discourse_ai.ai_persona.default_llm_help"],null],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,7,["Custom"]],null,null,[["default"],[[[[1,"\\n        "],[8,[32,5],[[24,0,"ai-persona-editor__llms"]],[["@value","@llms","@onChange"],[[30,7,["value"]],[30,8,["resultSetMeta","llms"]],[30,7,["set"]]]],null],[1,"\\n      "]],[]]]]],[1,"\\n    "]],[7]]]]],[1,"\\n\\n    "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["allowed_group_ids",[28,[32,3],["discourse_ai.ai_persona.allowed_groups"],null],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,9,["Custom"]],null,null,[["default"],[[[[1,"\\n        "],[8,[32,6],null,[["@value","@content","@onChange"],[[30,3,["allowed_group_ids"]],[30,0,["allGroups"]],[30,9,["set"]]]],null],[1,"\\n      "]],[]]]]],[1,"\\n    "]],[9]]]]],[1,"\\n\\n    "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["vision_enabled",[28,[32,3],["discourse_ai.ai_persona.vision_enabled"],null],[28,[32,3],["discourse_ai.ai_persona.vision_enabled_help"],null],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,10,["Checkbox"]],null,null,null],[1,"\\n    "]],[10]]]]],[1,"\\n\\n"],[41,[30,3,["vision_enabled"]],[[[1,"      "],[8,[30,2,["Field"]],null,[["@name","@title","@onSet","@format"],["vision_max_pixels",[28,[32,3],["discourse_ai.ai_persona.vision_max_pixels"],null],[30,0,["onChangeMaxPixels"]],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,11,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["maxPixelValues"]]],null]],null],null,[[[1,"            "],[8,[30,12,["Option"]],null,[["@value"],[[30,13,["id"]]]],[["default"],[[[[1,[30,13,["name"]]]],[]]]]],[1,"\\n"]],[13]],null],[1,"        "]],[12]]]]],[1,"\\n      "]],[11]]]]],[1,"\\n"]],[]],null],[1,"\\n    "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["max_context_posts",[28,[32,3],["discourse_ai.ai_persona.max_context_posts"],null],[28,[32,3],["discourse_ai.ai_persona.max_context_posts_help"],null],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,14,["Input"]],[[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n    "]],[14]]]]],[1,"\\n\\n"],[41,[51,[30,3,["system"]]],[[[1,"      "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@disabled","@format"],["temperature",[28,[32,3],["discourse_ai.ai_persona.temperature"],null],[28,[32,3],["discourse_ai.ai_persona.temperature_help"],null],[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,15,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n      "]],[15]]]]],[1,"\\n\\n      "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@disabled","@format"],["top_p",[28,[32,3],["discourse_ai.ai_persona.top_p"],null],[28,[32,3],["discourse_ai.ai_persona.top_p_help"],null],[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,16,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n      "]],[16]]]]],[1,"\\n"]],[]],null],[1,"\\n    "],[8,[30,2,["Section"]],null,[["@title","@subtitle"],[[28,[32,3],["discourse_ai.ai_persona.examples.title"],null],[28,[32,3],["discourse_ai.ai_persona.examples.examples_help"],null]]],[["default"],[[[[1,"\\n"],[41,[51,[30,3,["system"]]],[[[1,"        "],[8,[30,2,["Container"]],null,null,[["default"],[[[[1,"\\n          "],[8,[30,2,["Button"]],[[24,0,"ai-persona-editor__new_example"]],[["@action","@label"],[[28,[32,7],[[30,0,["addExamplesPair"]],[30,2],[30,3]],null],"discourse_ai.ai_persona.examples.new"]],null],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,8],[[30,3,["examples","length"]],0],null],[[[1,"        "],[8,[30,2,["Collection"]],null,[["@name"],["examples"]],[["default"],[[[[1,"\\n          "],[8,[32,9],null,[["@examplesCollection","@exampleNumber","@system","@form"],[[30,17],[30,18],[30,3,["system"]],[30,2]]],null],[1,"\\n        "]],[17,18]]]]],[1,"\\n"]],[]],null],[1,"    "]],[]]]]],[1,"\\n\\n    "],[8,[30,2,["Section"]],null,[["@title"],[[28,[32,3],["discourse_ai.ai_persona.ai_tools"],null]]],[["default"],[[[[1,"\\n      "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["tools",[28,[32,3],["discourse_ai.ai_persona.tools"],null],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,19,["Custom"]],null,null,[["default"],[[[[1,"\\n          "],[8,[32,10],null,[["@value","@disabled","@onChange","@content"],[[30,19,["value"]],[30,3,["system"]],[28,[32,7],[[30,0,["updateToolNames"]],[30,2],[30,3]],null],[30,8,["resultSetMeta","tools"]]]],null],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[19]]]]],[1,"\\n\\n"],[41,[28,[32,8],[[30,3,["tools","length"]],0],null],[[[1,"        "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["forcedTools",[28,[32,3],["discourse_ai.ai_persona.forced_tools"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,20,["Custom"]],null,null,[["default"],[[[[1,"\\n            "],[8,[32,10],null,[["@value","@disabled","@onChange","@content"],[[30,20,["value"]],[30,3,["system"]],[30,20,["set"]],[28,[30,0,["availableForcedTools"]],[[30,3,["tools"]]],null]]],null],[1,"\\n          "]],[]]]]],[1,"\\n        "]],[20]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,8],[[30,3,["forcedTools","length"]],0],null],[[[1,"        "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["forced_tool_count",[28,[32,3],["discourse_ai.ai_persona.forced_tool_strategy"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,21,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["forcedToolStrategies"]]],null]],null],null,[[[1,"              "],[8,[30,22,["Option"]],null,[["@value"],[[30,23,["id"]]]],[["default"],[[[[1,[30,23,["name"]]]],[]]]]],[1,"\\n"]],[23]],null],[1,"          "]],[22]]]]],[1,"\\n        "]],[21]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,8],[[30,3,["tools","length"]],0],null],[[[1,"        "],[8,[32,11],null,[["@form","@data","@llms","@allTools"],[[30,2],[30,3],[30,8,["resultSetMeta","llms"]],[30,8,["resultSetMeta","tools"]]]],null],[1,"\\n"]],[]],null],[1,"\\n      "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["show_thinking",[28,[32,3],["discourse_ai.ai_persona.show_thinking"],null],[28,[32,3],["discourse_ai.ai_persona.show_thinking_help"],null],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,24,["Checkbox"]],null,null,null],[1,"\\n      "]],[24]]]]],[1,"\\n    "]],[]]]]],[1,"\\n\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[30,2,["Section"]],null,[["@title"],[[28,[32,3],["discourse_ai.rag.title"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["rag_uploads",[28,[32,3],["discourse_ai.rag.uploads.title"],null],"full"]],[["default"],[[[[1,"\\n          "],[8,[30,25,["Custom"]],null,null,[["default"],[[[[1,"\\n            "],[8,[32,12],null,[["@target","@targetName","@updateUploads","@onRemove","@allowImages"],[[30,3],"AiPersona",[28,[32,7],[[30,0,["updateUploads"]],[30,2]],null],[28,[32,7],[[30,0,["removeUpload"]],[30,2],[30,3],[30,25,["value"]]],null],[30,8,["resultSetMeta","settings","rag_images_enabled"]]]],null],[1,"\\n          "]],[]]]]],[1,"\\n        "]],[25]]]]],[1,"\\n\\n        "],[8,[32,13],null,[["@form","@data","@llms","@allowImages"],[[30,2],[30,3],[30,8,["resultSetMeta","llms"]],[30,8,["resultSetMeta","settings","rag_images_enabled"]]]],[["default"],[[[[1,"\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_conversation_chunks",[28,[32,3],["discourse_ai.ai_persona.rag_conversation_chunks"],null],[28,[32,3],["discourse_ai.ai_persona.rag_conversation_chunks_help"],null],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,26,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n          "]],[26]]]]],[1,"\\n\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["question_consolidator_llm_id",[28,[32,3],["discourse_ai.ai_persona.question_consolidator_llm"],null],[28,[32,3],["discourse_ai.ai_persona.question_consolidator_llm_help"],null],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,27,["Custom"]],null,null,[["default"],[[[[1,"\\n              "],[8,[32,5],[[24,0,"ai-persona-editor__llms"]],[["@value","@llms","@onChange"],[[30,27,["value"]],[30,8,["resultSetMeta","llms"]],[30,27,["set"]]]],null],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[27]]]]],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n    "],[8,[30,2,["Section"]],null,[["@title"],[[28,[32,3],["discourse_ai.ai_persona.ai_bot.title"],null]]],[["default"],[[[[1,"\\n      "],[8,[30,2,["Field"]],null,[["@name","@title","@onSet"],["enabled",[28,[32,3],["discourse_ai.ai_persona.enabled"],null],[28,[32,7],[[30,0,["toggleEnabled"]],[30,3]],null]]],[["default"],[[[[1,"\\n        "],[8,[30,28,["Toggle"]],null,null,null],[1,"\\n      "]],[28]]]]],[1,"\\n\\n      "],[8,[30,2,["Field"]],null,[["@name","@title","@onSet","@tooltip"],["priority",[28,[32,3],["discourse_ai.ai_persona.priority"],null],[28,[32,7],[[30,0,["togglePriority"]],[30,3]],null],[28,[32,3],["discourse_ai.ai_persona.priority_help"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,29,["Toggle"]],null,null,null],[1,"\\n      "]],[29]]]]],[1,"\\n\\n"],[41,[30,1,["isNew"]],[[[1,"        "],[10,0],[12],[1,[28,[32,3],["discourse_ai.ai_persona.ai_bot.save_first"],null]],[13],[1,"\\n"]],[]],[[[41,[30,3,["default_llm_id"]],[[[1,"          "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["force_default_llm",[28,[32,3],["discourse_ai.ai_persona.force_default_llm"],null],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,30,["Checkbox"]],null,null,null],[1,"\\n          "]],[30]]]]],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[30,2,["Container"]],[[24,0,"ai-persona-editor__ai_bot_user"]],[["@title","@tooltip"],[[28,[32,3],["discourse_ai.ai_persona.user"],null],[52,[51,[30,3,["user"]]],[28,[32,3],["discourse_ai.ai_persona.create_user_help"],null]]]],[["default"],[[[[1,"\\n"],[41,[30,3,["user"]],[[[1,"            "],[10,3],[14,0,"avatar"],[15,6,[30,3,["user","path"]]],[15,"data-user-card",[30,3,["user","username"]]],[12],[1,"\\n              "],[1,[28,[32,14],[[30,3,["user","avatar_template"]],"small"],null]],[1,"\\n            "],[13],[1,"\\n            "],[8,[32,15],null,[["@route","@model"],["adminUser",[30,0,["adminUser"]]]],[["default"],[[[[1,"\\n              "],[1,[30,3,["user","username"]]],[1,"\\n            "]],[]]]]],[1,"\\n"]],[]],[[[1,"            "],[8,[30,2,["Button"]],[[24,0,"ai-persona-editor__create-user"]],[["@action","@label"],[[28,[32,7],[[30,0,["createUser"]],[30,2]],null],"discourse_ai.ai_persona.create_user"]],null],[1,"\\n"]],[]]],[1,"        "]],[]]]]],[1,"\\n\\n"],[41,[30,3,["user"]],[[[1,"          "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["allow_personal_messages",[28,[32,3],["discourse_ai.ai_persona.allow_personal_messages"],null],[28,[32,3],["discourse_ai.ai_persona.allow_personal_messages_help"],null],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,31,["Checkbox"]],null,null,null],[1,"\\n          "]],[31]]]]],[1,"\\n\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["allow_topic_mentions",[28,[32,3],["discourse_ai.ai_persona.allow_topic_mentions"],null],[28,[32,3],["discourse_ai.ai_persona.allow_topic_mentions_help"],null],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,32,["Checkbox"]],null,null,null],[1,"\\n          "]],[32]]]]],[1,"\\n\\n"],[41,[30,0,["chatPluginEnabled"]],[[[1,"            "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["allow_chat_direct_messages",[28,[32,3],["discourse_ai.ai_persona.allow_chat_direct_messages"],null],[28,[32,3],["discourse_ai.ai_persona.allow_chat_direct_messages_help"],null],"large"]],[["default"],[[[[1,"\\n              "],[8,[30,33,["Checkbox"]],null,null,null],[1,"\\n            "]],[33]]]]],[1,"\\n\\n            "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["allow_chat_channel_mentions",[28,[32,3],["discourse_ai.ai_persona.allow_chat_channel_mentions"],null],[28,[32,3],["discourse_ai.ai_persona.allow_chat_channel_mentions_help"],null],"large"]],[["default"],[[[[1,"\\n              "],[8,[30,34,["Checkbox"]],null,null,null],[1,"\\n            "]],[34]]]]],[1,"\\n"]],[]],null]],[]],null]],[]]],[1,"    "]],[]]]]],[1,"\\n\\n    "],[8,[30,2,["Actions"]],null,null,[["default"],[[[[1,"\\n      "],[8,[30,2,["Submit"]],null,null,null],[1,"\\n\\n"],[41,[51,[28,[32,16],[[30,1,["isNew"]],[30,1,["system"]]],null]],[[[1,"        "],[8,[30,2,["Button"]],[[24,0,"ai-persona-editor__export"]],[["@label","@action"],["discourse_ai.ai_persona.export",[30,0,["exportPersona"]]]],null],[1,"\\n        "],[8,[30,2,["Button"]],[[24,0,"btn-danger"]],[["@action","@label"],[[30,0,["delete"]],"discourse_ai.ai_persona.delete"]],null],[1,"\\n"]],[]],null],[1,"    "]],[]]]]],[1,"\\n  "]],[2,3]]]]],[1,"\\n"],[13]],["@model","form","data","field","field","field","field","@personas","field","field","field","select","pixelValue","field","field","field","exCollection","exCollectionIdx","field","field","field","select","fts","field","field","field","field","field","field","field","field","field","field","field"],["if","each","-track-array","unless"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-editor.js",scope:()=>[u.default,n.default,c.default,v.i18n,w.default,x.default,b.default,i.fn,y.gt,k.default,C.default,T.default,M.default,P.default,p.default,a.LinkTo,y.or],isStrictMode:!0}),this)}}e.default=L}),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-example",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","discourse/helpers/d-icon","discourse/truth-helpers","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static{dt7948.g(this.prototype,"collapsed",[s.tracked],function(){return!0})}#pe=void dt7948.i(this,"collapsed")
get caretIcon(){return this.collapsed?"angle-right":"angle-down"}toggleExample(){this.collapsed=!this.collapsed}static{dt7948.n(this.prototype,"toggleExample",[n.action])}deletePair(){this.collapsed=!0,this.args.examplesCollection.remove(this.args.exampleNumber)}static{dt7948.n(this.prototype,"deletePair",[n.action])}get exampleTitle(){return(0,l.i18n)("discourse_ai.ai_persona.examples.collapsable_title",{number:this.args.exampleNumber+1})}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"A7lXMTiU",block:'[[[11,0],[24,"role","button"],[4,[32,0],["click",[30,0,["toggleExample"]]],null],[12],[1,"\\n  "],[10,1],[12],[1,[28,[32,1],[[30,0,["caretIcon"]]],null]],[13],[1,"\\n  "],[1,[30,0,["exampleTitle"]]],[1,"\\n"],[13],[1,"\\n"],[41,[51,[30,0,["collapsed"]]],[[[1,"  "],[8,[30,1,["Collection"]],null,null,[["default"],[[[[1,"\\n    "],[8,[30,2,["Field"]],null,[["@title","@validation","@disabled"],[[28,[32,2],[[28,[32,3],["discourse_ai.ai_persona.examples.",[52,[28,[32,4],[[30,3],0],null],"user","model"]],null]],null],"required|length:1,5000",[30,4]]],[["default"],[[[[1,"\\n      "],[8,[30,5,["Textarea"]],null,null,null],[1,"\\n    "]],[5]]]]],[1,"\\n  "]],[2,3]]]]],[1,"\\n\\n"],[41,[51,[30,4]],[[[1,"    "],[8,[30,6,["Container"]],null,null,[["default"],[[[[1,"\\n      "],[8,[30,6,["Button"]],[[24,0,"ai-persona-editor__delete_example btn-danger"]],[["@action","@label"],[[30,0,["deletePair"]],"discourse_ai.ai_persona.examples.remove"]],null],[1,"\\n    "]],[]]]]],[1,"\\n"]],[]],null]],[]],null]],["@examplesCollection","exPair","pairIdx","@system","field","@form"],["unless","if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-example.js",scope:()=>[o.on,a.default,l.i18n,i.concat,r.eq],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-list-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/routing","@ember/service","discourse/admin/components/admin-config-area-empty-list","discourse/admin/components/admin-filter-controls","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse/components/dropdown-menu","discourse/float-kit/components/d-menu","discourse/helpers/avatar","discourse/helpers/concat-class","discourse/helpers/d-icon","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/array-tools","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/admin/models/ai-persona","discourse/plugins/discourse-ai/discourse/components/ai-persona-editor","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x,k,T){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const C=[{id:"table",label:"discourse_ai.layout.table",icon:"discourse-table"},{id:"card",label:"discourse_ai.layout.card",icon:"table"}]
class P extends t.default{static{dt7948.g(this.prototype,"adminPluginNavManager",[a.service])}#Q=void dt7948.i(this,"adminPluginNavManager")
static{dt7948.g(this.prototype,"keyValueStore",[a.service])}#me=void dt7948.i(this,"keyValueStore")
static{dt7948.g(this.prototype,"capabilities",[a.service])}#v=void dt7948.i(this,"capabilities")
static{dt7948.g(this.prototype,"dialog",[a.service])}#H=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"currentLayout",[s.tracked],function(){return C[0]})}#he=void dt7948.i(this,"currentLayout")
constructor(){super(...arguments)
const e=this.keyValueStore.get("ai-persona-list-layout")
if(e){const t=C.find(t=>t.id===e)
t&&(this.currentLayout=t)}}get searchableProps(){return["name","description"]}get dropdownOptions(){let e=[]
return(this.args.personas?.content||[]).forEach(t=>{(t.features||[]).forEach(t=>{t?.module_name&&!e.includes(t.module_name)&&e.push(t.module_name)})}),e.sort(),[{value:"all",label:(0,w.i18n)("discourse_ai.ai_persona.filters.all_features"),filterFn:()=>!0},...e.map(e=>({value:e,label:(0,w.i18n)(`discourse_ai.features.${e}.name`),filterFn:t=>(t.features||[]).some(t=>t.module_name===e)}))]}async toggleEnabled(e){const t=e.enabled,s=!t
try{e.set("enabled",s),await e.save()}catch(i){e.set("enabled",t),(0,b.popupAjaxError)(i)}}static{dt7948.n(this.prototype,"toggleEnabled",[o.action])}onRegisterApi(e){this.dMenu=e}static{dt7948.n(this.prototype,"onRegisterApi",[o.action])}onLayoutSelect(e){const t=C.find(t=>t.id===e)
t&&(this.currentLayout=t,this.keyValueStore.set({key:"ai-persona-list-layout",value:e})),this.dMenu.close()}static{dt7948.n(this.prototype,"onLayoutSelect",[o.action])}importPersona(){const e=document.createElement("input")
e.type="file",e.accept=".json",e.style.display="none",e.onchange=e=>this.handleFileSelect(e),document.body.appendChild(e),e.click(),document.body.removeChild(e)}static{dt7948.n(this.prototype,"importPersona",[o.action])}handleFileSelect(e){const t=e.target.files[0]
if(!t)return
const s=new FileReader
s.onload=e=>{try{const t=JSON.parse(e.target.result)
this.uploadPersona(t)}catch{this.dialog.alert((0,w.i18n)("discourse_ai.ai_persona.import_error_not_json"))}},s.readAsText(t)}static{dt7948.n(this.prototype,"handleFileSelect",[o.action])}uploadPersona(e,t=!1){const s=e
return t&&(s.force=!0),(0,f.ajax)("/admin/plugins/discourse-ai/ai-personas/import.json",{type:"POST",data:JSON.stringify(s),contentType:"application/json"}).then(e=>{let t=S.default.create(e),s=this.args.personas.content.find(e=>e.id===t.id)
s&&(0,y.removeValueFromArray)(this.args.personas.content,s),this.args.personas.content.unshift(t)}).catch(t=>{422===t.jqXHR?.status?this.dialog.confirm({message:(0,w.i18n)("discourse_ai.ai_persona.import_error_conflict",{name:e.persona.name})+"\n"+t.jqXHR.responseJSON?.errors?.join("\n"),confirmButtonLabel:"discourse_ai.ai_persona.overwrite",didConfirm:()=>this.uploadPersona(e,!0)}):(0,b.popupAjaxError)(t)})}static{(0,k.setComponentTemplate)((0,T.createTemplateFactory)({id:"utekFgTB",block:'[[[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-personas"]],[28,[32,1],["discourse_ai.ai_persona.short_title"],null]]],null],[1,"\\n"],[10,"section"],[14,0,"ai-persona-list-editor__current admin-detail"],[12],[1,"\\n"],[41,[30,1],[[[1,"    "],[8,[32,2],null,[["@model","@personas"],[[30,1],[30,2]]],null],[1,"\\n"]],[]],[[[1,"    "],[8,[32,3],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[28,[32,1],["discourse_ai.ai_persona.short_title"],null],[28,[32,1],["discourse_ai.ai_persona.persona_description"],null],"https://meta.discourse.org/t/ai-bot-personas/306099"]],[["actions"],[[[[1,"\\n        "],[8,[30,3,["Default"]],[[24,0,"ai-persona-list-editor__import-button"]],[["@label","@action","@icon"],["discourse_ai.ai_persona.import",[30,0,["importPersona"]],"upload"]],null],[1,"\\n        "],[8,[30,3,["Primary"]],[[24,0,"ai-persona-list-editor__new-button"]],[["@label","@route","@icon"],["discourse_ai.ai_persona.new","adminPlugins.show.discourse-ai-personas.new","plus"]],null],[1,"\\n      "]],[3]]]]],[1,"\\n"],[41,[30,2,["content"]],[[[1,"      "],[8,[32,4],null,[["@array","@searchableProps","@dropdownOptions","@inputPlaceholder","@noResultsMessage"],[[30,2,["content"]],[30,0,["searchableProps"]],[30,0,["dropdownOptions"]],[28,[32,1],["discourse_ai.ai_persona.filters.text"],null],[28,[32,1],["discourse_ai.ai_persona.filters.no_results"],null]]],[["actions","content"],[[[[1,"\\n"],[41,[30,0,["capabilities","viewport","md"]],[[[1,"            "],[8,[32,5],null,[["@modalForMobile","@autofocus","@identifier","@onRegisterApi","@triggerClass"],[true,true,"persona-list-layout",[30,0,["onRegisterApi"]],"btn-default btn-icon"]],[["trigger","content"],[[[[1,"\\n                "],[1,[28,[32,6],[[30,0,["currentLayout","icon"]]],null]],[1,"\\n              "]],[]],[[[1,"\\n                "],[8,[32,7],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[32,8]],null]],null],null,[[[1,"                    "],[8,[30,4,["item"]],null,null,[["default"],[[[[1,"\\n                      "],[8,[32,9],[[24,0,"btn-transparent"]],[["@label","@icon","@action"],[[30,5,["label"]],[30,5,["icon"]],[28,[32,10],[[30,0,["onLayoutSelect"]],[30,5,["id"]]],null]]],null],[1,"\\n                    "]],[]]]]],[1,"\\n"]],[5]],null],[1,"                "]],[4]]]]],[1,"\\n              "]],[]]]]],[1,"\\n"]],[]],null],[1,"        "]],[]],[[[1,"\\n          "],[10,"table"],[15,0,[28,[32,11],["content-list ai-persona-list-editor d-admin-table",[28,[32,12],["--layout-",[30,0,["currentLayout","id"]]],null]],null]],[12],[1,"\\n            "],[10,"thead"],[12],[1,"\\n              "],[10,"tr"],[12],[1,"\\n                "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.ai_persona.name"],null]],[13],[1,"\\n                "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.llms.short_title"],null]],[13],[1,"\\n                "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.features.short_title"],null]],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n            "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,6]],null]],null],null,[[[1,"                "],[10,"tr"],[15,"data-persona-id",[30,7,["id"]]],[15,0,[28,[32,11],["ai-persona-list__row d-admin-row__content",[52,[30,7,["priority"]],"--priority"],[52,[30,7,["enabled"]],"--enabled"]],null]],[12],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n                    "],[10,0],[14,0,"ai-persona-list__name-with-description"],[12],[1,"\\n                      "],[10,"h3"],[14,0,"ai-persona-list__name"],[12],[1,"\\n"],[41,[30,7,["user"]],[[[1,"                          "],[1,[28,[32,13],[[30,7,["user"]]],[["imageSize"],["tiny"]]]],[1,"\\n"]],[]],null],[1,"                        "],[1,[30,7,["name"]]],[1,"\\n                      "],[13],[1,"\\n                      "],[10,0],[14,0,"ai-persona-list__description"],[12],[1,"\\n                        "],[1,[30,7,["description"]]],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__llms"],[12],[1,"\\n"],[41,[30,7,["default_llm"]],[[[1,"                      "],[10,1],[14,0,"--card-label"],[12],[1,"\\n                        "],[1,[28,[32,1],["discourse_ai.ai_persona.llms_list"],null]],[1,"\\n                      "],[13],[1,"\\n                      "],[8,[32,9],[[24,0,"btn-flat btn-small ai-persona-list__row-item-feature"]],[["@translatedLabel","@route","@routeModels"],[[30,7,["default_llm","display_name"]],"adminPlugins.show.discourse-ai-llms.edit",[30,7,["default_llm","id"]]]],null],[1,"\\n"]],[]],null],[1,"                  "],[13],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__features"],[12],[1,"\\n"],[41,[30,7,["features","length"]],[[[1,"                      "],[10,1],[14,0,"--card-label"],[12],[1,"\\n                        "],[1,[28,[32,1],["discourse_ai.ai_persona.features_list"],[["count"],[[30,7,["features","length"]]]]]],[1,"\\n                      "],[13],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,7,["features"]]],null]],null],null,[[[1,"                        "],[10,1],[14,0,"d-admin-row__row-feature-list"],[12],[1,"\\n                          "],[41,[28,[32,14],[[30,9],0],null],[[[1,", "]],[]],null],[1,"\\n                          "],[8,[32,9],[[24,0,"btn-flat btn-small ai-persona-list__row-item-feature"]],[["@translatedLabel","@route","@routeModels"],[[28,[32,1],[[28,[32,12],["discourse_ai.features.",[30,8,["module_name"]],".name"],null]],null],"adminPlugins.show.discourse-ai-features.edit",[30,8,["id"]]]],null],[1,"\\n                        "],[13],[1,"\\n"]],[8,9]],null]],[]],null],[1,"                  "],[13],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n                    "],[8,[32,15],[[24,0,"btn btn-default btn-text btn-small"]],[["@route","@model"],["adminPlugins.show.discourse-ai-personas.edit",[30,7]]],[["default"],[[[[1,[28,[32,1],["discourse_ai.ai_persona.edit"],null]],[1," "]],[]]]]],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n"]],[7]],null],[1,"            "],[13],[1,"\\n          "],[13],[1,"\\n        "]],[6]]]]],[1,"\\n"]],[]],[[[1,"      "],[8,[32,16],null,[["@ctaLabel","@ctaRoute","@ctaClass","@emptyLabel"],["discourse_ai.ai_persona.new","adminPlugins.show.discourse-ai-personas.new","ai-persona-list-editor__empty-new-button","discourse_ai.ai_persona.no_personas"]],null],[1,"\\n"]],[]]]],[]]],[13]],["@currentPersona","@personas","actions","dropdown","button","filteredPersonas","persona","feature","index"],["if","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-list-editor.js",scope:()=>[d.default,w.i18n,x.default,c.default,l.default,m.default,_.default,p.default,C,u.default,i.fn,g.default,i.concat,h.default,v.gt,n.LinkTo,r.default],isStrictMode:!0}),this)}}e.default=P}),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-llm-selector",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/runloop","@ember/service","discourse/select-kit/components/dropdown-select-box","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const u="ai_persona_selector_id",c="ai_llm_selector_id"
class p extends t.default{static{dt7948.g(this.prototype,"currentUser",[n.service])}#A=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"keyValueStore",[n.service])}#me=void dt7948.i(this,"keyValueStore")
static{dt7948.g(this.prototype,"llm",[s.tracked])}#ge=void dt7948.i(this,"llm")
static{dt7948.g(this.prototype,"allowLLMSelector",[s.tracked],function(){return!0})}#_e=void dt7948.i(this,"allowLLMSelector")
constructor(){super(...arguments),this.botOptions?.length&&(this.#fe(),this.#be(),(0,o.next)(()=>{this.resetTargetRecipients()}))}get composer(){return this.args?.outletArgs?.model}get hasLlmSelector(){return this.currentUser.ai_enabled_chat_bots.some(e=>!e.is_persona)}get botOptions(){if(!this.currentUser.ai_enabled_personas)return
let e=this.currentUser.ai_enabled_personas
return e=e.filter(e=>e.allow_personal_messages),this.hasLlmSelector||(e=e.filter(e=>e.username)),e.map(e=>({id:e.id,name:e.name,description:e.description}))}get filterable(){return this.botOptions.length>8}get value(){return this._value}set value(e){this._value=e,this.keyValueStore.setItem(u,e),this.args.setPersonaId(e),this.setAllowLLMSelector(),this.resetTargetRecipients()}setAllowLLMSelector(){if(!this.hasLlmSelector)return void(this.allowLLMSelector=!1)
const e=this.currentUser.ai_enabled_personas.find(e=>e.id===this._value)
this.allowLLMSelector=!e?.force_default_llm}get currentLlm(){return this.llm}set currentLlm(e){this.llm=e,this.keyValueStore.setItem(c,e)
const t=this.currentUser.ai_enabled_chat_bots.find(t=>t.id===e)
this.args.setLlmId?.(t?.llm_model_id),this.resetTargetRecipients()}resetTargetRecipients(){if(this.allowLLMSelector){const e=this.currentUser.ai_enabled_chat_bots.find(e=>e.id===this.llm).username
this.args.setTargetRecipient(e)}else{const e=this.currentUser.ai_enabled_personas.find(e=>e.id===this._value)
this.args.setTargetRecipient(e.username||"")}}get llmOptions(){return this.currentUser.ai_enabled_chat_bots.filter(e=>!e.is_persona).filter(Boolean).map(e=>({id:e.id,name:e.display_name})).sort((e,t)=>e.name.localeCompare(t.name))}get showPersonaSelector(){return this.botOptions?.length>1}get showLLMSelector(){return this.allowLLMSelector&&this.llmOptions.length>1}#ye(){const e=this.args?.personaName
if(e){const t=this.botOptions.find(t=>t.name===e)
if(t)return t.id}}#ve(){const e=this.args?.llmName
if(e){const t=this.llmOptions.find(t=>t.name===e)
if(t)return t.id}}#fe(){let e=this.#ye()||this.keyValueStore.getItem(u)
this._value=this.botOptions[0].id,e&&(e=parseInt(e,10),this.botOptions.some(t=>t.id===e)&&(this._value=e)),this.args.setPersonaId(this._value)}#be(){if(this.setAllowLLMSelector(),this.hasLlmSelector){let e=this.#ve()||this.keyValueStore.getItem(c)
e&&(e=parseInt(e,10))
const t=this.llmOptions.find(t=>t.id===e)||this.llmOptions[0]
e=t?t.id:"",e&&(0,o.next)(()=>{this.currentLlm=e})}}static{(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"GxJ3L0YM",block:'[[[10,0],[14,0,"persona-llm-selector"],[12],[1,"\\n"],[41,[30,0,["showPersonaSelector"]],[[[1,"    "],[10,0],[14,0,"persona-llm-selector__selection-wrapper gpt-persona"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[10,"label"],[12],[1,[28,[32,0],["discourse_ai.ai_bot.persona"],null]],[13],[1,"\\n"]],[]],null],[1,"      "],[8,[32,1],[[24,0,"persona-llm-selector__persona-dropdown"]],[["@value","@content","@options"],[[30,0,["value"]],[30,0,["botOptions"]],[28,[32,2],null,[["icon","filterable"],[[52,[30,1],"angle-down","robot"],[30,0,["filterable"]]]]]]],null],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[41,[30,0,["showLLMSelector"]],[[[1,"    "],[10,0],[14,0,"persona-llm-selector__selection-wrapper llm-selector"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[10,"label"],[12],[1,[28,[32,0],["discourse_ai.ai_bot.llm"],null]],[13],[1,"\\n"]],[]],null],[1,"      "],[8,[32,1],[[24,0,"persona-llm-selector__llm-dropdown"]],[["@value","@content","@options"],[[30,0,["currentLlm"]],[30,0,["llmOptions"]],[28,[32,2],null,[["icon"],[[52,[30,1],"angle-down","globe"]]]]]],null],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[13]],["@showLabels"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-llm-selector.js",scope:()=>[r.i18n,a.default,i.hash],isStrictMode:!0}),this)}}e.default=p}),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options",["exports","@glimmer/component","@ember/object","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-llm-selector","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{get showToolOptions(){const e=this.args.allTools
return!(!e||!this.args.data.tools)&&this.args.data?.tools.some(t=>e.find(e=>e.id===t)?.options)}get toolsMetadata(){const e={}
return this.args.allTools.map(t=>{e[t.id]={name:t.name,...t?.options}}),e}formObjectKeys(e){return e?Object.keys(e):[]}static{dt7948.n(this.prototype,"formObjectKeys",[s.action])}toolOptionKeys(e){const t=this.toolsMetadata[e]
if(!t)return[]
return Object.keys(t).filter(e=>"name"!==e)}static{dt7948.n(this.prototype,"toolOptionKeys",[s.action])}static{(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"V1zRWCV/",block:'[[[41,[30,0,["showToolOptions"]],[[[1,"  "],[8,[30,1,["Container"]],null,[["@title","@direction","@format"],[[28,[32,0],["discourse_ai.ai_persona.tool_options"],null],"column","full"]],[["default"],[[[[1,"\\n    "],[8,[30,1,["Object"]],null,[["@name","@title"],["toolOptions",[28,[32,0],["discourse_ai.ai_persona.tool_options"],null]]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[28,[30,0,["formObjectKeys"]],[[30,3]],null]],null]],null],null,[[[1,"        "],[10,0],[14,0,"ai-persona-editor__tool-options"],[12],[1,"\\n"],[44,[[28,[32,1],[[30,0,["toolsMetadata"]],[30,4]],null]],[[[1,"            "],[10,0],[14,0,"ai-persona-editor__tool-options-name"],[12],[1,"\\n              "],[1,[30,5,["name"]]],[1,"\\n            "],[13],[1,"\\n            "],[8,[30,2,["Object"]],null,[["@name"],[[30,4]]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[28,[30,0,["toolOptionKeys"]],[[30,4]],null]],null]],null],null,[[[44,[[28,[32,1],[[30,5],[30,7]],null]],[[[1,"                  "],[8,[30,6,["Field"]],null,[["@name","@title","@helpText","@format"],[[30,7],[30,8,["name"]],[30,8,["description"]],"full"]],[["default"],[[[[1,"\\n"],[41,[28,[32,2],[[30,8,["type"]],"enum"],null],[[[1,"                      "],[8,[30,9,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,8,["values"]]],null]],null],null,[[[1,"                          "],[8,[30,10,["Option"]],null,[["@value"],[[30,11]]],[["default"],[[[[1,[30,11]]],[]]]]],[1,"\\n"]],[11]],null],[1,"                      "]],[10]]]]],[1,"\\n"]],[]],[[[41,[28,[32,2],[[30,8,["type"]],"llm"],null],[[[1,"                      "],[8,[30,9,["Custom"]],null,null,[["default"],[[[[1,"\\n                        "],[8,[32,3],[[24,0,"ai-persona-tool-option-editor__llms"]],[["@value","@llms","@onChange"],[[30,9,["value"]],[30,12],[30,9,["set"]]]],null],[1,"\\n                      "]],[]]]]],[1,"\\n"]],[]],[[[41,[28,[32,2],[[30,8,["type"]],"boolean"],null],[[[1,"                      "],[8,[30,9,["Checkbox"]],null,null,null],[1,"\\n"]],[]],[[[41,[28,[32,2],[[30,8,["type"]],"text"],null],[[[1,"                      "],[8,[30,9,["Textarea"]],null,null,null],[1,"\\n"]],[]],[[[1,"                      "],[8,[30,9,["Input"]],null,null,null],[1,"\\n                    "]],[]]]],[]]]],[]]]],[]]],[1,"                  "]],[9]]]]],[1,"\\n"]],[8]]]],[7]],null],[1,"            "]],[6]]]]],[1,"\\n"]],[5]]],[1,"        "],[13],[1,"\\n"]],[4]],null],[1,"    "]],[2,3]]]]],[1,"\\n  "]],[]]]]],[1,"\\n"]],[]],null]],["@form","toolObj","optsPerTool","toolId","toolMeta","optionsObj","optionName","optionMeta","field","select","v","@llms"],["if","each","-track-array","let"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options.js",scope:()=>[o.i18n,s.get,i.eq,n.default],isStrictMode:!0}),this)}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/components/ai-post-helper-menu",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/will-destroy","@ember/service","ember-modifier","discourse/components/cook-text","discourse/components/d-button","discourse/components/fast-edit","discourse/components/modal/fast-edit","discourse/helpers/concat-class","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/decorators","discourse/lib/text","discourse/lib/utilities","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-helper-loading","discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list","discourse/plugins/discourse-ai/discourse/lib/ai-errors","discourse/plugins/discourse-ai/discourse/lib/smooth-streamer","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x,k){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class T extends t.default{static{dt7948.g(this.prototype,"messageBus",[n.service])}#we=void dt7948.i(this,"messageBus")
static{dt7948.g(this.prototype,"site",[n.service])}#S=void dt7948.i(this,"site")
static{dt7948.g(this.prototype,"modal",[n.service])}#O=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"siteSettings",[n.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"currentUser",[n.service])}#A=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"menu",[n.service])}#Se=void dt7948.i(this,"menu")
static{dt7948.g(this.prototype,"tooltip",[n.service])}#x=void dt7948.i(this,"tooltip")
static{dt7948.g(this.prototype,"menuState",[s.tracked],function(){return this.MENU_STATES.options})}#xe=void dt7948.i(this,"menuState")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"suggestion",[s.tracked],function(){return""})}#Te=void dt7948.i(this,"suggestion")
static{dt7948.g(this.prototype,"customPromptValue",[s.tracked],function(){return""})}#D=void dt7948.i(this,"customPromptValue")
static{dt7948.g(this.prototype,"copyButtonIcon",[s.tracked],function(){return"copy"})}#Ce=void dt7948.i(this,"copyButtonIcon")
static{dt7948.g(this.prototype,"copyButtonLabel",[s.tracked],function(){return"discourse_ai.ai_helper.post_options_menu.copy"})}#Pe=void dt7948.i(this,"copyButtonLabel")
static{dt7948.g(this.prototype,"showFastEdit",[s.tracked],function(){return!1})}#Me=void dt7948.i(this,"showFastEdit")
static{dt7948.g(this.prototype,"showAiButtons",[s.tracked],function(){return!0})}#je=void dt7948.i(this,"showAiButtons")
static{dt7948.g(this.prototype,"streaming",[s.tracked],function(){return!1})}#Ae=void dt7948.i(this,"streaming")
static{dt7948.g(this.prototype,"lastSelectedOption",[s.tracked],function(){return null})}#Le=void dt7948.i(this,"lastSelectedOption")
static{dt7948.g(this.prototype,"isSavingFootnote",[s.tracked],function(){return!1})}#Ee=void dt7948.i(this,"isSavingFootnote")
static{dt7948.g(this.prototype,"smoothStreamer",[s.tracked],function(){return new S.default(()=>this.suggestion,e=>this.suggestion=e)})}#Re=void dt7948.i(this,"smoothStreamer")
MENU_STATES={options:"OPTIONS",loading:"LOADING",result:"RESULT"}
showFootnoteTooltip=(0,a.modifier)(e=>{if(this.args.data.supportsFastEdit||this.streaming)return
const t=this.tooltip.register(e,{identifier:"cannot-add-footnote-tooltip",content:(0,b.i18n)("discourse_ai.ai_helper.post_options_menu.footnote_disabled"),placement:"top",triggers:"hover"})
return()=>{t.destroy()}})
static{dt7948.g(this.prototype,"_activeAiRequest",[s.tracked],function(){return null})}#Oe=void dt7948.i(this,"_activeAiRequest")
get footnoteDisabled(){return this.streaming||!this.args.data.supportsFastEdit}get helperOptions(){let e=this.currentUser?.ai_helper_prompts
e=e.filter(e=>e.location.includes("post"))
const t=e.findIndex(e=>"custom_prompt"===e.name)
if(-1!==t){const s=e.splice(t,1)[0]
e.unshift(s)}return this._showUserCustomPrompts()||(e=e.filter(e=>"custom_prompt"!==e.name)),this.args.data.canEditPost||(e=e.filter(e=>"proofread"!==e.name)),e}get highlightedTextToggleIcon(){return this.showHighlightedText?"angle-double-left":"angle-double-right"}get allowInsertFootnote(){const e=this.siteSettings,t=this.args.data.canEditPost
return!!(e?.enable_markdown_footnotes&&e?.display_footnotes_inline&&t)&&"explain"===this.lastSelectedOption?.name}_showUserCustomPrompts(){return this.currentUser?.can_use_custom_prompts}_sanitizeForFootnote(e){return e=(e=(e=e.replace(/[\r\n]+/g," ")).replace(/^(#+)\s+/gm,"")).trim(),(0,g.sanitize)(e)}set progressChannel(e){this._progressChannel&&this.unsubscribe(),this._progressChannel=e,this.subscribe()}subscribe(){this.messageBus.subscribe(this._progressChannel,this._updateResult,0)}unsubscribe(){this._progressChannel&&(this.messageBus.unsubscribe(this._progressChannel,this._updateResult),this._progressChannel=null)}static{dt7948.n(this.prototype,"unsubscribe",[h.bind])}async _updateResult(e){if((0,w.isAiCreditLimitError)(e))return this.loading=!1,this.menuState=this.MENU_STATES.triggers,void(0,w.popupAiCreditLimitError)(e)
this.streaming=!e.done,await this.smoothStreamer.updateResult(e,"result")}static{dt7948.n(this.prototype,"_updateResult",[h.bind])}toggleHighlightedTextPreview(){this.showHighlightedText=!this.showHighlightedText}static{dt7948.n(this.prototype,"toggleHighlightedTextPreview",[i.action])}async performAiSuggestion(e){this.menuState=this.MENU_STATES.loading,this.lastSelectedOption=e
const t=["explain","translate","custom_prompt"]
try{if(t.includes(e.name)){const t=await this._handleStreamedResult(e)
return void(this.progressChannel=t.progress_channel)}this._activeAiRequest=(0,p.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:e.name,text:this.args.data.quoteState.buffer,custom_prompt:this.customPromptValue}}),this._activeAiRequest.then(({suggestions:t})=>{if(this.suggestion=t[0].trim(),"proofread"===e.name)return this._handleProofreadOption()}).finally(()=>{this.loading=!1,this.menuState=this.MENU_STATES.result})}catch(s){(0,w.isAiCreditLimitError)(s)?(0,w.popupAiCreditLimitError)(s):(0,m.popupAjaxError)(s),this.loading=!1,this.menuState=this.MENU_STATES.triggers}return this._activeAiRequest}static{dt7948.n(this.prototype,"performAiSuggestion",[i.action])}_handleStreamedResult(e){this.menuState=this.MENU_STATES.result
const t=this.menu.getByIdentifier("post-text-selection-toolbar")
t&&(t.options.placement="bottom")
return this._activeAiRequest=(0,p.ajax)("/discourse-ai/ai-helper/stream_suggestion",{method:"POST",data:{location:"post",mode:e.name,text:this.args.data.quoteState.buffer,post_id:this.args.data.quoteState.postId,custom_prompt:this.customPromptValue,client_id:this.messageBus.clientId}}),this._activeAiRequest}_handleProofreadOption(){return this.showAiButtons=!1,this.site.desktopView?void(this.showFastEdit=!0):this.modal.show(u.default,{model:{initialValue:this.args.data.quoteState.buffer,newValue:this.suggestion,post:this.args.data.post,close:this.closeFastEdit}})}cancelAiAction(){this._activeAiRequest&&(this._activeAiRequest.abort(),this._activeAiRequest=null,this.loading=!1,this.menuState=this.MENU_STATES.options)}static{dt7948.n(this.prototype,"cancelAiAction",[i.action])}copySuggestion(){this.suggestion?.length>0&&((0,_.clipboardCopy)(this.suggestion),this.copyButtonIcon="check",this.copyButtonLabel="discourse_ai.ai_helper.post_options_menu.copied",setTimeout(()=>{this.copyButtonIcon="copy",this.copyButtonLabel="discourse_ai.ai_helper.post_options_menu.copy"},3500))}static{dt7948.n(this.prototype,"copySuggestion",[i.action])}closeMenu(){return this.suggestion="",this.customPromptValue="",this.args.close()}static{dt7948.n(this.prototype,"closeMenu",[i.action])}async closeFastEdit(){this.showFastEdit=!1,await this.args.data.hideToolbar()}static{dt7948.n(this.prototype,"closeFastEdit",[i.action])}async insertFootnote(){if(this.isSavingFootnote=!0,this.allowInsertFootnote)try{const e=await(0,p.ajax)(`/posts/${this.args.data.post.id}`),t=this._sanitizeForFootnote(this.suggestion),s=(0,b.i18n)("discourse_ai.ai_helper.post_options_menu.footnote_credits"),i=`${this.args.data.quoteState.buffer} ^[${t} (${s})]`,o=e.raw.replace(this.args.data.quoteState.buffer,i)
await this.args.data.post.save({raw:o})}catch(e){(0,w.isAiCreditLimitError)(e)?(0,w.popupAiCreditLimitError)(e):(0,m.popupAjaxError)(e)}finally{this.isSavingFootnote=!1,await this.closeMenu()}}static{dt7948.n(this.prototype,"insertFootnote",[i.action])}static{(0,x.setComponentTemplate)((0,k.createTemplateFactory)({id:"SQK9A9cQ",block:'[[[41,[28,[32,0],[[30,0,["site","mobileView"]],[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","options"]]],null]],null],[[[1,"  "],[10,0],[14,0,"ai-post-helper-menu__selected-text"],[12],[1,"\\n    "],[1,[30,1,["quoteState","buffer"]]],[1,"\\n  "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showAiButtons"]],[[[1,"  "],[10,0],[14,0,"ai-post-helper"],[12],[1,"\\n"],[41,[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","options"]]],null],[[[1,"      "],[8,[32,2],null,[["@options","@customPromptValue","@performAction","@shortcutVisible"],[[30,0,["helperOptions"]],[30,0,["customPromptValue"]],[30,0,["performAiSuggestion"]],false]],null],[1,"\\n"]],[]],[[[41,[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","loading"]]],null],[[[1,"      "],[8,[32,3],null,[["@cancel"],[[30,0,["cancelAiAction"]]]],null],[1,"\\n"]],[]],[[[41,[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","result"]]],null],[[[1,"      "],[11,0],[24,0,"ai-post-helper__suggestion"],[4,[32,4],[[30,0,["unsubscribe"]]],null],[12],[1,"\\n"],[41,[30,0,["suggestion"]],[[[1,"          "],[10,0],[15,0,[28,[32,5],[[52,[30,0,["smoothStreamer","isStreaming"]],"streaming"],"streamable-content","ai-post-helper__suggestion__text"],null]],[14,"dir","auto"],[12],[1,"\\n            "],[8,[32,6],[[24,0,"cooked"]],[["@rawText"],[[30,0,["smoothStreamer","renderedText"]]]],null],[1,"\\n          "],[13],[1,"\\n          "],[10,0],[14,0,"ai-post-helper__suggestion__buttons"],[12],[1,"\\n            "],[8,[32,7],[[24,0,"btn-flat ai-post-helper__suggestion__cancel"]],[["@icon","@label","@action"],["xmark","discourse_ai.ai_helper.post_options_menu.cancel",[30,0,["cancelAiAction"]]]],null],[1,"\\n            "],[8,[32,7],[[24,0,"btn-flat ai-post-helper__suggestion__copy"]],[["@icon","@label","@action","@disabled"],[[30,0,["copyButtonIcon"]],[30,0,["copyButtonLabel"]],[30,0,["copySuggestion"]],[30,0,["streaming"]]]],null],[1,"\\n"],[41,[30,0,["allowInsertFootnote"]],[[[1,"              "],[8,[32,7],[[24,0,"btn-flat ai-post-helper__suggestion__insert-footnote"],[4,[30,0,["showFootnoteTooltip"]],null,null]],[["@icon","@label","@action","@isLoading","@disabled"],["asterisk","discourse_ai.ai_helper.post_options_menu.insert_footnote",[30,0,["insertFootnote"]],[30,0,["isSavingFootnote"]],[30,0,["footnoteDisabled"]]]],null],[1,"\\n"]],[]],null],[1,"          "],[13],[1,"\\n"]],[]],[[[1,"          "],[8,[32,3],null,[["@cancel"],[[30,0,["cancelAiAction"]]]],null],[1,"\\n"]],[]]],[1,"      "],[13],[1,"\\n    "]],[]],null]],[]]]],[]]],[1,"  "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showFastEdit"]],[[[1,"  "],[10,0],[14,0,"ai-post-helper__fast-edit"],[12],[1,"\\n    "],[8,[32,8],null,[["@initialValue","@newValue","@post","@close"],[[30,1,["quoteState","buffer"]],[30,0,["suggestion"]],[30,1,["post"]],[30,0,["closeFastEdit"]]]],null],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],["@data"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-post-helper-menu.js",scope:()=>[f.and,f.eq,v.default,y.default,o.default,c.default,r.default,l.default,d.default],isStrictMode:!0}),this)}}e.default=T}),define("discourse/plugins/discourse-ai/discourse/components/ai-quota-duration-selector",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","discourse/select-kit/components/combo-box","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=[{id:"3600",seconds:3600,nameKey:"discourse_ai.llms.quotas.durations.hour"},{id:"21600",seconds:21600,nameKey:"discourse_ai.llms.quotas.durations.six_hours"},{id:"86400",seconds:86400,nameKey:"discourse_ai.llms.quotas.durations.day"},{id:"604800",seconds:604800,nameKey:"discourse_ai.llms.quotas.durations.week"},{id:"custom",nameKey:"discourse_ai.llms.quotas.durations.custom"}]
class u extends t.default{static{dt7948.g(this.prototype,"selectedPresetId",[s.tracked],function(){return"86400"})}#Fe=void dt7948.i(this,"selectedPresetId")
static{dt7948.g(this.prototype,"customHours",[s.tracked],function(){return null})}#Ie=void dt7948.i(this,"customHours")
constructor(){super(...arguments)
const e=this.args.value,t=d.find(t=>t.seconds===e)
t?this.selectedPresetId=t.id:(this.selectedPresetId="custom",this.customHours=Math.round(e/3600))}get presetOptions(){return d.map(e=>({id:e.id,name:(0,a.i18n)(e.nameKey),seconds:e.seconds}))}get isCustom(){return"custom"===this.selectedPresetId}get currentDurationSeconds(){return this.isCustom?this.customHours?3600*this.customHours:0:parseInt(this.selectedPresetId,10)}onPresetChange(e){this.selectedPresetId=e,this.updateValue()}static{dt7948.n(this.prototype,"onPresetChange",[o.action])}onCustomHoursChange(e){this.customHours=parseInt(e.target.value,10),this.updateValue()}static{dt7948.n(this.prototype,"onCustomHoursChange",[o.action])}updateValue(){this.args.onChange&&this.args.onChange(this.currentDurationSeconds)}static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"VIaRZosV",block:'[[[10,0],[14,0,"duration-selector"],[12],[1,"\\n  "],[8,[32,0],[[24,0,"duration-selector__preset"]],[["@content","@value","@onChange"],[[30,0,["presetOptions"]],[30,0,["selectedPresetId"]],[30,0,["onPresetChange"]]]],null],[1,"\\n\\n"],[41,[30,0,["isCustom"]],[[[1,"    "],[10,0],[14,0,"duration-selector__custom"],[12],[1,"\\n      "],[11,"input"],[16,2,[30,0,["customHours"]]],[24,0,"duration-selector__hours-input"],[24,"min","1"],[24,4,"number"],[4,[32,1],["input",[30,0,["onCustomHoursChange"]]],null],[12],[13],[1,"\\n      "],[10,1],[14,0,"duration-selector__hours-label"],[12],[1,"\\n        "],[1,[28,[32,2],["discourse_ai.llms.quotas.hours"],null]],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[13]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-quota-duration-selector.js",scope:()=>[n.default,i.on,a.i18n],isStrictMode:!0}),this)}}e.default=u}),define("discourse/plugins/discourse-ai/discourse/components/ai-regen-summaries-buttons",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/ajax","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static{dt7948.g(this.prototype,"currentUser",[i.service])}#A=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"toasts",[i.service])}#U=void dt7948.i(this,"toasts")
get showGistOption(){return this.currentUser.can_request_gists}get topicIds(){return this.args.topicIds}get count(){return this.topicIds.length}get dataPayload(){return 1===this.count?{topic_id:this.topicIds[0]}:{topic_ids:this.topicIds}}async regenerateGists(){this.args.onLoadingChange?.(!0)
try{await(0,n.ajax)("/discourse-ai/summarization/regen_gist",{type:"PUT",data:this.dataPayload}),this.toasts.success({data:{message:(0,a.i18n)("discourse_ai.summarization.topic.regenerate_gists_success",{count:this.count})}}),this.args.onSuccess?.()}catch{this.toasts.error({data:{message:(0,a.i18n)("discourse_ai.summarization.topic.regenerate_gists_error",{count:this.count})}})}finally{this.args.onLoadingChange?.(!1)}}static{dt7948.n(this.prototype,"regenerateGists",[s.action])}async regenerateSummaries(){this.args.onLoadingChange?.(!0)
try{await(0,n.ajax)("/discourse-ai/summarization/regen_summary",{type:"PUT",data:this.dataPayload}),this.toasts.success({data:{message:(0,a.i18n)("discourse_ai.summarization.topic.regenerate_topic_summary_success",{count:this.count})}}),this.args.onSuccess?.()}catch{this.toasts.error({data:{message:(0,a.i18n)("discourse_ai.summarization.topic.regenerate_topic_summary_error",{count:this.count})}})}finally{this.args.onLoadingChange?.(!1)}}static{dt7948.n(this.prototype,"regenerateSummaries",[s.action])}static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"JY9sYi9U",block:'[[[41,[30,0,["showGistOption"]],[[[1,"  "],[8,[32,0],[[24,0,"btn-primary ai-regen-gists-btn"]],[["@label","@icon","@action","@disabled"],["discourse_ai.summarization.topic.regenerate_gists_option","arrows-rotate",[30,0,["regenerateGists"]],[30,1]]],null],[1,"\\n"]],[]],null],[8,[32,0],[[24,0,"btn-primary ai-regen-summaries-btn"]],[["@label","@icon","@action","@disabled"],["discourse_ai.summarization.topic.regenerate_summaries_option","arrows-rotate",[30,0,["regenerateSummaries"]],[30,1]]],null]],["@disabled"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-regen-summaries-buttons.js",scope:()=>[o.default],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries-tooltip",["exports","@glimmer/component","@ember/service","discourse/components/d-button","discourse/float-kit/components/d-tooltip","discourse/helpers/d-icon","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static{dt7948.g(this.prototype,"discobotDiscoveries",[s.service])}#De=void dt7948.i(this,"discobotDiscoveries")
static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"ynELYb7p",block:'[[[10,1],[14,0,"ai-search-discoveries-tooltip"],[12],[1,"\\n  "],[8,[32,0],null,[["@placement","@interactive"],["top-end",true]],[["trigger","content"],[[[[1,"\\n      "],[1,[28,[32,1],["circle-info"],null]],[1,"\\n    "]],[]],[[[1,"\\n      "],[10,0],[14,0,"ai-search-discoveries-tooltip__content"],[12],[1,"\\n        "],[10,0],[14,0,"ai-search-discoveries-tooltip__header"],[12],[1,"\\n          "],[1,[28,[32,2],["discourse_ai.discobot_discoveries.tooltip.header"],null]],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"ai-search-discoveries-tooltip__description"],[12],[1,"\\n"],[41,[30,0,["discobotDiscoveries","modelUsed"]],[[[1,"            "],[1,[28,[32,2],["discourse_ai.discobot_discoveries.tooltip.content"],[["model"],[[30,0,["discobotDiscoveries","modelUsed"]]]]]],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"ai-search-discoveries-tooltip__actions"],[12],[1,"\\n          "],[8,[32,3],[[24,0,"btn-transparent --primary"]],[["@label","@href"],["discourse_ai.discobot_discoveries.tooltip.actions.info","https://meta.discourse.org/t/conversational-ai-search-coming-to-discourse-ai/355939"]],null],[1,"\\n          "],[8,[32,3],[[24,0,"btn-transparent btn-danger"]],[["@label","@action"],["discourse_ai.discobot_discoveries.tooltip.actions.disable",[30,0,["discobotDiscoveries","disableDiscoveries"]]]],null],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n    "]],[]]]]],[1,"\\n"],[13]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries-tooltip.js",scope:()=>[o.default,n.default,a.i18n,i.default],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/service","discourse/components/cook-text","discourse/components/d-button","discourse/helpers/concat-class","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/decorators","discourse/lib/intercept-click","discourse/lib/url","discourse/models/topic","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-blinking-animation","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class x extends t.default{static{dt7948.g(this.prototype,"search",[l.service])}#Ne=void dt7948.i(this,"search")
static{dt7948.g(this.prototype,"messageBus",[l.service])}#we=void dt7948.i(this,"messageBus")
static{dt7948.g(this.prototype,"discobotDiscoveries",[l.service])}#De=void dt7948.i(this,"discobotDiscoveries")
static{dt7948.g(this.prototype,"appEvents",[l.service])}#j=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"currentUser",[l.service])}#A=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"siteSettings",[l.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"composer",[l.service])}#Ue=void dt7948.i(this,"composer")
static{dt7948.g(this.prototype,"loadingConversationTopic",[s.tracked],function(){return!1})}#qe=void dt7948.i(this,"loadingConversationTopic")
static{dt7948.g(this.prototype,"fullDiscoveryToggled",[s.tracked],function(){return!1})}#Be=void dt7948.i(this,"fullDiscoveryToggled")
static{dt7948.g(this.prototype,"discoveryPreviewLength",[s.tracked],function(){return this.args.discoveryPreviewLength||150})}#ze=void dt7948.i(this,"discoveryPreviewLength")
constructor(){super(...arguments),this.appEvents.on("full-page-search:trigger-search",this,this.triggerDiscovery)}willDestroy(){super.willDestroy(...arguments),this.appEvents.off("full-page-search:trigger-search",this,this.triggerDiscovery)}async _updateDiscovery(e){this.query===e.query&&this.discobotDiscoveries.onDiscoveryUpdate(e)}static{dt7948.n(this.prototype,"_updateDiscovery",[h.bind])}unsubscribe(){this.messageBus.unsubscribe("/discourse-ai/discoveries",this._updateDiscovery)}static{dt7948.n(this.prototype,"unsubscribe",[h.bind])}subscribe(){this.messageBus.subscribe("/discourse-ai/discoveries",this._updateDiscovery)}static{dt7948.n(this.prototype,"subscribe",[h.bind])}get query(){return this.args?.searchTerm||this.search.activeGlobalSearchTerm}get toggleLabel(){return this.fullDiscoveryToggled?"discourse_ai.discobot_discoveries.collapse":"discourse_ai.discobot_discoveries.tell_me_more"}get toggleIcon(){return this.fullDiscoveryToggled?"chevron-up":""}get canShowExpandtoggle(){return!this.discobotDiscoveries.loadingDiscoveries&&this.discobotDiscoveries.streamedText.length>this.discoveryPreviewLength}get renderPreviewOnly(){return!this.fullDiscoveryToggled&&this.canShowExpandtoggle}get canContinueConversation(){const e=this.currentUser?.ai_enabled_personas
if(!e)return!1
if(this.discobotDiscoveries.discoveryTimedOut)return!1
const t=e.find(e=>e.id===parseInt(this.siteSettings?.ai_discover_persona,10)),s=t?.username
return this.discobotDiscoveries.discovery?.length>0&&!this.discobotDiscoveries.isStreaming&&s}get continueConvoBtnLabel(){return this.loadingConversationTopic?"discourse_ai.discobot_discoveries.loading_convo":"discourse_ai.discobot_discoveries.continue_convo"}async triggerDiscovery(){this.discobotDiscoveries.triggerDiscovery(this.query)}static{dt7948.n(this.prototype,"triggerDiscovery",[o.action])}toggleDiscovery(){this.fullDiscoveryToggled=!this.fullDiscoveryToggled}static{dt7948.n(this.prototype,"toggleDiscovery",[o.action])}handleDiscoveryClick(e){const t=e.target.closest("a")
t&&((0,g.wantsNewWindow)(e)||(e.preventDefault(),_.default.routeTo(t.href),this.args.closeSearchMenu&&this.args.closeSearchMenu()))}static{dt7948.n(this.prototype,"handleDiscoveryClick",[o.action])}async continueConversation(){const e={query:this.query,context:this.discobotDiscoveries.discovery}
try{this.loadingConversationTopic=!0
const t=await(0,p.ajax)("/discourse-ai/discoveries/continue-convo",{type:"POST",data:e}),s=await f.default.find(t.topic_id,{}),i=f.default.create(s)
_.default.routeTo(`/t/${t.topic_id}`,{afterRouteComplete:()=>{this.args.closeSearchMenu&&this.args.closeSearchMenu(),this.composer.focusComposer({topic:i})}})}catch(t){(0,m.popupAjaxError)(t)}finally{this.loadingConversationTopic=!1}}static{dt7948.n(this.prototype,"continueConversation",[o.action])}static{(0,w.setComponentTemplate)((0,S.createTemplateFactory)({id:"RskGwHvZ",block:'[[[11,0],[24,0,"ai-search-discoveries"],[4,[32,0],[[30,0,["subscribe"]],[30,0,["query"]]],null],[4,[32,1],[[30,0,["subscribe"]],[30,0,["query"]]],null],[4,[32,0],[[30,0,["triggerDiscovery"]],[30,0,["query"]]],null],[4,[32,2],[[30,0,["unsubscribe"]]],null],[12],[1,"\\n  "],[10,0],[14,0,"ai-search-discoveries__completion"],[12],[1,"\\n"],[41,[30,0,["discobotDiscoveries","loadingDiscoveries"]],[[[1,"      "],[8,[32,3],null,null,null],[1,"\\n"]],[]],[[[41,[30,0,["discobotDiscoveries","discoveryTimedOut"]],[[[1,"      "],[1,[28,[32,4],["discourse_ai.discobot_discoveries.timed_out"],null]],[1,"\\n"]],[]],[[[1,"      "],[11,"article"],[16,0,[28,[32,5],["ai-search-discoveries__discovery",[52,[30,0,["renderPreviewOnly"]],"preview"],[52,[30,0,["discobotDiscoveries","isStreaming"]],"streaming"],"streamable-content"],null]],[4,[32,6],["click",[30,0,["handleDiscoveryClick"]]],null],[12],[1,"\\n        "],[8,[32,7],[[24,0,"cooked"]],[["@rawText"],[[30,0,["discobotDiscoveries","streamedText"]]]],null],[1,"\\n      "],[13],[1,"\\n\\n"],[41,[30,0,["canShowExpandtoggle"]],[[[1,"        "],[8,[32,8],[[24,0,"btn-flat btn-text ai-search-discoveries__toggle"]],[["@label","@icon","@action"],[[30,0,["toggleLabel"]],[30,0,["toggleIcon"]],[30,0,["toggleDiscovery"]]]],null],[1,"\\n"]],[]],null],[1,"    "]],[]]]],[]]],[1,"  "],[13],[1,"\\n\\n"],[41,[30,0,["canContinueConversation"]],[[[1,"    "],[10,0],[14,0,"ai-search-discoveries__continue-conversation"],[12],[1,"\\n      "],[8,[32,8],[[24,0,"btn-default btn-small"]],[["@action","@label"],[[30,0,["continueConversation"]],[30,0,["continueConvoBtnLabel"]]]],[["default"],[[[[1,"\\n        "],[8,[32,9],null,[["@loading"],[[30,0,["loadingConversationTopic"]]]],null],[1,"\\n      "]],[]]]]],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[13]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries.js",scope:()=>[n.default,a.default,r.default,y.default,b.i18n,c.default,i.on,d.default,u.default,v.default],isStrictMode:!0}),this)}}e.default=x}),define("discourse/plugins/discourse-ai/discourse/components/ai-secret-editor-form",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/routing","@ember/runloop","@ember/service","discourse/components/back-button","discourse/components/form","discourse/lib/ajax-error","discourse/lib/array-tools","discourse/truth-helpers","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static{dt7948.g(this.prototype,"toasts",[a.service])}#U=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"router",[a.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"dialog",[a.service])}#H=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"isSaving",[s.tracked],function(){return!1})}#z=void dt7948.i(this,"isSaving")
get formData(){const{model:e}=this.args
return{name:e.name,secret:e.secret}}static{dt7948.n(this.prototype,"formData",[s.cached])}get isInUse(){return this.args.model.used_by?.length>0}get usedByLastIndex(){const e=this.args.model.used_by?.length||0
return Math.max(0,e-1)}async save(e){this.isSaving=!0
const t=this.args.model.isNew
try{const s={...e}
"********"===s.secret&&delete s.secret,await this.args.model.save(s),t&&((0,u.addUniqueValueToArray)(this.args.secrets.content,this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-secrets.index")),this.toasts.success({data:{message:(0,p.i18n)("discourse_ai.secrets.saved")},duration:"short"})}catch(s){(0,d.popupAjaxError)(s)}finally{(0,n.later)(()=>{this.isSaving=!1},1e3)}}static{dt7948.n(this.prototype,"save",[i.action])}delete(){return this.dialog.confirm({message:(0,p.i18n)("discourse_ai.secrets.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then(()=>{(0,u.removeValueFromArray)(this.args.secrets.content,this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-secrets.index")}).catch(d.popupAjaxError)})}static{dt7948.n(this.prototype,"delete",[i.action])}static{(0,m.setComponentTemplate)((0,h.createTemplateFactory)({id:"157ssRp9",block:'[[[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-secrets","discourse_ai.secrets.back"]],null],[1,"\\n"],[8,[32,1],[[24,0,"ai-secret-editor"]],[["@onSubmit","@data"],[[30,0,["save"]],[30,0,["formData"]]]],[["default"],[[[[1,"\\n  "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format"],["name",[28,[32,2],["discourse_ai.secrets.name"],null],"required|length:1,100","large"]],[["default"],[[[[1,"\\n    "],[8,[30,2,["Input"]],null,null,null],[1,"\\n  "]],[2]]]]],[1,"\\n\\n  "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format"],["secret",[28,[32,2],["discourse_ai.secrets.secret"],null],"required","large"]],[["default"],[[[[1,"\\n    "],[8,[30,3,["Password"]],[[24,"autocomplete","off"]],null,null],[1,"\\n  "]],[3]]]]],[1,"\\n\\n  "],[8,[30,1,["Actions"]],null,null,[["default"],[[[[1,"\\n    "],[8,[30,1,["Submit"]],null,null,null],[1,"\\n\\n"],[41,[51,[30,4,["isNew"]]],[[[41,[30,0,["isInUse"]],[[[1,"        "],[10,0],[14,0,"ai-secret-editor__in-use-message"],[12],[1,"\\n          "],[1,[28,[32,2],["discourse_ai.secrets.cannot_delete_in_use"],null]],[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,4,["used_by"]]],null]],null],null,[[[41,[28,[32,3],[[30,5,["type"]],"embedding"],null],[[[8,[32,4],null,[["@route","@model"],["adminPlugins.show.discourse-ai-embeddings.edit",[30,5,["id"]]]],[["default"],[[[[1,[30,5,["name"]]]],[]]]]]],[]],[[[8,[32,4],null,[["@route","@model"],["adminPlugins.show.discourse-ai-llms.edit",[30,5,["id"]]]],[["default"],[[[[1,[30,5,["name"]]]],[]]]]]],[]]],[41,[51,[28,[32,3],[[30,6],[30,0,["usedByLastIndex"]]],null]],[[[1,[28,[32,2],["word_connector.comma"],null]]],[]],null]],[5,6]],null],[1,"        "],[13],[1,"\\n"]],[]],[[[1,"        "],[8,[30,1,["Button"]],[[24,0,"btn-danger"]],[["@action","@label"],[[30,0,["delete"]],"discourse_ai.secrets.delete"]],null],[1,"\\n"]],[]]]],[]],null],[1,"  "]],[]]]]],[1,"\\n"]],[1]]]]]],["form","field","field","@model","usage","index"],["unless","if","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-secret-editor-form.js",scope:()=>[r.default,l.default,p.i18n,c.eq,o.LinkTo],isStrictMode:!0}),this)}}e.default=g}),define("discourse/plugins/discourse-ai/discourse/components/ai-secret-selector",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/service","discourse/components/d-button","discourse/select-kit/components/combo-box","discourse/plugins/discourse-ai/discourse/components/modal/ai-secret-create-modal","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static{dt7948.g(this.prototype,"modal",[n.service])}#O=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"addedSecrets",[s.tracked],function(){return[]})}#Ve=void dt7948.i(this,"addedSecrets")
get secretOptions(){return[...this.args.secrets||[],...this.addedSecrets].map(e=>({id:e.id,name:e.name}))}get hasSecrets(){return this.secretOptions.length>0}onSelectSecret(e){this.args.onChange?.(e)}static{dt7948.n(this.prototype,"onSelectSecret",[o.action])}openCreateModal(){this.modal.show(l.default,{model:{onSave:e=>{this.addedSecrets=[...this.addedSecrets,e],this.args.onChange?.(e.id)}}})}static{dt7948.n(this.prototype,"openCreateModal",[o.action])}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"+ykb4tJd",block:'[[[10,0],[14,0,"ai-secret-selector"],[12],[1,"\\n"],[41,[30,0,["hasSecrets"]],[[[1,"    "],[8,[32,0],[[24,0,"ai-secret-selector__dropdown"]],[["@value","@content","@onChange","@options"],[[30,1],[30,0,["secretOptions"]],[30,0,["onSelectSecret"]],[28,[32,1],null,[["filterable","none"],[true,"discourse_ai.secrets.select_secret"]]]]],null],[1,"\\n    "],[8,[32,2],[[24,0,"btn-default ai-secret-selector__add-btn"]],[["@action","@icon","@title"],[[30,0,["openCreateModal"]],"plus","discourse_ai.secrets.create_new"]],null],[1,"\\n"]],[]],[[[1,"    "],[8,[32,2],[[24,0,"btn-default ai-secret-selector__add-btn"]],[["@action","@icon","@label"],[[30,0,["openCreateModal"]],"plus","discourse_ai.secrets.add_secret"]],null],[1,"\\n"]],[]]],[13]],["@value"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-secret-selector.js",scope:()=>[r.default,i.hash,a.default],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/ai-secrets-list-editor",["exports","@glimmer/component","@ember/routing","@ember/service","discourse/admin/components/admin-config-area-empty-list","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-secret-editor-form","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends t.default{static{dt7948.g(this.prototype,"adminPluginNavManager",[i.service])}#Q=void dt7948.i(this,"adminPluginNavManager")
get hasSecrets(){return this.args.secrets.content?.length>0}static{(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"hQeSZzG0",block:'[[[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-secrets"]],[28,[32,1],["discourse_ai.secrets.short_title"],null]]],null],[1,"\\n"],[10,"section"],[14,0,"ai-secret-list-editor admin-detail"],[12],[1,"\\n"],[41,[30,1],[[[1,"    "],[8,[32,2],null,[["@model","@secrets"],[[30,1],[30,2]]],null],[1,"\\n"]],[]],[[[1,"    "],[8,[32,3],null,[["@titleLabel","@descriptionLabel"],[[28,[32,1],["discourse_ai.secrets.short_title"],null],[28,[32,1],["discourse_ai.secrets.description"],null]]],[["actions"],[[[[1,"\\n        "],[8,[30,3,["Primary"]],[[24,0,"ai-secret-list-editor__new-btn"]],[["@label","@route","@icon"],["discourse_ai.secrets.create_new","adminPlugins.show.discourse-ai-secrets.new","plus"]],null],[1,"\\n      "]],[3]]]]],[1,"\\n\\n"],[41,[30,0,["hasSecrets"]],[[[1,"      "],[10,"table"],[14,0,"d-admin-table ai-secret-list-editor__table"],[12],[1,"\\n        "],[10,"thead"],[12],[1,"\\n          "],[10,"tr"],[12],[1,"\\n            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.secrets.name"],null]],[13],[1,"\\n            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.secrets.used_by"],null]],[13],[1,"\\n            "],[10,"th"],[12],[13],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2,["content"]]],null]],null],null,[[[1,"            "],[10,"tr"],[15,"data-secret-id",[30,4,["id"]]],[14,0,"ai-secret-list__row d-admin-row__content"],[12],[1,"\\n              "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n                "],[10,"strong"],[12],[1,[30,4,["name"]]],[13],[1,"\\n              "],[13],[1,"\\n              "],[10,"td"],[14,0,"d-admin-row__detail ai-secret-list__usage"],[12],[1,"\\n                "],[10,0],[14,0,"d-admin-row__mobile-label"],[12],[1,"\\n                  "],[1,[28,[32,1],["discourse_ai.secrets.used_by"],null]],[1,"\\n                "],[13],[1,"\\n"],[41,[30,4,["used_by"]],[[[41,[30,4,["used_by","length"]],[[[42,[28,[31,2],[[28,[31,2],[[30,4,["used_by"]]],null]],null],null,[[[1,"                      "],[10,0],[14,0,"ai-secret-list__usage-item"],[12],[1,"\\n"],[41,[28,[32,4],[[30,5,["type"]],"embedding"],null],[[[1,"                          "],[8,[32,5],null,[["@route","@model"],["adminPlugins.show.discourse-ai-embeddings.edit",[30,5,["id"]]]],[["default"],[[[[1,"\\n                            "],[1,[30,5,["name"]]],[1,"\\n                          "]],[]]]]],[1,"\\n                          ("],[1,[28,[32,1],["discourse_ai.secrets.embedding"],null]],[1,")\\n"]],[]],[[[1,"                          "],[8,[32,5],null,[["@route","@model"],["adminPlugins.show.discourse-ai-llms.edit",[30,5,["id"]]]],[["default"],[[[[1,"\\n                            "],[1,[30,5,["name"]]],[1,"\\n                          "]],[]]]]],[1,"\\n"]],[]]],[1,"                      "],[13],[1,"\\n"]],[5]],null]],[]],[[[1,"                    "],[10,1],[14,0,"ai-secret-list__usage-none"],[12],[1,"\\n                      "],[1,[28,[32,1],["discourse_ai.secrets.not_used"],null]],[1,"\\n                    "],[13],[1,"\\n"]],[]]]],[]],[[[1,"                  "],[10,1],[14,0,"ai-secret-list__usage-none"],[12],[1,"\\n                    "],[1,[28,[32,1],["discourse_ai.secrets.not_used"],null]],[1,"\\n                  "],[13],[1,"\\n"]],[]]],[1,"              "],[13],[1,"\\n              "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n                "],[8,[32,6],[[24,0,"btn btn-default btn-small ai-secret-list__edit-button"]],[["@label","@route","@routeModels"],["discourse_ai.secrets.edit","adminPlugins.show.discourse-ai-secrets.edit",[30,4,["id"]]]],null],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[4]],null],[1,"        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],[[[1,"      "],[8,[32,7],null,[["@ctaLabel","@ctaRoute","@ctaClass","@emptyLabel"],["discourse_ai.secrets.create_new","adminPlugins.show.discourse-ai-secrets.new","ai-secret-list-editor__empty-new-btn","discourse_ai.secrets.no_secrets"]],null],[1,"\\n"]],[]]]],[]]],[13]],["@currentSecret","@secrets","actions","secret","usage"],["if","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-secrets-list-editor.js",scope:()=>[n.default,d.i18n,u.default,r.default,l.eq,s.LinkTo,a.default,o.default],isStrictMode:!0}),this)}}e.default=m}),define("discourse/plugins/discourse-ai/discourse/components/ai-sentiment-horizontal-bar",["exports","@ember/helper","@ember/template","discourse/float-kit/components/d-tooltip","discourse/truth-helpers","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"OKBATw4W",block:'[[[41,[28,[32,0],[[30,1],0],null],[[[1,"  "],[8,[32,1],[[16,0,[28,[32,2],["sentiment-horizontal-bar__",[30,2]],null]],[16,5,[28,[32,3],[[28,[32,2],["width: ",[30,3],"%"],null]],null]]],null,[["trigger","content"],[[[[1,"\\n      "],[10,1],[14,0,"sentiment-horizontal-bar__count"],[12],[1,"\\n        "],[1,[30,1]],[1,"\\n      "],[13],[1,"\\n    "]],[]],[[[1,"\\n      "],[1,[28,[32,4],[[28,[32,2],["discourse_ai.sentiments.sentiment_analysis.filter_types.",[30,2]],null]],null]],[1,":\\n      "],[1,[30,1]],[1,"\\n    "]],[]]]]],[1,"\\n"]],[]],null]],["@score","@type","@width"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-sentiment-horizontal-bar.js",scope:()=>[o.gt,i.default,t.concat,s.htmlSafe,n.i18n],isStrictMode:!0}),(0,l.default)(void 0,"ai-sentiment-horizontal-bar:AiSentimentHorizontalBar"))
e.default=d}),define("discourse/plugins/discourse-ai/discourse/components/ai-spam",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/routing","@ember/service","discourse/admin/components/admin-config-area-card","discourse/components/d-button","discourse/components/d-page-subheader","discourse/components/d-stat-tiles","discourse/components/d-toggle-switch","discourse/float-kit/components/d-tooltip","discourse/helpers/d-icon","discourse/helpers/with-event-value","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/get-url","discourse/select-kit/components/combo-box","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/modal/spam-test-modal","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class k extends t.default{static{dt7948.g(this.prototype,"toasts",[r.service])}#U=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"modal",[r.service])}#O=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"stats",[s.tracked],function(){return{scanned_count:0,spam_detected:0,false_positives:0,false_negatives:0,daily_data:[]}})}#He=void dt7948.i(this,"stats")
static{dt7948.g(this.prototype,"isEnabled",[s.tracked],function(){return!1})}#$e=void dt7948.i(this,"isEnabled")
static{dt7948.g(this.prototype,"selectedLLM",[s.tracked],function(){return null})}#Ge=void dt7948.i(this,"selectedLLM")
static{dt7948.g(this.prototype,"selectedPersonaId",[s.tracked],function(){return null})}#We=void dt7948.i(this,"selectedPersonaId")
static{dt7948.g(this.prototype,"customInstructions",[s.tracked],function(){return""})}#Ke=void dt7948.i(this,"customInstructions")
static{dt7948.g(this.prototype,"errors",[s.tracked],function(){return[]})}#Ye=void dt7948.i(this,"errors")
constructor(){super(...arguments),this.initializeFromModel(),!1===this.args.model?.spam_scanning_user?.admin&&this.errors.push({message:(0,v.i18n)("discourse_ai.spam.errors.scan_not_admin.message"),button:{label:(0,v.i18n)("discourse_ai.spam.errors.scan_not_admin.action"),action:this.fixScanUserNotAdmin}})}async fixScanUserNotAdmin(){const e=this.args.model.spam_scanning_user
if(e&&!e.admin)try{(await(0,_.ajax)("/admin/plugins/discourse-ai/ai-spam/fix-errors",{type:"POST",data:{error:"spam_scanner_not_admin"}})).success&&this.toasts.success({data:{message:(0,v.i18n)("discourse_ai.spam.errors.resolved")},duration:"short"})}catch(t){(0,f.popupAjaxError)(t)}finally{window.location.reload()}}static{dt7948.n(this.prototype,"fixScanUserNotAdmin",[n.action])}initializeFromModel(){const e=this.args.model
this.isEnabled=e.is_enabled,e.llm_id?this.selectedLLM=e.llm_id:this.availableLLMs.length&&(this.selectedLLM=this.availableLLMs[0].id,this.autoSelectedLLM=!0),this.customInstructions=e.custom_instructions,this.stats=e.stats,this.selectedPersonaId=e.ai_persona_id}static{dt7948.n(this.prototype,"initializeFromModel",[n.action])}get availableLLMs(){return this.args.model?.available_llms||[]}async toggleEnabled(){this.isEnabled=!this.isEnabled
const e={is_enabled:this.isEnabled}
this.autoSelectedLLM&&(e.llm_model_id=this.llmId)
try{const t=await(0,_.ajax)("/admin/plugins/discourse-ai/ai-spam.json",{type:"PUT",data:e})
this.autoSelectedLLM=!1,this.isEnabled=t.is_enabled}catch(t){this.isEnabled=!this.isEnabled,(0,f.popupAjaxError)(t)}}static{dt7948.n(this.prototype,"toggleEnabled",[n.action])}get llmId(){return this.selectedLLM}async updateLLM(e){this.selectedLLM=e}static{dt7948.n(this.prototype,"updateLLM",[n.action])}async updatePersona(e){this.selectedPersonaId=e}static{dt7948.n(this.prototype,"updatePersona",[n.action])}async save(){try{await(0,_.ajax)("/admin/plugins/discourse-ai/ai-spam.json",{type:"PUT",data:{llm_model_id:this.llmId,custom_instructions:this.customInstructions,ai_persona_id:this.selectedPersonaId}}),this.toasts.success({data:{message:(0,v.i18n)("discourse_ai.spam.settings_saved")},duration:"short"})}catch(e){(0,f.popupAjaxError)(e)}}static{dt7948.n(this.prototype,"save",[n.action])}showTestModal(){this.modal.show(w.default,{model:{customInstructions:this.customInstructions,llmId:this.llmId}})}static{dt7948.n(this.prototype,"showTestModal",[n.action])}get metrics(){const e={label:(0,v.i18n)("discourse_ai.spam.spam_detected"),value:this.stats.spam_detected},t={label:(0,v.i18n)("discourse_ai.spam.false_positives"),value:this.stats.false_positives,tooltip:(0,v.i18n)("discourse_ai.spam.stat_tooltips.incorrectly_flagged")},s={label:(0,v.i18n)("discourse_ai.spam.false_negatives"),value:this.stats.false_negatives,tooltip:(0,v.i18n)("discourse_ai.spam.stat_tooltips.missed_spam")}
return this.args.model.flagging_username&&(e.href=(0,b.default)(`/review?flagged_by=${this.args.model.flagging_username}&status=all&sort_order=created_at`),t.href=(0,b.default)(`/review?flagged_by=${this.args.model.flagging_username}&status=rejected&sort_order=created_at`),s.href=(0,b.default)(`/review?status=approved&sort_order=created_at&additional_filters={"ai_spam_false_negative":true}&order=created&score_type=${this.args.model.spam_score_type}`)),[{label:(0,v.i18n)("discourse_ai.spam.scanned_count"),value:this.stats.scanned_count},e,t,s]}static{(0,S.setComponentTemplate)((0,x.createTemplateFactory)({id:"xylBCkJy",block:'[[[10,0],[14,0,"ai-spam"],[12],[1,"\\n  "],[10,"section"],[14,0,"ai-spam__settings"],[12],[1,"\\n    "],[10,0],[14,0,"ai-spam__errors"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["errors"]]],null]],null],null,[[[1,"        "],[10,0],[14,0,"alert alert-error"],[12],[1,"\\n          "],[1,[28,[32,0],["triangle-exclamation"],null]],[1,"\\n          "],[10,2],[12],[1,[30,1,["message"]]],[13],[1,"\\n          "],[8,[32,1],null,[["@action","@translatedLabel"],[[30,1,["button","action"]],[30,1,["button","label"]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[1]],null],[1,"    "],[13],[1,"\\n    "],[8,[32,2],null,[["@titleLabel","@descriptionLabel"],[[28,[32,3],["discourse_ai.spam.title"],null],[28,[32,3],["discourse_ai.spam.spam_description"],null]]],null],[1,"\\n    "],[10,0],[14,0,"control-group ai-spam__enabled"],[12],[1,"\\n      "],[8,[32,4],[[24,0,"ai-spam__toggle"],[4,[32,5],["click",[30,0,["toggleEnabled"]]],null]],[["@state","@label"],[[30,0,["isEnabled"]],"discourse_ai.spam.enable"]],null],[1,"\\n      "],[8,[32,6],null,[["@icon","@content"],["circle-question",[28,[32,3],["discourse_ai.spam.spam_tip"],null]]],null],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"ai-spam__llm"],[12],[1,"\\n      "],[10,"label"],[14,0,"ai-spam__llm-label"],[12],[1,[28,[32,3],["discourse_ai.spam.select_llm"],null]],[13],[1,"\\n"],[41,[30,0,["availableLLMs","length"]],[[[1,"        "],[8,[32,7],[[24,0,"ai-spam__llm-selector"]],[["@value","@content","@onChange"],[[30,0,["selectedLLM"]],[30,0,["availableLLMs"]],[30,0,["updateLLM"]]]],null],[1,"\\n"]],[]],[[[1,"        "],[10,1],[14,0,"ai-spam__llm-placeholder"],[12],[1,"\\n          "],[8,[32,8],null,[["@route"],["adminPlugins.show.discourse-ai-llms.index"]],[["default"],[[[[1,"\\n            "],[1,[28,[32,3],["discourse_ai.spam.no_llms"],null]],[1,"\\n          "]],[]]]]],[1,"\\n        "],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"ai-spam__persona"],[12],[1,"\\n      "],[10,"label"],[14,0,"ai-spam__persona-label"],[12],[1,[28,[32,3],["discourse_ai.spam.select_persona"],null]],[13],[1,"\\n      "],[8,[32,7],[[24,0,"ai-spam__persona-selector"]],[["@value","@content","@onChange"],[[30,0,["selectedPersonaId"]],[30,2,["available_personas"]],[30,0,["updatePersona"]]]],null],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"ai-spam__instructions"],[12],[1,"\\n      "],[10,"label"],[14,0,"ai-spam__instructions-label"],[12],[1,"\\n        "],[1,[28,[32,3],["discourse_ai.spam.custom_instructions"],null]],[1,"\\n        "],[8,[32,6],null,[["@icon","@content"],["circle-question",[28,[32,3],["discourse_ai.spam.custom_instructions_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n      "],[11,"textarea"],[24,0,"ai-spam__instructions-input"],[16,"placeholder",[28,[32,3],["discourse_ai.spam.custom_instructions_placeholder"],null]],[4,[32,5],["input",[28,[32,9],[[28,[32,10],[[28,[31,3],[[30,0,["customInstructions"]]],null]],null]],null]],null],[12],[1,[30,0,["customInstructions"]]],[13],[1,"\\n      "],[8,[32,1],[[24,0,"ai-spam__instructions-save btn-primary"]],[["@action","@label"],[[30,0,["save"]],"discourse_ai.spam.save_button"]],null],[1,"\\n      "],[8,[32,1],[[24,0,"btn-default"]],[["@action","@label"],[[30,0,["showTestModal"]],"discourse_ai.spam.test_button"]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n\\n  "],[8,[32,11],[[24,0,"ai-spam__stats"]],[["@heading"],["discourse_ai.spam.last_seven_days"]],[["content"],[[[[1,"\\n      "],[8,[32,12],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["metrics"]]],null]],null],null,[[[1,"          "],[8,[30,3,["Tile"]],null,[["@label","@url","@value","@tooltip"],[[30,4,["label"]],[30,4,["href"]],[30,4,["value"]],[30,4,["tooltip"]]]],null],[1,"\\n"]],[4]],null],[1,"      "]],[3]]]]],[1,"\\n    "]],[]]]]],[1,"\\n"],[13]],["e","@model","tiles","metric"],["each","-track-array","if","mut"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-spam.js",scope:()=>[h.default,d.default,u.default,v.i18n,p.default,o.on,m.default,y.default,a.LinkTo,g.default,i.fn,l.default,c.default],isStrictMode:!0}),this)}}e.default=k}),define("discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/float-kit/components/d-menu","discourse/helpers/category-badge","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/array-tools","discourse/truth-helpers","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static{dt7948.g(this.prototype,"site",[a.service])}#S=void dt7948.i(this,"site")
static{dt7948.g(this.prototype,"suggestions",[s.tracked],function(){return[]})}#Je=void dt7948.i(this,"suggestions")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"icon",[s.tracked],function(){return"discourse-sparkles"})}#Qe=void dt7948.i(this,"icon")
SUGGESTION_TYPES={title:"suggest_title",category:"suggest_category",tag:"suggest_tags"}
get input(){return this.args.selectedPosts.map(e=>e.cooked).join("\n")}get disabled(){return this.loading||this.suggestions.length>0}loadSuggestions(){this.loading||this.suggestions.length>0||(this.loading=!0,(0,u.ajax)(`/discourse-ai/ai-helper/${this.args.mode}`,{method:"POST",data:{text:this.input}}).then(e=>{if(this.args.mode===this.SUGGESTION_TYPES.title)this.suggestions=e.suggestions
else if(this.args.mode===this.SUGGESTION_TYPES.category){const t=e.assistant.map(e=>e.id),s=this.site.categories.filter(e=>t.includes(e.id))
this.suggestions=s}else this.args.mode===this.SUGGESTION_TYPES.tag&&(this.suggestions=e.assistant.map(e=>({id:e.id,name:e.name,count:e.count})))}).catch(c.popupAjaxError).finally(()=>{this.loading=!1}))}static{dt7948.n(this.prototype,"loadSuggestions",[n.action])}applySuggestion(e,t){if(this.args.mode){if(this.args.mode===this.SUGGESTION_TYPES.title)return this.args.updateAction(e),t.close()
if(this.args.mode===this.SUGGESTION_TYPES.category)return this.args.updateAction(e.id),t.close()
if(this.args.mode===this.SUGGESTION_TYPES.tag){if(this.args.currentValue)if(Array.isArray(this.args.currentValue)){const t=[...this.args.currentValue,e]
this.args.updateAction((0,p.uniqueItemsFromArray)(t))}else{const t=[this.args.currentValue,e]
this.args.updateAction((0,p.uniqueItemsFromArray)(t))}else Array.isArray(e)?this.args.updateAction([...e]):this.args.updateAction([e])
return t.close()}}}static{dt7948.n(this.prototype,"applySuggestion",[n.action])}static{(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"VINEiz2V",block:'[[[41,[30,0,["loading"]],[[[1,"  "],[8,[32,0],[[24,0,"ai-split-topic-loading-placeholder"]],[["@disabled","@icon"],[true,"spinner"]],null],[1,"\\n"]],[]],null],[8,[32,1],[[24,0,"ai-split-topic-suggestion-button"],[16,"data-suggestion-mode",[30,1]],[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@icon","@interactive","@identifier"],["discourse-sparkles",true,"ai-split-topic-suggestion-menu"]],[["default"],[[[[1,"\\n  "],[10,"ul"],[14,0,"ai-split-topic-suggestion__results"],[12],[1,"\\n"],[41,[51,[30,0,["loading"]]],[[[42,[28,[31,3],[[28,[31,3],[[30,0,["suggestions"]]],null]],null],null,[[[41,[28,[32,3],[[30,1],"suggest_category"],null],[[[1,"          "],[11,"li"],[16,"data-name",[30,3,["name"]]],[16,"data-value",[30,3,["id"]]],[24,0,"ai-split-topic-suggestion__category-result"],[24,"role","button"],[4,[32,2],["click",[28,[32,4],[[30,0,["applySuggestion"]],[30,3],[30,2]],null]],null],[12],[1,"\\n            "],[1,[28,[32,5],[[30,3]],null]],[1,"\\n            "],[10,1],[14,0,"topic-count"],[12],[1,"x\\n              "],[1,[30,3,["totalTopicCount"]]],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[41,[28,[32,3],[[30,1],"suggest_tags"],null],[[[1,"          "],[10,"li"],[15,"data-name",[30,3,["name"]]],[15,"data-value",[30,4]],[12],[1,"\\n            "],[8,[32,0],null,[["@translatedLabel","@action"],[[30,3,["name"]],[28,[32,4],[[30,0,["applySuggestion"]],[30,3],[30,2]],null]]],[["default"],[[[[1,"\\n              "],[10,1],[14,0,"topic-count"],[12],[1,"x"],[1,[30,3,["count"]]],[13],[1,"\\n            "]],[]]]]],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[1,"          "],[10,"li"],[15,"data-name",[30,3]],[15,"data-value",[30,4]],[12],[1,"\\n            "],[8,[32,0],null,[["@translatedLabel","@action"],[[30,3],[28,[32,4],[[30,0,["applySuggestion"]],[30,3],[30,2]],null]]],null],[1,"\\n          "],[13],[1,"\\n        "]],[]]]],[]]]],[3,4]],null]],[]],null],[1,"  "],[13],[1,"\\n"]],[2]]]]]],["@mode","menu","suggestion","index"],["if","unless","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester.js",scope:()=>[r.default,l.default,o.on,m.eq,i.fn,d.default],isStrictMode:!0}),this)}}e.default=_}),define("discourse/plugins/discourse-ai/discourse/components/ai-summary-skeleton",["exports","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-blinking-animation","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const r=(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"K0towwA6",block:'[[[10,0],[14,0,"ai-summary__container"],[12],[1,"\\n  "],[8,[32,0],null,null,null],[1,"\\n\\n  "],[10,1],[12],[1,"\\n    "],[10,0],[14,0,"ai-summary__generating-text"],[12],[1,"\\n      "],[1,[28,[32,1],["summary.in_progress"],null]],[1,"\\n    "],[13],[1,"\\n    "],[8,[32,2],null,[["@loading"],[true]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],[],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-summary-skeleton.js",scope:()=>[s.default,t.i18n,i.default],isStrictMode:!0}),(0,a.default)(void 0,"ai-summary-skeleton:AiSummarySkeleton"))
e.default=r}),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-editor-form",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/service","discourse/components/form","discourse/lib/ajax-error","discourse/lib/array-tools","discourse/lib/get-url","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/utilities","discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal","discourse/plugins/discourse-ai/discourse/components/rag-options-fk","discourse/plugins/discourse-ai/discourse/components/rag-uploader","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class b extends t.default{static{dt7948.g(this.prototype,"modal",[n.service])}#O=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"siteSettings",[n.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"dialog",[n.service])}#H=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"router",[n.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"toasts",[n.service])}#U=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"uploadedFiles",[s.tracked],function(){return[]})}#Xe=void dt7948.i(this,"uploadedFiles")
static{dt7948.g(this.prototype,"isSaving",[s.tracked],function(){return!1})}#z=void dt7948.i(this,"isSaving")
PARAMETER_TYPES=[{name:"string",id:"string"},{name:"number",id:"number"},{name:"boolean",id:"boolean"},{name:"array",id:"array"}]
get formData(){const e=(this.args.editingModel.parameters??[]).map(e=>{const t={...e}
return t.isEnum=e.enum&&e.enum.length>0,t.isEnum||delete t.enum,t}),t=this.args.editingModel.rag_uploads||[],s=t.length>0?(0,p.toPlainObject)(t):[]
return{name:this.args.editingModel.name||"",tool_name:this.args.editingModel.tool_name||"",description:this.args.editingModel.description||"",summary:this.args.editingModel.summary||"",parameters:e,script:this.args.editingModel.script||"",rag_uploads:s}}toggleIsEnum(e,{name:t,parentName:s,set:i}){i(`${s}.enum`,e?[""]:[]),i(t,e)}static{dt7948.n(this.prototype,"toggleIsEnum",[o.action])}async save(e){this.isSaving=!0
const t=(0,p.toPlainObject)(e)
t.parameters&&t.parameters.forEach(e=>{e.isEnum||delete e.enum,delete e.isEnum})
try{await this.args.model.save(t),this.toasts.success({data:{message:(0,c.i18n)("discourse_ai.tools.saved")},duration:"short"}),this.args.tools.content.some(e=>e.id===this.args.model.id)||this.args.tools.content.push(this.args.model),await this.router.replaceWith("adminPlugins.show.discourse-ai-tools.edit",this.args.model)}catch(s){(0,r.popupAjaxError)(s)}finally{this.isSaving=!1}}static{dt7948.n(this.prototype,"save",[o.action])}delete(){return this.dialog.confirm({message:(0,c.i18n)("discourse_ai.tools.confirm_delete"),didConfirm:async()=>{await this.args.model.destroyRecord(),(0,l.removeValueFromArray)(this.args.tools.content,this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-tools.index")}})}static{dt7948.n(this.prototype,"delete",[o.action])}updateUploads(e,t){const s=(0,p.toPlainObject)(t).filter(e=>!this.uploadedFiles.some(t=>t.id===e.id))
e("rag_uploads",s),this.uploadedFiles=[...this.uploadedFiles,...s]}static{dt7948.n(this.prototype,"updateUploads",[o.action])}removeUpload(e,t){this.uploadedFiles=this.uploadedFiles.filter(e=>e.id!==t.id)
const s=this.uploadedFiles.length>0?(0,p.toPlainObject)(this.uploadedFiles):[]
e.set("rag_uploads",s)}static{dt7948.n(this.prototype,"removeUpload",[o.action])}openTestModal(){this.modal.show(m.default,{model:{tool:this.args.editingModel}})}static{dt7948.n(this.prototype,"openTestModal",[o.action])}currentParameterSelection(e,t){return e.parameters[t].type}get ragUploadsDescription(){return this.siteSettings.rag_images_enabled?(0,c.i18n)("discourse_ai.rag.uploads.description_with_images"):(0,c.i18n)("discourse_ai.rag.uploads.description")}exportTool(){const e=`/admin/plugins/discourse-ai/ai-tools/${this.args.model.id}/export.json`
window.location.href=(0,d.default)(e)}static{dt7948.n(this.prototype,"exportTool",[o.action])}static{(0,_.setComponentTemplate)((0,f.createTemplateFactory)({id:"rRdwh2tu",block:'[[[8,[32,0],[[24,0,"ai-tool-editor"]],[["@onSubmit","@data"],[[30,0,["save"]],[30,0,["formData"]]]],[["default"],[[[[1,"\\n"],[1,"  "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip"],["name",[28,[32,1],["discourse_ai.tools.name"],null],"required|length:1,100","large",[28,[32,1],["discourse_ai.tools.name_help"],null]]],[["default"],[[[[1,"\\n    "],[8,[30,3,["Input"]],[[24,0,"ai-tool-editor__name"]],null,null],[1,"\\n  "]],[3]]]]],[1,"\\n\\n"],[1,"  "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip"],["tool_name",[28,[32,1],["discourse_ai.tools.tool_name"],null],"required|length:1,100","large",[28,[32,1],["discourse_ai.tools.tool_name_help"],null]]],[["default"],[[[[1,"\\n    "],[8,[30,4,["Input"]],[[24,0,"ai-tool-editor__tool_name"]],null,null],[1,"\\n  "]],[4]]]]],[1,"\\n\\n"],[1,"  "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip"],["description",[28,[32,1],["discourse_ai.tools.description"],null],"required|length:1,1000","full",[28,[32,1],["discourse_ai.tools.description_help"],null]]],[["default"],[[[[1,"\\n    "],[8,[30,5,["Textarea"]],[[24,0,"ai-tool-editor__description"],[16,"placeholder",[28,[32,1],["discourse_ai.tools.description_help"],null]]],[["@height"],[60]],null],[1,"\\n  "]],[5]]]]],[1,"\\n\\n"],[1,"  "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip"],["summary",[28,[32,1],["discourse_ai.tools.summary"],null],"required|length:1,255","large",[28,[32,1],["discourse_ai.tools.summary_help"],null]]],[["default"],[[[[1,"\\n    "],[8,[30,6,["Input"]],[[24,0,"ai-tool-editor__summary"]],null,null],[1,"\\n  "]],[6]]]]],[1,"\\n\\n"],[1,"  "],[8,[30,1,["Collection"]],null,[["@name"],["parameters"]],[["default"],[[[[1,"\\n    "],[8,[30,1,["Container"]],[[24,0,"ai-tool-parameter"]],null,[["default"],[[[[1,"\\n      "],[8,[30,1,["Row"]],null,null,[["default"],[[[[1,"\\n        "],[8,[30,10,["Col"]],null,[["@size"],[6]],[["default"],[[[[1,"\\n          "],[8,[30,7,["Field"]],null,[["@name","@title","@validation","@format"],["name",[28,[32,1],["discourse_ai.tools.parameter_name"],null],"required|length:1,100","full"]],[["default"],[[[[1,"\\n            "],[8,[30,11,["Input"]],null,null,null],[1,"\\n          "]],[11]]]]],[1,"\\n        "]],[]]]]],[1,"\\n\\n        "],[8,[30,10,["Col"]],null,[["@size"],[6]],[["default"],[[[[1,"\\n          "],[8,[30,7,["Field"]],null,[["@name","@title","@validation","@format"],["type",[28,[32,1],["discourse_ai.tools.parameter_type"],null],"required","full"]],[["default"],[[[[1,"\\n            "],[8,[30,12,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["PARAMETER_TYPES"]]],null]],null],null,[[[1,"                "],[8,[30,13,["Option"]],null,[["@value"],[[30,14,["id"]]]],[["default"],[[[[1,[30,14,["name"]]]],[]]]]],[1,"\\n"]],[14]],null],[1,"            "]],[13]]]]],[1,"\\n          "]],[12]]]]],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[10]]]]],[1,"\\n\\n      "],[8,[30,1,["Row"]],null,null,[["default"],[[[[1,"\\n        "],[8,[30,15,["Col"]],null,[["@size"],[12]],[["default"],[[[[1,"\\n          "],[8,[30,7,["Field"]],null,[["@name","@title","@validation","@format"],["description",[28,[32,1],["discourse_ai.tools.parameter_description"],null],"required|length:1,1000","full"]],[["default"],[[[[1,"\\n            "],[8,[30,16,["Input"]],[[24,0,"ai-tool-editor__parameter-description"]],null,null],[1,"\\n          "]],[16]]]]],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[15]]]]],[1,"\\n\\n      "],[8,[30,1,["Row"]],null,null,[["default"],[[[[1,"\\n        "],[8,[30,17,["Col"]],null,null,[["default"],[[[[1,"\\n          "],[8,[30,7,["Field"]],null,[["@name","@title"],["required","Required"]],[["default"],[[[[1,"\\n            "],[8,[30,18,["Checkbox"]],null,null,null],[1,"\\n          "]],[18]]]]],[1,"\\n        "]],[]]]]],[1,"\\n\\n        "],[8,[30,17,["Col"]],null,null,[["default"],[[[[1,"\\n          "],[8,[30,7,["Field"]],null,[["@name","@title","@onSet"],["isEnum","Enum",[30,0,["toggleIsEnum"]]]],[["default"],[[[[1,"\\n            "],[8,[30,19,["Checkbox"]],null,null,null],[1,"\\n          "]],[19]]]]],[1,"\\n        "]],[]]]]],[1,"\\n\\n"],[41,[30,9,["isEnum"]],[[[1,"          "],[8,[30,17,["Col"]],null,[["@size"],[8]],[["default"],[[[[1,"\\n            "],[8,[30,7,["Collection"]],null,[["@name"],["enum"]],[["default"],[[[[1,"\\n              "],[8,[30,1,["Container"]],[[24,0,"ai-tool-parameter__enum-values"]],null,[["default"],[[[[1,"\\n                "],[8,[30,20,["Field"]],null,[["@title","@validation"],[[28,[32,1],["discourse_ai.tools.enum_value"],null],"required"]],[["default"],[[[[1,"\\n                  "],[8,[30,22,["Input"]],null,null,null],[1,"\\n\\n"],[41,[28,[32,2],[[28,[32,3],[[30,9,["enum","length"]],1],null],[28,[32,3],[[30,21],0],null]],null],[[[1,"                    "],[8,[30,1,["Button"]],[[24,0,"btn-danger"]],[["@icon","@action"],["trash-can",[28,[32,4],[[30,20,["remove"]],[30,21]],null]]],null],[1,"\\n"]],[]],null],[1,"                "]],[22]]]]],[1,"\\n              "]],[]]]]],[1,"\\n            "]],[20,21]]]]],[1,"\\n          "]],[]]]]],[1,"\\n\\n          "],[8,[30,17,["Col"]],null,[["@size"],[8]],[["default"],[[[[1,"\\n            "],[8,[30,1,["Button"]],null,[["@icon","@label","@action"],["plus","discourse_ai.tools.add_enum_value",[28,[32,4],[[30,1,["addItemToCollection"]],[28,[32,5],["parameters.",[30,8],".enum"],null],""],null]]],null],[1,"\\n          "]],[]]]]],[1,"\\n"]],[]],null],[1,"      "]],[17]]]]],[1,"\\n      "],[8,[30,1,["Row"]],null,null,[["default"],[[[[1,"\\n        "],[8,[30,23,["Col"]],[[24,0,"ai-tool-parameter-actions"]],null,[["default"],[[[[1,"\\n          "],[8,[30,1,["Button"]],[[24,0,"btn-danger"]],[["@label","@icon","@action"],["discourse_ai.tools.remove_parameter","trash-can",[28,[32,4],[[30,7,["remove"]],[30,8]],null]]],null],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[23]]]]],[1,"\\n    "]],[]]]]],[1,"\\n  "]],[7,8,9]]]]],[1,"\\n\\n  "],[8,[30,1,["Button"]],null,[["@icon","@label","@action"],["plus","discourse_ai.tools.add_parameter",[28,[32,4],[[30,1,["addItemToCollection"]],"parameters",[28,[32,6],null,[["name","type","description","required","isEnum"],["","string","",false,false]]]],null]]],null],[1,"\\n\\n"],[1,"  "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format"],["script",[28,[32,1],["discourse_ai.tools.script"],null],"required|length:1,100000","full"]],[["default"],[[[[1,"\\n    "],[8,[30,24,["Code"]],null,[["@lang","@height"],["javascript",600]],null],[1,"\\n  "]],[24]]]]],[1,"\\n\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"    "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_uploads",[28,[32,1],["discourse_ai.rag.uploads.title"],null],[30,0,["ragUploadsDescription"]],"full"]],[["default"],[[[[1,"\\n      "],[8,[30,25,["Custom"]],null,null,[["default"],[[[[1,"\\n        "],[8,[32,7],null,[["@target","@updateUploads","@onRemove","@allowImages"],[[30,26],[28,[32,4],[[30,0,["updateUploads"]],[30,1,["addItemToCollection"]]],null],[28,[32,4],[[30,0,["removeUpload"]],[30,1]],null],[30,27,["rag_images_enabled"]]]],null],[1,"\\n        "],[8,[32,8],null,[["@form","@data","@llms","@allowImages"],[[30,1],[30,2],[30,28],[30,27,["rag_images_enabled"]]]],null],[1,"\\n      "]],[]]]]],[1,"\\n    "]],[25]]]]],[1,"\\n"]],[]],null],[1,"\\n  "],[8,[30,1,["Actions"]],null,null,[["default"],[[[[1,"\\n"],[41,[51,[30,29]],[[[1,"      "],[8,[30,1,["Button"]],[[24,0,"ai-tool-editor__test-button"]],[["@label","@action"],["discourse_ai.tools.test",[30,0,["openTestModal"]]]],null],[1,"\\n      "],[8,[30,1,["Button"]],[[24,0,"ai-tool-editor__export"]],[["@label","@action"],["discourse_ai.tools.export",[30,0,["exportTool"]]]],null],[1,"\\n      "],[8,[30,1,["Button"]],[[24,0,"btn-danger ai-tool-editor__delete"]],[["@label","@icon","@action"],["discourse_ai.tools.delete","trash-can",[30,0,["delete"]]]],null],[1,"\\n"]],[]],null],[1,"\\n    "],[8,[30,1,["Submit"]],[[24,0,"ai-tool-editor__save"]],[["@label"],["discourse_ai.tools.save"]],null],[1,"\\n  "]],[]]]]],[1,"\\n"]],[1,2]]]]]],["form","data","field","field","field","field","collection","index","collectionData","row","field","field","select","type","row","field","row","field","field","child","childIndex","field","row","field","field","@editingModel","@settings","@llms","@isNew"],["each","-track-array","if","unless"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-editor-form.js",scope:()=>[a.default,c.i18n,u.and,u.gt,i.fn,i.concat,i.hash,g.default,h.default],isStrictMode:!0}),this)}}e.default=b})
define("discourse/plugins/discourse-ai/discourse/components/ai-tool-editor",["exports","@glimmer/component","@ember/service","discourse/components/back-button","discourse/plugins/discourse-ai/discourse/components/ai-tool-editor-form","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static{dt7948.g(this.prototype,"store",[s.service])}#$=void dt7948.i(this,"store")
get selectedPreset(){return this.args.selectedPreset?this.args.presets.find(e=>e.preset_id===this.args.selectedPreset):this.args.presets.find(e=>"empty_tool"===e.preset_id)}get editingModel(){return this.args.model.isNew?this.store.createRecord("ai-tool",this.selectedPreset):this.args.model}static{(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"/pbB1vj2",block:'[[[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-tools","discourse_ai.tools.back"]],null],[1,"\\n\\n"],[8,[32,1],null,[["@model","@tools","@editingModel","@isNew","@selectedPreset"],[[30,1],[30,2],[30,0,["editingModel"]],[30,1,["isNew"]],[30,0,["selectedPreset"]]]],null]],["@model","@tools"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-editor.js",scope:()=>[i.default,o.default],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-list-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/routing","@ember/service","discourse/admin/components/admin-config-area-empty-list","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse/components/dropdown-menu","discourse/float-kit/components/d-menu","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/array-tools","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/admin/models/ai-tool","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class S extends t.default{static{dt7948.g(this.prototype,"adminPluginNavManager",[r.service])}#Q=void dt7948.i(this,"adminPluginNavManager")
static{dt7948.g(this.prototype,"router",[r.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"dialog",[r.service])}#H=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"expandedCategory",[s.tracked],function(){return null})}#Ze=void dt7948.i(this,"expandedCategory")
get dropdownPresets(){return this.args.tools.resultSetMeta.presets.filter(e=>!e.category||e.is_category)}get categoryPresets(){if(!this.expandedCategory)return[]
const e=this.args.tools.resultSetMeta.presets.filter(e=>e.category===this.expandedCategory&&!e.is_category),t=e.find(e=>"image_generation_custom"===e.preset_id)
return{otherPresets:e.filter(e=>"image_generation_custom"!==e.preset_id).sort((e,t)=>e.provider.localeCompare(t.provider)),customPreset:t}}get lastIndexOfPresets(){return this.dropdownPresets.length-1}expandCategory(e){this.expandedCategory=e.category}static{dt7948.n(this.prototype,"expandCategory",[n.action])}collapseCategory(){this.expandedCategory=null}static{dt7948.n(this.prototype,"collapseCategory",[n.action])}resetMenuState(){this.expandedCategory=null}static{dt7948.n(this.prototype,"resetMenuState",[n.action])}routeToNewTool(e){const t={presetId:e.preset_id}
return this.router.transitionTo("adminPlugins.show.discourse-ai-tools.new",{queryParams:t})}static{dt7948.n(this.prototype,"routeToNewTool",[n.action])}importTool(){const e=document.createElement("input")
e.type="file",e.accept=".json",e.style.display="none",e.onchange=e=>this.handleFileSelect(e),document.body.appendChild(e),e.click(),document.body.removeChild(e)}static{dt7948.n(this.prototype,"importTool",[n.action])}handleFileSelect(e){const t=e.target.files[0]
if(!t)return
const s=new FileReader
s.onload=e=>{try{const t=JSON.parse(e.target.result)
this.uploadTool(t.ai_tool)}catch{this.dialog.alert((0,b.i18n)("discourse_ai.tools.import_error_not_json"))}},s.readAsText(t)}static{dt7948.n(this.prototype,"handleFileSelect",[n.action])}uploadTool(e,t=!1){const s={ai_tool:e}
return t&&(s.force=!0),(0,h.ajax)("/admin/plugins/discourse-ai/ai-tools/import.json",{type:"POST",data:JSON.stringify(s),contentType:"application/json"}).then(e=>{let t=y.default.create(e.ai_tool),s=this.args.tools.content.find(e=>e.id===t.id)
s&&(0,_.removeValueFromArray)(this.args.tools.content,s),this.args.tools.content.unshift(t)}).catch(t=>{409===t.jqXHR?.status?this.dialog.confirm({message:(0,b.i18n)("discourse_ai.tools.import_error_conflict",{name:e.tool_name}),confirmButtonLabel:"discourse_ai.tools.overwrite",didConfirm:()=>this.uploadTool(e,!0)}):(0,g.popupAjaxError)(t)})}static{(0,v.setComponentTemplate)((0,w.createTemplateFactory)({id:"QPp4hvzy",block:'[[[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-tools"]],[28,[32,1],["discourse_ai.tools.short_title"],null]]],null],[1,"\\n"],[10,"section"],[14,0,"ai-tool-list-editor__current admin-detail pull-left"],[12],[1,"\\n  "],[8,[32,2],null,[["@titleLabel","@learnMoreUrl","@descriptionLabel"],[[28,[32,1],["discourse_ai.tools.short_title"],null],"https://meta.discourse.org/t/ai-bot-custom-tools/314103",[28,[32,1],["discourse_ai.tools.subheader_description"],null]]],[["actions"],[[[[1,"\\n      "],[8,[32,3],[[24,0,"btn btn-default btn-small ai-tool-list-editor__import-button"]],[["@translatedLabel","@icon","@action"],[[28,[32,1],["discourse_ai.tools.import"],null],"upload",[30,0,["importTool"]]]],null],[1,"\\n      "],[8,[32,4],null,[["@triggerClass","@label","@icon","@placement","@onClose"],["btn-primary btn-small ai-tool-list-editor__new-button",[28,[32,1],["discourse_ai.tools.new"],null],"plus","bottom-end",[30,0,["resetMenuState"]]]],[["content"],[[[[1,"\\n          "],[8,[32,5],null,null,[["default"],[[[[1,"\\n"],[41,[30,0,["expandedCategory"]],[[[1,"              "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                "],[8,[32,3],[[24,0,"btn-transparent"]],[["@label","@icon","@action"],["back_button","chevron-left",[30,0,["collapseCategory"]]]],null],[1,"\\n              "]],[]]]]],[1,"\\n              "],[8,[30,1,["divider"]],null,null,null],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["categoryPresets","otherPresets"]]],null]],null],null,[[[1,"                "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                  "],[11,0],[24,"role","button"],[24,0,"ai-tool-preset-item"],[16,"data-option",[30,2,["preset_id"]]],[4,[32,6],["click",[28,[32,7],[[30,0,["routeToNewTool"]],[30,2]],null]],null],[12],[1,"\\n                    "],[10,1],[14,0,"ai-tool-preset-provider"],[12],[1,[30,2,["provider"]]],[13],[1,"\\n                    "],[10,1],[14,0,"ai-tool-preset-model"],[12],[1,[30,2,["model_name"]]],[13],[1,"\\n                  "],[13],[1,"\\n                "]],[]]]]],[1,"\\n"]],[2]],null],[1,"\\n"],[41,[30,0,["categoryPresets","customPreset"]],[[[1,"                "],[8,[30,1,["divider"]],null,null,null],[1,"\\n                "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,3],[[24,0,"btn-transparent"],[16,"data-option",[30,0,["categoryPresets","customPreset","preset_id"]]]],[["@translatedLabel","@action"],[[30,0,["categoryPresets","customPreset","preset_name"]],[28,[32,7],[[30,0,["routeToNewTool"]],[30,0,["categoryPresets","customPreset"]]],null]]],null],[1,"\\n                "]],[]]]]],[1,"\\n"]],[]],null]],[]],[[[42,[28,[31,2],[[28,[31,2],[[30,0,["dropdownPresets"]]],null]],null],null,[[[41,[28,[32,8],[[30,4],[30,0,["lastIndexOfPresets"]]],null],[[[1,"                  "],[8,[30,1,["divider"]],null,null,null],[1,"\\n"]],[]],null],[1,"\\n                "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,3],[[24,0,"btn-transparent"],[16,"data-option",[30,3,["preset_id"]]]],[["@translatedLabel","@action"],[[30,3,["preset_name"]],[52,[30,3,["is_category"]],[28,[32,7],[[30,0,["expandCategory"]],[30,3]],null],[28,[32,7],[[30,0,["routeToNewTool"]],[30,3]],null]]]],null],[1,"\\n                "]],[]]]]],[1,"\\n"]],[3,4]],null]],[]]],[1,"          "]],[1]]]]],[1,"\\n\\n        "]],[]]]]],[1,"\\n    "]],[]]]]],[1,"\\n\\n"],[41,[30,5,["content"]],[[[1,"    "],[10,"table"],[14,0,"d-admin-table ai-tool-list-editor"],[12],[1,"\\n      "],[10,"thead"],[12],[1,"\\n        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.tools.name"],null]],[13],[1,"\\n        "],[10,"th"],[12],[13],[1,"\\n      "],[13],[1,"\\n      "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,5,["content"]]],null]],null],null,[[[1,"          "],[10,"tr"],[15,"data-tool-id",[30,6,["id"]]],[14,0,"ai-tool-list__row d-admin-row__content"],[12],[1,"\\n            "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n              "],[10,0],[14,0,"ai-tool-list__name-with-description"],[12],[1,"\\n                "],[10,0],[14,0,"ai-tool-list__name"],[12],[1,"\\n                  "],[10,"strong"],[12],[1,"\\n                    "],[1,[30,6,["name"]]],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n                "],[10,0],[14,0,"ai-tool-list__description"],[12],[1,"\\n                  "],[1,[30,6,["description"]]],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n            "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n              "],[8,[32,9],[[24,0,"btn btn-text btn-small"]],[["@route","@model"],["adminPlugins.show.discourse-ai-tools.edit",[30,6]]],[["default"],[[[[1,[28,[32,1],["discourse_ai.tools.edit"],null]]],[]]]]],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[6]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n"]],[]],[[[1,"    "],[8,[32,10],null,[["@ctaLabel","@ctaRoute","@ctaClass","@emptyLabel"],["discourse_ai.tools.new","adminPlugins.show.discourse-ai-tools.new","ai-tool-list-editor__empty-new-button","discourse_ai.tools.no_tools"]],null],[1,"\\n"]],[]]],[13]],["dropdown","preset","preset","index","@tools","tool"],["if","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-list-editor.js",scope:()=>[d.default,b.i18n,c.default,u.default,m.default,p.default,o.on,i.fn,f.eq,a.LinkTo,l.default],isStrictMode:!0}),this)}}e.default=S}),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-selector",["exports","@ember/helper","discourse/select-kit/components/multi-select","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"uMJM+uCW",block:'[[[8,[32,0],null,[["@value","@onChange","@content","@options"],[[30,1],[30,2],[30,3],[28,[32,1],null,[["filterable","allowAny","disabled"],[true,false,[30,4]]]]]],null]],["@value","@onChange","@content","@disabled"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-selector.js",scope:()=>[s.default,t.hash],isStrictMode:!0}),(0,n.default)(void 0,"ai-tool-selector:AiToolSelector"))
e.default=a}),define("discourse/plugins/discourse-ai/discourse/components/ai-topic-gist",["exports","@glimmer/component","@ember/service","@ember/template","discourse/helpers/body-class","discourse/plugins/discourse-ai/discourse/services/gists","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static{dt7948.g(this.prototype,"gists",[s.service])}#re=void dt7948.i(this,"gists")
get shouldShow(){return!!this.prefersTableAiLayout&&(this.gists.showToggle||this.hasGist)}get prefersTableAiLayout(){return this.gists.currentPreference===n.TABLE_AI_LAYOUT}get hasGist(){return!!this.gist}get gist(){return this.args.topic.get("ai_topic_gist")}get escapedExcerpt(){return this.args.topic.get("escapedExcerpt")}static{(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"yzYTNUZI",block:'[[[41,[30,0,["shouldShow"]],[[[1,"  "],[1,[28,[32,0],["topic-list-layout-table-ai"],null]],[1,"\\n"],[41,[30,0,["hasGist"]],[[[1,"    "],[10,3],[15,6,[30,1,["lastUnreadUrl"]]],[14,0,"excerpt"],[12],[1,"\\n      "],[10,0],[14,0,"excerpt__contents"],[12],[1,[30,0,["gist"]]],[13],[1,"\\n    "],[13],[1,"\\n"]],[]],[[[41,[30,0,["escapedExcerpt"]],[[[1,"      "],[10,3],[15,6,[30,1,["lastUnreadUrl"]]],[14,0,"excerpt"],[12],[1,"\\n        "],[10,0],[14,0,"excerpt__contents"],[12],[1,"\\n          "],[1,[28,[32,1],[[30,0,["escapedExcerpt"]]],null]],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null]],[]]]],[]],null]],["@topic"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-topic-gist.js",scope:()=>[o.default,i.htmlSafe],isStrictMode:!0}),this)}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/components/ai-translations",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","@ember/template","discourse/admin/components/admin-config-area-card","discourse/admin/components/chart","discourse/components/d-button","discourse/components/d-page-subheader","discourse/components/d-toggle-switch","discourse/helpers/d-icon","discourse/lib/ajax","discourse/lib/ajax-error","discourse/select-kit/components/multi-select","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class v extends t.default{static{dt7948.g(this.prototype,"aiCredits",[a.service])}#b=void dt7948.i(this,"aiCredits")
static{dt7948.g(this.prototype,"router",[a.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"languageNameLookup",[a.service])}#et=void dt7948.i(this,"languageNameLookup")
static{dt7948.g(this.prototype,"site",[a.service])}#S=void dt7948.i(this,"site")
static{dt7948.g(this.prototype,"siteSettings",[a.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"data",[s.tracked],function(){return this.args.model?.translation_progress})}#tt=void dt7948.i(this,"data")
static{dt7948.g(this.prototype,"done",[s.tracked],function(){return this.args.model?.posts_with_detected_locale})}#st=void dt7948.i(this,"done")
static{dt7948.g(this.prototype,"total",[s.tracked],function(){return this.args.model?.total})}#it=void dt7948.i(this,"total")
static{dt7948.g(this.prototype,"translationEnabled",[s.tracked],function(){return this.args.model?.translation_enabled&&!this.args.model?.no_locales_configured})}#ot=void dt7948.i(this,"translationEnabled")
static{dt7948.g(this.prototype,"enabled",[s.tracked],function(){return this.args.model?.enabled})}#nt=void dt7948.i(this,"enabled")
static{dt7948.g(this.prototype,"selectedLocales",[s.tracked],function(){return this.siteSettings.content_localization_supported_locales?this.siteSettings.content_localization_supported_locales.split("|"):[]})}#at=void dt7948.i(this,"selectedLocales")
static{dt7948.g(this.prototype,"originalLocales",[s.tracked],function(){return this.siteSettings.content_localization_supported_locales?this.siteSettings.content_localization_supported_locales.split("|"):[]})}#rt=void dt7948.i(this,"originalLocales")
static{dt7948.g(this.prototype,"isSavingLocales",[s.tracked],function(){return!1})}#lt=void dt7948.i(this,"isSavingLocales")
static{dt7948.g(this.prototype,"isTogglingTranslation",[s.tracked],function(){return!1})}#dt=void dt7948.i(this,"isTogglingTranslation")
static{dt7948.g(this.prototype,"hourlyRate",[s.tracked],function(){return this.args.model?.hourly_rate||0})}#ut=void dt7948.i(this,"hourlyRate")
static{dt7948.g(this.prototype,"creditStatus",[s.tracked],function(){return null})}#k=void dt7948.i(this,"creditStatus")
static{dt7948.g(this.prototype,"creditCheckComplete",[s.tracked],function(){return!1})}#ct=void dt7948.i(this,"creditCheckComplete")
constructor(){super(...arguments),this._checkCredits()}async _checkCredits(){try{this.creditStatus=await this.aiCredits.getFeatureCreditStatus("locale_detector")}catch{this.creditStatus=null}this.creditCheckComplete=!0}get creditLimitReached(){return!0===this.creditStatus?.hard_limit_reached}get creditLimitWarningMessage(){if(!this.creditLimitReached)return null
const e=this.creditStatus?.reset_time_formatted||this.creditStatus?.reset_time_absolute
return e?(0,r.htmlSafe)((0,f.i18n)("discourse_ai.translations.credit_limit_warning",{reset_time:e})):(0,r.htmlSafe)((0,f.i18n)("discourse_ai.translations.credit_limit_warning_no_time"))}get localesChanged(){return[...this.selectedLocales].sort().join("|")!==[...this.originalLocales].sort().join("|")}get showLocaleSelector(){return(this.args.model?.no_locales_configured||0===this.originalLocales.length)&&!this.translationEnabled}get showLocalizationSettingsButton(){return this.enabled||!this.showLocaleSelector}get isToggleDisabled(){return this.isTogglingTranslation||this.args.model?.no_locales_configured&&0===this.originalLocales.length}get availableLocales(){const e=this.siteSettings.available_locales
return e||[]}get settingsUrl(){return this.router.urlFor("adminPlugins.show.discourse-ai-features.edit",this.args.model.translation_id)}get descriptionTooltip(){return(0,f.i18n)("discourse_ai.translations.stats.description_tooltip",{count:this.total})}navigateToLocalizationSettings(){this.router.transitionTo("adminConfig.localization.settings",{queryParams:{filter:"content_localization_supported_locales"}})}static{dt7948.n(this.prototype,"navigateToLocalizationSettings",[n.action])}updateSelectedLocales(e){this.selectedLocales=e}static{dt7948.n(this.prototype,"updateSelectedLocales",[n.action])}async saveLocales(){this.isSavingLocales=!0
try{this.selectedLocales.length>0&&await(0,h.ajax)("/admin/site_settings/content_localization_enabled",{type:"PUT",data:{content_localization_enabled:!0}}),await(0,h.ajax)("/admin/site_settings/content_localization_supported_locales",{type:"PUT",data:{content_localization_supported_locales:this.selectedLocales.join("|")}}),this.originalLocales=[...this.selectedLocales],this.selectedLocales.length>0&&(this.args.model.no_locales_configured=!1),this.translationEnabled&&window.location.reload()}catch(e){(0,g.popupAjaxError)(e)}finally{this.isSavingLocales=!1}}static{dt7948.n(this.prototype,"saveLocales",[n.action])}cancelLocales(){this.selectedLocales=[...this.originalLocales]}static{dt7948.n(this.prototype,"cancelLocales",[n.action])}resetLocales(){this.selectedLocales=[]}static{dt7948.n(this.prototype,"resetLocales",[n.action])}async toggleTranslationEnabled(){if(!this.isTogglingTranslation&&(this.translationEnabled||0!==this.originalLocales.length)){this.isTogglingTranslation=!0
try{if(!this.translationEnabled&&this.originalLocales.length>0&&await(0,h.ajax)("/admin/site_settings/content_localization_enabled",{type:"PUT",data:{content_localization_enabled:!0}}),await(0,h.ajax)("/admin/site_settings/ai_translation_enabled",{type:"PUT",data:{ai_translation_enabled:!this.translationEnabled}}),this.translationEnabled=!this.translationEnabled,this.translationEnabled&&!this.args.model.no_locales_configured){const e=await(0,h.ajax)("/admin/plugins/discourse-ai/ai-translations")
e.enabled&&(this.data=e.translation_progress,this.total=e.total,this.done=e.posts_with_detected_locale,this.enabled=e.enabled,this.hourlyRate=e.hourly_rate||0)}else this.enabled=!1}catch(e){(0,g.popupAjaxError)(e)}finally{this.isTogglingTranslation=!1}}}static{dt7948.n(this.prototype,"toggleTranslationEnabled",[n.action])}get chartRightPadding(){const e=Math.max(...this.data.map(({total:e})=>e))
switch(!0){case e>=1e5:return 90
case e>=1e4:return 80
case e>=20:return 70
default:return 50}}get descriptionKey(){return this.done===this.total?"discourse_ai.translations.stats.complete_language_detection_description":"discourse_ai.translations.stats.incomplete_language_detection_description"}get backfillStatusMessage(){if(this.args.model?.backfill_enabled&&this.args.model?.backfill_max_age_days&&this.hourlyRate>0){const e=this.data?.reduce((e,{total:t,done:s})=>e+(t-s),0)
if(e&&e>0){const t=e/this.hourlyRate,s=new Date
s.setDate(s.getDate()-this.args.model.backfill_max_age_days)
const i=s.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})
let o
if(t<1){const e=Math.ceil(60*t)
o=(0,f.i18n)("discourse_ai.translations.stats.eta_minutes",{count:e})}else if(t<24){const e=Math.ceil(t)
o=(0,f.i18n)("discourse_ai.translations.stats.eta_hours",{count:e})}else{const e=Math.ceil(t/24)
o=(0,f.i18n)("discourse_ai.translations.stats.eta_days",{count:e})}return(0,r.htmlSafe)((0,f.i18n)("discourse_ai.translations.stats.backfill_message",{date:i,eta:o,settingsUrl:this.settingsUrl}))}}return this.args.model?.backfill_enabled?null:(0,f.i18n)("discourse_ai.translations.stats.backfill_disabled")}get chartColors(){const e=getComputedStyle(document.querySelector(".ai-translations"))
return{progress:e.getPropertyValue("--chart-progress-color").trim(),remaining:e.getPropertyValue("--chart-remaining-color").trim(),text:e.getPropertyValue("--chart-text-color").trim(),label:e.getPropertyValue("--chart-label-color").trim()}}get chartConfig(){if(!this.data?.length)return{}
const e=this.chartColors,t=this.data.map(({locale:e,total:t,done:s})=>{const i=t>0?s/t*100:0,o=Math.trunc(i).toString(),n=this.languageNameLookup.getLanguageName(e),a=n.split(" (")[0]
return{locale:n,done:s,total:t,donePercentage:o,tooltip:[(0,f.i18n)("discourse_ai.translations.progress_chart.tooltip_translated",{done:s,total:t,language:a})]}})
return{type:"bar",data:{labels:t.map(({locale:e})=>e),datasets:[{tooltip:t.map(({tooltip:e})=>e),data:t.map(({donePercentage:e})=>e),totalItems:t.map(({total:e})=>e),backgroundColor:e.progress,barThickness:30,borderRadius:4}]},plugins:[{id:"barTotalText",afterDraw:({ctx:t,data:s,scales:i})=>{t.save(),t.textBaseline="middle",t.fillStyle=e.text
const o=s.datasets[0].totalItems
o.forEach((e,s)=>{t.fillText((0,f.i18n)("discourse_ai.translations.progress_chart.bar_done",{count:e}),i.x.getPixelForValue(100)+10,i.y.getPixelForValue(s))}),t.canvas.parentElement.style.height=50*o.length+40+"px",t.restore()}}],options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,layout:{padding:{right:this.chartRightPadding}},scales:{x:{beginAtZero:!0,max:100,grid:{display:!1},ticks:{color:e.text,callback:e=>(0,f.i18n)("discourse_ai.translations.progress_chart.data_label",{percentage:e})}},y:{grid:{display:!1},ticks:{color:e.text}}},plugins:{legend:{display:!1},tooltip:{displayColors:!1,callbacks:{label:({dataset:{tooltip:e},dataIndex:t})=>e[t]}},datalabels:{formatter:e=>this.site.mobileView&&e<20?"":(0,f.i18n)("discourse_ai.translations.progress_chart.data_label",{percentage:e}),color:e.label}}}}}static{(0,b.setComponentTemplate)((0,y.createTemplateFactory)({id:"TxPNvbE3",block:'[[[10,0],[14,0,"ai-translations admin-detail"],[12],[1,"\\n  "],[8,[32,0],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[28,[32,1],["discourse_ai.translations.title"],null],[28,[32,1],["discourse_ai.translations.description"],null],"https://meta.discourse.org/t/-/370969"]],[["actions"],[[[[1,"\\n"],[41,[30,0,["enabled"]],[[[1,"        "],[8,[30,1,["Default"]],[[24,0,"ai-translation-settings-button"]],[["@label","@route","@routeModels"],["discourse_ai.translations.admin_actions.translation_settings","adminPlugins.show.discourse-ai-features.edit",[30,2,["translation_id"]]]],null],[1,"\\n"]],[]],null],[41,[30,0,["showLocalizationSettingsButton"]],[[[1,"        "],[8,[30,1,["Default"]],[[24,0,"ai-localization-settings-button"]],[["@label","@route"],["discourse_ai.translations.admin_actions.localization_settings","adminConfig.localization.settings"]],null],[1,"\\n"]],[]],null],[1,"    "]],[1]]]]],[1,"\\n\\n"],[41,[30,0,["creditLimitReached"]],[[[1,"    "],[10,0],[14,0,"alert alert-warning ai-translations__credit-warning"],[12],[1,"\\n      "],[1,[28,[32,2],["triangle-exclamation"],null]],[1,"\\n      "],[10,1],[12],[1,[30,0,["creditLimitWarningMessage"]]],[13],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showLocaleSelector"]],[[[1,"    "],[10,0],[14,0,"alert alert-info"],[12],[1,"\\n      "],[10,0],[14,0,"settings"],[12],[1,"\\n        "],[10,0],[14,0,"setting"],[12],[1,"\\n          "],[10,0],[14,0,"setting-label"],[12],[1,"\\n            "],[10,"label"],[12],[1,[28,[32,1],["discourse_ai.translations.supported_locales"],null]],[13],[1,"\\n          "],[13],[1,"\\n          "],[10,0],[14,0,"setting-value"],[12],[1,"\\n            "],[10,0],[14,0,"ai-translations__locale-input-row"],[12],[1,"\\n              "],[8,[32,3],null,[["@value","@content","@nameProperty","@valueProperty","@onChange","@options"],[[30,0,["selectedLocales"]],[30,0,["availableLocales"]],"name","value",[30,0,["updateSelectedLocales"]],[28,[32,4],null,[["allowAny"],[false]]]]],null],[1,"\\n"],[41,[30,0,["localesChanged"]],[[[1,"                "],[10,0],[14,0,"setting-controls"],[12],[1,"\\n                  "],[8,[32,5],[[24,0,"ok setting-controls__ok"]],[["@action","@icon","@isLoading","@ariaLabel"],[[30,0,["saveLocales"]],"check",[30,0,["isSavingLocales"]],"save"]],null],[1,"\\n                  "],[8,[32,5],[[24,0,"cancel setting-controls__cancel"]],[["@action","@icon","@isLoading","@ariaLabel"],[[30,0,["cancelLocales"]],"xmark",[30,0,["isSavingLocales"]],"cancel"]],null],[1,"\\n                "],[13],[1,"\\n"]],[]],[[[41,[30,0,["selectedLocales","length"]],[[[1,"                "],[8,[32,5],[[24,0,"undo setting-controls__undo"]],[["@action","@icon","@label"],[[30,0,["resetLocales"]],"arrow-rotate-left","admin.settings.reset"]],null],[1,"\\n              "]],[]],null]],[]]],[1,"            "],[13],[1,"\\n            "],[10,0],[14,0,"desc"],[12],[1,[28,[32,1],["discourse_ai.translations.supported_locales_description"],null]],[13],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[1,"\\n  "],[10,0],[14,0,"ai-translations__toggle-container"],[12],[1,"\\n    "],[8,[32,6],[[16,"disabled",[30,0,["isToggleDisabled"]]],[4,[32,7],["click",[30,0,["toggleTranslationEnabled"]]],null]],[["@state","@label"],[[30,0,["translationEnabled"]],"discourse_ai.translations.admin_actions.enable_translations"]],null],[1,"\\n  "],[13],[1,"\\n\\n"],[41,[30,0,["enabled"]],[[[1,"    "],[8,[32,8],[[24,0,"ai-translations__charts"]],null,[["header","content"],[[[[1,"\\n        "],[1,[28,[32,1],["discourse_ai.translations.progress_chart.title"],null]],[1,"\\n      "]],[]],[[[1,"\\n        "],[10,0],[14,0,"ai-translations__stats-container"],[12],[1,"\\n"],[41,[30,0,["backfillStatusMessage"]],[[[1,"            "],[10,0],[14,0,"ai-translations__stat-item"],[12],[1,"\\n              "],[10,1],[14,0,"ai-translations__stat-label"],[12],[1,"\\n                "],[1,[30,0,["backfillStatusMessage"]]],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n        "],[10,0],[14,0,"ai-translations__chart-container"],[12],[1,"\\n          "],[8,[32,9],[[24,0,"ai-translations__chart"]],[["@chartConfig","@loadChartDataLabelsPlugin"],[[30,0,["chartConfig"]],true]],null],[1,"\\n        "],[13],[1,"\\n      "]],[]]]]],[1,"\\n\\n"]],[]],null],[1,"\\n"],[13]],["actions","@model"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-translations.js",scope:()=>[c.default,f.i18n,m.default,_.default,i.hash,u.default,p.default,o.on,l.default,d.default],isStrictMode:!0}),this)}}e.default=v}),define("discourse/plugins/discourse-ai/discourse/components/ai-usage",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/routing","@ember/service","discourse/admin/components/admin-config-area-card","discourse/admin/components/admin-config-area-empty-list","discourse/admin/components/chart","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/d-page-subheader","discourse/components/d-stat-tiles","discourse/components/date-time-input-range","discourse/float-kit/components/d-tooltip","discourse/helpers/avatar","discourse/helpers/concat-class","discourse/helpers/d-icon","discourse/lib/ajax","discourse/lib/decorators","discourse/lib/formatter","discourse/select-kit/components/combo-box","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-credit-bar","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x,k,T,C,P,M,j){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class A extends t.default{static{dt7948.g(this.prototype,"currentUser",[l.service])}#A=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"startDate",[s.tracked],function(){return moment().subtract(30,"days").toDate()})}#pt=void dt7948.i(this,"startDate")
static{dt7948.g(this.prototype,"endDate",[s.tracked],function(){return new Date})}#mt=void dt7948.i(this,"endDate")
static{dt7948.g(this.prototype,"data",[s.tracked],function(){return this.args.model})}#tt=void dt7948.i(this,"data")
static{dt7948.g(this.prototype,"selectedFeature",[s.tracked])}#ht=void dt7948.i(this,"selectedFeature")
static{dt7948.g(this.prototype,"selectedModel",[s.tracked])}#gt=void dt7948.i(this,"selectedModel")
static{dt7948.g(this.prototype,"selectedPeriod",[s.tracked],function(){return"month"})}#_t=void dt7948.i(this,"selectedPeriod")
static{dt7948.g(this.prototype,"isCustomDateActive",[s.tracked],function(){return!1})}#ft=void dt7948.i(this,"isCustomDateActive")
static{dt7948.g(this.prototype,"loadingData",[s.tracked],function(){return!0})}#bt=void dt7948.i(this,"loadingData")
constructor(){super(...arguments),this.fetchData()}async fetchData(){const e=await(0,w.ajax)("/admin/plugins/discourse-ai/ai-usage-report.json",{data:{start_date:moment(this.startDate).format("YYYY-MM-DD"),end_date:moment(this.endDate).format("YYYY-MM-DD"),timezone:this.currentUser?.user_option?.timezone||moment.tz.guess(),feature:this.selectedFeature,model:this.selectedModel}})
this.data=e,this.loadingData=!1}static{dt7948.n(this.prototype,"fetchData",[o.action])}async onFilterChange(){await this.fetchData()}static{dt7948.n(this.prototype,"onFilterChange",[o.action])}onFeatureChanged(e){this.selectedFeature=e,this.onFilterChange()}static{dt7948.n(this.prototype,"onFeatureChanged",[o.action])}onModelChanged(e){this.selectedModel=e,this.onFilterChange()}static{dt7948.n(this.prototype,"onModelChanged",[o.action])}addCurrencyChar(e){e.querySelectorAll(".d-stat-tile__label").forEach(e=>{if(e.innerText.trim()===(0,C.i18n)("discourse_ai.usage.total_spending")){const t=e.closest(".d-stat-tile")?.querySelector(".d-stat-tile__value")
t&&(t.innerText=`$${t.innerText}`)}})}static{dt7948.n(this.prototype,"addCurrencyChar",[o.action])}takeUsers(e,t){return this.data.users.slice(e,t)}static{dt7948.n(this.prototype,"takeUsers",[S.bind])}get userSplitPoint(){return this.data?.users?Math.ceil(this.data.users.length/2):0}normalizeTimeSeriesData(e){if(!e?.length)return[]
const t=moment(this.startDate),s=moment(this.endDate),i=[]
let o,n
"hour"===this.data.period?(o="hour",n="YYYY-MM-DD HH:00:00"):"day"===this.data.period?(o="day",n="YYYY-MM-DD"):(o="month",n="YYYY-MM")
const a=new Map(e.map(e=>[moment(e.period).format(n),e]))
for(let r=moment(t);r.isSameOrBefore(s);r.add(1,o)){const e=r.format(n),t=a.get(e)
i.push(t||{period:r.format(),total_tokens:0,total_cache_read_tokens:0,total_cache_write_tokens:0,total_request_tokens:0,total_response_tokens:0})}return i}get metrics(){return[{label:(0,C.i18n)("discourse_ai.usage.total_requests"),value:this.data.summary.total_requests,tooltip:(0,C.i18n)("discourse_ai.usage.stat_tooltips.total_requests")},{label:(0,C.i18n)("discourse_ai.usage.total_tokens"),value:this.data.summary.total_tokens,tooltip:(0,C.i18n)("discourse_ai.usage.stat_tooltips.total_tokens")},{label:(0,C.i18n)("discourse_ai.usage.request_tokens"),value:this.data.summary.total_request_tokens,tooltip:(0,C.i18n)("discourse_ai.usage.stat_tooltips.request_tokens")},{label:(0,C.i18n)("discourse_ai.usage.response_tokens"),value:this.data.summary.total_response_tokens,tooltip:(0,C.i18n)("discourse_ai.usage.stat_tooltips.response_tokens")},{label:(0,C.i18n)("discourse_ai.usage.cache_read_tokens"),value:this.data.summary.total_cache_read_tokens,tooltip:(0,C.i18n)("discourse_ai.usage.stat_tooltips.cache_read_tokens")},{label:(0,C.i18n)("discourse_ai.usage.cache_write_tokens"),value:this.data.summary.total_cache_write_tokens,tooltip:(0,C.i18n)("discourse_ai.usage.stat_tooltips.cache_write_tokens")},{label:(0,C.i18n)("discourse_ai.usage.total_spending"),value:this.data.summary.total_spending,tooltip:(0,C.i18n)("discourse_ai.usage.stat_tooltips.total_spending")}]}get chartConfig(){if(!this.data?.data)return
const e=this.normalizeTimeSeriesData(this.data.data),t=document.querySelector(".ai-usage__chart"),s=getComputedStyle(t),i={response:s.getPropertyValue("--chart-response-color").trim(),request:s.getPropertyValue("--chart-request-color").trim(),cacheRead:s.getPropertyValue("--chart-cache-read-color").trim(),cacheWrite:s.getPropertyValue("--chart-cache-write-color").trim()}
return{type:"bar",data:{labels:e.map(e=>{const t=moment(e.period)
return"hour"===this.data.period?t.format("HH:00"):"day"===this.data.period?t.format("DD-MMM"):t.format("MMM-YY")}),datasets:[{label:(0,C.i18n)("discourse_ai.usage.response_tokens"),data:e.map(e=>e.total_response_tokens),backgroundColor:i.response},{label:(0,C.i18n)("discourse_ai.usage.request_tokens"),data:e.map(e=>e.total_request_tokens),backgroundColor:i.request},{label:(0,C.i18n)("discourse_ai.usage.cache_read_tokens"),data:e.map(e=>e.total_cache_read_tokens),backgroundColor:i.cacheRead},{label:(0,C.i18n)("discourse_ai.usage.cache_write_tokens"),data:e.map(e=>e.total_cache_write_tokens),backgroundColor:i.cacheWrite}]},options:{responsive:!0,scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0}}}}}get modelsWithCredits(){return(this.data?.models||[]).filter(e=>e.credit_allocation)}get modelsWithoutCredits(){return(this.data?.models||[]).filter(e=>!e.credit_allocation)}get featuresTotals(){const e=this.data?.features||[]
let t=0
return e.forEach(e=>{const s=this.getFeatureCostType(e.feature_name)
"included"===s||(t+="mixed"===s?this.getCostOnlySpending(e.feature_name):(e.input_spending||0)+(e.cache_read_spending||0)+(e.cache_write_spending||0)+(e.output_spending||0))}),{usage_count:e.reduce((e,t)=>e+(t.usage_count||0),0),total_tokens:e.reduce((e,t)=>e+(t.total_tokens||0),0),total_spending:t}}get modelsWithoutCreditsTotals(){const e=this.modelsWithoutCredits||[]
return{usage_count:e.reduce((e,t)=>e+(t.usage_count||0),0),total_tokens:e.reduce((e,t)=>e+(t.total_tokens||0),0),total_spending:e.reduce((e,t)=>e+(t.input_spending||0)+(t.cache_read_spending||0)+(t.cache_write_spending||0)+(t.output_spending||0),0)}}get usersTotals(){const e=this.data?.users||[]
return{usage_count:e.reduce((e,t)=>e+(t.usage_count||0),0),total_tokens:e.reduce((e,t)=>e+(t.total_tokens||0),0),total_spending:e.reduce((e,t)=>e+(t.input_spending||0)+(t.cache_read_spending||0)+(t.cache_write_spending||0)+(t.output_spending||0),0)}}formatSpending(e){return`$${(e||0).toFixed(2)}`}static{dt7948.n(this.prototype,"formatSpending",[S.bind])}getFeatureCostType(e){const t=this.data?.feature_models?.[e]||[]
if(0===t.length)return"cost"
const s=t.some(e=>e.credit_allocation),i=t.some(e=>!e.credit_allocation)
return s&&!i?"included":!s&&i?"cost":"mixed"}static{dt7948.n(this.prototype,"getFeatureCostType",[S.bind])}getIncludedModelsForFeature(e){return(this.data?.feature_models?.[e]||[]).filter(e=>e.credit_allocation)}static{dt7948.n(this.prototype,"getIncludedModelsForFeature",[S.bind])}getCostModelsForFeature(e){return(this.data?.feature_models?.[e]||[]).filter(e=>!e.credit_allocation)}static{dt7948.n(this.prototype,"getCostModelsForFeature",[S.bind])}getCostOnlySpending(e){return this.getCostModelsForFeature(e).reduce((e,t)=>e+(t.input_spending||0)+(t.cache_read_spending||0)+(t.cache_write_spending||0)+(t.output_spending||0),0)}static{dt7948.n(this.prototype,"getCostOnlySpending",[S.bind])}hasIncludedModelsForFeature(e){return this.getIncludedModelsForFeature(e).length>0}static{dt7948.n(this.prototype,"hasIncludedModelsForFeature",[S.bind])}hasCostModelsForFeature(e){return this.getCostModelsForFeature(e).length>0}static{dt7948.n(this.prototype,"hasCostModelsForFeature",[S.bind])}get availableFeatures(){if(this._cachedFeatures)return this._cachedFeatures
const e=this.data?.features
return e?.length&&(this._cachedFeatures=e.map(e=>({id:e.feature_name,name:e.feature_name}))),this._cachedFeatures||[]}get availableModels(){if(this._cachedModels)return this._cachedModels
const e=this.data?.models
return e?.length&&(this._cachedModels=e.map(e=>({id:e.id,name:e.llm}))),this._cachedModels||[]}get periodOptions(){return[{id:"day",name:(0,C.i18n)("discourse_ai.usage.periods.last_day")},{id:"week",name:(0,C.i18n)("discourse_ai.usage.periods.last_week")},{id:"month",name:(0,C.i18n)("discourse_ai.usage.periods.last_month")}]}setPeriodDates(e){const t=moment()
switch(e){case"day":this.startDate=t.clone().subtract(1,"day").toDate(),this.endDate=t.toDate()
break
case"week":this.startDate=t.clone().subtract(7,"days").toDate(),this.endDate=t.toDate()
break
case"month":this.startDate=t.clone().subtract(30,"days").toDate(),this.endDate=t.toDate()}}static{dt7948.n(this.prototype,"setPeriodDates",[o.action])}onPeriodSelect(e){this._cachedFeatures=null,this._cachedModels=null,this.selectedPeriod=e,this.isCustomDateActive=!1,this.setPeriodDates(e),this.fetchData()}static{dt7948.n(this.prototype,"onPeriodSelect",[o.action])}onCustomDateClick(){this.isCustomDateActive=!this.isCustomDateActive,this.isCustomDateActive&&(this.selectedPeriod=null)}static{dt7948.n(this.prototype,"onCustomDateClick",[o.action])}onDateChange(){this._cachedFeatures=null,this._cachedModels=null,this.isCustomDateActive=!0,this.selectedPeriod=null,this.fetchData()}static{dt7948.n(this.prototype,"onDateChange",[o.action])}onChangeDateRange({from:e,to:t}){this._startDate=e,this._endDate=t}static{dt7948.n(this.prototype,"onChangeDateRange",[o.action])}onRefreshDateRange(){this._cachedFeatures=null,this._cachedModels=null,this.startDate=this._startDate,this.endDate=this._endDate,this.fetchData(),this._startDate=null,this._endDate=null}static{dt7948.n(this.prototype,"onRefreshDateRange",[o.action])}get fromDate(){return this._startDate||this.startDate}get toDate(){return this._endDate||this.endDate}totalSpending(e,t,s,i){return`$${((e||0)+(t||0)+(s||0)+(i||0)).toFixed(2)}`}static{dt7948.n(this.prototype,"totalSpending",[S.bind])}static{(0,M.setComponentTemplate)((0,j.createTemplateFactory)({id:"KKmOec5/",block:'[[[10,0],[14,0,"ai-usage admin-detail"],[12],[1,"\\n  "],[8,[32,0],null,[["@titleLabel","@learnMoreUrl","@descriptionLabel"],[[28,[32,1],["discourse_ai.usage.short_title"],null],"https://meta.discourse.org/t/-/348677",[28,[32,1],["discourse_ai.usage.subheader_description"],null]]],null],[1,"\\n  "],[10,0],[14,0,"ai-usage__filters"],[12],[1,"\\n    "],[10,0],[14,0,"ai-usage__filters-dates"],[12],[1,"\\n      "],[10,0],[14,0,"ai-usage__period-buttons"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["periodOptions"]]],null]],null],null,[[[1,"          "],[8,[32,2],[[16,0,[52,[28,[32,3],[[30,0,["selectedPeriod"]],[30,1,["id"]]],null],"btn-primary","btn-default"]]],[["@action","@translatedLabel"],[[28,[32,4],[[30,0,["onPeriodSelect"]],[30,1,["id"]]],null],[30,1,["name"]]]],null],[1,"\\n"]],[1]],null],[1,"        "],[8,[32,2],[[16,0,[52,[30,0,["isCustomDateActive"]],"btn-primary","btn-default"]]],[["@action","@label"],[[30,0,["onCustomDateClick"]],"discourse_ai.usage.periods.custom"]],null],[1,"\\n      "],[13],[1,"\\n\\n"],[41,[30,0,["isCustomDateActive"]],[[[1,"        "],[10,0],[14,0,"ai-usage__custom-date-pickers"],[12],[1,"\\n\\n          "],[8,[32,5],null,[["@from","@to","@onChange","@showFromTime","@showToTime"],[[30,0,["fromDate"]],[30,0,["toDate"]],[30,0,["onChangeDateRange"]],false,false]],null],[1,"\\n\\n          "],[8,[32,2],null,[["@action","@label"],[[30,0,["onRefreshDateRange"]],"refresh"]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"ai-usage__filters-row"],[12],[1,"\\n      "],[8,[32,6],[[24,0,"ai-usage__feature-selector"]],[["@value","@content","@onChange","@options"],[[30,0,["selectedFeature"]],[30,0,["availableFeatures"]],[30,0,["onFeatureChanged"]],[28,[32,7],null,[["none"],["discourse_ai.usage.all_features"]]]]],null],[1,"\\n\\n      "],[8,[32,6],[[24,0,"ai-usage__model-selector"]],[["@value","@content","@onChange","@options"],[[30,0,["selectedModel"]],[30,0,["availableModels"]],[30,0,["onModelChanged"]],[28,[32,7],null,[["none"],["discourse_ai.usage.all_models"]]]]],null],[1,"\\n    "],[13],[1,"\\n\\n    "],[8,[32,8],null,[["@condition"],[[30,0,["loadingData"]]]],[["default"],[[[[1,"\\n      "],[8,[32,9],[[24,0,"ai-usage__summary"]],[["@heading"],["discourse_ai.usage.summary"]],[["content"],[[[[1,"\\n          "],[8,[32,10],[[4,[32,11],[[30,0,["addCurrencyChar"]],[30,0,["metrics"]]],null],[4,[32,12],[[30,0,["addCurrencyChar"]],[30,0,["metrics"]]],null]],null,[["default"],[[[[1,"\\n\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["metrics"]]],null]],null],null,[[[1,"              "],[8,[30,2,["Tile"]],[[24,0,"bar"]],[["@label","@href","@value","@tooltip"],[[30,3,["label"]],[30,3,["href"]],[30,3,["value"]],[30,3,["tooltip"]]]],null],[1,"\\n"]],[3]],null],[1,"          "]],[2]]]]],[1,"\\n        "]],[]]]]],[1,"\\n\\n      "],[8,[32,9],[[24,0,"ai-usage__charts"]],[["@heading"],["discourse_ai.usage.tokens_over_time"]],[["content"],[[[[1,"\\n          "],[10,0],[14,0,"ai-usage__chart-container"],[12],[1,"\\n            "],[8,[32,13],[[24,0,"ai-usage__chart"]],[["@chartConfig"],[[30,0,["chartConfig"]]]],null],[1,"\\n          "],[13],[1,"\\n        "]],[]]]]],[1,"\\n\\n      "],[10,0],[14,0,"ai-usage__breakdowns"],[12],[1,"\\n        "],[8,[32,9],[[24,0,"ai-usage__features"]],[["@heading"],["discourse_ai.usage.features_breakdown"]],[["content"],[[[[1,"\\n"],[41,[51,[30,0,["data","features","length"]]],[[[1,"              "],[8,[32,14],null,[["@emptyLabel"],["discourse_ai.usage.no_features"]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["data","features","length"]],[[[1,"              "],[10,"table"],[14,0,"ai-usage__features-table"],[12],[1,"\\n                "],[10,"thead"],[12],[1,"\\n                  "],[10,"tr"],[12],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.feature"],null]],[13],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_spending"],null]],[13],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n                "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["data","features"]]],null]],null],null,[[[1,"                    "],[10,"tr"],[14,0,"ai-usage__features-row"],[12],[1,"\\n                      "],[10,"td"],[14,0,"ai-usage__features-cell"],[12],[1,[30,4,["feature_name"]]],[13],[1,"\\n                      "],[10,"td"],[14,0,"ai-usage__features-cell"],[15,"title",[30,4,["usage_count"]]],[12],[1,[28,[32,15],[[30,4,["usage_count"]]],null]],[13],[1,"\\n                      "],[10,"td"],[14,0,"ai-usage__features-cell"],[15,"title",[30,4,["total_tokens"]]],[12],[1,[28,[32,15],[[30,4,["total_tokens"]]],null]],[13],[1,"\\n                      "],[10,"td"],[14,0,"ai-usage__features-cell"],[12],[1,"\\n"],[41,[28,[32,3],[[28,[30,0,["getFeatureCostType"]],[[30,4,["feature_name"]]],null],"included"],null],[[[1,"                          "],[10,1],[14,0,"ai-usage__included-label"],[12],[1,"\\n                            "],[1,[28,[32,1],["discourse_ai.usage.included_in_plan"],null]],[1,"\\n                          "],[13],[1,"\\n"]],[]],[[[41,[28,[32,3],[[28,[30,0,["getFeatureCostType"]],[[30,4,["feature_name"]]],null],"cost"],null],[[[1,"                          "],[1,[28,[30,0,["totalSpending"]],[[30,4,["input_spending"]],[30,4,["cache_read_spending"]],[30,4,["cache_write_spending"]],[30,4,["output_spending"]]],null]],[1,"\\n"]],[]],[[[1,"                          "],[10,1],[14,0,"ai-usage__mixed-cost"],[12],[1,"\\n                            "],[1,[28,[30,0,["formatSpending"]],[[28,[30,0,["getCostOnlySpending"]],[[30,4,["feature_name"]]],null]],null]],[1,"\\n                            "],[8,[32,16],null,[["@identifier","@placement","@interactive","@maxWidth"],["ai-usage-feature-breakdown","top",true,600]],[["trigger","content"],[[[[1,"\\n                                "],[1,[28,[32,17],["circle-question"],[["class"],["ai-usage__info-icon"]]]],[1,"\\n                              "]],[]],[[[1,"\\n                                "],[10,0],[14,0,"ai-usage__cost-breakdown"],[12],[1,"\\n"],[41,[28,[30,0,["hasIncludedModelsForFeature"]],[[30,4,["feature_name"]]],null],[[[1,"                                    "],[10,0],[14,0,"ai-usage__breakdown-section"],[12],[1,"\\n                                      "],[10,"h4"],[12],[1,[28,[32,1],["discourse_ai.usage.included_models"],null]],[13],[1,"\\n                                      "],[10,"table"],[14,0,"ai-usage__breakdown-table"],[12],[1,"\\n                                        "],[10,"thead"],[12],[1,"\\n                                          "],[10,"tr"],[12],[1,"\\n                                            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.model"],null]],[13],[1,"\\n                                            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                                            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                                            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.cost"],null]],[13],[1,"\\n                                          "],[13],[1,"\\n                                        "],[13],[1,"\\n                                        "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[28,[30,0,["getIncludedModelsForFeature"]],[[30,4,["feature_name"]]],null]],null]],null],null,[[[1,"                                            "],[10,"tr"],[12],[1,"\\n                                              "],[10,"td"],[12],[1,[30,5,["llm"]]],[13],[1,"\\n                                              "],[10,"td"],[12],[1,[28,[32,15],[[30,5,["usage_count"]]],null]],[13],[1,"\\n                                              "],[10,"td"],[12],[1,[28,[32,15],[[30,5,["total_tokens"]]],null]],[13],[1,"\\n                                              "],[10,"td"],[12],[1,[28,[32,1],["discourse_ai.usage.included_in_plan"],null]],[13],[1,"\\n                                            "],[13],[1,"\\n"]],[5]],null],[1,"                                        "],[13],[1,"\\n                                      "],[13],[1,"\\n                                    "],[13],[1,"\\n"]],[]],null],[41,[28,[30,0,["hasCostModelsForFeature"]],[[30,4,["feature_name"]]],null],[[[1,"                                    "],[10,0],[14,0,"ai-usage__breakdown-section"],[12],[1,"\\n                                      "],[10,"h4"],[12],[1,[28,[32,1],["discourse_ai.usage.billed_models"],null]],[13],[1,"\\n                                      "],[10,"table"],[14,0,"ai-usage__breakdown-table"],[12],[1,"\\n                                        "],[10,"thead"],[12],[1,"\\n                                          "],[10,"tr"],[12],[1,"\\n                                            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.model"],null]],[13],[1,"\\n                                            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                                            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                                            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.cost"],null]],[13],[1,"\\n                                          "],[13],[1,"\\n                                        "],[13],[1,"\\n                                        "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[28,[30,0,["getCostModelsForFeature"]],[[30,4,["feature_name"]]],null]],null]],null],null,[[[1,"                                            "],[10,"tr"],[12],[1,"\\n                                              "],[10,"td"],[12],[1,[30,6,["llm"]]],[13],[1,"\\n                                              "],[10,"td"],[12],[1,[28,[32,15],[[30,6,["usage_count"]]],null]],[13],[1,"\\n                                              "],[10,"td"],[12],[1,[28,[32,15],[[30,6,["total_tokens"]]],null]],[13],[1,"\\n                                              "],[10,"td"],[12],[1,[28,[30,0,["totalSpending"]],[[30,6,["input_spending"]],[30,6,["cache_read_spending"]],[30,6,["cache_write_spending"]],[30,6,["output_spending"]]],null]],[13],[1,"\\n                                            "],[13],[1,"\\n"]],[6]],null],[1,"                                        "],[13],[1,"\\n                                      "],[13],[1,"\\n                                    "],[13],[1,"\\n"]],[]],null],[1,"                                "],[13],[1,"\\n                              "]],[]]]]],[1,"\\n                          "],[13],[1,"\\n                        "]],[]]]],[]]],[1,"                      "],[13],[1,"\\n                    "],[13],[1,"\\n"]],[4]],null],[1,"                  "],[10,"tr"],[14,0,"ai-usage__total-row"],[12],[1,"\\n                    "],[10,"td"],[12],[1,[28,[32,1],["discourse_ai.usage.total"],null]],[13],[1,"\\n                    "],[10,"td"],[15,"title",[30,0,["featuresTotals","usage_count"]]],[12],[1,[28,[32,15],[[30,0,["featuresTotals","usage_count"]]],null]],[13],[1,"\\n                    "],[10,"td"],[15,"title",[30,0,["featuresTotals","total_tokens"]]],[12],[1,[28,[32,15],[[30,0,["featuresTotals","total_tokens"]]],null]],[13],[1,"\\n                    "],[10,"td"],[12],[1,[28,[30,0,["formatSpending"]],[[30,0,["featuresTotals","total_spending"]]],null]],[13],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],null],[1,"          "]],[]]]]],[1,"\\n\\n        "],[8,[32,9],[[24,0,"ai-usage__models"]],[["@heading"],["discourse_ai.usage.models_breakdown"]],[["content"],[[[[1,"\\n"],[41,[51,[30,0,["data","models","length"]]],[[[1,"              "],[8,[32,14],null,[["@emptyLabel"],["discourse_ai.usage.no_models"]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["modelsWithCredits","length"]],[[[1,"              "],[10,"table"],[14,0,"ai-usage__models-table"],[12],[1,"\\n                "],[10,"thead"],[12],[1,"\\n                  "],[10,"tr"],[12],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.model"],null]],[13],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.credits_remaining"],null]],[13],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n                "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["modelsWithCredits"]]],null]],null],null,[[[1,"                    "],[10,"tr"],[14,0,"ai-usage__models-row"],[12],[1,"\\n                      "],[10,"td"],[14,0,"ai-usage__models-cell"],[12],[1,[30,7,["llm"]]],[13],[1,"\\n                      "],[10,"td"],[14,0,"ai-usage__models-cell"],[15,"title",[30,7,["usage_count"]]],[12],[1,[28,[32,15],[[30,7,["usage_count"]]],null]],[13],[1,"\\n                      "],[10,"td"],[14,0,"ai-usage__models-cell"],[15,"title",[30,7,["total_tokens"]]],[12],[1,[28,[32,15],[[30,7,["total_tokens"]]],null]],[13],[1,"\\n                      "],[10,"td"],[14,0,"ai-usage__models-credit-bar"],[12],[1,"\\n                        "],[8,[32,18],null,[["@allocation","@compact"],[[30,7,["credit_allocation"]],true]],null],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n"]],[7]],null],[1,"                "],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["modelsWithoutCredits","length"]],[[[1,"              "],[10,"table"],[14,0,"ai-usage__models-table"],[12],[1,"\\n                "],[10,"thead"],[12],[1,"\\n                  "],[10,"tr"],[12],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.model"],null]],[13],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                    "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_spending"],null]],[13],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n                "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["modelsWithoutCredits"]]],null]],null],null,[[[1,"                    "],[10,"tr"],[14,0,"ai-usage__models-row"],[12],[1,"\\n                      "],[10,"td"],[14,0,"ai-usage__models-cell"],[12],[1,[30,8,["llm"]]],[13],[1,"\\n                      "],[10,"td"],[14,0,"ai-usage__models-cell"],[15,"title",[30,8,["usage_count"]]],[12],[1,[28,[32,15],[[30,8,["usage_count"]]],null]],[13],[1,"\\n                      "],[10,"td"],[14,0,"ai-usage__models-cell"],[15,"title",[30,8,["total_tokens"]]],[12],[1,[28,[32,15],[[30,8,["total_tokens"]]],null]],[13],[1,"\\n                      "],[10,"td"],[12],[1,"\\n                        "],[1,[28,[30,0,["totalSpending"]],[[30,8,["input_spending"]],[30,8,["cache_read_spending"]],[30,8,["cache_write_spending"]],[30,8,["output_spending"]]],null]],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n"]],[8]],null],[1,"                  "],[10,"tr"],[14,0,"ai-usage__total-row"],[12],[1,"\\n                    "],[10,"td"],[12],[1,[28,[32,1],["discourse_ai.usage.total"],null]],[13],[1,"\\n                    "],[10,"td"],[15,"title",[30,0,["modelsWithoutCreditsTotals","usage_count"]]],[12],[1,[28,[32,15],[[30,0,["modelsWithoutCreditsTotals","usage_count"]]],null]],[13],[1,"\\n                    "],[10,"td"],[15,"title",[30,0,["modelsWithoutCreditsTotals","total_tokens"]]],[12],[1,[28,[32,15],[[30,0,["modelsWithoutCreditsTotals","total_tokens"]]],null]],[13],[1,"\\n                    "],[10,"td"],[12],[1,[28,[30,0,["formatSpending"]],[[30,0,["modelsWithoutCreditsTotals","total_spending"]]],null]],[13],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],null],[1,"          "]],[]]]]],[1,"\\n\\n        "],[8,[32,9],[[24,0,"ai-usage__users"]],[["@heading"],["discourse_ai.usage.users_breakdown"]],[["content"],[[[[1,"\\n"],[41,[51,[30,0,["data","users","length"]]],[[[1,"              "],[8,[32,14],null,[["@emptyLabel"],["discourse_ai.usage.no_users"]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["data","users","length"]],[[[1,"              "],[10,0],[15,0,[28,[32,19],["ai-usage__users-table-wrapper",[52,[28,[32,20],[[30,0,["data","users","length"]],24],null],"-multi-column"]],null]],[12],[1,"\\n                "],[10,"table"],[14,0,"ai-usage__users-table"],[12],[1,"\\n                  "],[10,"thead"],[12],[1,"\\n                    "],[10,"tr"],[12],[1,"\\n                      "],[10,"th"],[14,0,"ai-usage__users-username"],[12],[1,[28,[32,1],["discourse_ai.usage.username"],null]],[13],[1,"\\n                      "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                      "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                      "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_spending"],null]],[13],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n                  "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[28,[30,0,["takeUsers"]],[0,[30,0,["userSplitPoint"]]],null]],null]],null],null,[[[1,"                      "],[10,"tr"],[14,0,"ai-usage__users-row"],[12],[1,"\\n                        "],[10,"td"],[14,0,"ai-usage__users-cell"],[12],[1,"\\n                          "],[10,0],[14,0,"user-info"],[12],[1,"\\n                            "],[8,[32,21],[[24,0,"username"]],[["@route","@model"],["user",[30,9,["username"]]]],[["default"],[[[[1,"\\n                              "],[1,[28,[32,22],[[30,9]],[["imageSize"],["tiny"]]]],[1,"\\n                              "],[1,[30,9,["username"]]],[1,"\\n                            "]],[]]]]],[1,"\\n                          "],[13],[13],[1,"\\n                        "],[10,"td"],[14,0,"ai-usage__users-cell"],[15,"title",[30,9,["usage_count"]]],[12],[1,[28,[32,15],[[30,9,["usage_count"]]],null]],[13],[1,"\\n                        "],[10,"td"],[14,0,"ai-usage__users-cell"],[15,"title",[30,9,["total_tokens"]]],[12],[1,[28,[32,15],[[30,9,["total_tokens"]]],null]],[13],[1,"\\n                        "],[10,"td"],[12],[1,"\\n                          "],[1,[28,[30,0,["totalSpending"]],[[30,9,["input_spending"]],[30,9,["cache_read_spending"]],[30,9,["cache_write_spending"]],[30,9,["output_spending"]]],null]],[1,"\\n                        "],[13],[1,"\\n                      "],[13],[1,"\\n"]],[9]],null],[41,[51,[28,[32,20],[[30,0,["data","users","length"]],24],null]],[[[1,"                      "],[10,"tr"],[14,0,"ai-usage__total-row"],[12],[1,"\\n                        "],[10,"td"],[12],[1,[28,[32,1],["discourse_ai.usage.total"],null]],[13],[1,"\\n                        "],[10,"td"],[15,"title",[30,0,["usersTotals","usage_count"]]],[12],[1,[28,[32,15],[[30,0,["usersTotals","usage_count"]]],null]],[13],[1,"\\n                        "],[10,"td"],[15,"title",[30,0,["usersTotals","total_tokens"]]],[12],[1,[28,[32,15],[[30,0,["usersTotals","total_tokens"]]],null]],[13],[1,"\\n                        "],[10,"td"],[12],[1,[28,[30,0,["formatSpending"]],[[30,0,["usersTotals","total_spending"]]],null]],[13],[1,"\\n                      "],[13],[1,"\\n"]],[]],null],[1,"                  "],[13],[1,"\\n                "],[13],[1,"\\n\\n"],[41,[28,[32,20],[[30,0,["data","users","length"]],24],null],[[[1,"                  "],[10,"table"],[14,0,"ai-usage__users-table"],[12],[1,"\\n                    "],[10,"thead"],[12],[1,"\\n                      "],[10,"tr"],[12],[1,"\\n                        "],[10,"th"],[14,0,"ai-usage__users-username"],[12],[1,[28,[32,1],["discourse_ai.usage.username"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_spending"],null]],[13],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                    "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[28,[30,0,["takeUsers"]],[[30,0,["userSplitPoint"]],50],null]],null]],null],null,[[[1,"                        "],[10,"tr"],[14,0,"ai-usage__users-row"],[12],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__users-cell"],[12],[1,"\\n                            "],[10,0],[14,0,"user-info"],[12],[1,"\\n                              "],[8,[32,21],[[24,0,"username"]],[["@route","@model"],["user",[30,10,["username"]]]],[["default"],[[[[1,"\\n                                "],[1,[28,[32,22],[[30,10]],[["imageSize"],["tiny"]]]],[1,"\\n                                "],[1,[30,10,["username"]]],[1,"\\n                              "]],[]]]]],[1,"\\n                            "],[13],[13],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__users-cell"],[15,"title",[30,10,["usage_count"]]],[12],[1,[28,[32,15],[[30,10,["usage_count"]]],null]],[13],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__users-cell"],[15,"title",[30,10,["total_tokens"]]],[12],[1,[28,[32,15],[[30,10,["total_tokens"]]],null]],[13],[1,"\\n                          "],[10,"td"],[12],[1,"\\n                            "],[1,[28,[30,0,["totalSpending"]],[[30,10,["input_spending"]],[30,10,["cache_read_spending"]],[30,10,["cache_write_spending"]],[30,10,["output_spending"]]],null]],[1,"\\n                          "],[13],[1,"\\n                        "],[13],[1,"\\n"]],[10]],null],[1,"                      "],[10,"tr"],[14,0,"ai-usage__total-row"],[12],[1,"\\n                        "],[10,"td"],[12],[1,[28,[32,1],["discourse_ai.usage.total"],null]],[13],[1,"\\n                        "],[10,"td"],[15,"title",[30,0,["usersTotals","usage_count"]]],[12],[1,[28,[32,15],[[30,0,["usersTotals","usage_count"]]],null]],[13],[1,"\\n                        "],[10,"td"],[15,"title",[30,0,["usersTotals","total_tokens"]]],[12],[1,[28,[32,15],[[30,0,["usersTotals","total_tokens"]]],null]],[13],[1,"\\n                        "],[10,"td"],[12],[1,[28,[30,0,["formatSpending"]],[[30,0,["usersTotals","total_spending"]]],null]],[13],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n"]],[]],null],[1,"              "],[13],[1,"\\n"]],[]],null],[1,"          "]],[]]]]],[1,"\\n      "],[13],[1,"\\n    "]],[]]]]],[1,"\\n  "],[13],[1,"\\n"],[13]],["option","tiles","metric","feature","model","model","model","model","user","user"],["each","-track-array","if","unless"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/ai-usage.js",scope:()=>[h.default,C.i18n,m.default,T.eq,i.fn,_.default,k.default,i.hash,p.default,d.default,g.default,n.default,a.default,c.default,u.default,x.number,f.default,v.default,P.default,y.default,T.gt,r.LinkTo,b.default],isStrictMode:!0}),this)}}e.default=A}),define("discourse/plugins/discourse-ai/discourse/components/bulk-actions/ai-regen-summaries",["exports","@glimmer/component","@glimmer/tracking","@ember/object","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-regen-summaries-buttons","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
get topicIds(){return this.args.topics.map(e=>e.id)}handleLoadingChange(e){this.loading=e}static{dt7948.n(this.prototype,"handleLoadingChange",[i.action])}static{(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"ANd4wlmR",block:'[[[10,0],[14,0,"ai-bulk-regen-summaries"],[12],[1,"\\n  "],[10,2],[14,0,"ai-bulk-regen-summaries__description"],[12],[1,"\\n    "],[1,[28,[32,0],["discourse_ai.summarization.topic.bulk_regen_description"],null]],[1,"\\n  "],[13],[1,"\\n  "],[10,0],[14,0,"ai-bulk-regen-summaries__buttons"],[12],[1,"\\n    "],[8,[32,1],null,[["@topicIds","@disabled","@onLoadingChange","@onSuccess"],[[30,0,["topicIds"]],[30,0,["loading"]],[30,0,["handleLoadingChange"]],[30,1]]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],["@afterBulkAction"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/bulk-actions/ai-regen-summaries.js",scope:()=>[o.i18n,n.default],isStrictMode:!0}),this)}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/components/doughnut-chart",["exports","@glimmer/component","@glimmer/tracking","discourse/admin/components/chart","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static{dt7948.g(this.prototype,"canvasSize",[s.tracked],function(){return null})}#yt=void dt7948.i(this,"canvasSize")
get config(){const e=this.args.totalScore||""
return{type:"doughnut",data:{labels:this.args.labels,datasets:[{data:this.args.data,backgroundColor:this.args.colors,cutout:"50%",radius:100}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:this.args.displayLegend||!1,position:"bottom"}}},plugins:[{id:"centerText",afterDraw:function(t){const s=getComputedStyle(document.documentElement).getPropertyValue("--primary-high")||"#000",i=getComputedStyle(document.documentElement).getPropertyValue("--font-up-4")||"1.3em",o=getComputedStyle(document.documentElement).getPropertyValue("--font-family")||"sans-serif",{ctx:n,chartArea:a}=t,r=(a.left+a.right)/2,l=(a.top+a.bottom)/2
n.restore(),n.textAlign="center",n.textBaseline="middle",n.fillStyle=s.trim(),n.font=`bold ${i.trim()} ${o.trim()}`,n.fillText(e,r,l),n.save()}},{id:"doughnutLabels",afterDraw(e){const t=e.ctx,s=e.data.datasets[0],i=e.getDatasetMeta(0),o=getComputedStyle(document.documentElement).getPropertyValue("--font-down-2")||"1.3em",n=getComputedStyle(document.documentElement).getPropertyValue("--font-family")||"sans-serif"
t.font=`${o.trim()} ${n.trim()}`,t.fillStyle="#fafafa",t.textAlign="center",t.textBaseline="middle",i.data.forEach((e,i)=>{const{x:o,y:n}=e.tooltipPosition(),a=s.data[i],r=s.data.filter(e=>e>0).length
0!==a&&1!==r&&t.fillText(a,o,n)})}}]}}static{(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"qOBX3J/5",block:'[[[41,[30,0,["config"]],[[[1,"  "],[10,"h3"],[14,0,"doughnut-chart-title"],[12],[1,[30,1]],[13],[1,"\\n  "],[8,[32,0],[[24,0,"admin-report-doughnut"]],[["@chartConfig"],[[30,0,["config"]]]],null],[1,"\\n"]],[]],null]],["@doughnutTitle"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/doughnut-chart.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-llm-quota-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/service","discourse/components/d-modal","discourse/components/form","discourse/lib/constants","discourse/select-kit/components/group-chooser","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-quota-duration-selector","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static{dt7948.g(this.prototype,"site",[n.service])}#S=void dt7948.i(this,"site")
save(e){const t={...e}
t.group_name=this.site.groups.find(t=>t.id===e.group_id)?.name,t.llm_model_id=this.args.model.id,this.args.model.addItemToCollection(t),this.args.closeModal(),this.args.model.onSave&&this.args.model.onSave()}static{dt7948.n(this.prototype,"save",[o.action])}get availableGroups(){const e=this.args.model.llm.llm_quotas.map(e=>e.group_id)||[]
return this.site.groups.filter(t=>!e.includes(t.id)&&t.id!==l.AUTO_GROUPS.everyone.id)}get quota(){return{group_id:null,llm_model_id:null,max_tokens:null,max_usages:null,duration_seconds:moment.duration(1,"day").asSeconds()}}static{dt7948.n(this.prototype,"quota",[s.cached])}setGroupId(e,t){e.set(t[0])}static{dt7948.n(this.prototype,"setGroupId",[o.action])}validateForm(e,{addError:t,removeError:s}){e.max_tokens||e.max_usages?(s("max_tokens"),s("max_usages")):(t("max_tokens",{title:(0,u.i18n)("discourse_ai.llms.quotas.max_tokens"),message:(0,u.i18n)("discourse_ai.llms.quotas.max_tokens_required")}),t("max_usages",{title:(0,u.i18n)("discourse_ai.llms.quotas.max_usages"),message:(0,u.i18n)("discourse_ai.llms.quotas.max_usages_required")}))}static{dt7948.n(this.prototype,"validateForm",[o.action])}static{(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"PQF4AQB9",block:'[[[8,[32,0],[[24,0,"ai-llm-quota-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.llms.quotas.add_title"],null],[30,1]]],[["body"],[[[[1,"\\n    "],[8,[32,2],null,[["@validate","@onSubmit","@data"],[[30,0,["validateForm"]],[30,0,["save"]],[30,0,["quota"]]]],[["default"],[[[[1,"\\n      "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@format"],["group_id",[28,[32,1],["discourse_ai.llms.quotas.group"],null],"required","large"]],[["default"],[[[[1,"\\n        "],[8,[30,4,["Custom"]],null,null,[["default"],[[[[1,"\\n          "],[8,[32,3],null,[["@value","@content","@onChange","@options"],[[30,3,["group_id"]],[30,0,["availableGroups"]],[28,[32,4],[[30,0,["setGroupId"]],[30,4]],null],[28,[32,5],null,[["maximum"],[1]]]]],null],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[4]]]]],[1,"\\n\\n      "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["max_tokens",[28,[32,1],["discourse_ai.llms.quotas.max_tokens"],null],[28,[32,1],["discourse_ai.llms.quotas.max_tokens_help"],null],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,5,["Input"]],[[24,"min","1"]],[["@type"],["number"]],null],[1,"\\n      "]],[5]]]]],[1,"\\n\\n      "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["max_usages",[28,[32,1],["discourse_ai.llms.quotas.max_usages"],null],[28,[32,1],["discourse_ai.llms.quotas.max_usages_help"],null],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,6,["Input"]],[[24,"min","1"]],[["@type"],["number"]],null],[1,"\\n      "]],[6]]]]],[1,"\\n\\n      "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@format"],["duration_seconds",[28,[32,1],["discourse_ai.llms.quotas.duration"],null],"required","large"]],[["default"],[[[[1,"\\n        "],[8,[30,7,["Custom"]],null,null,[["default"],[[[[1,"\\n          "],[8,[32,6],null,[["@value","@onChange"],[[30,3,["duration_seconds"]],[30,7,["set"]]]],null],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[7]]]]],[1,"\\n\\n      "],[8,[30,2,["Submit"]],[[24,0,"btn-primary"]],[["@label"],["discourse_ai.llms.quotas.add"]],null],[1,"\\n    "]],[2,3]]]]],[1,"\\n  "]],[]]]]]],["@closeModal","form","data","field","field","field","field"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-llm-quota-modal.js",scope:()=>[a.default,u.i18n,r.default,d.default,i.fn,i.hash,c.default],isStrictMode:!0}),this)}}e.default=h}),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-persona-response-format-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","discourse/components/modal/json-schema-editor","discourse/lib/formatter","discourse/truth-helpers","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static{dt7948.g(this.prototype,"showJsonEditorModal",[s.tracked],function(){return!1})}#vt=void dt7948.i(this,"showJsonEditorModal")
jsonSchema={type:"array",uniqueItems:!0,title:(0,l.i18n)("discourse_ai.ai_persona.response_format.modal.root_title"),items:{type:"object",title:(0,l.i18n)("discourse_ai.ai_persona.response_format.modal.key_title"),properties:{key:{type:"string"},type:{type:"string",enum:["string","integer","boolean","array"]},array_type:{type:"string",enum:["string","integer","boolean"],options:{dependencies:{type:"array"}}}},required:["key","type"]}}
get editorTitle(){return(0,l.i18n)("discourse_ai.ai_persona.response_format.title")}get responseFormatAsJSON(){return JSON.stringify(this.args.data.response_format)}get displayJSON(){const e={}
return this.args.data.response_format.forEach(t=>{"array"===t.type?e[t.key]=`[${t.array_type}]`:e[t.key]=t.type}),(0,a.prettyJSON)(e)}openModal(){this.showJsonEditorModal=!0}static{dt7948.n(this.prototype,"openModal",[o.action])}closeModal(){this.showJsonEditorModal=!1}static{dt7948.n(this.prototype,"closeModal",[o.action])}updateResponseFormat(e,t){e.set("response_format",JSON.parse(t))}static{dt7948.n(this.prototype,"updateResponseFormat",[o.action])}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"Uh9kqWJX",block:'[[[8,[30,1,["Container"]],null,[["@title","@format"],[[30,0,["editorTitle"]],"large"]],[["default"],[[[[1,"\\n  "],[10,0],[14,0,"ai-persona-editor__response-format"],[12],[1,"\\n"],[41,[28,[32,0],[[30,2,["response_format","length"]],0],null],[[[1,"      "],[10,"pre"],[14,0,"ai-persona-editor__response-format-pre"],[12],[1,"        "],[10,"code"],[12],[1,[30,0,["displayJSON"]]],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],[[[1,"      "],[10,0],[14,0,"ai-persona-editor__response-format-none"],[12],[1,"\\n        "],[1,[28,[32,1],["discourse_ai.ai_persona.response_format.no_format"],null]],[1,"\\n      "],[13],[1,"\\n"]],[]]],[1,"\\n    "],[8,[30,1,["Button"]],null,[["@action","@label","@disabled"],[[30,0,["openModal"]],"discourse_ai.ai_persona.response_format.open_modal",[30,2,["system"]]]],null],[1,"\\n  "],[13],[1,"\\n"]],[]]]]],[1,"\\n\\n"],[41,[30,0,["showJsonEditorModal"]],[[[1,"  "],[8,[32,2],null,[["@model","@closeModal"],[[28,[32,3],null,[["value","updateValue","settingName","jsonSchema"],[[30,0,["responseFormatAsJSON"]],[28,[32,4],[[30,0,["updateResponseFormat"]],[30,1]],null],[30,0,["editorTitle"]],[30,0,["jsonSchema"]]]]],[30,0,["closeModal"]]]],null],[1,"\\n"]],[]],null]],["@form","@data"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-persona-response-format-editor.js",scope:()=>[r.gt,l.i18n,n.default,i.hash,i.fn],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-regen-summaries-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/object","discourse/components/d-modal","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-regen-summaries-buttons","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
get topicIds(){return[this.args.model.topic.id]}handleLoadingChange(e){this.loading=e}static{dt7948.n(this.prototype,"handleLoadingChange",[i.action])}handleSuccess(){this.args.closeModal()}static{dt7948.n(this.prototype,"handleSuccess",[i.action])}static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"MsDQC+h8",block:'[[[8,[32,0],[[24,0,"ai-regen-summaries-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.summarization.topic.regenerate_ai_summaries"],null],[30,1]]],[["body"],[[[[1,"\\n    "],[10,2],[14,0,"ai-regen-summaries-modal__description"],[12],[1,"\\n      "],[1,[28,[32,1],["discourse_ai.summarization.topic.regen_modal_description"],null]],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"ai-regen-summaries-modal__buttons"],[12],[1,"\\n      "],[8,[32,2],null,[["@topicIds","@disabled","@onLoadingChange","@onSuccess"],[[30,0,["topicIds"]],[30,0,["loading"]],[30,0,["handleLoadingChange"]],[30,0,["handleSuccess"]]]],null],[1,"\\n    "],[13],[1,"\\n  "]],[]]]]]],["@closeModal"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-regen-summaries-modal.js",scope:()=>[o.default,n.i18n,a.default],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-secret-create-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/object","discourse/components/d-modal","discourse/components/form","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{get formData(){return{name:"",secret:""}}static{dt7948.n(this.prototype,"formData",[s.cached])}async save(e){try{const t=(await(0,a.ajax)("/admin/plugins/discourse-ai/ai-secrets",{type:"POST",data:{ai_secret:e}})).ai_secret
this.args.model.onSave&&this.args.model.onSave(t),this.args.closeModal()}catch(t){(0,r.popupAjaxError)(t)}}static{dt7948.n(this.prototype,"save",[i.action])}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"B92j2eiG",block:'[[[8,[32,0],[[24,0,"ai-secret-create-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.secrets.modal.title"],null],[30,1]]],[["default"],[[[[1,"\\n  "],[8,[32,2],null,[["@onSubmit","@data"],[[30,0,["save"]],[30,0,["formData"]]]],[["default"],[[[[1,"\\n    "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@format"],["name",[28,[32,1],["discourse_ai.secrets.name"],null],"required|length:1,100","large"]],[["default"],[[[[1,"\\n      "],[8,[30,3,["Input"]],null,null,null],[1,"\\n    "]],[3]]]]],[1,"\\n\\n    "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@format"],["secret",[28,[32,1],["discourse_ai.secrets.secret"],null],"required","large"]],[["default"],[[[[1,"\\n      "],[8,[30,4,["Password"]],[[24,"autocomplete","off"]],null,null],[1,"\\n    "]],[4]]]]],[1,"\\n\\n    "],[8,[30,2,["Actions"]],null,null,[["default"],[[[[1,"\\n      "],[8,[30,2,["Submit"]],null,[["@label"],["discourse_ai.secrets.save"]],null],[1,"\\n    "]],[]]]]],[1,"\\n  "]],[2]]]]],[1,"\\n"]],[]]]]]],["@closeModal","form","field","field"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-secret-create-modal.js",scope:()=>[o.default,l.i18n,n.default],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-summary-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/service","discourse/components/cook-text","discourse/components/d-button","discourse/components/d-modal","discourse/float-kit/components/d-tooltip","discourse/helpers/concat-class","discourse/helpers/d-icon","discourse/helpers/html-class","discourse/lib/ajax","discourse/lib/decorators","discourse/lib/formatter","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-summary-skeleton","discourse/plugins/discourse-ai/discourse/lib/ai-errors","discourse/plugins/discourse-ai/discourse/lib/smooth-streamer","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x,k,T){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class C extends t.default{static{dt7948.g(this.prototype,"messageBus",[l.service])}#we=void dt7948.i(this,"messageBus")
static{dt7948.g(this.prototype,"currentUser",[l.service])}#A=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"modal",[l.service])}#O=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"text",[s.tracked],function(){return""})}#wt=void dt7948.i(this,"text")
static{dt7948.g(this.prototype,"summarizedOn",[s.tracked],function(){return null})}#St=void dt7948.i(this,"summarizedOn")
static{dt7948.g(this.prototype,"summarizedBy",[s.tracked],function(){return null})}#xt=void dt7948.i(this,"summarizedBy")
static{dt7948.g(this.prototype,"newPostsSinceSummary",[s.tracked],function(){return null})}#kt=void dt7948.i(this,"newPostsSinceSummary")
static{dt7948.g(this.prototype,"outdated",[s.tracked],function(){return!1})}#Tt=void dt7948.i(this,"outdated")
static{dt7948.g(this.prototype,"canRegenerate",[s.tracked],function(){return!1})}#Ct=void dt7948.i(this,"canRegenerate")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"currentIndex",[s.tracked],function(){return 0})}#Pt=void dt7948.i(this,"currentIndex")
static{dt7948.g(this.prototype,"smoothStreamer",[s.tracked],function(){return new x.default(()=>this.text,e=>this.text=e)})}#Re=void dt7948.i(this,"smoothStreamer")
get outdatedSummaryWarningText(){let e=(0,v.i18n)("summary.outdated")
return!this.topRepliesSummaryEnabled&&this.newPostsSinceSummary>0&&(e+=" ",e+=(0,v.i18n)("summary.outdated_posts",{count:this.newPostsSinceSummary})),e}resetSummary(){this.smoothStreamer.resetStreaming(),this.currentIndex=0,this.text="",this.summarizedOn=null,this.summarizedBy=null,this.newPostsSinceSummary=null,this.outdated=!1,this.canRegenerate=!1,this.loading=!1,this._channel=null}get topRepliesSummaryEnabled(){return this.args.model.postStream.summary}get topicId(){return this.args.model.topic.id}get baseSummarizationURL(){return`/discourse-ai/summarization/t/${this.topicId}`}subscribe(){const e=`/discourse-ai/summaries/topic/${this.args.model.topic.id}`
this._channel=e,this.messageBus.subscribe(e,this._updateSummary)}static{dt7948.n(this.prototype,"subscribe",[f.bind])}unsubscribe(){this.messageBus.unsubscribe("/discourse-ai/summaries/topic/*",this._updateSummary),this.resetSummary()}static{dt7948.n(this.prototype,"unsubscribe",[f.bind])}generateSummary(){let e=this.baseSummarizationURL
return this.currentUser&&(e+="?stream=true"),this._requestSummary(e)}static{dt7948.n(this.prototype,"generateSummary",[o.action])}regenerateSummary(){let e=this.baseSummarizationURL
return this.currentUser&&(e+="?stream=true",this.canRegenerate&&(e+="&skip_age_check=true")),this.resetSummary(),this._requestSummary(e)}static{dt7948.n(this.prototype,"regenerateSummary",[o.action])}_requestSummary(e){if(!(this.loading||this.text&&!this.canRegenerate))return this.loading=!0,this.summarizedOn=null,(0,_.ajax)(e).then(e=>{e?.ai_topic_summary?.summarized_text&&(e.done=!0,this._updateSummary(e))}).catch(e=>{if(this.loading=!1,!(0,S.isAiCreditLimitError)(e))throw e;(0,S.popupAiCreditLimitError)(e)})}static{dt7948.n(this.prototype,"_requestSummary",[o.action])}async _updateSummary(e){if((0,S.isAiCreditLimitError)(e))return this.loading=!1,(0,S.popupAiCreditLimitError)(e),void this.unsubscribe()
const t={done:e.done,raw:e.ai_topic_summary?.summarized_text,...e.ai_topic_summary}
this.loading=!1,this.smoothStreamer.updateResult(t,"raw"),e.done&&(this.summarizedOn=(0,b.shortDateNoYear)(moment(t.updated_at,"YYYY-MM-DD HH:mm:ss Z")),this.summarizedBy=t.algorithm,this.newPostsSinceSummary=t.new_posts_since_summary,this.outdated=t.outdated,this.canRegenerate=t.outdated&&t.can_regenerate)}static{dt7948.n(this.prototype,"_updateSummary",[f.bind])}onRegisterApi(e){this.dMenu=e}static{dt7948.n(this.prototype,"onRegisterApi",[o.action])}handleClose(){this.modal.triggerElement=null,this.args.closeModal()}static{dt7948.n(this.prototype,"handleClose",[o.action])}static{(0,k.setComponentTemplate)((0,T.createTemplateFactory)({id:"qHadtlSr",block:'[[[8,[32,0],[[24,0,"ai-summary-modal"],[4,[32,3],[[30,0,["subscribe"]],[30,1,["topic","id"]]],null],[4,[32,4],[[30,0,["subscribe"]],[30,1,["topic","id"]]],null],[4,[32,5],[[30,0,["unsubscribe"]]],null]],[["@title","@closeModal","@bodyClass","@hideFooter"],[[28,[32,1],["discourse_ai.summarization.topic.title"],null],[30,0,["handleClose"]],"ai-summary-modal__body",[28,[32,2],[[30,0,["summarizedOn"]]],null]]],[["body","footer"],[[[[1,"\\n    "],[1,[28,[32,6],["scrollable-modal"],null]],[1,"\\n    "],[11,0],[24,0,"ai-summary-container"],[4,[32,3],[[30,0,["generateSummary"]]],null],[12],[1,"\\n      "],[10,"article"],[15,0,[28,[32,7],["ai-summary-box","streamable-content",[52,[30,0,["smoothStreamer","isStreaming"]],"streaming"]],null]],[12],[1,"\\n"],[41,[30,0,["loading"]],[[[1,"          "],[8,[32,8],null,null,null],[1,"\\n"]],[]],[[[1,"          "],[10,0],[14,0,"generated-summary cooked"],[12],[1,"\\n            "],[8,[32,9],null,[["@rawText"],[[30,0,["smoothStreamer","renderedText"]]]],null],[1,"\\n          "],[13],[1,"\\n"]],[]]],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],[]],[[[1,"\\n    "],[10,2],[14,0,"summarized-on"],[12],[1,"\\n      "],[1,[28,[32,1],["summary.summarized_on"],[["date"],[[30,0,["summarizedOn"]]]]]],[1,"\\n      "],[8,[32,10],null,[["@placements"],[[28,[32,11],["top-end"],null]]],[["trigger","content"],[[[[1,"\\n          "],[1,[28,[32,12],["circle-info"],null]],[1,"\\n        "]],[]],[[[1,"\\n          "],[1,[28,[32,1],["summary.model_used"],[["model"],[[30,0,["summarizedBy"]]]]]],[1,"\\n        "]],[]]]]],[1,"\\n    "],[13],[1,"\\n"],[41,[30,0,["outdated"]],[[[1,"      "],[10,2],[14,0,"summary-outdated"],[12],[1,[30,0,["outdatedSummaryWarningText"]]],[13],[1,"\\n"]],[]],null],[41,[30,0,["canRegenerate"]],[[[1,"      "],[8,[32,13],null,[["@label","@title","@action","@icon"],["summary.buttons.regenerate","summary.buttons.regenerate",[30,0,["regenerateSummary"]],"arrows-rotate"]],null],[1,"\\n"]],[]],null],[1,"  "]],[]]]]]],["@model"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-summary-modal.js",scope:()=>[c.default,v.i18n,y.not,n.default,a.default,r.default,g.default,m.default,w.default,d.default,p.default,i.array,h.default,u.default],isStrictMode:!0}),this)}}e.default=C}),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/utilities","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static{dt7948.g(this.prototype,"testResult",[s.tracked])}#K=void dt7948.i(this,"testResult")
static{dt7948.g(this.prototype,"isLoading",[s.tracked],function(){return!1})}#Mt=void dt7948.i(this,"isLoading")
parameterValues={}
updateParameter(e,t){this.parameterValues[e]=t.target.value}static{dt7948.n(this.prototype,"updateParameter",[n.action])}async runTest(){this.isLoading=!0
try{const e=await(0,l.ajax)(`/admin/plugins/discourse-ai/ai-tools/${this.args.model.tool.id}/test.json`,{type:"POST",data:JSON.stringify({ai_tool:this.args.model.tool,parameters:this.parameterValues}),contentType:"application/json"})
this.testResult=(0,c.jsonToHtml)(e.output)}catch(e){(0,d.popupAjaxError)(e)}finally{this.isLoading=!1}}static{dt7948.n(this.prototype,"runTest",[n.action])}static{(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"+Mfmkghi",block:'[[[8,[32,0],[[24,0,"ai-tool-test-modal"]],[["@title","@closeModal","@bodyClass"],[[28,[32,1],["discourse_ai.tools.test_modal.title"],null],[30,1],"ai-tool-test-modal__body"]],[["body","footer"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2,["tool","parameters"]]],null]],null],null,[[[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[30,3,["name"]]],[13],[1,"\\n        "],[11,"input"],[16,3,[30,3,["name"]]],[24,4,"text"],[4,[32,2],["input",[28,[32,3],[[30,0,["updateParameter"]],[30,3,["name"]]],null]],null],[12],[13],[1,"\\n      "],[13],[1,"\\n"]],[3]],null],[1,"\\n"],[41,[30,0,["testResult"]],[[[1,"      "],[10,0],[14,0,"ai-tool-test-modal__test-result"],[12],[1,"\\n        "],[10,"h3"],[12],[1,[28,[32,1],["discourse_ai.tools.test_modal.result"],null]],[13],[1,"\\n        "],[10,0],[12],[1,[30,0,["testResult"]]],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[]],[[[1,"\\n    "],[8,[32,4],[[24,0,"btn-primary ai-tool-test-modal__run-button"]],[["@action","@label","@disabled"],[[30,0,["runTest"]],"discourse_ai.tools.test_modal.run",[30,0,["isLoading"]]]],null],[1,"\\n  "]],[]]]]]],["@closeModal","@model","param"],["each","-track-array","if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal.js",scope:()=>[r.default,u.i18n,o.on,i.fn,a.default],isStrictMode:!0}),this)}}e.default=h}),define("discourse/plugins/discourse-ai/discourse/components/modal/chat-modal-channel-summary",["exports","@glimmer/component","@glimmer/tracking","@ember/object","discourse/components/conditional-loading-section","discourse/components/d-modal","discourse/components/d-modal-cancel","discourse/lib/ajax","discourse/lib/ajax-error","discourse/select-kit/components/combo-box","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/ai-errors","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static{dt7948.g(this.prototype,"sinceHours",[s.tracked],function(){return null})}#jt=void dt7948.i(this,"sinceHours")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"summary",[s.tracked],function(){return null})}#At=void dt7948.i(this,"summary")
availableSummaries={}
sinceOptions=[1,3,6,12,24,72,168].map(e=>({name:(0,u.i18n)("discourse_ai.summarization.chat.since",{count:e}),value:e}))
get channelId(){return this.args.model.channelId}summarize(e){return this.sinceHours=e,this.loading=!0,this.availableSummaries[e]?(this.summary=this.availableSummaries[e],void(this.loading=!1)):(0,r.ajax)(`/discourse-ai/summarization/channels/${this.channelId}.json`,{type:"GET",data:{since:e}}).then(e=>{this.availableSummaries[this.sinceHours]=e.summary,this.summary=this.availableSummaries[this.sinceHours]}).catch(e=>{(0,c.isAiCreditLimitError)(e)?(0,c.popupAiCreditLimitError)(e):(0,l.popupAjaxError)(e)}).finally(()=>this.loading=!1)}static{dt7948.n(this.prototype,"summarize",[i.action])}static{(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"iCojcwcX",block:'[[[8,[32,0],[[24,0,"chat-modal-channel-summary"]],[["@closeModal","@title"],[[30,1],[28,[32,1],["discourse_ai.summarization.chat.title"],null]]],[["body","footer"],[[[[1,"\\n    "],[10,1],[12],[1,[28,[32,1],["discourse_ai.summarization.chat.description"],null]],[13],[1,"\\n    "],[8,[32,2],[[24,0,"summarization-since"]],[["@value","@content","@onChange","@valueProperty"],[[30,0,["sinceHours"]],[30,0,["sinceOptions"]],[30,0,["summarize"]],"value"]],null],[1,"\\n    "],[8,[32,3],null,[["@isLoading"],[[30,0,["loading"]]]],[["default"],[[[[1,"\\n      "],[10,2],[14,0,"summary-area"],[12],[1,[30,0,["summary"]]],[13],[1,"\\n    "]],[]]]]],[1,"\\n  "]],[]],[[[1,"\\n    "],[8,[32,4],null,[["@close"],[[30,1]]],null],[1,"\\n  "]],[]]]]]],["@closeModal"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/modal/chat-modal-channel-summary.js",scope:()=>[n.default,u.i18n,d.default,o.default,a.default],isStrictMode:!0}),this)}}e.default=h}),define("discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/runloop","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/later","discourse/lib/utilities","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/utilities","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static{dt7948.g(this.prototype,"info",[s.tracked],function(){return null})}#Lt=void dt7948.i(this,"info")
static{dt7948.g(this.prototype,"justCopiedText",[s.tracked],function(){return""})}#Et=void dt7948.i(this,"justCopiedText")
static{dt7948.g(this.prototype,"activeTab",[s.tracked],function(){return"request"})}#Rt=void dt7948.i(this,"activeTab")
constructor(){super(...arguments),(0,n.next)(()=>{this.loadApiRequestInfo()})}get htmlContext(){if(!this.info)return""
let e
try{if("request"!==this.activeTab)return this.formattedResponse(this.info.raw_response_payload)
e=JSON.parse(this.info.raw_request_payload)}catch{return this.info.raw_request_payload}return(0,h.jsonToHtml)(e)}formattedResponse(e){const t=e.split("\n").map(e=>(0,p.escapeExpression)(e)).join("<br>")
return(0,a.htmlSafe)(t)}copyRequest(){this.copy(this.info.raw_request_payload)}static{dt7948.n(this.prototype,"copyRequest",[o.action])}copyResponse(){this.copy(this.info.raw_response_payload)}static{dt7948.n(this.prototype,"copyResponse",[o.action])}async loadLog(e){try{await(0,d.ajax)(`/discourse-ai/ai-bot/show-debug-info/${e}.json`).then(e=>{this.info=e})}catch(t){(0,u.popupAjaxError)(t)}}prevLog(){this.loadLog(this.info.prev_log_id)}static{dt7948.n(this.prototype,"prevLog",[o.action])}nextLog(){this.loadLog(this.info.next_log_id)}static{dt7948.n(this.prototype,"nextLog",[o.action])}copy(e){(0,p.clipboardCopy)(e),this.justCopiedText=(0,m.i18n)("discourse_ai.ai_bot.conversation_shared"),(0,c.default)(()=>{this.justCopiedText=""},2e3)}loadApiRequestInfo(){(0,d.ajax)(`/discourse-ai/ai-bot/post/${this.args.model.id}/show-debug-info.json`).then(e=>{this.info=e}).catch(e=>{(0,u.popupAjaxError)(e)})}get requestActive(){return"request"===this.activeTab?"active":""}get responseActive(){return"response"===this.activeTab?"active":""}requestClicked(e){this.activeTab="request",e.preventDefault()}static{dt7948.n(this.prototype,"requestClicked",[o.action])}responseClicked(e){this.activeTab="response",e.preventDefault()}static{dt7948.n(this.prototype,"responseClicked",[o.action])}static{(0,g.setComponentTemplate)((0,_.createTemplateFactory)({id:"CcroiDBn",block:'[[[8,[32,0],[[24,0,"ai-debug-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n    "],[10,"ul"],[14,0,"nav nav-pills ai-debug-modal__nav"],[12],[1,"\\n      "],[10,"li"],[12],[11,3],[24,6,""],[16,0,[30,0,["requestActive"]]],[4,[32,2],["click",[30,0,["requestClicked"]]],null],[12],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.request"],null]],[13],[13],[1,"\\n      "],[10,"li"],[12],[11,3],[24,6,""],[16,0,[30,0,["responseActive"]]],[4,[32,2],["click",[30,0,["responseClicked"]]],null],[12],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.response"],null]],[13],[13],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"ai-debug-modal__tokens"],[12],[1,"\\n      "],[10,1],[14,0,"ai-debug-modal__tokens__count"],[12],[1,"\\n        "],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.request_tokens"],null]],[1,"\\n        "],[1,[30,0,["info","request_tokens"]]],[1,"\\n      "],[13],[1,"\\n      "],[10,1],[14,0,"ai-debug-modal__tokens__count"],[12],[1,"\\n        "],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.response_tokens"],null]],[1,"\\n        "],[1,[30,0,["info","response_tokens"]]],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["info","cache_read_tokens"]],[[[1,"        "],[10,1],[14,0,"ai-debug-modal__tokens__count"],[12],[1,"\\n          "],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.cache_read_tokens"],null]],[1,"\\n          "],[1,[30,0,["info","cache_read_tokens"]]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[41,[30,0,["info","cache_write_tokens"]],[[[1,"        "],[10,1],[14,0,"ai-debug-modal__tokens__count"],[12],[1,"\\n          "],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.cache_write_tokens"],null]],[1,"\\n          "],[1,[30,0,["info","cache_write_tokens"]]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n    "],[10,0],[14,0,"debug-ai-modal__preview"],[12],[1,"\\n      "],[1,[30,0,["htmlContext"]]],[1,"\\n    "],[13],[1,"\\n  "]],[]],[[[1,"\\n    "],[8,[32,3],[[24,0,"btn confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyRequest"]],"discourse_ai.ai_bot.debug_ai_modal.copy_request"]],null],[1,"\\n    "],[8,[32,3],[[24,0,"btn confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyResponse"]],"discourse_ai.ai_bot.debug_ai_modal.copy_response"]],null],[1,"\\n"],[41,[30,0,["info","prev_log_id"]],[[[1,"      "],[8,[32,3],[[24,0,"btn"]],[["@icon","@action","@label"],["angles-left",[30,0,["prevLog"]],"discourse_ai.ai_bot.debug_ai_modal.previous_log"]],null],[1,"\\n"]],[]],null],[41,[30,0,["info","next_log_id"]],[[[1,"      "],[8,[32,3],[[24,0,"btn"]],[["@icon","@action","@label"],["angles-right",[30,0,["nextLog"]],"discourse_ai.ai_bot.debug_ai_modal.next_log"]],null],[1,"\\n"]],[]],null],[1,"    "],[10,1],[14,0,"ai-debut-modal__just-copied"],[12],[1,[30,0,["justCopiedText"]]],[13],[1,"\\n  "]],[]]]]]],["@closeModal"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal.js",scope:()=>[l.default,m.i18n,i.on,r.default],isStrictMode:!0}),this)}}e.default=f}),define("discourse/plugins/discourse-ai/discourse/components/modal/diff-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/service","@ember/template","discourse/components/cook-text","discourse/components/d-button","discourse/components/d-modal","discourse/helpers/concat-class","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/decorators","discourse/lib/utilities","discourse/truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/ai-errors","discourse/plugins/discourse-ai/discourse/lib/diff-streamer","discourse/plugins/discourse-ai/discourse/lib/smooth-streamer","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class k extends t.default{static{dt7948.g(this.prototype,"messageBus",[a.service])}#we=void dt7948.i(this,"messageBus")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"finalResult",[s.tracked],function(){return""})}#Ot=void dt7948.i(this,"finalResult")
static{dt7948.g(this.prototype,"escapedSelectedText",[s.tracked],function(){return(0,g.escapeExpression)(this.args.model.selectedText)})}#Ft=void dt7948.i(this,"escapedSelectedText")
static{dt7948.g(this.prototype,"diffStreamer",[s.tracked],function(){return new y.default(this.args.model.selectedText)})}#It=void dt7948.i(this,"diffStreamer")
static{dt7948.g(this.prototype,"suggestion",[s.tracked],function(){return""})}#Te=void dt7948.i(this,"suggestion")
static{dt7948.g(this.prototype,"smoothStreamer",[s.tracked],function(){return new v.default(()=>this.suggestion,e=>this.suggestion=e)})}#Re=void dt7948.i(this,"smoothStreamer")
constructor(){super(...arguments),this.suggestChanges()}get diffResult(){return this.loading?this.escapedSelectedText:this.diffStreamer.diff?.length>0?this.diffStreamer.diff:this.escapedSelectedText}get smoothStreamerResult(){return this.loading?this.escapedSelectedText:this.smoothStreamer.renderedText}get isStreaming(){return this.args.model.showResultAsDiff?!this.diffStreamer.isDone:this.smoothStreamer.isStreaming}get primaryBtnLabel(){return this.loading?(0,f.i18n)("discourse_ai.ai_helper.context_menu.loading"):(0,f.i18n)("discourse_ai.ai_helper.context_menu.confirm")}get primaryBtnDisabled(){return this.loading||this.isStreaming}set progressChannel(e){this._progressChannel&&this.messageBus.unsubscribe(this._progressChannel,this.updateResult),this._progressChannel=e,this.subscribe()}subscribe(){this.messageBus.subscribe(this._progressChannel,this.updateResult,0)}cleanup(){this.#Dt(),this._progressChannel&&this.messageBus.unsubscribe(this._progressChannel,this.updateResult)}static{dt7948.n(this.prototype,"cleanup",[h.bind])}updateResult(e){if((0,b.isAiCreditLimitError)(e))return this.loading=!1,this.cleanupAndClose(),void(0,b.popupAiCreditLimitError)(e)
this.loading=!1,e.done&&(this.finalResult=e.result,this.loading=!1),this.args.model.showResultAsDiff?this.diffStreamer.updateResult(e,"result"):this.smoothStreamer.updateResult(e,"result")}static{dt7948.n(this.prototype,"updateResult",[i.action])}async suggestChanges(){this.#Dt()
try{this.loading=!0
const e=await(0,p.ajax)("/discourse-ai/ai-helper/stream_suggestion",{method:"POST",data:{location:"composer",mode:this.args.model.mode,text:this.args.model.selectedText,custom_prompt:this.args.model.customPromptValue,force_default_locale:!0,client_id:this.messageBus.clientId}})
this.progressChannel=e.progress_channel}catch(e){(0,b.isAiCreditLimitError)(e)?(this.cleanupAndClose(),(0,b.popupAiCreditLimitError)(e)):(0,m.popupAjaxError)(e)}}static{dt7948.n(this.prototype,"suggestChanges",[i.action])}triggerConfirmChanges(){this.args.closeModal(),this.suggestion&&this.args.model.toolbarEvent.replaceText(this.args.model.selectedText,this.suggestion)
const e=this.finalResult?.length>0?this.finalResult:this.diffStreamer.suggestion
this.args.model.showResultAsDiff&&e&&this.args.model.toolbarEvent.replaceText(this.args.model.selectedText,e)}static{dt7948.n(this.prototype,"triggerConfirmChanges",[i.action])}cleanupAndClose(){this.cleanup(),this.#Dt(),this.loading=!1,this.args.closeModal()}static{dt7948.n(this.prototype,"cleanupAndClose",[i.action])}focusConfirmBtn(e){this.primaryBtnDisabled||e.focus()}static{dt7948.n(this.prototype,"focusConfirmBtn",[i.action])}#Dt(){this.suggestion="",this.finalResult="",this.smoothStreamer.resetStreaming(),this.diffStreamer.reset()}static{(0,S.setComponentTemplate)((0,x.createTemplateFactory)({id:"gejGP+fR",block:'[[[8,[32,0],[[24,0,"composer-ai-helper-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_helper.context_menu.changes"],null],[30,0,["cleanupAndClose"]]]],[["body","footer"],[[[[1,"\\n    "],[11,0],[24,0,"text-preview"],[4,[32,2],[[30,0,["cleanup"]]],null],[12],[1,"\\n      "],[10,0],[15,0,[28,[32,3],["composer-ai-helper-modal__suggestion","streamable-content",[52,[30,0,["isStreaming"]],"streaming"],[52,[30,1,["showResultAsDiff"]],"inline-diff"],[52,[30,0,["diffStreamer","isThinking"]],"thinking"],[52,[30,0,["loading"]],"composer-ai-helper-modal__loading"]],null]],[12],[41,[30,1,["showResultAsDiff"]],[[[10,1],[14,0,"diff-inner"],[12],[1,[28,[32,4],[[30,0,["diffResult"]]],null]],[13],[1,"\\n"]],[]],[[[41,[28,[32,5],[[30,0,["loading"]],[30,0,["smoothStreamer","isStreaming"]]],null],[[[1,"            "],[8,[32,6],[[24,0,"cooked"]],[["@rawText"],[[30,0,["smoothStreamerResult"]]]],null],[1,"\\n"]],[]],[[[1,"            "],[10,0],[14,0,"composer-ai-helper-modal__old-value"],[12],[1,[30,0,["escapedSelectedText"]]],[13],[1,"\\n            "],[10,0],[14,0,"composer-ai-helper-modal__new-value"],[12],[1,"\\n              "],[8,[32,6],[[24,0,"cooked"]],[["@rawText"],[[30,0,["smoothStreamerResult"]]]],null],[1,"\\n            "],[13],[1,"\\n"]],[]]]],[]]],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],[]],[[[1,"\\n    "],[8,[32,7],[[24,0,"btn-primary confirm"],[4,[32,8],[[30,0,["focusConfirmBtn"]],[30,0,["isStreaming"]]],null]],[["@disabled","@action","@translatedLabel"],[[30,0,["primaryBtnDisabled"]],[30,0,["triggerConfirmChanges"]],[30,0,["primaryBtnLabel"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["loading"]],[[[1,"        "],[8,[32,9],null,[["@loading"],[[30,0,["loading"]]]],null],[1,"\\n"]],[]],null],[1,"    "]],[]]]]],[1,"\\n    "],[8,[32,7],[[24,0,"btn-flat discard"]],[["@action","@label"],[[30,0,["cleanupAndClose"]],"discourse_ai.ai_helper.context_menu.discard"]],null],[1,"\\n    "],[8,[32,7],[[24,0,"regenerate"]],[["@icon","@action","@label"],["arrows-rotate",[30,0,["suggestChanges"]],"discourse_ai.ai_helper.context_menu.regen"]],null],[1,"\\n  "]],[]]]]]],["@model"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/modal/diff-modal.js",scope:()=>[u.default,f.i18n,n.default,c.default,r.htmlSafe,_.or,l.default,d.default,o.default,w.default],isStrictMode:!0}),this)}}e.default=k}),define("discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/service","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/get-url","discourse/lib/utilities","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static{dt7948.g(this.prototype,"toasts",[n.service])}#U=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"shareKey",[s.tracked],function(){return""})}#Nt=void dt7948.i(this,"shareKey")
constructor(){super(...arguments),this.shareKey=this.args.model.share_key}get htmlContext(){let e=[]
return this.args.model.context.forEach(t=>{e.push(`<p><b>${t.username}:</b></p>`),e.push(t.cooked)}),(0,a.htmlSafe)(e.join("\n"))}async generateShareURL(){try{const e=await(0,d.ajax)("/discourse-ai/ai-bot/shared-ai-conversations",{type:"POST",data:{topic_id:this.args.model.topic_id}}),t=(0,c.getAbsoluteURL)(`/discourse-ai/ai-bot/shared-ai-conversations/${e.share_key}`)
return this.shareKey=e.share_key,new Blob([t],{type:"text/plain"})}catch(e){return void(0,u.popupAjaxError)(e)}}get primaryLabel(){return this.shareKey?"discourse_ai.ai_bot.share_full_topic_modal.update":"discourse_ai.ai_bot.share_full_topic_modal.share"}async deleteLink(){try{await(0,d.ajax)(`/discourse-ai/ai-bot/shared-ai-conversations/${this.shareKey}.json`,{type:"DELETE"}),this.shareKey=null}catch(e){(0,u.popupAjaxError)(e)}}static{dt7948.n(this.prototype,"deleteLink",[o.action])}async share(){await(0,p.clipboardCopyAsync)(this.generateShareURL.bind(this)),this.toasts.success({duration:"short",data:{message:(0,m.i18n)("discourse_ai.ai_bot.conversation_shared")}})}static{dt7948.n(this.prototype,"share",[o.action])}async maybeCopyEmbed(e){if(!e.target.classList.contains("copy-embed"))return!0
e.stopPropagation(),e.preventDefault()
let t=""
e.target.dataset.artifactVersion&&(t=`data-ai-artifact-version="${e.target.dataset.artifactVersion}"`)
const s=`<div class="ai-artifact" ${t} data-ai-artifact-id="${e.target.dataset.artifactId}"></div>`,i=new Promise(e=>{e(s)})
await(0,p.clipboardCopyAsync)(()=>i),this.toasts.success({duration:"short",data:{message:(0,m.i18n)("discourse_ai.ai_bot.embed_copied")}})}static{dt7948.n(this.prototype,"maybeCopyEmbed",[o.action])}static{(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"frDL5ty7",block:'[[[8,[32,0],[[24,0,"ai-share-full-topic-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.share_full_topic_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n"],[1,"    "],[11,0],[24,0,"ai-share-full-topic-modal__body"],[4,[32,2],["click",[30,0,["maybeCopyEmbed"]]],null],[12],[1,"\\n      "],[1,[30,0,["htmlContext"]]],[1,"\\n    "],[13],[1,"\\n"],[1,"  "]],[]],[[[1,"\\n    "],[8,[32,3],[[24,0,"btn-primary confirm"]],[["@icon","@action","@label"],["copy",[30,0,["share"]],[30,0,["primaryLabel"]]]],null],[1,"\\n"],[41,[30,0,["shareKey"]],[[[1,"      "],[8,[32,3],[[24,0,"btn-danger"]],[["@icon","@action","@label"],["far-trash-can",[30,0,["deleteLink"]],"discourse_ai.ai_bot.share_full_topic_modal.delete"]],null],[1,"\\n"]],[]],null],[1,"  "]],[]]]]]],["@closeModal"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal.js",scope:()=>[l.default,m.i18n,i.on,r.default],isStrictMode:!0}),this)}}e.default=_}),define("discourse/plugins/discourse-ai/discourse/components/modal/share-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/modifier","@ember/object","@ember/service","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse/lib/later","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/lib/copy-conversation","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static{dt7948.g(this.prototype,"modal",[a.service])}#O=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"currentUser",[a.service])}#A=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"contextValue",[s.tracked],function(){return 1})}#Ut=void dt7948.i(this,"contextValue")
static{dt7948.g(this.prototype,"htmlContext",[s.tracked],function(){return""})}#qt=void dt7948.i(this,"htmlContext")
static{dt7948.g(this.prototype,"maxContext",[s.tracked],function(){return 0})}#Bt=void dt7948.i(this,"maxContext")
static{dt7948.g(this.prototype,"allPosts",[s.tracked],function(){return[]})}#zt=void dt7948.i(this,"allPosts")
static{dt7948.g(this.prototype,"justCopiedText",[s.tracked],function(){return""})}#Et=void dt7948.i(this,"justCopiedText")
constructor(){super(...arguments)
const e=this.args.model.topic.get("postStream")
let t=[]
for(let s=1;s<=this.args.model.post_number;s++)t.push(s)
this.allPosts=t.map(t=>{let s=e.findPostIdForPostNumber(t)
if(s)return e.findLoadedPost(s)}).filter(e=>e),this.maxContext=this.allPosts.length/2,this.contextValue=1,this.updateHtmlContext()}updateHtmlContext(){let e=[]
for(let t=this.allPosts.length-2*this.contextValue;t<this.allPosts.length;t++){const s=this.allPosts[t]
e.push(`<p><b>${s.username}:</b></p>`),e.push(s.cooked)}this.htmlContext=(0,r.htmlSafe)(e.join("\n"))}static{dt7948.n(this.prototype,"updateHtmlContext",[n.action])}async copyContext(){const e=this.allPosts[this.allPosts.length-2*this.contextValue].post_number,t=this.args.model.post_number
await(0,m.default)(this.args.model.topic,e,t),this.justCopiedText=(0,c.i18n)("discourse_ai.ai_bot.conversation_shared"),(0,u.default)(()=>{this.justCopiedText=""},2e3)}static{dt7948.n(this.prototype,"copyContext",[n.action])}shareConversationModal(e){return e?.preventDefault(),this.args.closeModal(),(0,p.showShareConversationModal)(this.modal,this.args.model.topic_id),!1}static{dt7948.n(this.prototype,"shareConversationModal",[n.action])}static{(0,i.setComponentTemplate)((0,h.createTemplateFactory)({id:"lEjTT0/V",block:'[[[8,[32,0],[[24,0,"ai-share-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.share_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n    "],[10,0],[14,0,"ai-share-modal__preview"],[12],[1,"\\n      "],[1,[30,0,["htmlContext"]]],[1,"\\n    "],[13],[1,"\\n  "]],[]],[[[1,"\\n    "],[10,0],[14,0,"ai-share-modal__slider"],[12],[1,"\\n      "],[8,[32,2],[[24,"min","1"],[16,"max",[30,0,["maxContext"]]],[4,[32,3],["change",[30,0,["updateHtmlContext"]]],null]],[["@type","@value"],["range",[30,0,["contextValue"]]]],null],[1,"\\n      "],[10,0],[14,0,"ai-share-modal__context"],[12],[1,"\\n        "],[1,[28,[32,1],["discourse_ai.ai_bot.share_modal.context"],null]],[1,"\\n        "],[1,[30,0,["contextValue"]]],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n    "],[8,[32,4],[[24,0,"btn-primary confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyContext"]],"discourse_ai.ai_bot.share_modal.copy"]],null],[1,"\\n    "],[10,1],[14,0,"ai-share-modal__just-copied"],[12],[1,[30,0,["justCopiedText"]]],[13],[1,"\\n"],[41,[30,0,["currentUser","can_share_ai_bot_conversations"]],[[[1,"      "],[11,3],[24,6,""],[4,[32,3],["click",[30,0,["shareConversationModal"]]],null],[12],[1,"\\n        "],[10,1],[14,0,"ai-share-modal__share-tip"],[12],[1,"\\n          "],[1,[28,[32,1],["discourse_ai.ai_bot.share_modal.share_tip"],null]],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[]]]]]],["@closeModal"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/modal/share-modal.js",scope:()=>[d.default,c.i18n,i.Input,o.on,l.default],isStrictMode:!0}),this)}}e.default=g}),define("discourse/plugins/discourse-ai/discourse/components/modal/spam-test-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/components/d-modal","discourse/helpers/with-event-value","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static{dt7948.g(this.prototype,"testResult",[s.tracked])}#K=void dt7948.i(this,"testResult")
static{dt7948.g(this.prototype,"isLoading",[s.tracked],function(){return!1})}#Mt=void dt7948.i(this,"isLoading")
static{dt7948.g(this.prototype,"postUrl",[s.tracked],function(){return""})}#Vt=void dt7948.i(this,"postUrl")
static{dt7948.g(this.prototype,"isSpam",[s.tracked])}#Ht=void dt7948.i(this,"isSpam")
static{dt7948.g(this.prototype,"reason",[s.tracked])}#$t=void dt7948.i(this,"reason")
static{dt7948.g(this.prototype,"llmName",[s.tracked])}#Gt=void dt7948.i(this,"llmName")
static{dt7948.g(this.prototype,"systemPrompt",[s.tracked])}#Wt=void dt7948.i(this,"systemPrompt")
static{dt7948.g(this.prototype,"sentMessage",[s.tracked])}#Kt=void dt7948.i(this,"sentMessage")
static{dt7948.g(this.prototype,"scanHistory",[s.tracked])}#Yt=void dt7948.i(this,"scanHistory")
async runTest(){this.isLoading=!0
try{const e=await(0,d.ajax)("/admin/plugins/discourse-ai/ai-spam/test.json",{type:"POST",data:{post_url:this.postUrl,custom_instructions:this.args.model.customInstructions,llm_id:this.args.model.llmId}})
this.isSpam=e.is_spam,this.testResult=e.is_spam?(0,c.i18n)("discourse_ai.spam.test_modal.spam"):(0,c.i18n)("discourse_ai.spam.test_modal.not_spam"),this.reason=e.reason,this.llmName=e.llm_name,this.systemPrompt=e.system_prompt,this.sentMessage=e.sent_message,this.scanHistory=e.scan_history}catch(e){(0,u.popupAjaxError)(e)}finally{this.isLoading=!1}}static{dt7948.n(this.prototype,"runTest",[n.action])}static{(0,m.setComponentTemplate)((0,h.createTemplateFactory)({id:"U8BdmtaA",block:'[[[8,[32,0],[[24,0,"spam-test-modal"]],[["@title","@closeModal","@bodyClass"],[[28,[32,1],["discourse_ai.spam.test_modal.title"],null],[30,1],"spam-test-modal__body"]],[["body","footer"],[[[[1,"\\n    "],[10,0],[14,0,"control-group"],[12],[1,"\\n      "],[10,"label"],[12],[1,[28,[32,1],["discourse_ai.spam.test_modal.post_url_label"],null]],[13],[1,"\\n      "],[11,"input"],[16,"placeholder",[28,[32,1],["discourse_ai.spam.test_modal.post_url_placeholder"],null]],[24,4,"text"],[4,[32,2],["input",[28,[32,3],[[28,[32,4],[[28,[31,0],[[30,0,["postUrl"]]],null]],null]],null]],null],[12],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[41,[30,0,["testResult"]],[[[1,"      "],[10,0],[14,0,"spam-test-modal__results"],[12],[1,"\\n        "],[10,0],[15,0,[29,["spam-test-modal__verdict\\n            ",[52,[30,0,["isSpam"]],"is-spam","not-spam"]]]],[12],[1,"\\n          "],[1,[30,0,["testResult"]]],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[30,0,["reason"]],[[[1,"          "],[10,0],[14,0,"spam-test-modal__info-box spam-test-modal__info-box--reason"],[12],[1,"\\n            "],[10,"h4"],[14,0,"spam-test-modal__info-box-title"],[12],[1,[28,[32,1],["discourse_ai.spam.test_modal.reason"],null]],[13],[1,"\\n            "],[10,0],[14,0,"spam-test-modal__info-box-content"],[12],[1,"\\n              "],[10,2],[12],[1,[30,0,["reason"]]],[13],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[10,0],[14,0,"spam-test-modal__info-grid"],[12],[1,"\\n"],[41,[30,0,["llmName"]],[[[1,"            "],[10,0],[14,0,"spam-test-modal__info-box spam-test-modal__info-box--llm"],[12],[1,"\\n              "],[10,"h4"],[14,0,"spam-test-modal__info-box-title"],[12],[1,[28,[32,1],["discourse_ai.spam.test_modal.llm"],null]],[13],[1,"\\n              "],[10,0],[14,0,"spam-test-modal__info-box-content"],[12],[1,"\\n                "],[1,[30,0,["llmName"]]],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["scanHistory"]],[[[1,"            "],[10,0],[14,0,"spam-test-modal__info-box spam-test-modal__info-box--history"],[12],[1,"\\n              "],[10,"h4"],[14,0,"spam-test-modal__info-box-title"],[12],[1,[28,[32,1],["discourse_ai.spam.test_modal.scan_history"],null]],[13],[1,"\\n              "],[10,0],[14,0,"spam-test-modal__info-box-content"],[12],[1,"\\n                "],[10,"pre"],[12],[1,[30,0,["scanHistory"]]],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n\\n"],[41,[30,0,["sentMessage"]],[[[1,"          "],[10,0],[14,0,"spam-test-modal__info-box spam-test-modal__info-box--message"],[12],[1,"\\n            "],[10,"h4"],[14,0,"spam-test-modal__info-box-title"],[12],[1,[28,[32,1],["discourse_ai.spam.test_modal.sent_message"],null]],[13],[1,"\\n            "],[10,0],[14,0,"spam-test-modal__info-box-content"],[12],[1,"\\n              "],[10,"pre"],[12],[1,[30,0,["sentMessage"]]],[13],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["systemPrompt"]],[[[1,"          "],[10,0],[14,0,"spam-test-modal__info-box spam-test-modal__info-box--prompt"],[12],[1,"\\n            "],[10,"h4"],[14,0,"spam-test-modal__info-box-title"],[12],[1,[28,[32,1],["discourse_ai.spam.test_modal.system_prompt"],null]],[13],[1,"\\n            "],[10,0],[14,0,"spam-test-modal__info-box-content"],[12],[1,"\\n              "],[10,"pre"],[12],[1,[30,0,["systemPrompt"]]],[13],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[]],[[[1,"\\n    "],[8,[32,5],[[24,0,"btn-primary spam-test-modal__run-button"]],[["@action","@label","@disabled"],[[30,0,["runTest"]],"discourse_ai.spam.test_modal.run",[30,0,["isLoading"]]]],[["default"],[[[[1,"\\n      "],[8,[32,6],null,[["@loading"],[[30,0,["isLoading"]]]],null],[1,"\\n    "]],[]]]]],[1,"\\n  "]],[]]]]]],["@closeModal"],["mut","if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/modal/spam-test-modal.js",scope:()=>[r.default,c.i18n,o.on,l.default,i.fn,a.default,p.default],isStrictMode:!0}),this)}}e.default=g}),define("discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions",["exports","@glimmer/component","@glimmer/tracking","@ember/object","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/d-modal","discourse/components/d-modal-cancel","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/ai-errors","discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"selectedImages",[s.tracked],function(){return[]})}#Jt=void dt7948.i(this,"selectedImages")
static{dt7948.g(this.prototype,"thumbnails",[s.tracked],function(){return null})}#Qt=void dt7948.i(this,"thumbnails")
constructor(){super(...arguments),this.findThumbnails()}get isDisabled(){return 0===this.selectedImages.length}async findThumbnails(){this.loading=!0
try{const e=await(0,l.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:this.args.model.mode,text:this.args.model.selectedText,force_default_locale:!0}})
this.thumbnails=e.thumbnails}catch(e){(0,c.isAiCreditLimitError)(e)?(this.args.closeModal(),(0,c.popupAiCreditLimitError)(e)):(0,d.popupAjaxError)(e)}finally{this.loading=!1}}addSelection(e){const t=`![${e.original_filename}|${e.width}x${e.height}](${e.short_url})`
this.selectedImages=[...this.selectedImages,t]}static{dt7948.n(this.prototype,"addSelection",[i.action])}removeSelection(e){const t=`![${e.original_filename}|${e.width}x${e.height}](${e.short_url})`
this.selectedImages=this.selectedImages.filter(e=>{if(e!==t)return e})}static{dt7948.n(this.prototype,"removeSelection",[i.action])}appendSelectedImages(){const e="\n\n"+this.selectedImages.join("\n"),t=document.querySelector(".d-editor-input")
t.setSelectionRange(t.value.length,t.value.length),t.focus(),document.execCommand("insertText",!1,e),this.args.closeModal()}static{dt7948.n(this.prototype,"appendSelectedImages",[i.action])}regenerateThumbnails(){this.selectedImages=[],this.thumbnails=null,this.findThumbnails()}static{dt7948.n(this.prototype,"regenerateThumbnails",[i.action])}static{(0,m.setComponentTemplate)((0,h.createTemplateFactory)({id:"JBtnWdta",block:'[[[8,[32,0],[[24,0,"thumbnail-suggestions-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_helper.thumbnail_suggestions.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n    "],[8,[32,2],null,[["@condition"],[[30,0,["loading"]]]],[["default"],[[[[1,"\\n      "],[10,0],[14,0,"ai-thumbnail-suggestions"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["thumbnails"]]],null]],null],null,[[[1,"          "],[8,[32,3],null,[["@thumbnail","@addSelection","@removeSelection"],[[30,2],[30,0,["addSelection"]],[30,0,["removeSelection"]]]],null],[1,"\\n"]],[2]],null],[1,"      "],[13],[1,"\\n    "]],[]]]]],[1,"\\n  "]],[]],[[[1,"\\n    "],[8,[32,4],[[24,0,"btn-primary create"]],[["@action","@label","@disabled"],[[30,0,["appendSelectedImages"]],"save",[30,0,["isDisabled"]]]],null],[1,"\\n    "],[8,[32,5],null,[["@close"],[[30,1]]],null],[1,"\\n    "],[8,[32,4],[[24,0,"regenerate"]],[["@action","@icon","@label","@disabled"],[[30,0,["regenerateThumbnails"]],"arrows-rotate","discourse_ai.ai_helper.thumbnail_suggestions.try_again",[30,0,["loading"]]]],null],[1,"\\n  "]],[]]]]]],["@closeModal","thumbnail"],["each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions.js",scope:()=>[a.default,u.i18n,o.default,p.default,n.default,r.default],isStrictMode:!0}),this)}}e.default=g}),define("discourse/plugins/discourse-ai/discourse/components/model-accuracies",["exports","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,s.setComponentTemplate)((0,i.createTemplateFactory)({id:"UFeJQqNH",block:'[[[41,[30,1],[[[1,"  "],[10,"table"],[14,0,"reviewable-scores"],[12],[1,"\\n    "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[30,1]],null],null,[[[1,"        "],[10,"tr"],[12],[1,"\\n          "],[10,"td"],[14,"colspan","4"],[12],[1,[28,[32,0],["discourse_ai.reviewables.model_used"],null]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","3"],[12],[1,[30,3]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","4"],[12],[1,[28,[32,0],["discourse_ai.reviewables.accuracy"],null]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","3"],[12],[1,[30,2]],[1,"%"],[13],[1,"\\n        "],[13],[1,"\\n"]],[2,3]],null],[1,"    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],["@accuracies","acc","model"],["if","each","-each-in"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/model-accuracies.js",scope:()=>[t.i18n],isStrictMode:!0}),(0,o.default)(void 0,"model-accuracies:ModelAccuracies"))
e.default=n}),define("discourse/plugins/discourse-ai/discourse/components/post-menu/ai-cancel-streaming-button",["exports","@glimmer/component","@ember/object","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{async cancelStreaming(){const e=this.args.post
try{await(0,o.ajax)(`/discourse-ai/ai-bot/post/${e.id}/stop-streaming`,{type:"POST"}),document.querySelector(`#post_${e.post_number}`).classList.remove("streaming")}catch(t){(0,n.popupAjaxError)(t)}}static{dt7948.n(this.prototype,"cancelStreaming",[s.action])}static{(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"Ojb3h+Ni",block:'[[[8,[32,0],[[24,0,"post-action-menu__ai-cancel-streaming cancel-streaming"],[17,1]],[["@action","@icon","@title"],[[30,0,["cancelStreaming"]],"pause","discourse_ai.ai_bot.cancel_streaming"]],null]],["&attrs"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/post-menu/ai-cancel-streaming-button.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/components/post-menu/ai-debug-button",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static shouldRender(e){return(0,n.isPostFromAiBot)(e.post,e.state.currentUser)}static{dt7948.g(this.prototype,"modal",[i.service])}#O=void dt7948.i(this,"modal")
debugAiResponse(){this.modal.show(a.default,{model:this.args.post})}static{dt7948.n(this.prototype,"debugAiResponse",[s.action])}static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"OKy13k7U",block:'[[[8,[32,0],[[24,0,"post-action-menu__debug-ai"],[17,1]],[["@action","@icon","@title"],[[30,0,["debugAiResponse"]],"info","discourse_ai.ai_bot.debug_ai"]],null]],["&attrs"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/post-menu/ai-debug-button.js",scope:()=>[o.default],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/discourse-ai/discourse/components/post-menu/ai-retry-streaming-button",["exports","@glimmer/component","@glimmer/tracking","@ember/object","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static{dt7948.g(this.prototype,"retrying",[s.tracked],function(){return!1})}#Xt=void dt7948.i(this,"retrying")
async retry(){if(!this.retrying){this.retrying=!0
try{await(0,n.ajax)(`/discourse-ai/ai-bot/post/${this.args.post.id}/retry`,{type:"POST"})}catch(e){(0,a.popupAjaxError)(e)}finally{this.retrying=!1}}}static{dt7948.n(this.prototype,"retry",[i.action])}static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"/ULKgb6H",block:'[[[8,[32,0],[[24,0,"post-action-menu__ai-retry-streaming ai-retry-streaming"],[17,1]],[["@action","@icon","@title","@disabled"],[[30,0,["retry"]],[52,[30,0,["retrying"]],"spinner","arrow-rotate-right"],"discourse_ai.ai_bot.try_again",[30,0,["retrying"]]]],null]],["&attrs"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/post-menu/ai-retry-streaming-button.js",scope:()=>[o.default],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/discourse-ai/discourse/components/post-menu/ai-share-button",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/lib/copy-conversation","discourse/plugins/discourse-ai/discourse/components/modal/share-modal","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static shouldRender(e){return(0,n.isPostFromAiBot)(e.post,e.state.currentUser)}static{dt7948.g(this.prototype,"modal",[i.service])}#O=void dt7948.i(this,"modal")
async shareAiResponse(){const e=this.args.post
e.post_number<=4?(await(0,a.default)(e.topic,1,e.post_number),this.args.showFeedback("discourse_ai.ai_bot.conversation_shared")):this.modal.show(r.default,{model:e})}static{dt7948.n(this.prototype,"shareAiResponse",[s.action])}static{(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"91QN/QYI",block:'[[[8,[32,0],[[24,0,"post-action-menu__share-ai"],[17,1]],[["@action","@icon","@title"],[[30,0,["shareAiResponse"]],"far-copy","discourse_ai.ai_bot.share"]],null]],["&attrs"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/post-menu/ai-share-button.js",scope:()=>[o.default],isStrictMode:!0}),this)}}e.default=u}),define("discourse/plugins/discourse-ai/discourse/components/post/ai-persona-flair",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e){return(0,s.isGPTBot)(e.post.user)}static{(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"50uzhI5k",block:'[[[10,1],[14,0,"persona-flair"],[12],[1,"\\n  "],[1,[30,1,["post","topic","ai_persona_name"]]],[1,"\\n"],[13]],["@outletArgs"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/post/ai-persona-flair.js",isStrictMode:!0}),this)}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/components/post/meta-data/ai-cancel-streaming",["exports","@glimmer/component","@ember/object","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{async cancelStreaming(){const e=this.args.post
try{await(0,o.ajax)(`/discourse-ai/ai-bot/post/${e.id}/stop-streaming`,{type:"POST"}),document.querySelector(`#post_${e.post_number}`).classList.remove("streaming")}catch(t){(0,n.popupAjaxError)(t)}}static{dt7948.n(this.prototype,"cancelStreaming",[s.action])}static{(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"3+a10o8X",block:'[[[10,0],[14,0,"post-info ai-cancel-streaming-container"],[12],[1,"\\n  "],[8,[32,0],[[24,0,"btn-transparent ai-cancel-streaming"]],[["@action","@icon","@label"],[[30,0,["cancelStreaming"]],"pause","discourse_ai.ai_bot.cancel_streaming"]],null],[1,"\\n"],[13]],[],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/post/meta-data/ai-cancel-streaming.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/components/rag-options-fk",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-llm-selector","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static{dt7948.g(this.prototype,"showIndexingOptions",[s.tracked],function(){return!1})}#Zt=void dt7948.i(this,"showIndexingOptions")
toggleIndexingOptions(e){this.showIndexingOptions=!this.showIndexingOptions,e.preventDefault(),e.stopPropagation()}static{dt7948.n(this.prototype,"toggleIndexingOptions",[o.action])}get indexingOptionsText(){return this.showIndexingOptions?(0,n.i18n)("discourse_ai.rag.options.hide_indexing_options"):(0,n.i18n)("discourse_ai.rag.options.show_indexing_options")}get visionLlms(){return this.args.llms.filter(e=>e.vision_enabled)}static{(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"qAhkfLv+",block:'[[[41,[30,1,["rag_uploads"]],[[[1,"  "],[11,3],[24,6,"#"],[24,0,"rag-options__indexing-options"],[4,[32,0],["click",[30,0,["toggleIndexingOptions"]]],null],[12],[1,[30,0,["indexingOptionsText"]]],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showIndexingOptions"]],[[[1,"  "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_chunk_tokens",[28,[32,1],["discourse_ai.rag.options.rag_chunk_tokens"],null],[28,[32,1],["discourse_ai.rag.options.rag_chunk_tokens_help"],null],"large"]],[["default"],[[[[1,"\\n    "],[8,[30,3,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n  "]],[3]]]]],[1,"\\n\\n  "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_chunk_overlap_tokens",[28,[32,1],["discourse_ai.rag.options.rag_chunk_tokens"],null],[28,[32,1],["discourse_ai.rag.options.rag_chunk_overlap_tokens_help"],null],"large"]],[["default"],[[[[1,"\\n    "],[8,[30,4,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n  "]],[4]]]]],[1,"\\n\\n"],[41,[30,5],[[[1,"    "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_llm_model_id",[28,[32,1],["discourse_ai.rag.options.rag_llm_model"],null],[28,[32,1],["discourse_ai.rag.options.rag_llm_model_help"],null],"large"]],[["default"],[[[[1,"\\n      "],[8,[30,6,["Custom"]],null,null,[["default"],[[[[1,"\\n        "],[8,[32,2],[[24,0,"ai-persona-editor__llms"]],[["@value","@llms","@onChange"],[[30,6,["value"]],[30,0,["visionLlms"]],[30,6,["set"]]]],null],[1,"\\n      "]],[]]]]],[1,"\\n    "]],[6]]]]],[1,"\\n"]],[]],null],[1,"  "],[18,7,null],[1,"\\n"]],[]],null]],["@data","@form","field","field","@allowImages","field","&default"],["if","yield"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/rag-options-fk.js",scope:()=>[i.on,n.i18n,a.default],isStrictMode:!0}),this)}}e.default=d}),define("discourse/plugins/discourse-ai/discourse/components/rag-upload-progress",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","discourse/helpers/d-icon","discourse/lib/decorators","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static{dt7948.g(this.prototype,"messageBus",[n.service])}#we=void dt7948.i(this,"messageBus")
static{dt7948.g(this.prototype,"updatedProgress",[s.tracked],function(){return null})}#es=void dt7948.i(this,"updatedProgress")
willDestroy(){super.willDestroy(...arguments),this.messageBus.unsubscribe(`/discourse-ai/rag/${this.args.upload.id}`)}trackProgress(){this.messageBus.subscribe(`/discourse-ai/rag/${this.args.upload.id}`,this.onIndexingUpdate)}static{dt7948.n(this.prototype,"trackProgress",[i.action])}onIndexingUpdate(e){(!this.updatedProgress||0===this.updatedProgress.left||this.updatedProgress.left>e.left||e.total===e.indexed)&&(this.updatedProgress=e)}static{dt7948.n(this.prototype,"onIndexingUpdate",[r.bind])}get calculateProgress(){return 0===this.progress.total?0:Math.ceil(100*this.progress.indexed/this.progress.total)}get fullyIndexed(){return this.progress&&0!==this.progress.total&&0===this.progress.left}get progress(){return this.updatedProgress?this.updatedProgress:this.args.ragIndexingStatuses?this.args.ragIndexingStatuses[this.args.upload.id]:[]}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"jn4kfYzg",block:'[[[11,"td"],[24,0,"rag-uploader__upload-status"],[4,[32,0],[[30,0,["trackProgress"]]],null],[12],[1,"\\n"],[41,[30,0,["progress"]],[[[41,[30,0,["fullyIndexed"]],[[[1,"      "],[10,1],[14,0,"indexed"],[12],[1,"\\n        "],[1,[28,[32,1],["check"],null]],[1,"\\n        "],[1,[28,[32,2],["discourse_ai.rag.uploads.indexed"],null]],[1,"\\n      "],[13],[1,"\\n"]],[]],[[[1,"      "],[10,1],[14,0,"indexing"],[12],[1,"\\n        "],[1,[28,[32,1],["robot"],null]],[1,"\\n        "],[1,[28,[32,2],["discourse_ai.rag.uploads.indexing"],null]],[1,"\\n        "],[1,[30,0,["calculateProgress"]]],[1,"%\\n      "],[13],[1,"\\n"]],[]]]],[]],[[[1,"    "],[10,1],[14,0,"uploaded"],[12],[1,[28,[32,2],["discourse_ai.rag.uploads.uploaded"],null]],[13],[1,"\\n"]],[]]],[13]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/rag-upload-progress.js",scope:()=>[o.default,a.default,l.i18n],isStrictMode:!0}),this)}}e.default=c})
define("discourse/plugins/discourse-ai/discourse/components/rag-uploader",["exports","@glimmer/tracking","@ember/component","@ember/helper","@ember/modifier","@ember/object","@ember/owner","@ember/render-modifiers/modifiers/did-insert","@ember/service","@ember-decorators/component","discourse/components/d-button","discourse/helpers/d-icon","discourse/lib/ajax","discourse/lib/array-tools","discourse/lib/debounce","discourse/lib/tracked-tools","discourse/lib/uppy/uppy-upload","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/rag-upload-progress","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const v=dt7948.c(class extends s.default{static{dt7948.g(this.prototype,"appEvents",[l.service])}#j=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"term",[t.tracked],function(){return null})}#ts=void dt7948.i(this,"term")
static{dt7948.g(this.prototype,"filteredUploads",[t.tracked],function(){return null})}#ss=void dt7948.i(this,"filteredUploads")
static{dt7948.g(this.prototype,"ragIndexingStatuses",[t.tracked],function(){return null})}#is=void dt7948.i(this,"ragIndexingStatuses")
static{dt7948.g(this.prototype,"ragUploads",[g.trackedArray],function(){return null})}#os=void dt7948.i(this,"ragUploads")
uppyUpload=new _.default((0,a.getOwner)(this),{id:"discourse-ai-rag-uploader",maxFiles:20,type:"discourse_ai_rag_upload",uploadUrl:"/admin/plugins/discourse-ai/rag-document-fragments/files/upload",preventDirectS3Uploads:!0,uploadDone:e=>{const t=e.upload
t.status="uploaded",t.statusText=(0,f.i18n)("discourse_ai.rag.uploads.uploaded"),this.ragUploads.push(t),this.debouncedSearch()}})
willDestroy(){super.willDestroy(...arguments),this.appEvents.off(`upload-mixin:${this.uppyUpload.config}:all-uploads-complete`,this,"_updateTargetWithUploads")}didReceiveAttrs(){super.didReceiveAttrs(...arguments),this.uppyUpload.inProgressUploads?.length>0&&this.uppyUpload.cancelAllUploads(),this.ragUploads=this.target?.rag_uploads?.slice()||[],this.filteredUploads=this.ragUploads
const e=this.targetName||this.target?.constructor?.name
this.ragUploads?.length&&this.target?.id&&(0,p.ajax)(`/admin/plugins/discourse-ai/rag-document-fragments/files/status.json?target_type=${e}&target_id=${this.target.id}`).then(e=>{this.set("ragIndexingStatuses",e)}),this.appEvents.on(`upload-mixin:${this.uppyUpload.config.id}:all-uploads-complete`,this,"_updateTargetWithUploads")}_updateTargetWithUploads(){this.updateUploads(this.ragUploads)}get acceptedFileTypes(){return this.args?.allowImages?".txt,.md,.png,.jpg,.jpeg":".txt,.md,.pdf"}submitFiles(){this.uppyUpload.openPicker()}static{dt7948.n(this.prototype,"submitFiles",[n.action])}cancelUploading(e){this.uppyUpload.cancelSingleUpload({fileId:e.id})}static{dt7948.n(this.prototype,"cancelUploading",[n.action])}search(){this.term?this.filteredUploads=this.ragUploads.filter(e=>e.original_filename.toUpperCase().indexOf(this.term.toUpperCase())>-1):this.filteredUploads=this.ragUploads}static{dt7948.n(this.prototype,"search",[n.action])}debouncedSearch(){(0,h.default)(this,this.search,100)}static{dt7948.n(this.prototype,"debouncedSearch",[n.action])}removeUpload(e){(0,m.removeValueFromArray)(this.ragUploads,e),this.onRemove(e),this.debouncedSearch()}static{dt7948.n(this.prototype,"removeUpload",[n.action])}static{(0,s.setComponentTemplate)((0,y.createTemplateFactory)({id:"X229IuC6",block:'[[[11,0],[24,0,"rag-uploader"],[17,1],[12],[1,"\\n"],[41,[30,2],[[[1,"    "],[10,2],[12],[1,[28,[32,0],["discourse_ai.rag.uploads.description_with_images"],null]],[13],[1,"\\n"]],[]],[[[1,"    "],[10,2],[12],[1,[28,[32,0],["discourse_ai.rag.uploads.description"],null]],[13],[1,"\\n"]],[]]],[1,"\\n"],[41,[30,0,["ragUploads"]],[[[1,"    "],[10,0],[14,0,"rag-uploader__search-input-container"],[12],[1,"\\n      "],[10,0],[14,0,"rag-uploader__search-input"],[12],[1,"\\n        "],[1,[28,[32,1],["magnifying-glass"],[["class"],["rag-uploader__search-input__search-icon"]]]],[1,"\\n        "],[8,[32,2],[[24,0,"rag-uploader__search-input__input"],[16,"placeholder",[28,[32,0],["discourse_ai.rag.uploads.filter"],null]],[4,[32,3],["keyup",[30,0,["debouncedSearch"]]],null]],[["@value"],[[30,0,["term"]]]],null],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[1,"\\n  "],[10,"table"],[14,0,"rag-uploader__uploads-list"],[12],[1,"\\n    "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["filteredUploads"]]],null]],null],null,[[[1,"        "],[10,"tr"],[12],[1,"\\n          "],[10,"td"],[12],[1,"\\n            "],[10,1],[14,0,"rag-uploader__rag-file-icon"],[12],[1,[28,[32,1],["file"],null]],[13],[1,"\\n            "],[1,[30,3,["original_filename"]]],[1,"\\n          "],[13],[1,"\\n          "],[8,[32,4],null,[["@upload","@ragIndexingStatuses"],[[30,3],[30,0,["ragIndexingStatuses"]]]],null],[1,"\\n          "],[10,"td"],[14,0,"rag-uploader__remove-file"],[12],[1,"\\n            "],[8,[32,5],[[24,0,"btn-flat"]],[["@icon","@title","@action"],["xmark","discourse_ai.rag.uploads.remove",[28,[32,6],[[30,0,["removeUpload"]],[30,3]],null]]],null],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n"]],[3]],null],[42,[28,[31,2],[[28,[31,2],[[30,0,["uppyUpload","inProgressUploads"]]],null]],null],null,[[[1,"        "],[10,"tr"],[12],[1,"\\n          "],[10,"td"],[12],[10,1],[14,0,"rag-uploader__rag-file-icon"],[12],[1,[28,[32,1],["file"],null]],[13],[1,"\\n            "],[1,[30,4,["original_filename"]]],[13],[1,"\\n          "],[10,"td"],[14,0,"rag-uploader__upload-status"],[12],[1,"\\n            "],[10,0],[14,0,"spinner small"],[12],[13],[1,"\\n            "],[10,1],[12],[1,[28,[32,0],["discourse_ai.rag.uploads.uploading"],null]],[1,"\\n              "],[1,[30,4,["uploadProgress"]]],[1,"%"],[13],[1,"\\n          "],[13],[1,"\\n          "],[10,"td"],[14,0,"rag-uploader__remove-file"],[12],[1,"\\n            "],[8,[32,5],[[24,0,"btn-flat"]],[["@icon","@title","@action"],["xmark","discourse_ai.rag.uploads.remove",[28,[32,6],[[30,0,["cancelUploading"]],[30,4]],null]]],null],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n"]],[4]],null],[1,"    "],[13],[1,"\\n  "],[13],[1,"\\n\\n  "],[11,"input"],[24,0,"hidden-upload-field"],[16,"disabled",[30,0,["uploading"]]],[24,"multiple","multiple"],[16,"accept",[30,0,["acceptedFileTypes"]]],[24,4,"file"],[4,[32,7],[[30,0,["uppyUpload","setup"]]],null],[12],[13],[1,"\\n  "],[8,[32,5],[[24,0,"btn-default"]],[["@label","@icon","@title","@action"],["discourse_ai.rag.uploads.button","plus","discourse_ai.rag.uploads.button",[30,0,["submitFiles"]]]],null],[1,"\\n"],[13]],["&attrs","@allowImages","upload","upload"],["if","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/rag-uploader.js",scope:()=>[f.i18n,c.default,s.Input,o.on,b.default,u.default,i.fn,r.default],isStrictMode:!0}),this)}},[(0,d.tagName)("")])
e.default=v}),define("discourse/plugins/discourse-ai/discourse/components/reviewable-ai-chat-message",["exports","@glimmer/component","@ember/helper","@ember/routing","@ember/template","discourse/components/reviewable-created-by","discourse/components/reviewable-post-header","discourse/truth-helpers","discourse/plugins/chat/discourse/components/chat-channel-title","discourse/plugins/chat/discourse/models/chat-channel","discourse/plugins/discourse-ai/discourse/components/model-accuracies","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends t.default{get chatChannel(){if(this.args.reviewable.chat_channel)return d.default.create(this.args.reviewable.chat_channel)}static{(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"qEV1Swvx",block:'[[[41,[30,0,["chatChannel"]],[[[1,"  "],[10,0],[14,0,"flagged-post-header"],[12],[1,"\\n    "],[8,[32,0],null,[["@route","@models"],["chat.channel.near-message",[28,[32,1],[[30,0,["chatChannel","slugifiedTitle"]],[30,0,["chatChannel","id"]],[30,1,["target_id"]]],null]]],[["default"],[[[[1,"\\n      "],[8,[32,2],null,[["@channel"],[[30,0,["chatChannel"]]]],null],[1,"\\n    "]],[]]]]],[1,"\\n  "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[10,0],[14,0,"post-contents-wrapper"],[12],[1,"\\n  "],[8,[32,3],null,[["@user"],[[30,1,["target_created_by"]]]],null],[1,"\\n  "],[10,0],[14,0,"post-contents"],[12],[1,"\\n    "],[8,[32,4],null,[["@reviewable","@createdBy"],[[30,1],[30,1,["target_created_by"]]]],null],[1,"\\n\\n    "],[10,0],[14,0,"post-body"],[12],[1,"\\n      "],[1,[28,[32,5],[[28,[32,6],[[30,1,["payload","message_cooked"]],[30,1,["cooked"]]],null]],null]],[1,"\\n    "],[13],[1,"\\n\\n    "],[18,2,null],[1,"\\n\\n    "],[8,[32,7],null,[["@accuracies"],[[30,1,["payload","accuracies"]]]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],["@reviewable","&default"],["if","yield"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/reviewable-ai-chat-message.js",scope:()=>[i.LinkTo,s.array,l.default,n.default,a.default,o.htmlSafe,r.or,u.default],isStrictMode:!0}),this)}}e.default=m}),define("discourse/plugins/discourse-ai/discourse/components/reviewable-ai-post",["exports","@ember/template","discourse/components/reviewable-created-by","discourse/components/reviewable-post-edits","discourse/components/reviewable-post-header","discourse/components/reviewable-topic-link","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/model-accuracies","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"y6YgjjSW",block:'[[[10,0],[14,0,"flagged-post-header"],[12],[1,"\\n  "],[8,[32,0],null,[["@reviewable"],[[30,1]]],null],[1,"\\n  "],[8,[32,1],null,[["@reviewable"],[[30,1]]],null],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[14,0,"post-contents-wrapper"],[12],[1,"\\n  "],[8,[32,2],null,[["@user"],[[30,1,["target_created_by"]]]],null],[1,"\\n  "],[10,0],[14,0,"post-contents"],[12],[1,"\\n    "],[8,[32,3],null,[["@reviewable","@createdBy"],[[30,1],[30,1,["target_created_by"]]]],null],[1,"\\n    "],[10,0],[14,0,"post-body"],[12],[1,"\\n"],[41,[30,1,["blank_post"]],[[[1,"        "],[10,2],[12],[1,[28,[32,4],["review.deleted_post"],null]],[13],[1,"\\n"]],[]],[[[1,"        "],[1,[28,[32,5],[[30,1,["cooked"]]],null]],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n\\n    "],[18,2,null],[1,"\\n\\n    "],[8,[32,6],null,[["@accuracies"],[[30,1,["payload","accuracies"]]]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],["@reviewable","&default"],["if","yield"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/reviewable-ai-post.js",scope:()=>[n.default,i.default,s.default,o.default,a.i18n,t.htmlSafe,r.default],isStrictMode:!0}),(0,u.default)(void 0,"reviewable-ai-post:ReviewableAiPost"))
e.default=c}),define("discourse/plugins/discourse-ai/discourse/components/reviewable-refresh/ai-chat-message",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/routing","discourse/components/reviewable-refresh/created-by","discourse/components/reviewable-refresh/topic-link","discourse/lib/highlight-watched-words","discourse-i18n","discourse/plugins/chat/discourse/components/channel-title","discourse/plugins/chat/discourse/models/chat-channel","discourse/plugins/discourse-ai/discourse/components/model-accuracies","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{get channel(){if(this.args.reviewable.chat_channel)return u.default.create(this.args.reviewable.chat_channel)}static{dt7948.n(this.prototype,"channel",[s.cached])}get messageCooked(){return this.args.reviewable.payload?.message_cooked||this.args.reviewable.cooked}static{(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"dVwZlFH5",block:'[[[10,0],[14,0,"review-item__meta-content"],[12],[1,"\\n  "],[10,0],[14,0,"review-item__meta-label"],[12],[1,[28,[32,0],["chat.reviewable.message_in_channel"],null]],[13],[1,"\\n\\n  "],[10,0],[14,0,"review-item__meta-topic-title"],[12],[1,"\\n"],[41,[30,0,["channel"]],[[[1,"      "],[8,[32,1],null,[["@route","@models"],["chat.channel.near-message",[28,[32,2],[[30,0,["channel","slugifiedTitle"]],[30,0,["channel","id"]],[30,1,["target_id"]]],null]]],[["default"],[[[[1,"\\n        "],[8,[32,3],null,[["@channel"],[[30,0,["channel"]]]],null],[1,"\\n      "]],[]]]]],[1,"\\n"]],[]],[[[1,"      "],[8,[32,4],null,[["@reviewable"],[[30,1]]],null],[1,"\\n"]],[]]],[1,"  "],[13],[1,"\\n\\n  "],[10,0],[14,0,"review-item__meta-label"],[12],[1,[28,[32,0],["review.review_user"],null]],[13],[1,"\\n\\n  "],[10,0],[14,0,"review-item__meta-flagged-user"],[12],[1,"\\n    "],[8,[32,5],null,[["@user"],[[30,1,["target_created_by"]]]],null],[1,"\\n  "],[13],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[14,0,"review-item__post"],[12],[1,"\\n  "],[10,0],[14,0,"review-item__post-content-wrapper"],[12],[1,"\\n    "],[10,0],[14,0,"review-item__post-content"],[12],[1,"\\n      "],[1,[28,[32,6],[[30,0,["messageCooked"]],[30,1]],null]],[1,"\\n\\n"],[41,[30,1,["payload","transcript_topic_id"]],[[[1,"        "],[10,0],[14,0,"transcript"],[12],[1,"\\n          "],[8,[32,1],[[24,0,"btn btn-default btn-small"]],[["@route","@models"],["topic",[28,[32,2],["-",[30,1,["payload","transcript_topic_id"]]],null]]],[["default"],[[[[1,"\\n            "],[1,[28,[32,0],["review.transcript.view"],null]],[1,"\\n          "]],[]]]]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n      "],[8,[32,7],null,[["@accuracies"],[[30,1,["payload","accuracies"]]]],null],[1,"\\n\\n      "],[18,2,null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"],[13]],["@reviewable","&default"],["if","yield"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/reviewable-refresh/ai-chat-message.js",scope:()=>[l.i18n,o.LinkTo,i.array,d.default,a.default,n.default,r.default,c.default],isStrictMode:!0}),this)}}e.default=h}),define("discourse/plugins/discourse-ai/discourse/components/reviewable-refresh/ai-post",["exports","discourse/components/reviewable-refresh/post","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/model-accuracies","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"n8PGo6bS",block:'[[[8,[32,0],null,[["@reviewable","@userLabel","@pluginOutletName"],[[30,1],[28,[32,1],["review.flagged_user"],null],"after-reviewable-ai-post-body"]],[["default"],[[[[1,"\\n  "],[8,[32,2],null,[["@accuracies"],[[30,1,["payload","accuracies"]]]],null],[1,"\\n"]],[]]]]]],["@reviewable"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/reviewable-refresh/ai-post.js",scope:()=>[t.default,s.i18n,i.default],isStrictMode:!0}),(0,a.default)(void 0,"ai-post"))}),define("discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/components/dropdown-menu","discourse/float-kit/components/d-menu","discourse/helpers/category-badge","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static{dt7948.g(this.prototype,"siteSettings",[a.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"suggestions",[s.tracked],function(){return null})}#Je=void dt7948.i(this,"suggestions")
static{dt7948.g(this.prototype,"triggerIcon",[s.tracked],function(){return"discourse-sparkles"})}#ns=void dt7948.i(this,"triggerIcon")
dMenu
get content(){return this.args.composer?.reply}get showSuggestionButton(){const e=this.content?.length>h.MIN_CHARACTER_COUNT||"edit"===this.args.topicState
return document.querySelector(".composer-fields")?.classList.toggle("showing-ai-suggestions",e),this.siteSettings.ai_embeddings_enabled&&e}get showDropdown(){return!this.loading&&this.suggestions?.length>0}async loadSuggestions(){if(this.suggestions?.length>0&&!this.dMenu.expanded)return this.suggestions
this.loading=!0,this.triggerIcon="spinner"
const e={}
this.content?e.text=this.content:e.topic_id=this.args.buffered.content.id
try{const{assistant:t}=await(0,c.ajax)("/discourse-ai/ai-helper/suggest_category",{method:"POST",data:e})
if(this.suggestions=t,0===this.suggestions?.length)return this.dMenu.close(),void(0,h.showSuggestionsError)(this,this.loadSuggestions.bind(this))}catch(t){(0,p.popupAjaxError)(t)}finally{this.loading=!1,this.triggerIcon="rotate"}return this.suggestions}static{dt7948.n(this.prototype,"loadSuggestions",[n.action])}applySuggestion(e){return this.args.composer&&this.args.composer.set("categoryId",e.id),this.args.buffered&&this.args.buffered.set("category_id",e.id),this.dMenu.close()}static{dt7948.n(this.prototype,"applySuggestion",[n.action])}onRegisterApi(e){this.dMenu=e}static{dt7948.n(this.prototype,"onRegisterApi",[n.action])}onClose(){this.suggestions?.length>0&&(this.triggerIcon="discourse-sparkles")}static{dt7948.n(this.prototype,"onClose",[n.action])}static{(0,g.setComponentTemplate)((0,_.createTemplateFactory)({id:"RM3QJvsu",block:'[[[41,[30,0,["showSuggestionButton"]],[[[1,"  "],[8,[32,0],[[4,[32,3],["click",[30,0,["loadSuggestions"]]],null]],[["@title","@icon","@identifier","@onClose","@triggerClass","@contentClass","@onRegisterApi","@modalForMobile","@untriggers"],[[28,[32,1],["discourse_ai.ai_helper.suggest"],null],[30,0,["triggerIcon"]],"ai-category-suggester",[30,0,["onClose"]],[29,["btn-transparent suggestion-button suggest-category-button ",[52,[30,0,["loading"]],"is-loading"]]],"ai-suggestions-menu",[30,0,["onRegisterApi"]],true,[32,2]]],[["content"],[[[[1,"\\n"],[41,[30,0,["showDropdown"]],[[[1,"        "],[8,[32,4],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["suggestions"]]],null]],null],null,[[[1,"            "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n              "],[8,[32,5],[[24,0,"category-row"],[16,"data-name",[30,2,["name"]]],[16,"data-value",[30,3]],[16,"title",[30,2,["name"]]]],[["@action"],[[28,[32,6],[[30,0,["applySuggestion"]],[30,2]],null]]],[["default"],[[[[1,"\\n                "],[10,0],[14,0,"category-status"],[12],[1,"\\n                  "],[1,[28,[32,7],[[30,2]],null]],[1,"\\n                  "],[10,1],[14,0,"topic-count"],[12],[1,"x\\n                    "],[1,[30,2,["topicCount"]]],[13],[1,"\\n                "],[13],[1,"\\n              "]],[]]]]],[1,"\\n            "]],[]]]]],[1,"\\n"]],[2,3]],null],[1,"        "]],[1]]]]],[1,"\\n"]],[]],null],[1,"    "]],[]]]]],[1,"\\n"]],[]],null]],["dropdown","suggestion","index"],["if","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester.js",scope:()=>[d.default,m.i18n,i.array,o.on,l.default,r.default,i.fn,u.default],isStrictMode:!0}),this)}}e.default=f}),define("discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/components/dropdown-menu","discourse/float-kit/components/d-menu","discourse/helpers/discourse-tag","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static{dt7948.g(this.prototype,"siteSettings",[a.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"toasts",[a.service])}#U=void dt7948.i(this,"toasts")
static{dt7948.g(this.prototype,"composer",[a.service])}#Ue=void dt7948.i(this,"composer")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"suggestions",[s.tracked],function(){return null})}#Je=void dt7948.i(this,"suggestions")
static{dt7948.g(this.prototype,"triggerIcon",[s.tracked],function(){return"discourse-sparkles"})}#ns=void dt7948.i(this,"triggerIcon")
dMenu
get content(){return this.args.composer?.reply}get model(){return this.args.composer||this.args.buffered}get showSuggestionButton(){if(this.composer.disableTagsChooser)return!1
const e=this.content?.length>h.MIN_CHARACTER_COUNT||"edit"===this.args.topicState
return document.querySelector(".composer-fields")?.classList.toggle("showing-ai-suggestions",e),this.siteSettings.ai_embeddings_enabled&&e}get showDropdown(){return!this.loading&&this.suggestions?.length>0}get tagSelectorHasValues(){return this.model.get("tags")?.length>0}async loadSuggestions(){if(this.suggestions?.length>0&&!this.dMenu.expanded)return this.suggestions
this.loading=!0,this.triggerIcon="spinner"
const e={}
this.content?e.text=this.content:e.topic_id=this.args.buffered.content.id
try{const{assistant:t}=await(0,c.ajax)("/discourse-ai/ai-helper/suggest_tags",{method:"POST",data:e})
if(this.suggestions=t,this.tagSelectorHasValues&&(this.suggestions=this.suggestions.filter(e=>!model.get("tags").some(t=>t.id===e.id))),0===this.suggestions?.length)return void(0,h.showSuggestionsError)(this,this.loadSuggestions.bind(this))}catch(t){(0,p.popupAjaxError)(t)}finally{this.loading=!1,this.triggerIcon="rotate"}return this.suggestions}static{dt7948.n(this.prototype,"loadSuggestions",[n.action])}#as(e){this.suggestions=this.suggestions.filter(t=>t.id!==e.id)}applySuggestion(e){const t=this.siteSettings.max_tags_per_topic
if(!this.model)return
const s=this.model.get("tags")
return s?s.length>=t?this.toasts.error({class:"ai-suggestion-error",duration:"short",data:{message:(0,m.i18n)("discourse_ai.ai_helper.suggest_errors.too_many_tags",{count:t})}}):(s.push(e),this.model.set("tags",[...s]),e.disabled=!0,void this.#as(e)):(this.model.set("tags",[e]),void this.#as(e))}static{dt7948.n(this.prototype,"applySuggestion",[n.action])}onRegisterApi(e){this.dMenu=e}static{dt7948.n(this.prototype,"onRegisterApi",[n.action])}onClose(){this.suggestions?.length>0&&(this.triggerIcon="discourse-sparkles")}static{dt7948.n(this.prototype,"onClose",[n.action])}static{(0,g.setComponentTemplate)((0,_.createTemplateFactory)({id:"x/P6iJMM",block:'[[[41,[30,0,["showSuggestionButton"]],[[[1,"  "],[8,[32,0],[[4,[32,3],["click",[30,0,["loadSuggestions"]]],null]],[["@title","@icon","@identifier","@onClose","@triggerClass","@contentClass","@onRegisterApi","@modalForMobile","@untriggers"],[[28,[32,1],["discourse_ai.ai_helper.suggest"],null],[30,0,["triggerIcon"]],"ai-tag-suggester",[30,0,["onClose"]],[29,["btn-transparent suggestion-button suggest-tags-button ",[52,[30,0,["loading"]],"is-loading"]]],"ai-suggestions-menu",[30,0,["onRegisterApi"]],true,[32,2]]],[["content"],[[[[1,"\\n"],[41,[30,0,["showDropdown"]],[[[1,"        "],[8,[32,4],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["suggestions"]]],null]],null],null,[[[1,"            "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n              "],[8,[32,5],[[24,0,"tag-row"],[16,"data-name",[30,2,["name"]]],[16,"data-value",[30,3]],[16,"title",[30,2,["name"]]]],[["@translatedLabel","@disabled","@action"],[[30,2,["name"]],[30,2,["disabled"]],[28,[32,6],[[30,0,["applySuggestion"]],[30,2]],null]]],[["default"],[[[[1,"\\n                "],[1,[28,[32,7],[[30,2,["name"]]],[["count","noHref"],[[30,2,["count"]],true]]]],[1,"\\n              "]],[]]]]],[1,"\\n            "]],[]]]]],[1,"\\n"]],[2,3]],null],[1,"        "]],[1]]]]],[1,"\\n"]],[]],null],[1,"    "]],[]]]]],[1,"\\n"]],[]],null]],["dropdown","suggestion","index"],["if","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester.js",scope:()=>[d.default,m.i18n,i.array,o.on,l.default,r.default,i.fn,u.default],isStrictMode:!0}),this)}}e.default=f}),define("discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/components/dropdown-menu","discourse/float-kit/components/d-menu","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/ai-errors","discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"suggestions",[s.tracked],function(){return null})}#Je=void dt7948.i(this,"suggestions")
static{dt7948.g(this.prototype,"triggerIcon",[s.tracked],function(){return"discourse-sparkles"})}#ns=void dt7948.i(this,"triggerIcon")
dMenu
get content(){return this.args.composer?.reply}get showSuggestionButton(){const e=this.content?.length>m.MIN_CHARACTER_COUNT||"edit"===this.args.topicState
return document.querySelector(".composer-fields")?.classList.toggle("showing-ai-suggestions",e),document.querySelector(".edit-topic-title")?.classList.toggle("showing-ai-suggestions",e),e}get showDropdown(){return!this.loading&&this.suggestions?.length>0}async loadSuggestions(){if(this.suggestions?.length>0&&!this.dMenu.expanded)return this.suggestions
this.loading=!0,this.triggerIcon="spinner"
const e={}
this.content?e.text=this.content:e.topic_id=this.args.buffered.content.id
try{const{suggestions:t}=await(0,d.ajax)("/discourse-ai/ai-helper/suggest_title",{method:"POST",data:e})
if(this.suggestions=t,0===t?.length)return void(0,m.showSuggestionsError)(this,this.loadSuggestions.bind(this))}catch(t){(0,p.isAiCreditLimitError)(t)?(0,p.popupAiCreditLimitError)(t):(0,u.popupAjaxError)(t)}finally{this.loading=!1,this.triggerIcon="rotate"}return this.suggestions}static{dt7948.n(this.prototype,"loadSuggestions",[n.action])}applySuggestion(e){const t=this.args.composer||this.args.buffered
t&&(t.set("title",e),this.dMenu.close())}static{dt7948.n(this.prototype,"applySuggestion",[n.action])}onRegisterApi(e){this.dMenu=e}static{dt7948.n(this.prototype,"onRegisterApi",[n.action])}onClose(){this.suggestions?.length>0&&(this.triggerIcon="discourse-sparkles")}static{dt7948.n(this.prototype,"onClose",[n.action])}static{(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"oup+LKAo",block:'[[[41,[30,0,["showSuggestionButton"]],[[[1,"  "],[8,[32,0],[[4,[32,3],["click",[30,0,["loadSuggestions"]]],null]],[["@title","@icon","@identifier","@onClose","@triggerClass","@contentClass","@onRegisterApi","@modalForMobile","@untriggers"],[[28,[32,1],["discourse_ai.ai_helper.suggest"],null],[30,0,["triggerIcon"]],"ai-title-suggester",[30,0,["onClose"]],[29,["btn-transparent suggestion-button suggest-titles-button ",[52,[30,0,["loading"]],"is-loading"]]],"ai-suggestions-menu",[30,0,["onRegisterApi"]],true,[32,2]]],[["content"],[[[[1,"\\n"],[41,[30,0,["showDropdown"]],[[[1,"        "],[8,[32,4],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["suggestions"]]],null]],null],null,[[[1,"            "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n              "],[8,[32,5],[[16,"data-name",[30,2]],[16,"data-value",[30,3]],[16,"title",[30,2]]],[["@translatedLabel","@action"],[[30,2],[28,[32,6],[[30,0,["applySuggestion"]],[30,2]],null]]],null],[1,"\\n            "]],[]]]]],[1,"\\n"]],[2,3]],null],[1,"        "]],[1]]]]],[1,"\\n"]],[]],null],[1,"    "]],[]]]]],[1,"\\n"]],[]],null]],["dropdown","suggestion","index"],["if","each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester.js",scope:()=>[l.default,c.i18n,i.array,o.on,r.default,a.default,i.fn],isStrictMode:!0}),this)}}e.default=_}),define("discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","discourse/components/d-button","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static{dt7948.g(this.prototype,"selected",[s.tracked],function(){return!1})}#rs=void dt7948.i(this,"selected")
static{dt7948.g(this.prototype,"selectIcon",[s.tracked],function(){return"far-circle"})}#ls=void dt7948.i(this,"selectIcon")
static{dt7948.g(this.prototype,"selectLabel",[s.tracked],function(){return"discourse_ai.ai_helper.thumbnail_suggestions.select"})}#ds=void dt7948.i(this,"selectLabel")
toggleSelection(e){return this.selected?(this.selectIcon="far-circle",this.selectLabel="discourse_ai.ai_helper.thumbnail_suggestions.select",this.selected=!1,this.args.removeSelection(e)):(this.selectIcon="circle-check",this.selectLabel="discourse_ai.ai_helper.thumbnail_suggestions.selected",this.selected=!0,this.args.addSelection(e))}static{dt7948.n(this.prototype,"toggleSelection",[o.action])}static{(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"/mhv1HM7",block:'[[[10,0],[14,0,"ai-thumbnail-suggestions__item"],[12],[1,"\\n  "],[8,[32,0],[[16,0,[52,[30,0,["selected"]],"btn-primary"]]],[["@icon","@label","@action"],[[30,0,["selectIcon"]],[30,0,["selectLabel"]],[28,[32,1],[[30,0,["toggleSelection"]],[30,1]],null]]],null],[1,"\\n  "],[10,"img"],[15,"src",[30,1,["url"]]],[14,"loading","lazy"],[15,"width",[30,1,["thumbnail_width"]]],[15,"height",[30,1,["thumbnail_height"]]],[12],[13],[1,"\\n"],[13]],["@thumbnail"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item.js",scope:()=>[n.default,i.fn],isStrictMode:!0}),this)}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/connectors/admin-dashboard-tabs-after/admin-sentiment-dashbboard",["exports","@glimmer/component","@ember/routing","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return t.siteSettings.ai_sentiment_enabled}static{(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"BfdHvLdH",block:'[[[10,"li"],[14,0,"navigation-item sentiment"],[12],[1,"\\n  "],[8,[32,0],[[24,0,"navigation-link"]],[["@route"],["admin.dashboardSentiment"]],[["default"],[[[[1,"\\n    "],[1,[28,[32,1],["discourse_ai.sentiments.dashboard.title"],null]],[1,"\\n  "]],[]]]]],[1,"\\n"],[13]],[],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/admin-dashboard-tabs-after/admin-sentiment-dashbboard.js",scope:()=>[s.LinkTo,i.i18n],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-category-input/ai-category-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static{dt7948.g(this.prototype,"composer",[s.service])}#Ue=void dt7948.i(this,"composer")
static{(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"AhK0qmuI",block:'[[[41,[51,[30,0,["composer","disableCategoryChooser"]]],[[[1,"  "],[8,[32,0],null,[["@composer","@topicState"],[[30,1,["composer"]],"new"]],null],[1,"\\n"]],[]],null]],["@outletArgs"],["unless"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-category-input/ai-category-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-tag-input/ai-tag-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static{(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"pJjxVih5",block:'[[[8,[32,0],null,[["@composer","@topicState"],[[30,1,["composer"]],"new"]],null]],["@outletArgs"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-tag-input/ai-tag-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-title-input/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static{(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"Fqb9w+kH",block:'[[[41,[51,[30,1,["composer","disableTitleInput"]]],[[[1,"  "],[8,[32,0],null,[["@composer","@topicState"],[[30,1,["composer"]],"new"]],null],[1,"\\n"]],[]],null]],["@outletArgs"],["unless"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-title-input/ai-title-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/connectors/after-d-editor/composer-open",["exports","@glimmer/component","@ember/object","@ember/service","discourse/helpers/body-class","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static{dt7948.g(this.prototype,"currentUser",[i.service])}#A=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"siteSettings",[i.service])}#l=void dt7948.i(this,"siteSettings")
get composerModel(){return this.args?.outletArgs?.composer}get renderChatWarning(){return this.siteSettings.ai_bot_enable_chat_warning}get aiBotClasses(){return this.composerModel?.title===(0,n.i18n)("discourse_ai.ai_bot.default_pm_prefix")?"ai-bot-chat":"ai-bot-pm"}static{dt7948.n(this.prototype,"aiBotClasses",[(0,s.computed)("composerModel.targetRecipients","composerModel.title")])}get isAiBotChat(){if(this.composerModel&&this.composerModel.targetRecipients&&this.currentUser.ai_enabled_chat_bots){let e=this.composerModel.targetRecipients.split(",")
return this.currentUser.ai_enabled_chat_bots.some(t=>e.some(e=>e===t.username))}return!1}static{dt7948.n(this.prototype,"isAiBotChat",[(0,s.computed)("composerModel.targetRecipients")])}static{(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"StGO2Pno",block:'[[[41,[30,0,["isAiBotChat"]],[[[1,"  "],[1,[28,[32,0],[[30,0,["aiBotClasses"]]],null]],[1,"\\n"],[41,[30,0,["renderChatWarning"]],[[[1,"    "],[10,0],[14,0,"ai-bot-chat-warning"],[12],[1,[28,[32,1],["discourse_ai.ai_bot.pm_warning"],null]],[13],[1,"\\n"]],[]],null]],[]],null]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-d-editor/composer-open.js",scope:()=>[o.default,n.i18n],isStrictMode:!0}),this)}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/connectors/after-filter-navigation-menu/filter-gist-toggle",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static{dt7948.g(this.prototype,"topicThumbnails",[s.service])}#us=void dt7948.i(this,"topicThumbnails")
get shouldShow(){return!this.topicThumbnails?.enabledForRoute}static{(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"vwk4+HCd",block:'[[[41,[30,0,["shouldShow"]],[[[1,"  "],[8,[32,0],null,null,null],[1,"\\n"]],[]],null]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-filter-navigation-menu/filter-gist-toggle.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/connectors/after-search-result-entry/search-result-decoration",["exports","discourse/helpers/d-icon","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"aVMs0Lzw",block:'[[[10,0],[14,0,"ai-result__icon"],[15,"title",[28,[32,0],["discourse_ai.embeddings.ai_generated_result"],null]],[12],[1,"\\n  "],[1,[28,[32,1],["discourse-sparkles"],null]],[1,"\\n"],[13]],[],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-search-result-entry/search-result-decoration.js",scope:()=>[s.i18n,t.default],isStrictMode:!0}),(0,n.default)(void 0,"search-result-decoration:SearchResultDecoration"))
e.default=a}),define("discourse/plugins/discourse-ai/discourse/connectors/before-create-topic-button/topic-list-gist-toggle",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static{dt7948.g(this.prototype,"topicThumbnails",[s.service])}#us=void dt7948.i(this,"topicThumbnails")
get shouldShow(){return!this.topicThumbnails?.enabledForRoute}static{(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"EVnj2EUi",block:'[[[41,[30,0,["shouldShow"]],[[[1,"  "],[8,[32,0],null,null,null],[1,"\\n"]],[]],null]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/before-create-topic-button/topic-list-gist-toggle.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/connectors/composer-fields/persona-llm-selector",["exports","@glimmer/component","@ember/object","discourse/plugins/discourse-ai/discourse/components/ai-persona-llm-selector","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,{currentUser:t}){return t?.ai_enabled_personas&&function(e,t){if(e&&e.targetRecipients&&t.ai_enabled_chat_bots){const s=e.targetRecipients.split(",")
return t.ai_enabled_chat_bots.filter(e=>e.username).some(e=>s.some(t=>t===e.username))}return!1}(e.model,t)}setPersonaIdOnComposer(e){this.args.outletArgs.model.metaData={ai_persona_id:e}}static{dt7948.n(this.prototype,"setPersonaIdOnComposer",[s.action])}setTargetRecipientsOnComposer(e){this.args.outletArgs.model.set("targetRecipients",e)}static{dt7948.n(this.prototype,"setTargetRecipientsOnComposer",[s.action])}static{(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"be8wq0bv",block:'[[[8,[32,0],null,[["@setPersonaId","@setTargetRecipient"],[[30,0,["setPersonaIdOnComposer"]],[30,0,["setTargetRecipientsOnComposer"]]]],null]],[],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/composer-fields/persona-llm-selector.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/connectors/edit-topic-category__after/ai-category-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static{(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"6K752EBC",block:'[[[8,[32,0],null,[["@buffered","@topicState"],[[30,1,["buffered"]],"edit"]],null]],["@outletArgs"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/edit-topic-category__after/ai-category-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/connectors/edit-topic-tags__after/ai-tag-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static{(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"mP/k5rTG",block:'[[[8,[32,0],null,[["@buffered","@topicState"],[[30,1,["buffered"]],"edit"]],null]],["@outletArgs"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/edit-topic-tags__after/ai-tag-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/connectors/edit-topic-title__after/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static{(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"dp30qeW4",block:'[[[8,[32,0],null,[["@buffered","@topicState"],[[30,1,["buffered"]],"edit"]],null]],["@outletArgs"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/edit-topic-title__after/ai-title-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/connectors/editor-preview/ai-image-caption-container",["exports","@glimmer/component","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/service","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/d-textarea","discourse/helpers/d-icon","discourse/modifiers/auto-focus","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static{dt7948.g(this.prototype,"imageCaptionPopup",[r.service])}#cs=void dt7948.i(this,"imageCaptionPopup")
updateCaption(e){e.preventDefault(),this.imageCaptionPopup.newCaption=e.target.value}static{dt7948.n(this.prototype,"updateCaption",[i.action])}saveCaption(){this.imageCaptionPopup.updateCaption(),this.hidePopup()}static{dt7948.n(this.prototype,"saveCaption",[i.action])}resizeTextarea(e){const t=window.getComputedStyle(e),s=parseInt(t.borderTopWidth,10),i=parseInt(t.borderBottomWidth,10)
e.scrollTop=0,e.style.height=`${e.scrollHeight+s+i}px`}static{dt7948.n(this.prototype,"resizeTextarea",[i.action])}hidePopup(){this.imageCaptionPopup.showPopup=!1,this.imageCaptionPopup._request&&(this.imageCaptionPopup._request.abort(),this.imageCaptionPopup._request=null,this.imageCaptionPopup.toggleLoadingState(!1))}static{dt7948.n(this.prototype,"hidePopup",[i.action])}static{(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"/HjRMS2I",block:'[[[41,[30,0,["imageCaptionPopup","showPopup"]],[[[1,"  "],[11,0],[24,0,"composer-popup education-message ai-caption-popup"],[4,[32,0],[[30,0,["hidePopup"]]],null],[12],[1,"\\n    "],[8,[32,1],null,[["@condition"],[[30,0,["imageCaptionPopup","loading"]]]],[["default"],[[[[1,"\\n      "],[8,[32,2],[[4,[32,3],[[30,0,["resizeTextarea"]]],null],[4,[32,4],[[30,0,["resizeTextarea"]],[30,0,["imageCaptionPopup","newCaption"]]],null],[4,[32,5],["change",[30,0,["updateCaption"]]],null],[4,[32,6],null,null]],[["@value"],[[30,0,["imageCaptionPopup","newCaption"]]]],null],[1,"\\n    "]],[]]]]],[1,"\\n\\n    "],[10,0],[14,0,"actions"],[12],[1,"\\n      "],[8,[32,7],[[24,0,"btn-primary"]],[["@label","@icon","@action"],["discourse_ai.ai_helper.image_caption.save_caption","check",[30,0,["saveCaption"]]]],null],[1,"\\n      "],[8,[32,7],[[24,0,"btn-flat cancel-request"]],[["@label","@action"],["cancel",[30,0,["hidePopup"]]]],null],[1,"\\n\\n      "],[10,1],[14,0,"credits"],[12],[1,"\\n        "],[1,[28,[32,8],["discourse-sparkles"],null]],[1,"\\n        "],[10,1],[12],[1,[28,[32,9],["discourse_ai.ai_helper.image_caption.credits"],null]],[13],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/editor-preview/ai-image-caption-container.js",scope:()=>[a.default,l.default,u.default,o.default,n.default,s.on,p.default,d.default,c.default,m.i18n],isStrictMode:!0}),this)}}e.default=_}),define("discourse/plugins/discourse-ai/discourse/connectors/fast-edit-footer-after/ai-edit-suggestion-button",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static shouldRender(e,t){return(0,l.showPostAIHelper)(e,t)}static{dt7948.g(this.prototype,"currentUser",[o.service])}#A=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"loading",[s.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"suggestion",[s.tracked],function(){return""})}#Te=void dt7948.i(this,"suggestion")
static{dt7948.g(this.prototype,"_activeAIRequest",[s.tracked],function(){return null})}#ps=void dt7948.i(this,"_activeAIRequest")
get disabled(){return this.loading||this.suggestion?.length>0}get mode(){return this.currentUser?.ai_helper_prompts.find(e=>"proofread"===e.name)}suggest(){return this.loading=!0,this._activeAIRequest=(0,a.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:this.mode.name,text:this.args.outletArgs.initialValue,custom_prompt:""}}),this._activeAIRequest.then(({suggestions:e})=>{this.suggestion=e[0].trim(),this.args.outletArgs.updateValue(this.suggestion)}).catch(r.popupAjaxError).finally(()=>{this.loading=!1}),this._activeAIRequest}static{dt7948.n(this.prototype,"suggest",[i.action])}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"MJK3tH02",block:'[[[41,[51,[30,1,["newValue"]]],[[[1,"  "],[8,[32,0],[[24,0,"btn-default btn-small btn-ai-suggest-edit"]],[["@action","@icon","@label","@isLoading","@disabled"],[[30,0,["suggest"]],"discourse-sparkles","discourse_ai.ai_helper.fast_edit.suggest_button",[30,0,["loading"]],[30,0,["disabled"]]]],null],[1,"\\n"]],[]],null]],["@outletArgs"],["unless"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/fast-edit-footer-after/ai-edit-suggestion-button.js",scope:()=>[n.default],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/ai-full-page-discobot-discoveries",["exports","@glimmer/component","@glimmer/tracking","@ember/service","discourse/helpers/body-class","discourse/helpers/d-icon","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries","discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries-tooltip","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static shouldRender(e,{siteSettings:t,currentUser:s}){return t.ai_discover_enabled&&t.ai_discover_persona&&s?.can_use_ai_discover_persona&&s?.user_option?.ai_search_discoveries}static{dt7948.g(this.prototype,"aiCredits",[i.service])}#b=void dt7948.i(this,"aiCredits")
static{dt7948.g(this.prototype,"capabilities",[i.service])}#v=void dt7948.i(this,"capabilities")
static{dt7948.g(this.prototype,"discobotDiscoveries",[i.service])}#De=void dt7948.i(this,"discobotDiscoveries")
static{dt7948.g(this.prototype,"creditsAvailable",[s.tracked],function(){return!0})}#ms=void dt7948.i(this,"creditsAvailable")
static{dt7948.g(this.prototype,"creditCheckComplete",[s.tracked],function(){return!1})}#ct=void dt7948.i(this,"creditCheckComplete")
constructor(){super(...arguments),this.#hs()}async#hs(){try{this.creditsAvailable=await this.aiCredits.isFeatureCreditAvailable("discoveries")}catch{this.creditsAvailable=!0}this.creditCheckComplete=!0}get shouldShow(){return this.creditCheckComplete&&this.creditsAvailable}get previewLength(){return this.capabilities.viewport.md?1e4:50}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"2b/o8rY5",block:'[[[41,[30,0,["shouldShow"]],[[[1,"  "],[1,[28,[32,0],["has-discoveries"],null]],[1,"\\n  "],[10,0],[14,0,"ai-search-discoveries__discoveries-wrapper"],[12],[1,"\\n"],[41,[30,0,["discobotDiscoveries","showDiscoveryTitle"]],[[[1,"      "],[10,"h3"],[14,0,"ai-search-discoveries__discoveries-title full-page-discoveries"],[12],[1,"\\n        "],[10,1],[12],[1,"\\n          "],[1,[28,[32,1],["discobot"],null]],[1,"\\n          "],[1,[28,[32,2],["discourse_ai.discobot_discoveries.main_title"],null]],[1,"\\n        "],[13],[1,"\\n        "],[8,[32,3],null,null,null],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"\\n    "],[10,0],[14,0,"full-page-discoveries"],[12],[1,"\\n      "],[8,[32,4],null,[["@discoveryPreviewLength","@searchTerm"],[[30,0,["previewLength"]],[30,1,["search"]]]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],["@outletArgs"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/ai-full-page-discobot-discoveries.js",scope:()=>[o.default,n.default,a.i18n,l.default,r.default],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/ai-full-page-search",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/ai-full-page-search","@ember/component","@ember/template-factory"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e,{siteSettings:t}){return t.ai_embeddings_semantic_search_enabled}static{(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"PV53lMMT",block:'[[[8,[32,0],null,[["@sortOrder","@searchTerm","@searchType","@addSearchResults","@model"],[[30,1,["sortOrder"]],[30,1,["search"]],[30,1,["type"]],[30,1,["addSearchResults"]],[30,1,["model"]]]],null]],["@outletArgs"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/ai-full-page-search.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/connectors/post-menu-translations-dropdown/ai-post-menu-translation-extras",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static shouldRender(e,{siteSettings:t,currentUser:s}){return t.discourse_ai_enabled&&t.ai_translation_enabled&&s.can_localize_content}static{dt7948.g(this.prototype,"dialog",[i.service])}#H=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"toasts",[i.service])}#U=void dt7948.i(this,"toasts")
async#gs(){try{await(0,n.ajax)(`/discourse-ai/translate/posts/${this.args.post.id}`,{type:"POST"})}catch(e){(0,a.popupAjaxError)(e)}}translate(){const e=(0,r.i18n)("discourse_ai.translations.translations_menu.translate.confirm")
return this.dialog.yesNoConfirm({message:e,didConfirm:async()=>{try{await this.#gs(),this.toasts.success({duration:"short",data:{message:(0,r.i18n)("discourse_ai.translations.translations_menu.translate.success")}})}catch(e){(0,a.popupAjaxError)(e)}}})}static{dt7948.n(this.prototype,"translate",[s.action])}static{(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"5AWgKm7T",block:'[[[8,[30,1,["item"]],[[24,0,"update-translations-menu__translate"]],null,[["default"],[[[[1,"\\n  "],[8,[32,0],[[24,0,"post-action-menu__translate-translation"]],[["@label","@icon","@action","@title"],["discourse_ai.translations.translations_menu.translate.label","arrows-rotate",[30,0,["translate"]],"discourse_ai.translations.translations_menu.translate.title"]],null],[1,"\\n"]],[]]]]],[1,"\\n"],[18,2,null]],["@dropdown","&default"],["yield"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/post-menu-translations-dropdown/ai-post-menu-translation-extras.js",scope:()=>[o.default],isStrictMode:!0}),this)}}e.default=u}),define("discourse/plugins/discourse-ai/discourse/connectors/post-text-buttons/ai-post-helper-trigger",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/utilities","discourse/plugins/discourse-ai/discourse/components/ai-post-helper-menu","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static shouldRender(e,t){return(0,l.showPostAIHelper)(e,t)}static{dt7948.g(this.prototype,"menu",[o.service])}#Se=void dt7948.i(this,"menu")
static{dt7948.g(this.prototype,"postHighlighted",[s.tracked],function(){return!1})}#_s=void dt7948.i(this,"postHighlighted")
static{dt7948.g(this.prototype,"currentMenu",[s.tracked],function(){return this.menu.getByIdentifier("post-text-selection-toolbar")})}#fs=void dt7948.i(this,"currentMenu")
menuData={...this.args.outletArgs.data,quoteState:{buffer:this.args.outletArgs.data.quoteState.buffer,opts:this.args.outletArgs.data.quoteState.opts,postId:this.args.outletArgs.data.quoteState.postId},post:this.args.outletArgs.post,selectedRange:(0,a.selectedRange)()}
highlightSelectedText(){const e=this.args.outletArgs.data.quoteState.postId
if(!document.querySelector(`article[data-post-id='${e}'] .cooked`))return
const t=this.menuData.selectedRange
if(t.startContainer.nodeType===Node.TEXT_NODE&&t.startOffset>0){const e=t.startContainer.splitText(t.startOffset)
t.setStart(e,0)}t.endContainer.nodeType===Node.TEXT_NODE&&t.endOffset<t.endContainer.length&&t.endContainer.splitText(t.endOffset)
const s=document.createTreeWalker(t.commonAncestorContainer,NodeFilter.SHOW_TEXT,{acceptNode:e=>t.intersectsNode(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),i=[]
if(s.currentNode?.nodeType===Node.TEXT_NODE)i.push(s.currentNode)
else for(;s.nextNode();)i.push(s.currentNode)
for(let o of i){const e=document.createElement("span")
e.classList.add("ai-helper-highlighted-selection")
const t=o.cloneNode(!0)
e.appendChild(t),o.parentNode.replaceChild(e,o)}window.getSelection().removeAllRanges(),this.postHighlighted=!0}removeHighlightedText(){if(!this.postHighlighted)return
document.querySelectorAll("span.ai-helper-highlighted-selection").forEach(e=>{const t=document.createTextNode(e.textContent)
e.parentNode.replaceChild(t,e)}),this.postHighlighted=!1}async showAiPostHelperMenu(){await this.currentMenu.close(),await this.menu.show(this.currentMenu.trigger,{identifier:"ai-post-helper-menu",component:r.default,interactive:!0,trapTab:!1,closeOnScroll:!1,modalForMobile:!0,data:this.menuData,placement:"top-start",fallbackPlacements:["bottom-start"],updateOnScroll:!1,onClose:()=>{this.removeHighlightedText()}}),await this.currentMenu.destroy(),this.highlightSelectedText()}static{dt7948.n(this.prototype,"showAiPostHelperMenu",[i.action])}static{(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"+glzcLdu",block:'[[[18,1,null],[1,"\\n\\n"],[10,0],[14,0,"ai-post-helper"],[12],[1,"\\n  "],[8,[32,0],[[24,0,"btn-flat ai-post-helper__trigger"]],[["@icon","@title","@label","@action"],["discourse-sparkles","discourse_ai.ai_helper.post_options_menu.title","discourse_ai.ai_helper.post_options_menu.trigger",[30,0,["showAiPostHelperMenu"]]]],null],[1,"\\n"],[13]],["&default"],["yield"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/post-text-buttons/ai-post-helper-trigger.js",scope:()=>[n.default],isStrictMode:!0}),this)}}e.default=c}),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-before-advanced-search/ai-quick-search-loader",["exports","@glimmer/component","@ember/service","discourse/helpers/loading-spinner","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static{dt7948.g(this.prototype,"quickSearch",[s.service])}#bs=void dt7948.i(this,"quickSearch")
static{(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"IlYtsFR5",block:'[[[41,[30,0,["quickSearch","loading"]],[[[1,"  "],[10,0],[14,0,"ai-quick-search-spinner"],[12],[1,"\\n    "],[1,[32,0]],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-before-advanced-search/ai-quick-search-loader.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-bottom/ai-quick-search",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-update","@ember/service","ember-modifier","discourse/components/search-menu","discourse/helpers/loading-spinner","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/search","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static shouldRender(e,{siteSettings:t}){return t.ai_embeddings_semantic_quick_search_enabled}static{dt7948.g(this.prototype,"search",[n.service])}#Ne=void dt7948.i(this,"search")
static{dt7948.g(this.prototype,"siteSettings",[n.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"hasAiResults",[s.tracked],function(){return!1})}#ys=void dt7948.i(this,"hasAiResults")
static{dt7948.g(this.prototype,"searchingWithAi",[s.tracked],function(){return!1})}#vs=void dt7948.i(this,"searchingWithAi")
static{dt7948.g(this.prototype,"lastSearchTerm",[s.tracked],function(){return null})}#ws=void dt7948.i(this,"lastSearchTerm")
markAiResults=(0,a.modifier)(()=>{if(!this.hasAiResults)return
const e=document.querySelector(".search-menu .results")
e&&e.classList.add("has-ai-search-results");(this.search.results?.resultTypes||[]).forEach(e=>{e.results?.forEach(e=>{if(e.aiGenerated){const t=e.topic?.id||e.topic_id
if(t){const e=document.querySelector(`.search-menu .list .item [data-topic-id="${t}"]`)?.closest(".item")
e&&e.classList.add("ai-search-result")}}})})})
get totalResults(){return(this.search.results?.resultTypes||[]).reduce((e,t)=>e+(t.results?.length||0),0)}get hasModifiers(){const e=this.search.activeGlobalSearchTerm||""
return r.MODIFIER_REGEXP.test(e)}get shouldAddAiResults(){const e=this.args.outletArgs?.searchTopics,t=void 0!==this.search.results
return!this.hasAiResults&&!this.searchingWithAi&&e&&t&&(0,c.isValidSearchTerm)(this.search.activeGlobalSearchTerm,this.siteSettings)&&this.totalResults<=3&&!this.hasModifiers&&!this.search.inTopicContext}onSearchTermChange(){this.hasAiResults=!1,this.searchingWithAi=!1,this.lastSearchTerm=null
const e=document.querySelector(".search-menu .results")
e&&e.classList.remove("has-ai-search-results")}static{dt7948.n(this.prototype,"onSearchTermChange",[i.action])}async checkAndAddAiResults(){const e=this.search.activeGlobalSearchTerm
this.lastSearchTerm!==e&&this.shouldAddAiResults&&(this.lastSearchTerm=e,await this.performAiSearch())}static{dt7948.n(this.prototype,"checkAndAddAiResults",[i.action])}async performAiSearch(){this.searchingWithAi=!0,0===this.totalResults&&(this.search.noResults=!1)
try{const e=await(0,d.ajax)("/discourse-ai/embeddings/quick-search",{data:{q:this.search.activeGlobalSearchTerm}}),t=await(0,c.translateResults)(e)
t?.posts?.length>0?(t.posts.forEach(e=>{e.aiGenerated=!0}),this.appendResults(t),this.hasAiResults=!0):this.search.noResults=!0}catch(e){(0,u.popupAjaxError)(e),0===this.totalResults&&(this.search.noResults=!0)}finally{this.searchingWithAi=!1}}#Ss(){if(!this.search.results)return
this.search.results.posts&&(this.search.results.posts=this.search.results.posts.filter(e=>!e.aiGenerated));(this.search.results.resultTypes||[]).forEach(e=>{e.results&&(e.results=e.results.filter(e=>!e.aiGenerated))})}#xs(){const e=new Set
return(this.search.results?.resultTypes||[]).forEach(t=>{t.results?.forEach(t=>{const s=t.topic?.id||t.topic_id
s&&e.add(s)})}),e}appendResults(e){this.search.results||(this.search.results={}),this.#Ss()
const t=this.#xs(),s=e.posts.filter(e=>{const s=e.topic?.id||e.topic_id
return!t.has(s)})
if(0===s.length)return
this.search.results.posts=[...this.search.results.posts||[],...s]
const i=this.search.results.resultTypes||[],o=i.find(e=>"topic"===e.type)
o?o.results=[...o.results,...s]:i.push({results:s,componentName:"search-result-topic",type:"topic",more:!1}),this.search.results.resultTypes=i,this.search.results={...this.search.results},this.search.noResults=!1}static{(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"DjY7DVsJ",block:'[[[11,0],[4,[32,0],[[30,0,["onSearchTermChange"]],[30,0,["search","activeGlobalSearchTerm"]]],null],[4,[32,0],[[30,0,["checkAndAddAiResults"]],[30,0,["totalResults"]]],null],[4,[30,0,["markAiResults"]],null,null],[12],[1,"\\n"],[41,[30,0,["searchingWithAi"]],[[[1,"    "],[10,0],[14,0,"ai-quick-search-loading"],[12],[1,"\\n      "],[10,0],[14,0,"ai-quick-search-loading__content"],[12],[1,"\\n        "],[1,[32,1]],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[13]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-bottom/ai-quick-search.js",scope:()=>[o.default,l.default],isStrictMode:!0}),this)}}e.default=h}),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-discobot-discoveries",["exports","@glimmer/component","@glimmer/tracking","@ember/service","discourse/helpers/d-icon","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries","discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries-tooltip","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static shouldRender(e,{siteSettings:t,currentUser:s}){return t.ai_discover_enabled&&t.ai_discover_persona&&s?.can_use_ai_discover_persona&&s?.user_option?.ai_search_discoveries}static{dt7948.g(this.prototype,"aiCredits",[i.service])}#b=void dt7948.i(this,"aiCredits")
static{dt7948.g(this.prototype,"discobotDiscoveries",[i.service])}#De=void dt7948.i(this,"discobotDiscoveries")
static{dt7948.g(this.prototype,"search",[i.service])}#Ne=void dt7948.i(this,"search")
static{dt7948.g(this.prototype,"creditsAvailable",[s.tracked],function(){return!0})}#ms=void dt7948.i(this,"creditsAvailable")
static{dt7948.g(this.prototype,"creditCheckComplete",[s.tracked],function(){return!1})}#ct=void dt7948.i(this,"creditCheckComplete")
constructor(){super(...arguments),this._checkCredits()}async _checkCredits(){try{this.creditsAvailable=await this.aiCredits.isFeatureCreditAvailable("discoveries")}catch{this.creditsAvailable=!0}this.creditCheckComplete=!0}get shouldShow(){return this.creditCheckComplete&&this.creditsAvailable}static{(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"U+X2eByY",block:'[[[41,[30,0,["shouldShow"]],[[[1,"  "],[10,0],[14,0,"ai-discobot-discoveries"],[12],[1,"\\n"],[41,[30,0,["discobotDiscoveries","showDiscoveryTitle"]],[[[1,"      "],[10,"h3"],[14,0,"ai-search-discoveries__discoveries-title"],[12],[1,"\\n        "],[10,1],[12],[1,"\\n          "],[1,[28,[32,0],["discobot"],null]],[1,"\\n          "],[1,[28,[32,1],["discourse_ai.discobot_discoveries.main_title"],null]],[1,"\\n        "],[13],[1,"\\n\\n        "],[8,[32,2],null,null,null],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"\\n    "],[8,[32,3],null,[["@searchTerm","@discoveryPreviewLength","@closeSearchMenu"],[[30,1,["searchTerm"]],50,[30,1,["closeSearchMenu"]]]],null],[1,"\\n\\n"],[41,[30,0,["search","results","topics","length"]],[[[1,"      "],[10,"h3"],[14,0,"ai-search-discoveries__regular-results-title"],[12],[1,"\\n        "],[1,[28,[32,0],["bars-staggered"],null]],[1,"\\n        "],[1,[28,[32,1],["discourse_ai.discobot_discoveries.regular_results"],null]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "],[13],[1,"\\n"]],[]],null]],["@outletArgs"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-discobot-discoveries.js",scope:()=>[o.default,n.i18n,r.default,a.default],isStrictMode:!0}),this)}}e.default=u})
define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-quick-search-info",["exports","@glimmer/component","@ember/service","discourse/lib/search","discourse-i18n","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static{dt7948.g(this.prototype,"search",[s.service])}#Ne=void dt7948.i(this,"search")
static{dt7948.g(this.prototype,"siteSettings",[s.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"quickSearch",[s.service])}#bs=void dt7948.i(this,"quickSearch")
get termTooShort(){return!(0,i.isValidSearchTerm)(this.search.activeGlobalSearchTerm,this.siteSettings)&&this.quickSearch.invalidTerm&&this.search.activeGlobalSearchTerm?.length>0}static{(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"8A8XYNxM",block:'[[[41,[30,0,["termTooShort"]],[[[1,"  "],[10,0],[14,0,"no-results"],[12],[1,[28,[32,0],["search.too_short"],null]],[13],[1,"\\n"]],[]],null]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-quick-search-info.js",scope:()=>[o.i18n],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-category-after/ai-category-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showPostAIHelper)(e,t)}static{dt7948.g(this.prototype,"siteSettings",[s.service])}#l=void dt7948.i(this,"siteSettings")
static{(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"6pKA3AuT",block:'[[[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"  "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction"],[[30,1,["selectedPosts"]],"suggest_category",[30,1,["updateCategoryId"]]]],null],[1,"\\n"]],[]],null]],["@outletArgs"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-category-after/ai-category-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-tag-after/ai-tag-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showPostAIHelper)(e,t)}static{dt7948.g(this.prototype,"siteSettings",[s.service])}#l=void dt7948.i(this,"siteSettings")
static{(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"r4+ScahE",block:'[[[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"  "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction","@currentValue"],[[30,1,["selectedPosts"]],"suggest_tags",[30,1,["updateTags"]],[30,1,["tags"]]]],null],[1,"\\n"]],[]],null]],["@outletArgs"],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-tag-after/ai-tag-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-title-after/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showPostAIHelper)(e,t)}static{(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"1bYoKdrW",block:'[[[8,[32,0],null,[["@selectedPosts","@mode","@updateAction"],[[30,1,["selectedPosts"]],"suggest_title",[30,1,["updateTopicName"]]]],null]],["@outletArgs"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-title-after/ai-title-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/connectors/topic-map-expanded-after/ai-summary-trigger",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/service","@ember/template","ember-modifier","discourse/components/d-button","discourse/plugins/discourse-ai/discourse/components/modal/ai-summary-modal","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends t.default{static{dt7948.g(this.prototype,"aiCredits",[a.service])}#b=void dt7948.i(this,"aiCredits")
static{dt7948.g(this.prototype,"currentUser",[a.service])}#A=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"modal",[a.service])}#O=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"tooltip",[a.service])}#x=void dt7948.i(this,"tooltip")
static{dt7948.g(this.prototype,"creditStatus",[s.tracked],function(){return null})}#k=void dt7948.i(this,"creditStatus")
static{dt7948.g(this.prototype,"creditCheckComplete",[s.tracked],function(){return!1})}#ct=void dt7948.i(this,"creditCheckComplete")
creditLimitTooltipModifier=(0,l.modifier)(e=>{if(!this.isDisabled)return
const t=this.tooltip.register(e,{identifier:"ai-credit-limit-tooltip",content:(0,r.htmlSafe)(this.aiCredits.getCreditLimitMessage(this.creditStatus)),placement:"top",triggers:"hover",interactive:!0})
return()=>t.destroy()})
get isAiConversation(){return this.args.outletArgs.topic.is_bot_pm}get hasCachedSummary(){return this.args.outletArgs.topic.has_cached_summary}get isDisabled(){return!this.hasCachedSummary&&(!!this.creditCheckComplete&&!0===this.creditStatus?.hard_limit_reached)}async checkCredits(){if(this.creditStatus=null,this.creditCheckComplete=!1,this.currentUser)try{this.creditStatus=await this.aiCredits.getFeatureCreditStatus("topic_summaries")}catch{this.creditStatus=null}finally{this.creditCheckComplete=!0}else this.creditCheckComplete=!0}static{dt7948.n(this.prototype,"checkCredits",[i.action])}openAiSummaryModal(){this.isDisabled||this.modal.show(u.default,{model:{topic:this.args.outletArgs.topic,postStream:this.args.outletArgs.postStream}})}static{dt7948.n(this.prototype,"openAiSummaryModal",[i.action])}static{(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"4O6eWOm1",block:'[[[41,[51,[30,0,["isAiConversation"]]],[[[41,[30,1,["topic","summarizable"]],[[[1,"    "],[11,"section"],[24,0,"topic-map__additional-contents toggle-summary"],[4,[32,0],[[30,0,["checkCredits"]]],null],[4,[32,1],[[30,0,["checkCredits"]],[30,1,["topic","id"]]],null],[4,[30,0,["creditLimitTooltipModifier"]],null,null],[12],[1,"\\n      "],[8,[32,2],[[24,0,"btn-default ai-summarization-button"]],[["@label","@icon","@action","@disabled"],["summary.buttons.generate","discourse-sparkles",[30,0,["openAiSummaryModal"]],[30,0,["isDisabled"]]]],null],[1,"\\n    "],[13],[1,"\\n"]],[]],null]],[]],null]],["@outletArgs"],["unless","if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/topic-map-expanded-after/ai-summary-trigger.js",scope:()=>[o.default,n.default,d.default],isStrictMode:!0}),this)}}e.default=m}),define("discourse/plugins/discourse-ai/discourse/connectors/topic-map-participants-after/ai-conversation-invite",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/components/header/topic/participant","discourse/components/modal/add-pm-participants","discourse/truth-helpers","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static shouldRender(e){return e.topic.is_bot_pm}static{dt7948.g(this.prototype,"modal",[i.service])}#O=void dt7948.i(this,"modal")
static{dt7948.g(this.prototype,"header",[i.service])}#ks=void dt7948.i(this,"header")
get participants(){return[...this.header.topicInfo.details?.allowed_users??[],...this.header.topicInfo.details?.allowed_groups??[]]}showInvite(){this.modal.show(a.default,{model:{title:"discourse_ai.ai_bot.invite_ai_conversation.title",inviteModel:this.args.outletArgs.topic}})}static{dt7948.n(this.prototype,"showInvite",[s.action])}static{(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"AS7AnLI2",block:'[[[10,0],[14,0,"ai-conversation__participants"],[12],[1,"\\n  "],[8,[32,0],[[24,0,"btn-default ai-conversations__invite-button"]],[["@icon","@label","@action"],["user-plus","discourse_ai.ai_bot.invite_ai_conversation.button",[30,0,["showInvite"]]]],null],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["participants"]]],null]],null],null,[[[1,"    "],[8,[32,1],null,[["@user","@type","@username","@avatarSize"],[[30,1],[52,[30,1,["username"]],"user","group"],[28,[32,2],[[30,1,["username"]],[30,1,["name"]]],null],"medium"]],null],[1,"\\n"]],[1]],null],[13]],["participant"],["each","-track-array","if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/topic-map-participants-after/ai-conversation-invite.js",scope:()=>[o.default,n.default,r.or],isStrictMode:!0}),this)}}e.default=u}),define("discourse/plugins/discourse-ai/discourse/connectors/user-messages-controls-bottom/pm-list-gist-toggle",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static{dt7948.g(this.prototype,"topicThumbnails",[s.service])}#us=void dt7948.i(this,"topicThumbnails")
get shouldShow(){return!this.topicThumbnails?.enabledForRoute}static{(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"rMYGMZb1",block:'[[[41,[30,0,["shouldShow"]],[[[1,"  "],[8,[32,0],null,null,null],[1,"\\n"]],[]],null]],[],["if"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/user-messages-controls-bottom/pm-list-gist-toggle.js",scope:()=>[i.default],isStrictMode:!0}),this)}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/connectors/user-preferences-interface/ai-search-discoveries",["exports","@glimmer/component","discourse/components/preference-checkbox","@ember/component","@ember/template-factory"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e,t){const{siteSettings:s,currentUser:i}=t
return s.discourse_ai_enabled&&s.ai_discover_enabled&&s.ai_discover_persona&&i?.can_use_ai_discover_persona}static{(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"CJ/I+4z7",block:'[[[10,"fieldset"],[14,0,"control-group ai-preferences"],[12],[1,"\\n  "],[8,[32,0],[[24,"data-setting-name","ai-search-discoveries"],[24,0,"pref-ai-search-discoveries"]],[["@labelKey","@checked"],["discourse_ai.discobot_discoveries.user_setting",[30,1,["model","user_option","ai_search_discoveries"]]]],null],[1,"\\n"],[13]],["@outletArgs"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/connectors/user-preferences-interface/ai-search-discoveries.js",scope:()=>[s.default],isStrictMode:!0}),this)}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/controllers/admin/dashboard-sentiment",["exports","@ember/object","discourse/admin/controllers/admin-dashboard-tab"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{get filters(){return{startDate:this.startDate,endDate:this.endDate}}static{dt7948.n(this.prototype,"filters",[(0,t.computed)("startDate","endDate")])}get emotionFilters(){return{startDate:moment().subtract(2,"month").format("YYYY-MM-DD"),endDate:moment().format("YYYY-MM-DD")}}get emotions(){return["admiration","amusement","anger","annoyance","approval","caring","confusion","curiosity","desire","disappointment","disapproval","disgust","embarrassment","excitement","fear","gratitude","grief","joy","love","nervousness","neutral","optimism","pride","realization","relief","remorse","sadness","surprise"]}}e.default=i}),define("discourse/plugins/discourse-ai/discourse/controllers/discourse-ai-bot-conversations",["exports","@glimmer/tracking","@ember/controller"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static{dt7948.g(this.prototype,"llm",[t.tracked],function(){return null})}#ge=void dt7948.i(this,"llm")
static{dt7948.g(this.prototype,"persona",[t.tracked],function(){return null})}#Ts=void dt7948.i(this,"persona")
queryParams=["llm","persona"]}e.default=i}),define("discourse/plugins/discourse-ai/discourse/discourse-ai-bot-dashboard-route-map",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){this.route("discourse-ai-bot-conversations",{path:"/discourse-ai/ai-bot/conversations"})}}),define("discourse/plugins/discourse-ai/discourse/discourse-ai-shared-conversation-show-route-map",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){this.route("discourse-ai-shared-conversation-show",{path:"/discourse-ai/ai-bot/shared-ai-conversations/:share_key"})}}),define("discourse/plugins/discourse-ai/discourse/initializers/add-ai-bot-to-community-section",["exports","discourse/lib/plugin-api","discourse-i18n"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"add-ai-bot-to-community-section",initialize(e){const i=e.lookup("service:site-settings"),o=e.lookup("service:current-user")
if(!o||!i.ai_bot_add_to_community_section||!o.ai_enabled_chat_bots?.length)return
0!==o.ai_enabled_chat_bots.filter(e=>!e.is_persona||e.has_default_llm).length&&(0,t.withPluginApi)(e=>{e.addCommunitySectionLink(e=>class extends e{name="ai-bot"
route="discourse-ai-bot-conversations"
text=(0,s.i18n)("discourse_ai.ai_bot.shortcut_link")
title=(0,s.i18n)("discourse_ai.ai_bot.shortcut_title")
defaultPrefixValue="robot"})})}}}),define("discourse/plugins/discourse-ai/discourse/initializers/admin-plugin-configuration-nav",["exports","discourse/lib/plugin-api"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s="discourse-ai"
e.default={name:"discourse-ai-admin-plugin-configuration-nav",initialize(e){const i=e.lookup("service:current-user")
i&&i.admin&&(0,t.withPluginApi)(e=>{e.setAdminPluginIcon(s,"discourse-sparkles"),e.addAdminPluginConfigurationNav(s,[{label:"discourse_ai.features.short_title",route:"adminPlugins.show.discourse-ai-features",description:"discourse_ai.features.description"},{label:"discourse_ai.usage.short_title",route:"adminPlugins.show.discourse-ai-usage",description:"discourse_ai.usage.subheader_description"},{label:"discourse_ai.llms.short_title",route:"adminPlugins.show.discourse-ai-llms",description:"discourse_ai.llms.preconfigured.description"},{label:"discourse_ai.secrets.short_title",route:"adminPlugins.show.discourse-ai-secrets",description:"discourse_ai.secrets.description"},{label:"discourse_ai.ai_persona.short_title",route:"adminPlugins.show.discourse-ai-personas",description:"discourse_ai.ai_persona.persona_description"},{label:"discourse_ai.embeddings.short_title",route:"adminPlugins.show.discourse-ai-embeddings",description:"discourse_ai.embeddings.description"},{label:"discourse_ai.tools.short_title",route:"adminPlugins.show.discourse-ai-tools",description:"discourse_ai.tools.subheader_description"},{label:"discourse_ai.spam.short_title",route:"adminPlugins.show.discourse-ai-spam",description:"discourse_ai.spam.spam_description"},{label:"discourse_ai.translations.title",route:"adminPlugins.show.discourse-ai-translations",description:"discourse_ai.translations.description"}])})}}}),define("discourse/plugins/discourse-ai/discourse/initializers/admin-reports",["exports","discourse/lib/plugin-api","discourse/lib/utilities","discourse/plugins/discourse-ai/discourse/components/admin-report-emotion"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"discourse-ai-admin-reports",initialize(e){const o=e.lookup("service:current-user")
if(!o||!o.staff)return
const n=(0,s.optionalRequire)("discourse/plugins/discourse-ai/discourse/components/admin-report-sentiment-analysis");(0,t.withPluginApi)(e=>{e.registerReportModeComponent("emotion",i.default),e.registerReportModeComponent("sentiment_analysis",n),e.registerValueTransformer("admin-reports-show-query-params",({value:e})=>[...e,"selectedChart"])})}}}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-artifacts",["exports","discourse/lib/plugin-api","discourse/plugins/discourse-ai/discourse/components/ai-artifact","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,n){"use strict"
function a(e){e.decorateCookedElement((e,t)=>{t.renderGlimmer&&[...e.querySelectorAll("div.ai-artifact")].forEach(e=>{const a=e.getAttribute("data-ai-artifact-id"),r=e.getAttribute("data-ai-artifact-version"),l=e.getAttribute("data-ai-artifact-height"),d=e.getAttribute("data-ai-artifact-autorun")||e.hasAttribute("data-ai-artifact-autorun"),u=e.getAttribute("data-ai-artifact-seamless")||e.hasAttribute("data-ai-artifact-seamless"),c={}
for(const t of e.attributes)t.name.startsWith("data-")&&"data-ai-artifact-id"!==t.name&&"data-ai-artifact-version"!==t.name&&"data-ai-artifact-height"!==t.name&&"data-ai-artifact-autorun"!==t.name&&"data-ai-artifact-seamless"!==t.name&&(c[t.name]=t.value)
t.renderGlimmer(e,(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"utVXp9xh",block:'[[[8,[32,0],null,[["@artifactId","@artifactVersion","@artifactHeight","@autorun","@seamless","@dataAttributes"],[[32,1],[32,2],[32,3],[32,4],[32,5],[32,6]]],null]],[],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/initializers/ai-artifacts.js",scope:()=>[s.default,a,r,l,d,u,c],isStrictMode:!0}),(0,n.default)(void 0,void 0)))})},{id:"ai-artifact",onlyStream:!0})}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"ai-artifact",initialize(){(0,t.withPluginApi)(a)}}}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-bot-replies",["exports","discourse/lib/plugin-api","discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon","discourse/plugins/discourse-ai/discourse/components/post/ai-persona-flair","discourse/plugins/discourse-ai/discourse/components/post/meta-data/ai-cancel-streaming","discourse/plugins/discourse-ai/discourse/components/post-menu/ai-cancel-streaming-button","discourse/plugins/discourse-ai/discourse/components/post-menu/ai-debug-button","discourse/plugins/discourse-ai/discourse/components/post-menu/ai-retry-streaming-button","discourse/plugins/discourse-ai/discourse/components/post-menu/ai-share-button","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/progress-handlers"],function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
let c=!1
function p(e){(function(e){e.registerValueTransformer("post-menu-buttons",({value:e,context:{post:t,firstButtonKey:s}})=>{(0,d.isGPTBot)(t.user)&&e.add("ai-cancel-gpt",n.default,{before:s,after:["ai-share","ai-debug"]})}),e.registerValueTransformer("post-meta-data-infos",({value:e,context:{post:t,metaDataInfoKeys:s}})=>{(0,d.isGPTBot)(t.user)&&e.add("ai-cancel-streaming",o.default,{before:s.DATE})})})(e),e.modifyClass("controller:topic",{pluginId:"discourse-ai",onAIBotStreamedReply:function(e){(0,u.streamPostText)(this.model.postStream,e)},subscribe:function(){this._super(),this.model.isPrivateMessage&&this.model.details.allowed_users&&this.model.details.allowed_users.filter(d.isGPTBot).length>=1&&this.messageBus.subscribe(`discourse-ai/ai-bot/topic/${this.model.id}`,this.onAIBotStreamedReply.bind(this),-3)},unsubscribe:function(){(0,u.cleanupStreamingData)(this.model.postStream),this.messageBus.unsubscribe("discourse-ai/ai-bot/topic/*"),this._super()}})}e.default={name:"discourse-ai-bot-replies",initialize(e){const o=e.lookup("service:current-user")
o?.ai_enabled_chat_bots&&(c=o.can_debug_ai_bot_conversations,(0,t.withPluginApi)(e=>{(function(e){e.headerIcons.add("ai",s.default)})(e),p(e),function(e){e.renderAfterWrapperOutlet("post-meta-data-poster-name",i.default)}(e),function(e){const t=e.getCurrentUser()
t&&t.ai_enabled_chat_bots&&c&&e.registerValueTransformer("post-menu-buttons",({value:e,context:{post:t,firstButtonKey:s}})=>{"private_message"===t.topic?.archetype&&e.add("ai-debug",a.default,{before:s,after:"ai-share"})})}(e),function(e){const t=e.getCurrentUser()
t&&t.ai_enabled_chat_bots&&e.registerValueTransformer("post-menu-buttons",({value:e,context:{post:t,firstButtonKey:s}})=>{"private_message"===t.topic?.archetype&&e.add("ai-share",l.default,{before:s})})}(e),function(e){const t=e.container.lookup("service:modal"),s=e.container.lookup("service:current-user")
e.registerTopicFooterButton({id:"share-ai-conversation",icon:"share-nodes",label:"discourse_ai.ai_bot.share_ai_conversation.name",title:"discourse_ai.ai_bot.share_ai_conversation.title",action(){(0,d.showShareConversationModal)(t,this.topic.id)},classNames:["share-ai-conversation-button"],dependentKeys:["topic.ai_persona_name"],displayed(){return s?.can_share_ai_bot_conversations&&this.topic.ai_persona_name}})}(e),function(e){e.registerValueTransformer("post-menu-buttons",({value:e,context:{post:t,firstButtonKey:s}})=>{(0,d.isGPTBot)(t.user)&&e.add("ai-retry",r.default,{before:s,after:["ai-cancel-gpt","ai-share","ai-debug"]})})}(e)}))}}}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-chat-summarization",["exports","discourse/lib/api","discourse/plugins/discourse-ai/discourse/components/modal/chat-modal-channel-summary"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)(e=>{const t=e.container.lookup("service:site-settings"),i=e.getCurrentUser(),o=e.container.lookup("service:chat"),n=e.container.lookup("service:modal"),a=i&&i.can_summarize
t.chat_enabled&&o?.userCanChat&&a&&e.registerChatComposerButton({translatedLabel:"discourse_ai.summarization.chat.title",id:"channel-summary",icon:"discourse-sparkles",position:"dropdown",action:()=>{n.show(s.default,{model:{channelId:o.activeChannel?.id}})}})})}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-conversations-sidebar",["exports","discourse/lib/plugin-api","discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-new-conversation","discourse/plugins/discourse-ai/discourse/services/ai-conversations-sidebar-manager"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"ai-conversations-sidebar",initialize(){(0,t.withPluginApi)(e=>{const t=e.container.lookup("service:current-user")
if(!t)return
const o=e.container.lookup("service:ai-conversations-sidebar-manager")
o.api=e,e.addSidebarPanel(e=>class extends e{key=i.AI_CONVERSATIONS_PANEL
hidden=!0
displayHeader=!1
expandActiveSection=!0}),e.renderInOutlet("before-sidebar-sections",s.default)
e.container.lookup("service:router").on("routeDidChange",s=>{if("discourse-ai-bot-conversations"===s?.to?.name)return o.forceCustomSidebar()
const i=e.container.lookup("controller:topic").model
if("private_message"===i?.archetype&&i.user_id===t.id&&i.is_bot_pm)return o.forceCustomSidebar()
o.stopForcingCustomSidebar()})})}}}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-gist-connector",["exports","@glimmer/component","discourse/lib/api","discourse/plugins/discourse-ai/discourse/components/ai-topic-gist","discourse/plugins/discourse-ai/discourse/components/bulk-actions/ai-regen-summaries","discourse/plugins/discourse-ai/discourse/components/modal/ai-regen-summaries-modal","@ember/component","@ember/template-factory"],function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,s.apiInitializer)(e=>{const s=e.container.lookup("service:site-settings"),l=e.getCurrentUser()
if(e.addBulkActionButton({label:"discourse_ai.summarization.topic.regenerate_ai_summaries",icon:"arrows-rotate",class:"btn-default",visible:({topics:e,siteSettings:t,currentUser:s})=>!(e?.length>30)&&(t.discourse_ai_enabled&&t.ai_summarization_enabled&&s.staff),action({setComponent:e,topics:t,afterBulkAction:s}){e(o.default,{topics:t,afterBulkAction:s})},actionType:"setComponent"}),s.discourse_ai_enabled&&s.ai_summarization_enabled){const d={mobile:"topic-list-main-link-bottom",desktop:"topic-list-topic-cell-link-bottom-line__before"}
function u(s,o){e.renderInOutlet(s,class extends t.default{static shouldRender(e,t,s){if(!o(t))return!1
const i=s.lookup("service:router")
return n=i.currentRouteName,!!(n?.startsWith("discovery.")||n?.startsWith("filter")||n?.startsWith("userPrivateMessages")||n?.startsWith("topic.")||n?.startsWith("tag.")||n?.startsWith("tags."))
var n}static{(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"+FXY+VrG",block:'[[[8,[32,0],null,[["@topic"],[[30,1]]],null]],["@topic"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/initializers/ai-gist-connector.js",scope:()=>[i.default],isStrictMode:!0}),this)}})}u(d.mobile,e=>e.site.mobileView),u(d.desktop,e=>e.site.desktopView),e.addTopicAdminMenuButton(t=>{if(!l?.staff)return
const s=e.container.lookup("service:modal")
return{action:()=>{s.show(n.default,{model:{topic:t}})},icon:"arrows-rotate",className:"regenerate-ai-summaries-button",label:"discourse_ai.summarization.topic.regenerate_ai_summaries"}})}})}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-gist-topic-list-class",["exports","discourse/lib/api"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)(e=>{const t=e.container.lookup("service:gists")
e.registerValueTransformer("topic-list-item-class",({value:e,context:s})=>{const i="table-ai"===t.currentPreference&&t.showToggle
return s.topic.get("ai_topic_gist")&&i&&e.push("excerpt-expanded"),e})})}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-helper",["exports","discourse/lib/plugin-api","discourse/lib/wait-for-keyboard","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-composer-helper-menu","discourse/plugins/discourse-ai/discourse/components/modal/diff-modal","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper"],function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"discourse-ai-helper",initialize(){(0,t.withPluginApi)(e=>{(function(e){e.onToolbarCreate(t=>{const r=e.getCurrentUser(),l=e.container.lookup("service:modal"),d=e=>{const t=e.getText(),s=e.selected.value
return s&&s.length>0?s:t&&t.length>0?t:void 0}
t.addButton({id:"ai-helper-trigger",group:"extras",icon:"discourse-sparkles",title:"discourse_ai.ai_helper.context_menu.trigger",preventFocus:!0,hideShortcutInTitle:!0,shortcut:"ALT+P",shortcutAction:t=>{if(0===t.getText().length)return e.container.lookup("service:toasts").error({class:"ai-proofread-error-toast",duration:"short",data:{message:(0,i.i18n)("discourse_ai.ai_helper.no_content_error")}})
const s=r?.ai_helper_prompts.find(e=>"proofread"===e.name).name
l.show(n.default,{model:{mode:s,selectedText:d(t),toolbarEvent:t,showResultAsDiff:!0}})},condition:()=>(0,a.showComposerAiHelper)(e.container.lookup("service:composer").model,e.container.lookup("service:site-settings"),r,"context_menu"),sendAction:async t=>{const i=e.container.lookup("service:capabilities"),n=e.container.lookup("service:site")
await(0,s.waitForClosedKeyboard)(i,n),e.container.lookup("service:menu").show(document.querySelector(".ai-helper-trigger"),{identifier:"ai-composer-helper-menu",component:o.default,modalForMobile:!0,interactive:!0,data:{toolbarEvent:t,selectedText:d(t)}})}})})})(e)})}}}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-image-caption",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/api","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/ai-errors"],function(e,t,s,i,o,n){"use strict"
function a(e){return!!e&&/\.(png|jpe?g|gif|webp)$/i.test(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,i.apiInitializer)(e=>{const i={label:(0,o.i18n)("discourse_ai.ai_helper.image_caption.button_label"),icon:"discourse-sparkles",class:"generate-caption"},r=e.container.lookup("service:site-settings"),l=e.getCurrentUser()
r.ai_helper_enabled_features.includes("image_caption")&&l?.can_use_assistant&&e.addComposerImageWrapperButton(i.label,i.class,i.icon,i=>{const o=e.container.lookup("service:imageCaptionPopup")
if(o.popupTrigger=i.target,o.popupTrigger.classList.contains("generate-caption")){const a=i.target.closest(".button-wrapper"),r=parseInt(a.getAttribute("data-image-index"),10),l=i.target.closest(".image-wrapper").querySelector("img").getAttribute("src")
o.toggleLoadingState(!0)
const d=e.container.lookup("service:site")
d.mobileView||(o.showPopup=!o.showPopup),o._request=(0,t.ajax)("/discourse-ai/ai-helper/caption_image",{method:"POST",data:{image_url:l,image_url_type:"long_url"}}),o._request.then(({caption:e})=>{o.imageSrc=l,o.imageIndex=r,o.newCaption=e,d.mobileView&&o.updateCaption()}).catch(e=>{(0,n.isAiCreditLimitError)(e)?(0,n.popupAiCreditLimitError)(e):(0,s.popupAjaxError)(e)}).finally(()=>{o.toggleLoadingState(!1)})}},a)})}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-search-discoveries",["exports","discourse/lib/api"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)(e=>{const t=e.getCurrentUser()
if(!e.container.lookup("service:site-settings").ai_discover_enabled||!t?.can_use_ai_discover_persona)return
e.addSaveableUserOption("ai_search_discoveries",{page:"interface"})
const s=e.container.lookup("service:discobot-discoveries")
e.addSearchMenuOnKeyDownCallback((e,t)=>{if(!e)return
const i=e.search.activeGlobalSearchTerm
return e.search?.searchContext?.type||s.lastQuery===i||"Enter"===t.key&&i?.length>0&&s.triggerDiscovery(i),!0})
const i=e.container.lookup("service:search")
e.addSearchMenuAssistantSelectCallback(e=>(e.updatedTerm===s.lastQuery&&s.discovery||i?.searchContext?.type||e.updatedTerm&&s.triggerDiscovery(e.updatedTerm),!0))})}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-semantic-search",["exports","discourse/lib/api"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)(e=>{e.modifyClass("component:search-result-entry",{pluginId:"discourse-ai",classNameBindings:["bulkSelectEnabled","post.generatedByAi:ai-result"]})})}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-sentiment-admin-nav",["exports","discourse/lib/api"],function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)(e=>{const t=e.getCurrentUser()
t&&t.staff&&t.can_see_sentiment_reports&&(e.addAdminSidebarSectionLink("reports",{name:"sentiment_overview",route:"admin.dashboardSentiment",label:"discourse_ai.sentiments.sidebar.overview",icon:"chart-column",moderator:!0}),e.addAdminSidebarSectionLink("reports",{name:"sentiment_analysis",route:"adminReports.show",routeModels:["sentiment_analysis"],label:"discourse_ai.sentiments.sidebar.analysis",icon:"chart-pie",moderator:!0}))})}),define("discourse/plugins/discourse-ai/discourse/initializers/ai-translation-topic-admin",["exports","discourse/lib/ajax","discourse/lib/api","discourse-i18n"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,s.apiInitializer)(e=>{const s=e.container.lookup("service:site-settings")
s.discourse_ai_enabled&&s.ai_translation_enabled&&e.addTopicAdminMenuButton(o=>{const n=e.getCurrentUser()
if(!n)return
const a=s.content_localization_allowed_groups.split("|").map(e=>parseInt(e,10)),r=n.groups.map(e=>e.id)
return a.some(e=>r.includes(e))?{action:async()=>{const s=e.container.lookup("service:toasts")
try{const e=await(0,t.ajax)(`/discourse-ai/translate/topics/${o.id}`,{type:"POST"})
s.success({duration:"long",data:{message:(0,i.i18n)("discourse_ai.translation.schedule_topic_success",{count:e.scheduled_posts})}})}catch(n){const e=n.jqXHR?.responseJSON?.errors?.[0]||(0,i.i18n)("discourse_ai.translation.schedule_topic_error")
s.error({duration:"long",data:{message:e}})}},icon:"language",className:"schedule-topic-translations-button",label:"discourse_ai.features.translation.schedule_untranslated"}:void 0})})}),define("discourse/plugins/discourse-ai/discourse/initializers/related-topics",["exports","@glimmer/tracking","discourse/components/basic-topic-list","discourse/helpers/d-icon","discourse/lib/plugin-api","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"VYbJm81O",block:'[[[10,0],[14,"role","complementary"],[14,"aria-labelledby","related-topics-title"],[14,1,"related-topics"],[14,0,"more-topics__list"],[12],[1,"\\n  "],[10,"h3"],[14,1,"related-topics-title"],[14,0,"more-topics__list-title"],[12],[1,"\\n    "],[1,[28,[32,0],["discourse-sparkles"],null]],[1,[28,[32,1],["discourse_ai.related_topics.title"],null]],[1,"\\n  "],[13],[1,"\\n  "],[10,0],[14,0,"topics"],[12],[1,"\\n    "],[8,[32,2],null,[["@topics"],[[30,1,["relatedTopics"]]]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],["@topic"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/initializers/related-topics.js",scope:()=>[i.default,n.i18n,s.default],isStrictMode:!0}),(0,l.default)(void 0,"related-topics:RelatedTopics"))
e.default={name:"discourse-ai-related-topics",initialize(e){const s=e.lookup("service:site-settings")
s.ai_embeddings_enabled&&s.ai_embeddings_semantic_related_topics_enabled&&(0,o.withPluginApi)(e=>{e.registerMoreTopicsTab({id:"related-topics",name:(0,n.i18n)("discourse_ai.related_topics.pill"),icon:"discourse-sparkles",component:d,condition:({topic:e})=>e.relatedTopics?.length}),e.modifyClass("model:topic",e=>class extends e{static{dt7948.g(this.prototype,"_relatedTopicsRecords",[t.tracked],function(){return null})}#Cs=void dt7948.i(this,"_relatedTopicsRecords")
set related_topics(e){e?.length&&(this._relatedTopicsRecords=e.map(e=>this.store.createRecord("topic",e)))}get relatedTopics(){return this._relatedTopicsRecords}}),e.modifyClass("model:post-stream",e=>class extends e{_setSuggestedTopics(e){super._setSuggestedTopics(...arguments),e.related_topics&&(this.topic.related_topics=e.related_topics)}})})}}}),define("discourse/plugins/discourse-ai/discourse/initializers/translation",["exports","discourse/lib/api","discourse/lib/cookie"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)(e=>{const t=e.container.lookup("service:site-settings")
t.discourse_ai_enabled&&t.ai_translation_enabled&&e.registerCustomPostMessageCallback("localized",(e,t)=>{if(!(0,s.default)("content-localization-show-original")){e.get("model.postStream").triggerChangedPost(t.id,t.updated_at)}})})}),define("discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/get-owner","discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.getBotType=function(e){if(!e)return
r()
const t=a[e.id]
if(!t)return
return t.is_persona?"persona":"llm"},e.isGPTBot=function(e){if(!e)return
return r(),!!a[e.id]},e.isPostFromAiBot=function(e,t){return e.user_id<=n||!!t?.ai_enabled_chat_bots?.some(t=>e.username===t.username)},e.showShareConversationModal=function(e,i){(0,t.ajax)(`/discourse-ai/ai-bot/shared-ai-conversations/preview/${i}.json`).then(t=>{e.show(o.default,{model:t})}).catch(s.popupAjaxError)}
const n=-1200
let a=null
function r(){if(!a){const e=(0,i.getOwnerWithFallback)(this).lookup("service:current-user")
a={},e?.ai_enabled_chat_bots?.forEach(e=>{a[e.id]=e})}}})
define("discourse/plugins/discourse-ai/discourse/lib/ai-errors",["exports","@ember/template","discourse/lib/get-owner","discourse-i18n"],function(e,t,s,i){"use strict"
function o({resetTime:e,isAdmin:t}={}){const s=t?"admin":"user"
return e&&e.length>0?(0,i.i18n)(`discourse_ai.errors.credit_limit_dialog.message_${s}`,{reset_time:e}):(0,i.i18n)(`discourse_ai.errors.credit_limit_dialog.message_without_time_${s}`)}Object.defineProperty(e,"__esModule",{value:!0}),e.getAiCreditLimitMessage=o,e.isAiCreditLimitError=function(e){if(!e)return!1
if("credit_limit_exceeded"===e.jqXHR?.responseJSON?.error)return!0
if("credit_limit_exceeded"===e.error_type)return!0
if("credit_limit_exceeded"===e.error)return!0
return!1},e.popupAiCreditLimitError=function(e){const n=(0,s.getOwnerWithFallback)(this).lookup("service:dialog"),a=(0,s.getOwnerWithFallback)(this).lookup("service:current-user"),r=e.jqXHR?.responseJSON?.details||e.details||{},l=o({resetTime:r?.reset_time_absolute||r?.reset_time_relative||r?.reset_time,isAdmin:a?.admin})
n.alert({title:(0,i.i18n)("discourse_ai.errors.credit_limit_dialog.title"),message:(0,t.htmlSafe)(l)})}}),define("discourse/plugins/discourse-ai/discourse/lib/ai-feature-setting-groups",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.AI_FEATURE_SETTING_GROUPS=void 0,e.getSettingGroupsForFeature=function(e){return t[e]||[]}
const t=e.AI_FEATURE_SETTING_GROUPS={ai_helper:[{key:"access_permissions",titleKey:"discourse_ai.features.ai_helper.setting_groups.access_permissions",settings:["ai_helper_enabled","composer_ai_helper_allowed_groups","post_ai_helper_allowed_groups","ai_helper_allowed_in_pm"]},{key:"enabled_features",titleKey:"discourse_ai.features.ai_helper.setting_groups.enabled_features",settings:["ai_helper_enabled_features"]},{key:"automation",titleKey:"discourse_ai.features.ai_helper.setting_groups.automation",settings:["ai_helper_automatic_chat_thread_title","ai_helper_automatic_chat_thread_title_delay"]},{key:"personas",titleKey:"discourse_ai.features.ai_helper.setting_groups.personas",settings:["ai_helper_proofreader_persona","ai_helper_title_suggestions_persona","ai_helper_explain_persona","ai_helper_post_illustrator_persona","ai_helper_smart_dates_persona","ai_helper_translator_persona","ai_helper_markdown_tables_persona","ai_helper_custom_prompt_persona","ai_helper_image_caption_persona","ai_helper_chat_thread_title_persona"]}],embeddings:[{key:"model_settings",titleKey:"discourse_ai.features.embeddings.setting_groups.model_settings",settings:["ai_embeddings_enabled","ai_embeddings_selected_model","ai_embeddings_generate_for_pms"]},{key:"related_topics",titleKey:"discourse_ai.features.embeddings.setting_groups.related_topics",settings:["ai_embeddings_semantic_related_topics_enabled","ai_embeddings_semantic_related_topics","ai_embeddings_semantic_related_include_closed_topics","ai_embeddings_semantic_related_age_penalty","ai_embeddings_semantic_related_age_time_scale"]},{key:"semantic_search",titleKey:"discourse_ai.features.embeddings.setting_groups.semantic_search",settings:["ai_embeddings_semantic_search_enabled","ai_embeddings_semantic_search_use_hyde","ai_embeddings_semantic_quick_search_enabled","ai_embeddings_semantic_search_hyde_persona"]}],bot:[{key:"settings",titleKey:"discourse_ai.features.bot.setting_groups.settings",settings:["ai_bot_enabled","ai_bot_enabled_llms","ai_bot_enable_chat_warning"]},{key:"access_control",titleKey:"discourse_ai.features.bot.setting_groups.access_control",settings:["ai_bot_debugging_allowed_groups","ai_bot_allowed_groups","ai_bot_public_sharing_allowed_groups"]},{key:"ui_settings",titleKey:"discourse_ai.features.bot.setting_groups.ui_settings",settings:["ai_bot_add_to_header","ai_bot_add_to_community_section"]},{key:"integrations",titleKey:"discourse_ai.features.bot.setting_groups.integrations",settings:["ai_bot_github_access_token"]}],summarization:[{key:"settings",titleKey:"discourse_ai.features.summarization.setting_groups.settings",settings:["ai_summarization_enabled","ai_summarization_persona","ai_pm_summarization_allowed_groups"]},{key:"gists",titleKey:"discourse_ai.features.summarization.setting_groups.gists",settings:["ai_summary_gists_enabled","ai_summary_gists_persona"]},{key:"backfill",titleKey:"discourse_ai.features.summarization.setting_groups.backfill",settings:["ai_summary_backfill_topic_max_age_days","ai_summary_backfill_maximum_topics_per_hour","ai_summary_backfill_minimum_word_count"]}],search:[{key:"settings",titleKey:"discourse_ai.features.search.setting_groups.settings",settings:["ai_discover_enabled","ai_discover_persona"]}],translation:[{key:"settings",titleKey:"discourse_ai.features.translation.setting_groups.settings",settings:["ai_translation_enabled"]},{key:"personas",titleKey:"discourse_ai.features.translation.setting_groups.personas",settings:["ai_translation_locale_detector_persona","ai_translation_post_raw_translator_persona","ai_translation_topic_title_translator_persona","ai_translation_short_text_translator_persona"]},{key:"backfill_and_limits",titleKey:"discourse_ai.features.translation.setting_groups.backfill_and_limits",settings:["ai_translation_backfill_hourly_rate","ai_translation_backfill_limit_to_public_content","ai_translation_max_post_length","ai_translation_backfill_max_age_days","ai_translation_max_tokens_multiplier","ai_translation_verbose_logs"]}],discord:[{key:"settings",titleKey:"discourse_ai.features.discord.setting_groups.settings",settings:["ai_discord_search_enabled","ai_discord_search_mode","ai_discord_search_persona"]},{key:"discord_configuration",titleKey:"discourse_ai.features.discord.setting_groups.discord_configuration",settings:["ai_discord_app_id","ai_discord_app_public_key","ai_discord_allowed_guilds"]}],inference:[{key:"settings",titleKey:"discourse_ai.features.inference.setting_groups.settings",settings:["inferred_concepts_enabled"]},{key:"topic_criteria",titleKey:"discourse_ai.features.inference.setting_groups.topic_criteria",settings:["inferred_concepts_background_match","inferred_concepts_daily_topics_limit","inferred_concepts_min_posts","inferred_concepts_min_likes","inferred_concepts_min_views","inferred_concepts_lookback_days"]},{key:"post_criteria",titleKey:"discourse_ai.features.inference.setting_groups.post_criteria",settings:["inferred_concepts_daily_posts_limit","inferred_concepts_post_min_likes"]},{key:"personas",titleKey:"discourse_ai.features.inference.setting_groups.personas",settings:["inferred_concepts_generate_persona","inferred_concepts_match_persona","inferred_concepts_deduplicate_persona"]}]}}),define("discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions",["exports","@ember/owner","@ember/runloop","discourse-i18n"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.MIN_CHARACTER_COUNT=void 0,e.showSuggestionsError=function(e,o){(0,t.getOwner)(e).lookup("service:toasts").error({class:"ai-suggestion-error",duration:"long",showProgressBar:!0,data:{message:(0,i.i18n)("discourse_ai.ai_helper.suggest_errors.no_suggestions"),actions:[{label:(0,i.i18n)("discourse_ai.ai_helper.context_menu.regen"),icon:"rotate",class:"btn btn-small",action:async t=>{t.close(),await o(),e.dMenu?.show&&e.suggestions?.length>0&&(0,s.later)(()=>e.dMenu.show(),50)}}]}})}
e.MIN_CHARACTER_COUNT=40}),define("discourse/plugins/discourse-ai/discourse/lib/ai-streamer/progress-handlers",["exports","@ember/runloop","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/post-updater"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.MIN_LETTERS_PER_INTERVAL=void 0,e.addProgressDecoration=function(e){const t=function(e){const t=e.querySelector(".ai-thinking:last-child")
if(t){let e=t.nextSibling
for(;e&&e.nodeType===Node.TEXT_NODE&&!/\S/.test(e.textContent);)e=e.nextSibling
if(!e)return t}return null}(e)
t&&t.classList.add("in-progress")
let s=e
for(;;){let e=l(s)
if(!e)break
if(e.nodeType!==Node.ELEMENT_NODE)break
s=e}const i=document.createElement("span")
i.classList.add("progress-dot"),s.appendChild(i)},e.applyProgress=d,e.cleanupStreamingData=function(e){e.aiStreamingStatus=void 0},e.default=function(e,s,o){const n=new e(s,o)
r||(r=(0,t.later)(async()=>{await d(s,n),r=null,s.done||await d(s,n)},i))},e.streamPostText=function(e,t){if(t.noop)return;(e.aiStreamingStatus=e.aiStreamingStatus||{})[t.post_id]=t,u(e)}
const i=40,o=6e5,n=e.MIN_LETTERS_PER_INTERVAL=6,a=800
let r=null
function l(e){let t=e.lastChild
for(;t&&t.nodeType===Node.TEXT_NODE&&!/\S/.test(t.textContent);)t=t.previousSibling
return t}async function d(e,t){if(e.startTime=e.startTime||Date.now(),Date.now()-e.startTime>o)return t.streaming=!1,!0
if(!t.element)return!1
const s=t.raw
if(e.raw===s&&!e.done){if(t.element.querySelector(".progress-dot"))return!1}if(void 0!==e.raw){let o=e.raw
if(!e.done)if(0===s.length&&-1!==o.indexOf("</details>"))o=e.raw
else{const t=o.length-s.length
let r=Math.floor(t/(a/i))
r<n&&(r=n),o=e.raw.substring(0,s.length+r)}await t.setRaw(o,e.done)}return e.done&&(e.cooked&&await t.setCooked(e.cooked,!0),t.streaming=!1),e.done}function u(e){r||(r=(0,t.later)(async()=>{const t=await async function(e){const t=e.aiStreamingStatus
if(!t)return!1
let i=!1
const o=Object.keys(t).map(async o=>{let n=t[o]
const a=new s.default(e,n.post_id)
await d(n,a)?delete t[o]:i=!0})
return await Promise.all(o),i}(e)
r=null,t&&u(e)},i))}}),define("discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/post-updater",["exports","discourse/lib/load-morphlex","discourse/lib/plugin-api","discourse/lib/text","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/progress-handlers","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/stream-updater"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends n.default{morphingOptions={beforeAttributeUpdated:(e,t)=>!("DETAILS"===e.tagName&&"open"===t)}
constructor(e,t){super(),this.postStream=e,this.postId=t,this.post=e.findLoadedPost(t)
const s=e.topic.id
this.post&&(this.postElement=document.querySelector(`.topic-area[data-topic-id="${s}"] #post_${this.post.post_number}`))}get element(){return this.postElement}set streaming(e){this.postElement&&(e?this.postElement.classList.add("streaming"):this.postElement.classList.remove("streaming"))}async setRaw(e,t){this.post.set("raw",e)
const s=await(0,i.cook)(e)
this.element.classList.remove("streaming"),this.element.offsetWidth,this.element.classList.add("streaming")
const n=document.createElement("div")
n.innerHTML=s,t||(0,o.addProgressDecoration)(n),await this.setCooked(n.innerHTML,t)}async setCooked(e,i){this.postElement&&((0,s.withPluginApi)(e=>e.preventCloak(this.postId)),(await(0,t.default)()).morphInner(this.postElement.querySelector(".cooked"),`<div>${e}</div>`,this.morphingOptions),i&&(this.post.set("cooked",e),(0,s.withPluginApi)(e=>e.preventCloak(this.postId,!1))))}get raw(){return this.post.get("raw")||""}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/stream-updater",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{set streaming(e){throw"not implemented"}async setCooked(){throw"not implemented"}async setRaw(){throw"not implemented"}get element(){throw"not implemented"}get raw(){throw"not implemented"}}}),define("discourse/plugins/discourse-ai/discourse/lib/ai-topic-summary",["exports","@glimmer/tracking","discourse/lib/ajax","discourse/lib/formatter","discourse/lib/text","discourse/plugins/discourse-ai/discourse/lib/ai-errors"],function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a{static{dt7948.g(this.prototype,"text",[t.tracked],function(){return""})}#wt=void dt7948.i(this,"text")
static{dt7948.g(this.prototype,"summarizedOn",[t.tracked],function(){return null})}#St=void dt7948.i(this,"summarizedOn")
static{dt7948.g(this.prototype,"summarizedBy",[t.tracked],function(){return null})}#xt=void dt7948.i(this,"summarizedBy")
static{dt7948.g(this.prototype,"newPostsSinceSummary",[t.tracked],function(){return null})}#kt=void dt7948.i(this,"newPostsSinceSummary")
static{dt7948.g(this.prototype,"outdated",[t.tracked],function(){return!1})}#Tt=void dt7948.i(this,"outdated")
static{dt7948.g(this.prototype,"canRegenerate",[t.tracked],function(){return!1})}#Ct=void dt7948.i(this,"canRegenerate")
static{dt7948.g(this.prototype,"regenerated",[t.tracked],function(){return!1})}#Ps=void dt7948.i(this,"regenerated")
static{dt7948.g(this.prototype,"showSummaryBox",[t.tracked],function(){return!1})}#Ms=void dt7948.i(this,"showSummaryBox")
static{dt7948.g(this.prototype,"canCollapseSummary",[t.tracked],function(){return!1})}#js=void dt7948.i(this,"canCollapseSummary")
static{dt7948.g(this.prototype,"loadingSummary",[t.tracked],function(){return!1})}#As=void dt7948.i(this,"loadingSummary")
processUpdate(e){const t=e.ai_topic_summary
return(0,o.cook)(t.summarized_text).then(e=>{this.text=e,this.loading=!1}).then(()=>{e.done&&(this.summarizedOn=(0,i.shortDateNoYear)(t.summarized_on),this.summarizedBy=t.algorithm,this.newPostsSinceSummary=t.new_posts_since_summary,this.outdated=t.outdated,this.newPostsSinceSummary=t.new_posts_since_summary,this.canRegenerate=t.outdated&&t.can_regenerate)})}collapse(){this.showSummaryBox=!1,this.canCollapseSummary=!1}generateSummary(e,t){if(this.showSummaryBox=!0,this.text&&!this.canRegenerate)return void(this.canCollapseSummary=!1)
let i=`/discourse-ai/summarization/t/${t}?`
return e&&(i+="stream=true",this.canRegenerate&&(i+="&skip_age_check=true")),this.loading=!0,(0,s.ajax)(i).then(t=>{e||(t.done=!0,this.processUpdate(t))}).catch(e=>{if(this.loading=!1,!(0,n.isAiCreditLimitError)(e))throw e;(0,n.popupAiCreditLimitError)(e)})}}e.default=a}),define("discourse/plugins/discourse-ai/discourse/lib/copy-conversation",["exports","discourse/lib/ajax","discourse/lib/utilities","discourse-i18n"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(e,o,n){await(0,s.clipboardCopyAsync)(async()=>{const s=await async function(e,s,o){const n=e.get("postStream")
let a=[]
for(let t=s;t<=o;t++)a.push(t)
const r=a.map(e=>n.findPostIdForPostNumber(e)),l=`/t/${e.id}/posts.json`,d={post_ids:r,include_raw:!0},u=await(0,t.ajax)(l,{data:d})
let c=[]
c.push("<details class='ai-quote'>"),c.push("<summary>"),c.push(`<span>${e.title}</span>`),c.push(`<span title='${(0,i.i18n)("discourse_ai.ai_bot.ai_title")}'>${(0,i.i18n)("discourse_ai.ai_bot.ai_label")}</span>`),c.push("</summary>"),u.post_stream.posts.forEach(e=>{c.push(""),c.push(`**${e.username}:**`),c.push(""),c.push(e.raw)}),c.push("</details>")
const p=c.join("\n")
return p}(e,o,n)
return new Blob([s],{type:"text/plain"})})}}),define("discourse/plugins/discourse-ai/discourse/lib/diff-streamer",["exports","@glimmer/tracking","@ember/runloop","discourse/lib/load-js-diff","discourse/lib/utilities"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n{static{dt7948.g(this.prototype,"isStreaming",[t.tracked],function(){return!1})}#Ls=void dt7948.i(this,"isStreaming")
static{dt7948.g(this.prototype,"words",[t.tracked],function(){return[]})}#Es=void dt7948.i(this,"words")
static{dt7948.g(this.prototype,"lastResultText",[t.tracked],function(){return""})}#Rs=void dt7948.i(this,"lastResultText")
static{dt7948.g(this.prototype,"diff",[t.tracked],function(){return this.selectedText})}#I=void dt7948.i(this,"diff")
static{dt7948.g(this.prototype,"suggestion",[t.tracked],function(){return""})}#Te=void dt7948.i(this,"suggestion")
static{dt7948.g(this.prototype,"isDone",[t.tracked],function(){return!1})}#Os=void dt7948.i(this,"isDone")
static{dt7948.g(this.prototype,"isThinking",[t.tracked],function(){return!0})}#Fs=void dt7948.i(this,"isThinking")
typingTimer=null
currentWordIndex=0
currentCharIndex=0
jsDiff=null
bufferedToken=null
rushMode=!1
rushBatchSize=1
rushTicksLeft=0
receivedFinalUpdate=!1
constructor(e,t){this.selectedText=e,this.typingDelay=t||10,this.loadJSDiff()}async loadJSDiff(){this.jsDiff=await(0,i.default)()}async updateResult(e,t){if(this.receivedFinalUpdate)return
this.jsDiff||await this.loadJSDiff(),this.isThinking=!1
const i=e[t]
if(!!e?.done){this.receivedFinalUpdate=!0,this.typingTimer&&((0,s.cancel)(this.typingTimer),this.typingTimer=null),this.bufferedToken&&(this.words.push(this.bufferedToken),this.bufferedToken=null)
const e=i.slice(this.lastResultText.length)
e.length&&this.words.push(...this.#Is(e))
const t=i.length-this.suggestion.length
return t<=0?(this.suggestion=i,this.diff=this.#Ds(this.jsDiff.diffWordsWithSpace(this.selectedText,i),!1),this.isStreaming=!1,void(this.isDone=!0)):(this.rushBatchSize=Math.ceil(t/10),this.rushTicksLeft=10,this.rushMode=!0,this.isStreaming=!0,this.lastResultText=i,void this.#Ns())}const o=i.slice(this.lastResultText.length)
if(!o)return void(this.lastResultText=i)
const n=(this.bufferedToken||"")+o,a=this.#Is(n)
this.bufferedToken=a.pop()||null,a.length&&this.words.push(...a),this.isStreaming=!0,this.typingTimer||this.#Ns(),this.lastResultText=i}reset(){this.diff="",this.suggestion="",this.lastResultText="",this.words=[],this.currentWordIndex=0,this.currentCharIndex=0,this.bufferedToken=null,this.isStreaming=!1,this.isDone=!1,this.receivedFinalUpdate=!1,this.isThinking=!0,this.rushMode=!1,this.rushBatchSize=1,this.rushTicksLeft=0,this.typingTimer&&((0,s.cancel)(this.typingTimer),this.typingTimer=null)}streamingDiff(e,t){const s=Math.floor(t.length+.1*t.length+10),i=e.slice(0,s),o=e.slice(s),n=this.jsDiff.diffWordsWithSpace(i,t)
if(o.length){let e=n.at(-1),t=n.at(-2)
e.added&&t?.removed&&(n.splice(-2,2,e,t),e=t),e.removed||(e={added:!1,removed:!0,value:""},n.push(e)),e.value+=o}return n}#Ns(){if(!this.isStreaming)return
const e=this.rushMode?this.rushBatchSize:1
let t=0
for(;t<e&&this.currentWordIndex<this.words.length;){const e=this.words[this.currentWordIndex]
this.suggestion+=e.charAt(this.currentCharIndex),this.currentCharIndex++,t++,this.currentCharIndex>=e.length&&(this.currentWordIndex++,this.currentCharIndex=0)}let i=!1
if(this.rushMode?this.rushTicksLeft>0&&(this.rushTicksLeft--,i=!0):i=0===this.currentCharIndex,i||this.currentWordIndex>=this.words.length){const e=this.currentWordIndex<this.words.length||this.rushMode
this.diff=this.#Ds(e?this.streamingDiff(this.selectedText,this.suggestion):this.jsDiff.diffWordsWithSpace(this.selectedText,this.suggestion),!this.rushMode)}if(this.currentWordIndex>=this.words.length)this.isStreaming=!1,this.rushMode=!1,this.typingTimer=null,this.receivedFinalUpdate&&(this.isDone=!0)
else{const e=this.rushMode?100:this.typingDelay
this.typingTimer=(0,s.later)(this,this.#Ns,e)}}#Is(e){return e.split(/(?<=\S)(?=\s)/)}#Us(e,t){return"added"===t?`<ins>${e}</ins>`:"removed"===t?/^\s+$/.test(e)?"":`<del>${e}</del>`:`<span>${e}</span>`}#Ds(e,t=!0){const s=[]
e.forEach(e=>(e.value.match(/\S+|\s+/g)||[]).forEach(t=>s.push({text:t,type:e.added?"added":e.removed?"removed":"unchanged"})))
let i=-1
if(t)for(let o=s.length-1;o>=0;o--)if("removed"!==s[o].type&&/\S/.test(s[o].text)){i=o
break}const n=[]
for(let a=0;a<=i;a++){let{text:e,type:r}=s[a]
if(e=(0,o.escapeExpression)(e),/^\s+$/.test(e)){n.push(e)
continue}let l=this.#Us(e,r)
t&&a===i&&(l=`<mark class="highlight">${l}</mark>`),n.push(l)}for(let a=i+1;a<s.length;){const e=s[a].type
let t=""
for(;a<s.length&&s[a].type===e;)t+=s[a++].text
n.push(this.#Us((0,o.escapeExpression)(t),e))}return n.join("")}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/lib/show-ai-helper",["exports"],function(e){"use strict"
function t(e){return e.discourse_ai_enabled&&e.ai_helper_enabled}Object.defineProperty(e,"__esModule",{value:!0}),e.showComposerAiHelper=function(e,s,i,o){const n=t(s),a=i.can_use_assistant,r=s.ai_helper_allowed_in_pm,l=s.ai_helper_enabled_features.includes(o)
if(e?.privateMessage)return n&&a&&r&&l
return n&&a&&l},e.showPostAIHelper=function(e,s){return t(s.siteSettings)&&s.currentUser?.can_use_assistant_in_post}}),define("discourse/plugins/discourse-ai/discourse/lib/smooth-streamer",["exports","@glimmer/tracking","@ember/runloop"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i{static{dt7948.g(this.prototype,"isStreaming",[t.tracked],function(){return!1})}#Ls=void dt7948.i(this,"isStreaming")
static{dt7948.g(this.prototype,"streamedText",[t.tracked],function(){return""})}#qs=void dt7948.i(this,"streamedText")
typingTimer=null
streamedTextLength=0
constructor(e,t,s){this.getRealtimeText=e,this.setRealtimeText=t,this.typingDelay=s||15}get renderedText(){return this.isStreaming?this.streamedText:this.realtimeText}get realtimeText(){return this.getRealtimeText()}set realtimeText(e){this.setRealtimeText(e)}resetStreaming(){this.#Bs(),this.isStreaming=!1,this.streamedText="",this.streamedTextLength=0}async updateResult(e,t){const s=e[t]
e?.done?(this.streamedText=s,this.realtimeText=s,this.isStreaming=!1,this.#Bs()):s.length>this.realtimeText.length&&(this.realtimeText=s,this.isStreaming=!0,await this.#zs())}#Vs(){this.streamedTextLength<this.realtimeText.length?(this.streamedText+=this.realtimeText.charAt(this.streamedTextLength),this.streamedTextLength++,this.typingTimer=(0,s.later)(this,this.#Vs,this.typingDelay)):this.typingTimer=null}#zs(){this.#Bs(),this.#Vs()}#Bs(){this.typingTimer&&(0,s.cancel)(this.typingTimer)}}e.default=i}),define("discourse/plugins/discourse-ai/discourse/lib/utilities",["exports","@ember/template","discourse/lib/utilities"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.jsonToHtml=function e(i){if(null===i)return"null"
if("object"!=typeof i)return(0,s.escapeExpression)(i)
let o="<ul>"
for(let[t,n]of Object.entries(i))o+="<li>",t=(0,s.escapeExpression)(t),"object"==typeof n&&Array.isArray(n)?o+=`<strong>${t}:</strong> ${e(n)}`:"object"==typeof n?o+=`<strong>${t}:</strong> <ul><li>${e(n)}</li></ul>`:("string"==typeof n&&(n=(0,s.escapeExpression)(n).replace(/\n/g,"<br>")),o+=`<strong>${t}:</strong> ${n}`),o+="</li>"
return o+="</ul>",(0,t.htmlSafe)(o)},e.toPlainObject=function(e){if(!e)return e
return JSON.parse(JSON.stringify(e))}}),define("discourse/plugins/discourse-ai/discourse/routes/discourse-ai-bot-conversations",["exports","@ember/service","discourse/routes/discourse"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static{dt7948.g(this.prototype,"currentUser",[t.service])}#A=void dt7948.i(this,"currentUser")
beforeModel(e){this.currentUser||e.send("showLogin")}}e.default=i}),define("discourse/plugins/discourse-ai/discourse/routes/discourse-ai-shared-conversation-show",["exports","@ember/service","discourse/routes/discourse"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static{dt7948.g(this.prototype,"currentUser",[t.service])}#A=void dt7948.i(this,"currentUser")
beforeModel(e){this.currentUser?.user_option?.external_links_in_new_tab?window.open(e.intent.url,"_blank"):this.redirect(e.intent.url),e.abort()}redirect(e){window.location=e}}e.default=i}),define("discourse/plugins/discourse-ai/discourse/services/ai-bot-conversations-hidden-submit",["exports","@ember/object","@ember/runloop","@ember/service","@ember-compat/tracked-built-ins","discourse/lib/ajax","discourse/lib/uploads","discourse-i18n"],function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends i.default{static{dt7948.g(this.prototype,"appEvents",[i.service])}#j=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"composer",[i.service])}#Ue=void dt7948.i(this,"composer")
static{dt7948.g(this.prototype,"dialog",[i.service])}#H=void dt7948.i(this,"dialog")
static{dt7948.g(this.prototype,"router",[i.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"siteSettings",[i.service])}#l=void dt7948.i(this,"siteSettings")
static{dt7948.g(this.prototype,"loading",[o.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
personaId
targetUsername
inputValue=""
focusInput(){this.composer.destroyDraft(),this.composer.close(),(0,s.next)(()=>{document.getElementById("ai-bot-conversations-input").focus()})}static{dt7948.n(this.prototype,"focusInput",[t.action])}async submitToBot(e){if(this.inputValue.length<this.siteSettings.min_personal_message_post_length)return this.dialog.alert({message:(0,r.i18n)("discourse_ai.ai_bot.conversations.min_input_length_message",{count:this.siteSettings.min_personal_message_post_length}),didConfirm:()=>this.focusInput(),didCancel:()=>this.focusInput()})
if(e.inProgressUploadsCount>0)return this.dialog.alert({message:(0,r.i18n)("discourse_ai.ai_bot.conversations.uploads_in_progress")})
this.loading=!0
const t=(0,r.i18n)("discourse_ai.ai_bot.default_pm_prefix")
let s=this.inputValue
e.uploads&&e.uploads.length>0&&(s+="\n\n",e.uploads.forEach(e=>{const t=(0,a.getUploadMarkdown)(e)
s+=t+"\n"}))
try{const e=await(0,n.ajax)("/posts.json",{method:"POST",data:{raw:s,title:t,archetype:"private_message",target_recipients:this.targetUsername,meta_data:{ai_persona_id:this.personaId}}})
this.inputValue="",this.appEvents.trigger("discourse-ai:bot-pm-created",{id:e.topic_id,slug:e.topic_slug,title:t}),this.router.transitionTo(e.post_url)}finally{this.loading=!1}}static{dt7948.n(this.prototype,"submitToBot",[t.action])}}e.default=l}),define("discourse/plugins/discourse-ai/discourse/services/ai-conversations-sidebar-manager",["exports","@glimmer/tracking","@ember/runloop","@ember/service","@ember/template","@ember-compat/tracked-built-ins","discourse/lib/ajax","discourse/lib/debounce","discourse/lib/formatter","discourse/lib/sidebar/panels","discourse/lib/utilities","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-empty-state"],function(e,t,s,i,o,n,a,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.AI_CONVERSATIONS_PANEL=void 0
const m=e.AI_CONVERSATIONS_PANEL="ai-conversations",h="/discourse-ai/ai-bot/topic-titles"
class g extends i.default{static{dt7948.g(this.prototype,"appEvents",[i.service])}#j=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"sidebarState",[i.service])}#E=void dt7948.i(this,"sidebarState")
static{dt7948.g(this.prototype,"messageBus",[i.service])}#we=void dt7948.i(this,"messageBus")
static{dt7948.g(this.prototype,"routeHistory",[i.service])}#Hs=void dt7948.i(this,"routeHistory")
static{dt7948.g(this.prototype,"router",[i.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"topics",[t.tracked],function(){return[]})}#$s=void dt7948.i(this,"topics")
static{dt7948.g(this.prototype,"sections",[t.tracked],function(){return new n.TrackedArray})}#Gs=void dt7948.i(this,"sections")
static{dt7948.g(this.prototype,"isLoading",[t.tracked],function(){return!0})}#Mt=void dt7948.i(this,"isLoading")
api=null
isFetching=!1
page=0
hasMore=!0
_registered=new Set
_hasScrollListener=!1
_scrollElement=null
_didInit=!1
_debouncedScrollHandler=()=>{(0,r.default)(this,()=>{const e=this._scrollElement
if(!e)return
const{scrollTop:t,scrollHeight:s,clientHeight:i}=e
s-t-i-100<100&&!this.isFetching&&this.hasMore&&this.fetchMessages()},100)}
constructor(){super(...arguments),this.appEvents.on("discourse-ai:bot-pm-created",this,this._handleNewBotPM),this.appEvents.on("discourse-ai:conversations-sidebar-updated",this,this._attachScrollListener),this._watchForTitleUpdates()}willDestroy(){super.willDestroy(...arguments),this.appEvents.off("discourse-ai:bot-pm-created",this,this._handleNewBotPM),this.appEvents.off("discourse-ai:conversations-sidebar-updated",this,this._attachScrollListener),this.messageBus.unsubscribe(h)}addEmptyStateClass(){document.body.classList.toggle("has-empty-ai-conversations-sidebar",!this.topics.length)}forceCustomSidebar(){return document.body.classList.add("has-ai-conversations-sidebar"),this.sidebarState.isForcingSidebar||this.appEvents.trigger("discourse-ai:force-conversations-sidebar"),this.sidebarState.isForcingSidebar=!0,this.sidebarState.forcingSidebarPanel=m,this.sidebarState.setPanel(m),this.sidebarState.setSeparatedMode(),this.sidebarState.hideSwitchPanelButtons(),this._didInit?(this.addEmptyStateClass(),!0):(this._didInit=!0,this.fetchMessages().then(()=>{this.sidebarState.setPanel(m),this.addEmptyStateClass()}),!0)}_attachScrollListener(){const e=document.querySelector(".sidebar-sections.ai-conversations-panel")
this._scrollElement=e,!this._hasScrollListener&&this._scrollElement&&(e.addEventListener("scroll",this._debouncedScrollHandler),this._hasScrollListener=!0)}_removeScrollListener(){this._hasScrollListener&&(this._scrollElement.removeEventListener("scroll",this._debouncedScrollHandler),this._hasScrollListener=!1,this._scrollElement=null)}stopForcingCustomSidebar(){document.body.classList.remove("has-ai-conversations-sidebar"),document.body.classList.remove("has-empty-ai-conversations-sidebar")
const e=this.sidebarState.currentPanel?.key===m,t=this.sidebarState.forcingSidebarPanel===m
this.sidebarState.isForcingSidebar&&t&&(e&&this.sidebarState.setPanel(d.MAIN_PANEL),this.sidebarState.isForcingSidebar=!1,this.sidebarState.forcingSidebarPanel=null,this.appEvents.trigger("discourse-ai:stop-forcing-conversations-sidebar")),this._removeScrollListener()}get lastKnownAppURL(){return this.routeHistory.history.find(e=>!e.startsWith("/discourse-ai"))||this.router.urlFor(`discovery.${(0,u.defaultHomepage)()}`)}async fetchMessages(){if(this.isFetching||!this.hasMore)return
const e=0===this.page
this.isFetching=!0
try{let{conversations:t,meta:s}=await(0,a.ajax)("/discourse-ai/ai-bot/conversations.json",{data:{page:this.page,per_page:40}})
e?this.topics=t:(this.topics=[...this.topics,...t],this.sidebarState.setPanel(m)),this.page+=1,this.hasMore=s.has_more,this._rebuildSections()}finally{this.isFetching=!1,this.isLoading=!1}}_handleNewBotPM(e){this.topics=[e,...this.topics],this._rebuildSections()}_watchForTitleUpdates(){this.messageBus.subscribe(h,e=>{this._applyTitleUpdate(e.topic_id,e.title)})}_applyTitleUpdate(e,t){this.topics=this.topics.map(s=>s.id===e?{...s,title:t}:s),this._rebuildSections()}_rebuildSections(){const e=Date.now(),t=[],a={name:"today",title:(0,c.i18n)("discourse_ai.ai_bot.conversations.today"),links:new n.TrackedArray}
t.push(a),this.topics.forEach(s=>{const i=new Date(s.last_posted_at||e).valueOf(),o=Math.floor((e-i)/864e5)
let r,d
if(o<=1)r="today"
else if(o<=7)r="last-7-days"
else if(o<=30)r="last-30-days"
else{const e=new Date(i),t=`${e.getFullYear()}-${e.getMonth()}`
r=t}if(d="today"===r?a:t.find(e=>e.name===r),!d){let e
switch(r){case"last-7-days":e=(0,c.i18n)("discourse_ai.ai_bot.conversations.last_7_days")
break
case"last-30-days":e=(0,c.i18n)("discourse_ai.ai_bot.conversations.last_30_days")
break
default:e=(0,l.autoUpdatingRelativeAge)(new Date(s.last_posted_at))}d={name:r,title:e,links:new n.TrackedArray},t.push(d)}d.links.push({key:s.id,route:"topic.fromParamsNear",models:[s.slug,s.id,s.last_read_post_number||0],title:s.title,text:s.title,classNames:`ai-conversation-${s.id}`})}),this.sections=new n.TrackedArray(t)
for(let n of t)this._registered.has(n.name)||(this._registered.add(n.name),this.api.addSidebarSection(e=>class extends e{static{dt7948.g(this.prototype,"manager",[(0,i.service)("ai-conversations-sidebar-manager")])}#Ws=void dt7948.i(this,"manager")
static{dt7948.g(this.prototype,"events",[(0,i.service)("appEvents")])}#Ks=void dt7948.i(this,"events")
constructor(){super(...arguments),(0,s.scheduleOnce)("afterRender",this,this.triggerEvent)}triggerEvent(){this.events.trigger("discourse-ai:conversations-sidebar-updated")}get name(){return n.name}get title(){return n.title}get text(){return(0,o.htmlSafe)(n.title)}get links(){return this.manager.sections.find(e=>e.name===n.name)?.links||[]}get emptyStateComponent(){if(!this.manager.isLoading&&0===this.links.length)return p.default}},m))}}e.default=g}),define("discourse/plugins/discourse-ai/discourse/services/ai-credits",["exports","@ember/service","discourse/lib/ajax","discourse/plugins/discourse-ai/discourse/lib/ai-errors"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{static{dt7948.g(this.prototype,"currentUser",[t.service])}#A=void dt7948.i(this,"currentUser")
#Ys=new Map
async checkPersonaCredits(e){return(await this.#Js({persona_ids:e})).personas||{}}async checkFeatureCredits(e){return(await this.#Js({features:e})).features||{}}async isPersonaCreditAvailable(e){const t=(await this.checkPersonaCredits([e]))[e]
return t?.credit_status?.available??!0}async isFeatureCreditAvailable(e){const t=(await this.checkFeatureCredits([e]))[e]
return t?.credit_status?.available??!0}async getPersonaCreditStatus(e){const t=await this.checkPersonaCredits([e])
return t[e]?.credit_status||null}async getFeatureCreditStatus(e){const t=await this.checkFeatureCredits([e])
return t[e]?.credit_status||null}async checkLlmModelCredits(e){return(await this.#Js({llm_model_ids:e})).llm_models||{}}async getLlmModelCreditStatus(e){const t=await this.checkLlmModelCredits([e])
return t[e]?.credit_status||null}getCreditLimitMessage(e){const t=e?.reset_time_formatted||e?.reset_time_absolute
return(0,i.getAiCreditLimitMessage)({resetTime:t,isAdmin:this.currentUser?.admin})}async#Js(e){const t=JSON.stringify(e)
if(this.#Ys.has(t))return this.#Ys.get(t)
const i=(0,s.ajax)("/discourse-ai/credits/status",{type:"GET",data:e}).then(e=>(this.#Ys.delete(t),e)).catch(e=>{throw this.#Ys.delete(t),e})
return this.#Ys.set(t,i),i}}e.default=o}),define("discourse/plugins/discourse-ai/discourse/services/discobot-discoveries",["exports","@glimmer/tracking","@ember/object","@ember/runloop","@ember/service","discourse/lib/ajax","discourse/plugins/discourse-ai/discourse/lib/smooth-streamer"],function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends o.default{static{dt7948.g(this.prototype,"currentUser",[o.service])}#A=void dt7948.i(this,"currentUser")
static{dt7948.g(this.prototype,"discovery",[t.tracked],function(){return""})}#Qs=void dt7948.i(this,"discovery")
static{dt7948.g(this.prototype,"lastQuery",[t.tracked],function(){return""})}#Xs=void dt7948.i(this,"lastQuery")
static{dt7948.g(this.prototype,"discoveryTimedOut",[t.tracked],function(){return!1})}#Zs=void dt7948.i(this,"discoveryTimedOut")
static{dt7948.g(this.prototype,"modelUsed",[t.tracked],function(){return""})}#ei=void dt7948.i(this,"modelUsed")
static{dt7948.g(this.prototype,"loadingDiscoveries",[t.tracked],function(){return!1})}#ti=void dt7948.i(this,"loadingDiscoveries")
static{dt7948.g(this.prototype,"smoothStreamer",[t.tracked],function(){return new a.default(()=>this.discovery,e=>this.discovery=e)})}#Re=void dt7948.i(this,"smoothStreamer")
discoveryTimeout=null
async onDiscoveryUpdate(e){this.discoveryTimeout&&(0,i.cancel)(this.discoveryTimeout),this.discovery||(this.discovery=""),this.modelUsed=e.model_used,this.loadingDiscoveries=!1,this.smoothStreamer.updateResult(e,"ai_discover_reply")}resetDiscovery(){this.loadingDiscoveries=!1,this.discovery="",this.discoveryTimedOut=!1,this.modelUsed="",this.smoothStreamer.resetStreaming()}get showDiscoveryTitle(){return this.discovery.length>0||this.loadingDiscoveries||this.discoveryTimedOut}get isStreaming(){return this.smoothStreamer.isStreaming}get streamedText(){return this.smoothStreamer?.renderedText}async disableDiscoveries(){this.currentUser.user_option.ai_search_discoveries=!1,await this.currentUser.save(["ai_search_discoveries"]),location.reload()}static{dt7948.n(this.prototype,"disableDiscoveries",[s.action])}async triggerDiscovery(e){if(this.lastQuery!==e&&(this.resetDiscovery(),0!==e?.length)){this.loadingDiscoveries=!0,this.discoveryTimeout=(0,i.later)(this,this.timeoutDiscovery,2e4)
try{this.lastQuery=e,await(0,n.ajax)("/discourse-ai/discoveries/reply",{data:{query:e}})}catch{this.timeoutDiscovery()}}}static{dt7948.n(this.prototype,"triggerDiscovery",[s.action])}timeoutDiscovery(){this.discovery?.length>0||(this.loadingDiscoveries=!1,this.discovery="",this.discoveryTimedOut=!0)}}e.default=r}),define("discourse/plugins/discourse-ai/discourse/services/gists",["exports","@glimmer/tracking","@ember/service"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.TABLE_LAYOUT=e.TABLE_AI_LAYOUT=void 0
const i="topicListLayout",o="pmTopicListLayout"
e.TABLE_LAYOUT="table",e.TABLE_AI_LAYOUT="table-ai"
class n extends s.default{static{dt7948.g(this.prototype,"router",[s.service])}#e=void dt7948.i(this,"router")
static{dt7948.g(this.prototype,"preference",[t.tracked],function(){return this.#si()})}#ii=void dt7948.i(this,"preference")
#si(){const e=localStorage.getItem(o),t=localStorage.getItem(i)
return e&&!t?(localStorage.setItem(i,e),localStorage.removeItem(o),e):(e&&localStorage.removeItem(o),t)}get routerAttributes(){return this.router.currentRoute.attributes}get topics(){const e=this.routerAttributes?.list?.topics
if(e)return e
const t=this.routerAttributes?.topics
if(t)return t
const s=this.routerAttributes?.topic
if(!s)return null
const i=s.relatedTopics
if(i?.length)return i
const o=s.suggestedTopics
return o?.length?o:null}get showToggle(){return this.topics?.some(e=>e.ai_topic_gist)}get currentPreference(){return this.preference}setPreference(e){this.preference=e,localStorage.setItem(i,e)}}e.default=n}),define("discourse/plugins/discourse-ai/discourse/services/image-caption-popup",["exports","@glimmer/tracking","@ember/service","discourse/lib/uploads"],function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends s.default{static{dt7948.g(this.prototype,"composer",[s.service])}#Ue=void dt7948.i(this,"composer")
static{dt7948.g(this.prototype,"appEvents",[s.service])}#j=void dt7948.i(this,"appEvents")
static{dt7948.g(this.prototype,"showPopup",[t.tracked],function(){return!1})}#oi=void dt7948.i(this,"showPopup")
static{dt7948.g(this.prototype,"imageIndex",[t.tracked],function(){return null})}#ni=void dt7948.i(this,"imageIndex")
static{dt7948.g(this.prototype,"imageSrc",[t.tracked],function(){return null})}#ai=void dt7948.i(this,"imageSrc")
static{dt7948.g(this.prototype,"newCaption",[t.tracked],function(){return null})}#ri=void dt7948.i(this,"newCaption")
static{dt7948.g(this.prototype,"loading",[t.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"popupTrigger",[t.tracked],function(){return null})}#li=void dt7948.i(this,"popupTrigger")
static{dt7948.g(this.prototype,"_request",[t.tracked],function(){return null})}#di=void dt7948.i(this,"_request")
updateCaption(){const e=this.composer.model.reply.match(i.IMAGE_MARKDOWN_REGEX)
if(e){const t=e[this.imageIndex],s=t.replace(i.IMAGE_MARKDOWN_REGEX,`![${this.newCaption}|$2$3$4]($5)`)
t&&this.appEvents.trigger("composer:replace-text",t,s)}}toggleLoadingState(e){return e?(this.popupTrigger?.classList.add("disabled"),this.loading=!0):(this.popupTrigger?.classList.remove("disabled"),this.loading=!1)}}e.default=o}),define("discourse/plugins/discourse-ai/discourse/services/quick-search",["exports","@glimmer/tracking","@ember/service"],function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static{dt7948.g(this.prototype,"loading",[t.tracked],function(){return!1})}#ke=void dt7948.i(this,"loading")
static{dt7948.g(this.prototype,"invalidTerm",[t.tracked],function(){return!1})}#ui=void dt7948.i(this,"invalidTerm")}e.default=i}),define("discourse/plugins/discourse-ai/discourse/templates/admin/dashboard-sentiment",["exports","@ember/routing","discourse/admin/components/admin-report","discourse/admin/components/dashboard-period-selector","discourse/float-kit/components/d-tooltip","discourse/helpers/d-icon","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o,n,a,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"thTG8SJ+",block:'[[[10,0],[14,0,"sentiment section"],[12],[1,"\\n  "],[10,0],[14,0,"period-section"],[12],[1,"\\n    "],[10,0],[14,0,"section-title"],[12],[1,"\\n      "],[10,"h2"],[14,1,"sentiment-heading"],[12],[1,"\\n        "],[1,[28,[32,0],["discourse_ai.sentiments.dashboard.title"],null]],[1,"\\n      "],[13],[1,"\\n\\n      "],[8,[32,1],null,[["@period","@setPeriod","@startDate","@endDate","@setCustomDateRange"],[[30,1,["period"]],[30,1,["setPeriod"]],[30,1,["startDate"]],[30,1,["endDate"]],[30,1,["setCustomDateRange"]]]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n\\n  "],[10,0],[14,0,"section-body"],[12],[1,"\\n    "],[10,0],[14,0,"charts"],[12],[1,"\\n      "],[8,[32,2],null,[["@dataSourceName","@filters","@showHeader"],["overall_sentiment",[30,1,["filters"]],true]],null],[1,"\\n      "],[10,0],[14,0,"admin-report activity-metrics"],[12],[1,"\\n        "],[10,0],[14,0,"header"],[12],[1,"\\n          "],[10,"ul"],[14,0,"breadcrumb"],[12],[1,"\\n            "],[10,"li"],[14,0,"item report"],[12],[1,"\\n              "],[8,[32,3],[[24,0,"report-url"]],[["@route"],["adminReports"]],[["default"],[[[[1,"\\n                "],[1,[28,[32,0],["admin.dashboard.emotion.title"],null]],[1,"\\n              "]],[]]]]],[1,"\\n              "],[8,[32,4],null,[["@interactive"],["true"]],[["trigger","content"],[[[[1,"\\n                  "],[1,[28,[32,5],["circle-question"],null]],[1,"\\n                "]],[]],[[[1,"\\n                  "],[10,1],[12],[1,[28,[32,0],["admin.dashboard.emotion.description"],null]],[13],[1,"\\n                "]],[]]]]],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"report-body"],[12],[1,"\\n          "],[10,0],[14,0,"counters-list"],[12],[1,"\\n            "],[10,0],[14,0,"counters-header"],[12],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[13],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[32,0],["admin.dashboard.reports.today"],null]],[13],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[32,0],["admin.dashboard.reports.yesterday"],null]],[13],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[32,0],["admin.dashboard.reports.last_7_days"],null]],[13],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[32,0],["admin.dashboard.reports.last_30_days"],null]],[13],[1,"\\n            "],[13],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,1,["emotions"]]],null]],null],null,[[[1,"              "],[8,[32,2],null,[["@showHeader","@filters","@forcedModes","@dataSourceName"],[false,[30,1,["emotionFilters"]],"emotion",[29,["emotion_",[30,2]]]]],null],[1,"\\n"]],[2]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"],[13]],["@controller","metric"],["each","-track-array"]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/templates/admin/dashboard-sentiment.js",scope:()=>[a.i18n,i.default,s.default,t.LinkTo,o.default,n.default],isStrictMode:!0}),(0,d.default)(void 0,"dashboard-sentiment"))}),define("discourse/plugins/discourse-ai/discourse/templates/discourse-ai-bot-conversations",["exports","discourse/plugins/discourse-ai/discourse/components/ai-bot-conversations","@ember/component","@ember/template-factory","@ember/component/template-only"],function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,s.setComponentTemplate)((0,i.createTemplateFactory)({id:"D6ihxKXz",block:'[[[8,[32,0],null,[["@controller"],[[30,1]]],null]],["@controller"],[]]',moduleName:"/var/www/discourse/frontend/discourse/discourse/plugins/discourse-ai/discourse/templates/discourse-ai-bot-conversations.js",scope:()=>[t.default],isStrictMode:!0}),(0,o.default)(void 0,"discourse-ai-bot-conversations"))}),define("discourse/plugins/discourse-ai/lib/discourse-markdown/ai-tags",["exports"],function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.setup=function(e){e.allowList(["details[class=ai-quote]","details[class=ai-thinking]"]),e.allowList(["div[class=ai-artifact]","div[data-ai-artifact-id]","div[data-ai-artifact-version]","div[data-ai-artifact-autorun]","div[data-ai-artifact-height]","div[data-ai-artifact-width]"])}})

//# sourceMappingURL=discourse-ai-dd6d0264.map